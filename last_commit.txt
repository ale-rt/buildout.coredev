Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2017-10-26T20:27:44+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/b6c5d4e434920b3be7cdd5cc4447802b5302c33e

Fix dummy test FieldStorageStub to have a name attribute.

New ZPublisher HTTPRequest expects this.

Files changed:
M plone/formwidget/namedfile/widget.rst

diff --git a/plone/formwidget/namedfile/widget.rst b/plone/formwidget/namedfile/widget.rst
index d8303f2..df4be8e 100644
--- a/plone/formwidget/namedfile/widget.rst
+++ b/plone/formwidget/namedfile/widget.rst
@@ -123,6 +123,7 @@ Let's define a FieldStorage stub for easy use with the FileUpload::
   ...         self.file = file
   ...         self.headers = headers
   ...         self.filename = filename
+  ...         self.name = filename
 
 Now build a FileUpload::
 


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2017-10-26T20:29:40+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/5510211f90ae46d866268b03144bb2e7641633a3

FileUpload is an object, not an instance.

It is a proper 'new-style' class in Zope 4.

Files changed:
M plone/formwidget/namedfile/widget.rst

diff --git a/plone/formwidget/namedfile/widget.rst b/plone/formwidget/namedfile/widget.rst
index df4be8e..7918502 100644
--- a/plone/formwidget/namedfile/widget.rst
+++ b/plone/formwidget/namedfile/widget.rst
@@ -118,7 +118,7 @@ We can also handle file-upload objects::
 
 Let's define a FieldStorage stub for easy use with the FileUpload::
 
-  >>> class FieldStorageStub:
+  >>> class FieldStorageStub(object):
   ...     def __init__(self, file, headers={}, filename='foo.bar'):
   ...         self.file = file
   ...         self.headers = headers
@@ -134,12 +134,12 @@ Now build a FileUpload::
   >>> file_widget.request = make_request(form={'widget.name.file': myUpload})
   >>> file_widget.update()
   >>> file_widget.extract()
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
   >>> image_widget.request = make_request(form={'widget.name.image': myUpload})
   >>> image_widget.update()
   >>> image_widget.extract()
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
 The rendering is unchanged::
 
@@ -288,7 +288,7 @@ empty, the behaviour is the same as before::
   >>> file_widget.request = make_request(form={'widget.name.file': myUpload})
   >>> file_widget.update()
   >>> file_widget.extract()
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
 Set the current image, which is shown as thumb on the page, and then
 setup the widget with a new value::
@@ -299,7 +299,7 @@ setup the widget with a new value::
   >>> image_widget.request = make_request(form={'widget.name.image': myUpload})
   >>> image_widget.update()
   >>> image_widget.extract()
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
 If the widgets are rendered again, the newly uploaded files will be shown::
 
@@ -653,7 +653,7 @@ Let's upload data::
   >>> file_widget.update()
   >>> uploaded = file_widget.extract()
   >>> uploaded
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
   >>> content.file_field = ascii_file_converter.toFieldValue(uploaded)
   >>> content.file_field
@@ -671,7 +671,7 @@ Check that we have a good image that PIL can handle:
   >>> image_widget.update()
   >>> uploaded = image_widget.extract()
   >>> uploaded
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
   >>> content.image_field = ascii_image_converter.toFieldValue(uploaded)
   >>> print(content.image_field)
@@ -728,7 +728,7 @@ Now overwrite with other data::
   >>> file_widget.update()
   >>> uploaded = file_widget.extract()
   >>> uploaded
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
   >>> content.file_field = ascii_file_converter.toFieldValue(uploaded)
   >>> content.file_field
@@ -743,7 +743,7 @@ Now overwrite with other data::
   >>> image_widget.update()
   >>> uploaded = image_widget.extract()
   >>> uploaded
-  <ZPublisher.HTTPRequest.FileUpload instance at ...>
+  <ZPublisher.HTTPRequest.FileUpload object at ...>
 
   >>> content.image_field = ascii_file_converter.toFieldValue(uploaded)
   >>> content.image_field


