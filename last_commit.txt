Repository: plone.app.caching


Branch: refs/heads/1.1.x
Date: 2016-03-03T18:14:31+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/2cac5167dcd965a9b1a4e12d7e93d470a81fe60b

Show status after synchronous purge if it is an error status.

I had a misconfiguration, where all purge requests were denied by
varnish because my ip address was not in the allowed list.  This gave
a status 504 on all purge requests, but this was nowhere visible.  The
controlpanel only showed 'The following items were purged:' with the
list I expected, no errors.

Files changed:
M CHANGES.rst
M plone/app/caching/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f272633..d7852bd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,14 @@ Changelog
 1.1.11 (unreleased)
 ~~~~~~~~~~~~~~~~~~~
 
-- Nothing changed yet.
+New:
+
+- Show status after synchronous purge if it is an error status.
+  [maurits]
+
+Fixes:
+
+- *add item here*
 
 
 1.1.10 (2015-06-09)
diff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py
index 987ddca..ef3137e 100644
--- a/plone/app/caching/browser/controlpanel.py
+++ b/plone/app/caching/browser/controlpanel.py
@@ -535,6 +535,8 @@ def purge(url):
                     log += " (X-Cache header: " + xcache + ")"
                 if xerror:
                     log += " -- " + xerror
+                if not str(status).startswith('2'):
+                    log += " -- WARNING status " + str(status)
                 self.purgeLog.append(log)
             else:
                 purger.purgeAsync(url)


Repository: plone.app.caching


Branch: refs/heads/1.1.x
Date: 2016-03-13T21:55:34+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/48be95e50aaedb82be496f460d9e94746655d4f6

Merge pull request #24 from plone/maurits-report-purge-error-status-43

Show status after synchronous purge if it is an error status. Branch 1.1.x

Files changed:
M CHANGES.rst
M plone/app/caching/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f272633..d7852bd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,14 @@ Changelog
 1.1.11 (unreleased)
 ~~~~~~~~~~~~~~~~~~~
 
-- Nothing changed yet.
+New:
+
+- Show status after synchronous purge if it is an error status.
+  [maurits]
+
+Fixes:
+
+- *add item here*
 
 
 1.1.10 (2015-06-09)
diff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py
index 987ddca..ef3137e 100644
--- a/plone/app/caching/browser/controlpanel.py
+++ b/plone/app/caching/browser/controlpanel.py
@@ -535,6 +535,8 @@ def purge(url):
                     log += " (X-Cache header: " + xcache + ")"
                 if xerror:
                     log += " -- " + xerror
+                if not str(status).startswith('2'):
+                    log += " -- WARNING status " + str(status)
                 self.purgeLog.append(log)
             else:
                 purger.purgeAsync(url)


