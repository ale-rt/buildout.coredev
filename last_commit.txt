Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-08-24T17:29:59+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/2fbdb1e5f35876d434991eaae14d494edb8431c8

TTW behaviors selection of the name is now bound to the registration

Files changed:
M CHANGES.rst
M plone/app/dexterity/browser/behaviors.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 34aa1fa..e37544e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,10 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- TTW behaviors selection of the name is now bound to the registration,
+  prior it was bound to the interface.
+  But interfaces may be used by more than one registered behavior.
+  [jensens]
 
 
 2.3.2 (2016-08-12)
diff --git a/plone/app/dexterity/browser/behaviors.py b/plone/app/dexterity/browser/behaviors.py
index 7c193b9..905f8f2 100644
--- a/plone/app/dexterity/browser/behaviors.py
+++ b/plone/app/dexterity/browser/behaviors.py
@@ -91,14 +91,14 @@ def getContent(self):
     @property
     def fields(self):
         counts = Counter(
-            [reg.interface for name, reg in getUtilitiesFor(IBehavior)]
+            [id(reg) for name, reg in getUtilitiesFor(IBehavior)]
         )
         fields = []
         for name, reg in getUtilitiesFor(IBehavior):
             if name in TTW_BEHAVIOR_BLACKLIST:
                 # skip blacklisted
                 continue
-            with_name = counts[reg.interface] == 2
+            with_name = counts[id(reg)] > 1
             if with_name and reg.name != name:
                 continue
             fname = reg.name if reg.name else name


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-08-24T19:45:11+02:00
Author: Robert Niederreiter (rnixx) <office@squarewave.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/d15ba38019e1c325e53bd8a6a5df4c36ddf7e330

Merge pull request #225 from plone/fix-behaviors-form

TTW behaviors selection of the name is now bound to the registration

Files changed:
M CHANGES.rst
M plone/app/dexterity/browser/behaviors.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 34aa1fa..e37544e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,10 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- TTW behaviors selection of the name is now bound to the registration,
+  prior it was bound to the interface.
+  But interfaces may be used by more than one registered behavior.
+  [jensens]
 
 
 2.3.2 (2016-08-12)
diff --git a/plone/app/dexterity/browser/behaviors.py b/plone/app/dexterity/browser/behaviors.py
index 7c193b9..905f8f2 100644
--- a/plone/app/dexterity/browser/behaviors.py
+++ b/plone/app/dexterity/browser/behaviors.py
@@ -91,14 +91,14 @@ def getContent(self):
     @property
     def fields(self):
         counts = Counter(
-            [reg.interface for name, reg in getUtilitiesFor(IBehavior)]
+            [id(reg) for name, reg in getUtilitiesFor(IBehavior)]
         )
         fields = []
         for name, reg in getUtilitiesFor(IBehavior):
             if name in TTW_BEHAVIOR_BLACKLIST:
                 # skip blacklisted
                 continue
-            with_name = counts[reg.interface] == 2
+            with_name = counts[id(reg)] > 1
             if with_name and reg.name != name:
                 continue
             fname = reg.name if reg.name else name


