Repository: Products.CMFDiffTool


Branch: refs/heads/2.1.x
Date: 2016-04-15T21:57:44+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFDiffTool/commit/853839d4059db96ad8949c32b4160018238eef77

Revert "Merge pull request #16 from plone/davisagli-inline-diff"

This reverts commit e0d36e48e4f85d3b0bea0221e1880d150820b603, reversing
changes made to d5ad6f97b595ad2db40608825ca3ab7c7a0a804f.

I have kept those commits on the new 2.2.x branch, since this is a new
feature and we are starting to use semantic versioning more.

I could also have chosen to create a 2.x branch, which leaves more
room for new features without needing to create yet another branch,
but I don't think many new things are coming in.

Files changed:
M CHANGES.rst
M Products/CMFDiffTool/FieldDiff.py
M Products/CMFDiffTool/tests/testListDiff.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7801c91..2fe23df 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,8 +4,7 @@ Changelog
 2.1.3 (unreleased)
 ------------------
 
-- Add generic `inline_diff` implementation for FieldDiff.
-  [davisagli]
+- Nothing changed yet.
 
 
 2.1.2 (2015-09-28)
diff --git a/Products/CMFDiffTool/FieldDiff.py b/Products/CMFDiffTool/FieldDiff.py
index b044a04..cb29baa 100644
--- a/Products/CMFDiffTool/FieldDiff.py
+++ b/Products/CMFDiffTool/FieldDiff.py
@@ -1,21 +1,13 @@
 # -*- coding: utf-8 -*-
 import difflib
 from App.class_init import InitializeClass
-from os import linesep
 from Products.CMFDiffTool.BaseDiff import BaseDiff, _getValue
 
-
 class FieldDiff(BaseDiff):
     """Text difference"""
 
     meta_type = "Field Diff"
 
-    same_fmt = """<div class="%s">%s</div>"""
-    inlinediff_fmt = """<div class="%s">
-    <div class="diff_sub">%s</div>
-    <div class="diff_add">%s</div>
-</div>"""
-
     def _parseField(self, value, filename=None):
         """Parse a field value in preparation for diffing"""
         if filename is None:
@@ -64,33 +56,6 @@ def ndiff(self):
                 raise ValueError, 'unknown tag ' + `tag`
         return '\n'.join(r)
 
-    def inline_diff(self):
-        css_class = 'InlineDiff'
-        inlinediff_fmt = self.inlinediff_fmt
-        same_fmt = self.same_fmt
-        r=[]
-        a = self._parseField(self.oldValue, filename=self.oldFilename)
-        b = self._parseField(self.newValue, filename=self.newFilename)
-        for tag, alo, ahi, blo, bhi in self.getLineDiffs():
-            if tag == 'replace':
-                for i in xrange(alo, ahi):
-                    r.append(inlinediff_fmt % (css_class, a[i], ''))
-                for i in xrange(blo, bhi):
-                    r.append(inlinediff_fmt % (css_class, '', b[i]))
-            elif tag == 'delete':
-                for i in xrange(alo, ahi):
-                    r.append(inlinediff_fmt % (css_class, a[i], ''))
-            elif tag == 'insert':
-                for i in xrange(blo, bhi):
-                    r.append(inlinediff_fmt % (css_class, '', b[i]))
-            elif tag == 'equal':
-                for i in xrange(alo, ahi):
-                    r.append(same_fmt % (css_class, a[i]))
-            else:
-                raise ValueError('unknown tag ' + `tag`)
-        return '\n'.join(r)
-
-
 InitializeClass(FieldDiff)
 
 
diff --git a/Products/CMFDiffTool/tests/testListDiff.py b/Products/CMFDiffTool/tests/testListDiff.py
index 6fc25f3..bf26a99 100644
--- a/Products/CMFDiffTool/tests/testListDiff.py
+++ b/Products/CMFDiffTool/tests/testListDiff.py
@@ -66,18 +66,7 @@ def testDiffText(self):
         diff = ListDiff(a, b, 'attribute')
         self.assertEqual(diff.ndiff(), expected)
 
-    def test_inline_diff(self):
-        a = A()
-        b = B()
-        expected = """<div class="InlineDiff">1</div>
-<div class="InlineDiff">2</div>
-<div class="InlineDiff">3</div>
-<div class="InlineDiff">
-    <div class="diff_sub"></div>
-    <div class="diff_add">4</div>
-</div>"""
-        diff = ListDiff(a, b, 'attribute')
-        self.assertEqual(diff.inline_diff(), expected)
+        # FIXME: need tests for other kinds of diffs
 
 
 def test_suite():
@@ -85,3 +74,4 @@ def test_suite():
     suite = unittest.TestSuite()
     suite.addTest(unittest.makeSuite(TestListDiff))
     return suite
+


