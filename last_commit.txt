Repository: plone.portlet.collection


Branch: refs/heads/2.1.x
Date: 2015-12-07T11:22:11+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.collection/commit/0ed9c53d907c2f1c3ccaf29e451757d8eaed71fa

Fixed sometimes failing test due to sorting.

Sorting on 'created' could give wrong results,
because the four items of this test are probably created in the same second,
which means the order might be wrong.
On Jenkins number 3 and 0 were in the list, instead of the expected 0 and 1.

Files changed:
M CHANGES.txt
M plone/portlet/collection/tests/test_portlet_collection.py

diff --git a/CHANGES.txt b/CHANGES.txt
index 1fd3c3b..35617f5 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed sometimes failing test due to sorting.
+  [maurits]
 
 
 2.1.9 (2015-10-30)
diff --git a/plone/portlet/collection/tests/test_portlet_collection.py b/plone/portlet/collection/tests/test_portlet_collection.py
index 585a763..518fddf 100644
--- a/plone/portlet/collection/tests/test_portlet_collection.py
+++ b/plone/portlet/collection/tests/test_portlet_collection.py
@@ -333,7 +333,7 @@ def test_exclude_context(self):
             'i': 'portal_type',
             'o': 'plone.app.querystring.operation.string.is',
             'v': 'News Item'}]
-        self.folder.collection.sort_on = 'created'
+        self.folder.collection.sort_on = 'id'
         context = self.folder['foo-news-item-title-1']
         included = [
             self.folder['foo-news-item-title-{0}'.format(idx)].absolute_url()


