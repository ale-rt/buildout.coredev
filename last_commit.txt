Repository: plone.api


Branch: refs/heads/master
Date: 2016-11-21T16:23:26+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.api/commit/ca93dfadd0462899431989057b1d7ee2415da195

Fix PRINTINGMAILHOST_ENABLED evaluation

Files changed:
M docs/CHANGES.rst
M src/plone/api/portal.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index a4604b4..1da6547 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -43,6 +43,10 @@ Fixes:
 - Fix test
   [gforcada]
 
+- Fix PRINTINGMAILHOST_ENABLED evaluation to respect Products.PrintingMailHost
+  internal logic
+  [ale-rt]
+
 1.5 (2016-02-20)
 ----------------
 
diff --git a/src/plone/api/portal.py b/src/plone/api/portal.py
index 50228f6..5a4981d 100644
--- a/src/plone/api/portal.py
+++ b/src/plone/api/portal.py
@@ -35,15 +35,24 @@
     )
 
 try:
-    pkg_resources.get_distribution('Products.PrintingMailHost')
-except pkg_resources.DistributionNotFound:
+    from Products import PrintingMailHost
+except ImportError:
+    PrintingMailHost = None
+
+if not PrintingMailHost:
     PRINTINGMAILHOST_ENABLED = False
+elif (
+    PrintingMailHost.ENABLED is not None and
+    PrintingMailHost.ENABLED.lower() in PrintingMailHost.TRUISMS
+):
+    PRINTINGMAILHOST_ENABLED = True
+elif (
+    PrintingMailHost.ENABLED is None and
+    PrintingMailHost.DevelopmentMode is True
+):
+    PRINTINGMAILHOST_ENABLED = True
 else:
-    # PrintingMailHost only patches in debug mode.
-    # plone.api.env.debug_mode cannot be used here, because .env imports this
-    # file
-    import Globals
-    PRINTINGMAILHOST_ENABLED = Globals.DevelopmentMode
+    PRINTINGMAILHOST_ENABLED = False
 
 MISSING = object()
 


Repository: plone.api


Branch: refs/heads/master
Date: 2016-11-24T01:06:10+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.api/commit/51c246e174025ca54ab7141aecb1e5849ba3601f

Merge pull request #337 from plone/fix-printingmailhost

Fix PRINTINGMAILHOST_ENABLED evaluation

Files changed:
M docs/CHANGES.rst
M src/plone/api/portal.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index a4604b4..1da6547 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -43,6 +43,10 @@ Fixes:
 - Fix test
   [gforcada]
 
+- Fix PRINTINGMAILHOST_ENABLED evaluation to respect Products.PrintingMailHost
+  internal logic
+  [ale-rt]
+
 1.5 (2016-02-20)
 ----------------
 
diff --git a/src/plone/api/portal.py b/src/plone/api/portal.py
index 50228f6..5a4981d 100644
--- a/src/plone/api/portal.py
+++ b/src/plone/api/portal.py
@@ -35,15 +35,24 @@
     )
 
 try:
-    pkg_resources.get_distribution('Products.PrintingMailHost')
-except pkg_resources.DistributionNotFound:
+    from Products import PrintingMailHost
+except ImportError:
+    PrintingMailHost = None
+
+if not PrintingMailHost:
     PRINTINGMAILHOST_ENABLED = False
+elif (
+    PrintingMailHost.ENABLED is not None and
+    PrintingMailHost.ENABLED.lower() in PrintingMailHost.TRUISMS
+):
+    PRINTINGMAILHOST_ENABLED = True
+elif (
+    PrintingMailHost.ENABLED is None and
+    PrintingMailHost.DevelopmentMode is True
+):
+    PRINTINGMAILHOST_ENABLED = True
 else:
-    # PrintingMailHost only patches in debug mode.
-    # plone.api.env.debug_mode cannot be used here, because .env imports this
-    # file
-    import Globals
-    PRINTINGMAILHOST_ENABLED = Globals.DevelopmentMode
+    PRINTINGMAILHOST_ENABLED = False
 
 MISSING = object()
 


