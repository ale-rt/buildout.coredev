Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2017-03-31T13:25:43+02:00
Author: root (fgrcon) <franz@fgrcon.net>
Commit: https://github.com/plone/plone.app.vocabularies/commit/ff8cd53dd26f2c6a63b35fccf4ab0bbf9c9c5f99

return empty vocabulary when no imagescales defined

Files changed:
M CHANGES.rst
M plone/app/vocabularies/images.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 37380ff..47e77b8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- return empty vocabulary when no imagescales defined
+  [fgrcon]
 
 
 4.0.2 (2017-03-29)
diff --git a/plone/app/vocabularies/images.py b/plone/app/vocabularies/images.py
index 84ce72a..f2d75fb 100644
--- a/plone/app/vocabularies/images.py
+++ b/plone/app/vocabularies/images.py
@@ -15,11 +15,12 @@ def ScalesVocabulary(context):
     """Obtains available scales from registry
     """
     terms = []
-    for scale, (width, height) in getAllowedSizes().iteritems():
-        translated = PMF(
-            'imagescale_{0:s}'.format(scale),
-            default='{0:s} ${{width}}x${{height}}'.format(scale),
-            mapping={'width': str(width), 'height': str(height)})
-        terms.append(SimpleTerm(scale, scale, translated))
-
+    allowedSizes = getAllowedSizes()
+    if allowedSizes is not None:
+        for scale, (width, height) in getAllowedSizes().iteritems():
+            translated = PMF(
+                'imagescale_{0:s}'.format(scale),
+                default='{0:s} ${{width}}x${{height}}'.format(scale),
+                mapping={'width': str(width), 'height': str(height)})
+            terms.append(SimpleTerm(scale, scale, translated))
     return SimpleVocabulary(terms)


Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2017-04-09T23:44:51+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.vocabularies/commit/8814f3acc94176d9612315d1b11d9a458cfbd8d8

Merge pull request #47 from plone/plip1734thumbs

	return empty vocabulary when no imagescales defined

Files changed:
M CHANGES.rst
M plone/app/vocabularies/images.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 37380ff..47e77b8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- return empty vocabulary when no imagescales defined
+  [fgrcon]
 
 
 4.0.2 (2017-03-29)
diff --git a/plone/app/vocabularies/images.py b/plone/app/vocabularies/images.py
index 84ce72a..f2d75fb 100644
--- a/plone/app/vocabularies/images.py
+++ b/plone/app/vocabularies/images.py
@@ -15,11 +15,12 @@ def ScalesVocabulary(context):
     """Obtains available scales from registry
     """
     terms = []
-    for scale, (width, height) in getAllowedSizes().iteritems():
-        translated = PMF(
-            'imagescale_{0:s}'.format(scale),
-            default='{0:s} ${{width}}x${{height}}'.format(scale),
-            mapping={'width': str(width), 'height': str(height)})
-        terms.append(SimpleTerm(scale, scale, translated))
-
+    allowedSizes = getAllowedSizes()
+    if allowedSizes is not None:
+        for scale, (width, height) in getAllowedSizes().iteritems():
+            translated = PMF(
+                'imagescale_{0:s}'.format(scale),
+                default='{0:s} ${{width}}x${{height}}'.format(scale),
+                mapping={'width': str(width), 'height': str(height)})
+            terms.append(SimpleTerm(scale, scale, translated))
     return SimpleVocabulary(terms)


