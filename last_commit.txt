Repository: plone.app.contentmenu


Branch: refs/heads/2.0.x
Date: 2016-05-25T13:51:23-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.contentmenu/commit/8036dd50c7aa2668736e429c7d463ca8bde83fb1

Optimize display menu's check for index_html

This makes a big difference for BTree-based folders with thousands of items
when the container is not yet in the ZODB cache.
`context.objectIds()` woke all BTree buckets and built a list of ids
whereas `'index_html' in context` just does a BTree lookup.

Files changed:
M CHANGES.rst
M plone/app/contentmenu/menu.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d79a719..61abcc1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.0.12 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Optimized display menu's check for `index_html`.
+  [davisagli]
 
 
 2.0.11 (2015-08-14)
diff --git a/plone/app/contentmenu/menu.py b/plone/app/contentmenu/menu.py
index c1f672c..6d351be 100644
--- a/plone/app/contentmenu/menu.py
+++ b/plone/app/contentmenu/menu.py
@@ -218,7 +218,7 @@ def disabled(self):
             context = utils.parent(context)
         if not getattr(context, 'isPrincipiaFolderish', False):
             return False
-        elif 'index_html' not in context.objectIds():
+        elif 'index_html' not in context:
             return False
         else:
             return True


Repository: plone.app.contentmenu


Branch: refs/heads/2.0.x
Date: 2016-05-26T00:10:47+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentmenu/commit/4b1382eb1501dec6ba6677d198ee906561f28bf2

Merge pull request #14 from plone/davisagli-optimize-p4

Optimize display menu's check for index_html

Files changed:
M CHANGES.rst
M plone/app/contentmenu/menu.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d79a719..61abcc1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.0.12 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Optimized display menu's check for `index_html`.
+  [davisagli]
 
 
 2.0.11 (2015-08-14)
diff --git a/plone/app/contentmenu/menu.py b/plone/app/contentmenu/menu.py
index c1f672c..6d351be 100644
--- a/plone/app/contentmenu/menu.py
+++ b/plone/app/contentmenu/menu.py
@@ -218,7 +218,7 @@ def disabled(self):
             context = utils.parent(context)
         if not getattr(context, 'isPrincipiaFolderish', False):
             return False
-        elif 'index_html' not in context.objectIds():
+        elif 'index_html' not in context:
             return False
         else:
             return True


