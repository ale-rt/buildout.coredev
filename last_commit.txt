Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2016-04-13T10:17:40+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/0290af4656cf080af076158685e62d7245afeafd

Fix bundle aggregation when bundle has no CSS (or no JS)

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/browser/combine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 02db48e..311dc78 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,9 @@ Fixes:
 - Bundle aggregation must use ++plone++static overrided versions if any.
   [ebrehault]
 
+- Fix bundle aggregation when bundle has no CSS (or no JS)
+  [ebrehault]
+
 
 5.0.4 (2016-04-06)
 ------------------
diff --git a/Products/CMFPlone/resources/browser/combine.py b/Products/CMFPlone/resources/browser/combine.py
index 2ba659a..5240a27 100644
--- a/Products/CMFPlone/resources/browser/combine.py
+++ b/Products/CMFPlone/resources/browser/combine.py
@@ -70,7 +70,7 @@ def write_js(context, folder, meta_bundle):
     bundles = registry.collectionOfInterface(
         IBundleRegistry, prefix="plone.bundles", check=False)
     for bundle in bundles.values():
-        if bundle.merge_with == meta_bundle:
+        if bundle.merge_with == meta_bundle and bundle.jscompilation:
             resources.append(get_resource(context, bundle.jscompilation))
 
     fi = StringIO()
@@ -86,7 +86,7 @@ def write_css(context, folder, meta_bundle):
     bundles = registry.collectionOfInterface(
         IBundleRegistry, prefix="plone.bundles", check=False)
     for bundle in bundles.values():
-        if bundle.merge_with == meta_bundle:
+        if bundle.merge_with == meta_bundle and bundle.csscompilation:
             resources.append(get_resource(context, bundle.csscompilation))
 
     fi = StringIO()


Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2016-04-13T13:50:56+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/7fd5c4f10c99fd7804e5f14c81f1d0a250445743

Merge pull request #1525 from plone/ebr-fix-bundle-merging-50

Fix bundle aggregation when bundle has no CSS (or no JS) on 5.0.x

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/browser/combine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 02db48e..311dc78 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,9 @@ Fixes:
 - Bundle aggregation must use ++plone++static overrided versions if any.
   [ebrehault]
 
+- Fix bundle aggregation when bundle has no CSS (or no JS)
+  [ebrehault]
+
 
 5.0.4 (2016-04-06)
 ------------------
diff --git a/Products/CMFPlone/resources/browser/combine.py b/Products/CMFPlone/resources/browser/combine.py
index 2ba659a..5240a27 100644
--- a/Products/CMFPlone/resources/browser/combine.py
+++ b/Products/CMFPlone/resources/browser/combine.py
@@ -70,7 +70,7 @@ def write_js(context, folder, meta_bundle):
     bundles = registry.collectionOfInterface(
         IBundleRegistry, prefix="plone.bundles", check=False)
     for bundle in bundles.values():
-        if bundle.merge_with == meta_bundle:
+        if bundle.merge_with == meta_bundle and bundle.jscompilation:
             resources.append(get_resource(context, bundle.jscompilation))
 
     fi = StringIO()
@@ -86,7 +86,7 @@ def write_css(context, folder, meta_bundle):
     bundles = registry.collectionOfInterface(
         IBundleRegistry, prefix="plone.bundles", check=False)
     for bundle in bundles.values():
-        if bundle.merge_with == meta_bundle:
+        if bundle.merge_with == meta_bundle and bundle.csscompilation:
             resources.append(get_resource(context, bundle.csscompilation))
 
     fi = StringIO()


