Repository: plone.app.discussion


Branch: refs/heads/2.2.x
Date: 2016-02-14T20:28:54+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.discussion/commit/a3643bc7f01e6bf6c5358645c128f622989e299a

Fixed possible test failure by not overriding an existing user.

Files changed:
M CHANGES.rst
M plone/app/discussion/tests/test_migration.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a1084e6..7779781 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,7 @@ Changelog
 2.2.16 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Fixed possible test failure by not overriding an existing user.  [maurits]
 
 
 2.2.15 (2015-04-25)
diff --git a/plone/app/discussion/tests/test_migration.py b/plone/app/discussion/tests/test_migration.py
index eec1215..a4c2550 100644
--- a/plone/app/discussion/tests/test_migration.py
+++ b/plone/app/discussion/tests/test_migration.py
@@ -59,12 +59,13 @@ def setUp(self):
             'comment_review_workflow'
         )
 
-        # Create a user Jimmy Jones so comments creator migration can work?
-        acl_users = getToolByName(self.portal, 'acl_users')
-        acl_users.userFolderAddUser('Jim', 'secret', ['Member'], [])
-        mt = getToolByName(self.portal, 'portal_membership')
-        member = mt.getMemberById('Jim')
-        member.fullname = 'Jimmy Jones'
+        # Create a user Jimmy Jones so comments creator migration can work.
+        # Note that we create a user Jim here, but we also have a user jim
+        # (Fulton) in testing.py.
+        mtool = getToolByName(self.portal, 'portal_membership')
+        mtool.addMember('Jim', 'Jim', ['Member'], [])
+        mtool.getMemberById('Jim').setMemberProperties(
+            {"fullname": 'Jimmy Jones'})
 
         self.doc = self.portal.doc
 


