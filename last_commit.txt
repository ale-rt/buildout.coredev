Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2016-04-20T08:01:47-05:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/330df732cd68750e2bda9ff040f22634ab7dcb71

Fixed displaying the body text of a feed item.

This is when render_body is switched on in the Syndication settings.

We were overwriting the definition of the `view` variable, which made
it fail:
AttributeError: 'str' object has no attribute 'context'

Strangely, this does not fail in the tests.

Note that we caught the error so no error was visible to a visitor.

Also note that getting the content-core macro may fail anyway, for
example for a Folder, because its default view does not have this
macro.

Files changed:
M CHANGES.rst
M Products/CMFPlone/browser/syndication/templates/content_core.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 311dc78..ae51822 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -45,6 +45,9 @@ Fixes:
 --------------------
 
 Fixes:
+- Fixed displaying the body text of a feed item.  This is when
+  ``render_body`` is switched on in the Syndication settings.
+  [maurits]
 
 - In the ``combine-bundles`` import step, make sure the Content Type
   header is not set to ``application/javascript``.  This would result
diff --git a/Products/CMFPlone/browser/syndication/templates/content_core.pt b/Products/CMFPlone/browser/syndication/templates/content_core.pt
index 9318aae..b34981d 100644
--- a/Products/CMFPlone/browser/syndication/templates/content_core.pt
+++ b/Products/CMFPlone/browser/syndication/templates/content_core.pt
@@ -1,4 +1,4 @@
-<tal:block tal:define="view context/defaultView;"
+<tal:block tal:define="default_view_template context/defaultView;"
            tal:on-error="nothing">
-   <div metal:use-macro="here/?view/macros/content-core"/>
+   <div metal:use-macro="here/?default_view_template/macros/content-core"/>
 </tal:block>


