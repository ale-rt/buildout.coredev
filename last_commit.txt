Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-03-15T12:04:02+01:00
Author: Diederik Veeze (didrix) <d.veeze@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.contenttypes/commit/d45e2849a97e748e1d70f21c0b1c5b16ca988079

Make use of plone.namedfile's tag() function to generate img tags.

Add srcset data for leadimage modal.

Use new portal image_scale in more places.
This avoids a few more getObject calls.
Some getObject calls remain due to reasons that have nothing to do with images or scaling.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/leadimage.pt
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_album.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt
M plone/app/contenttypes/browser/templates/listing_tabular.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 5c39611..487ddce 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Make use of plone.namedfile's tag() function to generate img tags. Part of plip 1483.
+  [didrix]
 
 Bug fixes:
 
diff --git a/plone/app/contenttypes/behaviors/leadimage.pt b/plone/app/contenttypes/behaviors/leadimage.pt
index a5768f0..38d5a63 100644
--- a/plone/app/contenttypes/behaviors/leadimage.pt
+++ b/plone/app/contenttypes/behaviors/leadimage.pt
@@ -7,7 +7,7 @@
     <a tal:define="here_url context/@@plone_context_state/object_url;
                    large_image python: scale_func.scale('image', scale='large');"
         class="pat-plone-modal" data-pat-plone-modal="image: true"
-        tal:attributes="href large_image/url">
+        tal:attributes="href large_image/url; data-modal-srcset large_image/srcset_attribute">
       <img tal:replace="structure python: scaled_image.tag(css_class='newsImage')" />
       <figcaption tal:condition="context/image_caption|nothing"
           tal:content="context/image_caption">
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
index 8368076..11662e0 100644
--- a/plone/app/contenttypes/browser/templates/listing.pt
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -21,7 +21,9 @@
   <metal:listingmacro define-macro="listing">
     <tal:results define="batch view/batch">
       <tal:listing condition="batch">
-        <div class="entries" metal:define-slot="entries">
+        <div class="entries" metal:define-slot="entries"
+            tal:define="portal context/@@plone_portal_state/portal;
+                        image_scale portal/@@image_scale">
           <tal:repeat repeat="item batch" metal:define-macro="entries">
             <tal:block tal:define="obj item/getObject;
                 item_url item/getURL;
@@ -43,9 +45,8 @@
                   <header metal:define-macro="listitem" tal:attributes="class python:'vevent' if item_is_event else None">
                     <span class="summary" tal:attributes="title item_type">
                      <a tal:attributes="href item_link">
-                      <img class="image-tile"
-                             tal:condition="item_has_image"
-                             tal:attributes="src  string:$item_url/@@images/image/tile">
+                        <img tal:condition="item_has_image"
+                             tal:replace="structure python:image_scale.tag(item, 'image', scale='tile', css_class='image-tile')">
                       </a>
                       <a tal:attributes="href item_link;
                                          class string:$item_type_class $item_wf_state_class url;
diff --git a/plone/app/contenttypes/browser/templates/listing_album.pt b/plone/app/contenttypes/browser/templates/listing_album.pt
index 9127208..1f0d608 100644
--- a/plone/app/contenttypes/browser/templates/listing_album.pt
+++ b/plone/app/contenttypes/browser/templates/listing_album.pt
@@ -20,17 +20,15 @@
     <div metal:define-slot="inside" tal:replace="structure text">The body</div>
   </div>
 
-  <metal:listingmacro define-macro="listing">
+  <metal:listingmacro define-macro="listing"
+      tal:define="portal context/@@plone_portal_state/portal;
+                  image_scale portal/@@image_scale">
   <tal:images tal:repeat="image images">
-    <div class="photoAlbumEntry"
-         tal:define="ob image/getObject;
-                     scale ob/@@images;
-                     img_tag python:scale.scale('image', scale='thumb')">
+    <div class="photoAlbumEntry">
       <a tal:attributes="href string:${image/getURL}/view;
                          title image/Description">
         <span class="photoAlbumEntryWrapper">
-          <img tal:condition="img_tag"
-              tal:replace="structure img_tag/tag" />
+          <img tal:replace="structure python:image_scale.tag(image, 'image', scale='thumb')" />
         </span>
         <span class="photoAlbumEntryTitle" tal:content="image/Title">
             Title
@@ -51,9 +49,7 @@
       <a tal:attributes="href album/getURL;
                          title album/Description">
         <span class="photoAlbumEntryWrapper">
-          <img tal:define="random_img_ob random_image/getObject;
-                           scales random_img_ob/@@images"
-               tal:replace="structure python:scales.tag(fieldname='image', scale='thumb')" />
+          <img tal:replace="structure python:image_scale.tag(random_image, fieldname='image', scale='thumb')" />
         </span>
         <span class="photoAlbumEntryTitle">
           <tal:title content="album/Title">Title</tal:title>
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
index 611519c..360f6e8 100644
--- a/plone/app/contenttypes/browser/templates/listing_summary.pt
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -11,10 +11,12 @@
 <metal:block use-macro="context/@@listing_view/macros/content-core">
 
   <metal:entries fill-slot="entries">
-    <metal:block use-macro="context/@@listing_view/macros/entries">
+    <metal:block use-macro="context/@@listing_view/macros/entries"
+        tal:define="portal context/@@plone_portal_state/portal;
+                    image_scale portal/@@image_scale">
       <metal:entry fill-slot="entry">
 
-        <article class="tileItem" tal:define="obj item/getObject">
+        <article class="tileItem">
           <h2 class="tileHeadline" metal:define-macro="listitem">
             <a class="summary url"
                 tal:attributes="href item_link;
@@ -30,9 +32,7 @@
                tal:condition="item_has_image"
                tal:attributes="class python: 'tileImage' if item_description else 'tileImageNoFloat'">
             <a tal:attributes="href item_link">
-              <img tal:define="scales obj/@@images;
-                               scale python:scales.scale('image', 'thumb')"
-                  tal:replace="structure python:scale and scale.tag() or None" />
+              <img tal:replace="structure python:image_scale.tag(item, 'image', scale='thumb')" />
             </a>
           </div>
 
diff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt
index 94d343c..31dd3ae 100644
--- a/plone/app/contenttypes/browser/templates/listing_tabular.pt
+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt
@@ -35,7 +35,8 @@
                   tal:content="field">Field name</th>
             </tr>
           </thead>
-          <tbody>
+          <tbody tal:define="portal context/@@plone_portal_state/portal;
+                             image_scale portal/@@image_scale">
             <tal:entries tal:repeat="item batch">
               <tal:block tal:define="item_url item/getURL;
                                      item_title item/Title;
@@ -56,13 +57,9 @@
                       <tal:block tal:replace="field_data/value" />
                     </td>
                     <td tal:condition="python:field == 'Title'">
-                      <img class="image-icon"
-                         tal:define="getIcon python:item.getURL()+'/@@images/image/icon'"
-                         tal:condition="python:  item.getIcon"
-                         tal:attributes="href item/getURL;
-                                         src  string:$getIcon"
-                      />
-                      <a href="#"
+                        <img tal:condition="python: item.getIcon"
+                             tal:replace="structure python:image_scale.tag(item, 'image', scale='icon', css_class='image-icon')">
+                        <a href="#"
                           tal:attributes="href item_link;
                           class string:$item_wf_state_class $item_type_class;
                           title item_description;"


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-03-15T15:27:52+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.contenttypes/commit/623633e52d08b5974d27475fbd030e91938ff891

Fixed folder listing tests, which show more image titles.

In these tests, originally the images were already shown, but they were missing a title.
With PLIP 1483 (Retina) the 'tag' function is used in more places, which results in more titles.

For example, old:

  &lt;img class="image-tile"
      src="http://localhost:55001/plone/robot-test-folder/test_image/@@images/image/tile" /&gt;

New:

  &lt;img width="62" height="64" class="image-tile" title="Test Image" alt="Test Image"
      src="http://localhost:55001/plone/robot-test-folder/test_image/@@images/cbccdd2f-1a93-4935-b46f-d9e07e09cff6.png" /&gt;

Note that most images here are shown twice: in the navigation portlet and in the main content area.

Files changed:
M plone/app/contenttypes/tests/robot/test_folderlisting.robot

diff --git a/plone/app/contenttypes/tests/robot/test_folderlisting.robot b/plone/app/contenttypes/tests/robot/test_folderlisting.robot
index aaa86f0..76b7a03 100644
--- a/plone/app/contenttypes/tests/robot/test_folderlisting.robot
+++ b/plone/app/contenttypes/tests/robot/test_folderlisting.robot
@@ -71,7 +71,7 @@ Listing should list contained content in detail
   Page Should Contain  this is a test document
   Page Should Contain  Test News Item
   Page Should Contain  this is a test news item
-  Xpath Should Match X Times  //img[@title="Test News Item"]  0
+  Xpath Should Match X Times  //img[@title="Test News Item"]  2
   Page Should Contain  Test Event
   Page Should Contain  this is a test event
   Page Should Contain  Test Collection
@@ -81,29 +81,29 @@ Listing should list contained content in detail
   Page Should Contain  Test File
   Page Should Contain  file.pdf
   Page Should Contain  Test Image
-  Xpath Should Match X Times  //img[@title="Test Image"]  1
+  Xpath Should Match X Times  //img[@title="Test Image"]  3
   Page Should Contain  Test Album
   Page Should Contain  Test Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  0
+  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  2
   Page Should Contain  Test Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  0
+  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  2
   Page Should Contain  Test Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  0
+  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  2
   Page Should Contain  Test Sub Album
   Page Should Contain  Test Sub Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  0
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  1
   Page Should Contain  Test Sub Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  0
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  1
   Page Should Contain  Test Sub Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  0
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  1
 
 Album should list contained images and albums
   Page Should Contain  Test Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  2
   Page Should Contain  Test Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  2
   Page Should Contain  Test Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  2
   Page Should Contain  Test Sub Album
 
 
@@ -129,7 +129,7 @@ Listing should list all content in detail
   Page Should Contain  this is a test document
   Page Should Contain  Test News Item
   Page Should Contain  this is a test news item
-  Xpath Should Match X Times  //img[@title="Test News Item"]  0
+  Xpath Should Match X Times  //img[@title="Test News Item"]  2
   Page Should Contain  Test Event
   Page Should Contain  this is a test event
   Page Should Contain  Test Collection
@@ -139,25 +139,25 @@ Listing should list all content in detail
   Page Should Contain  Test File
   Page Should Contain  file.pdf
   Page Should Contain  Test Image
-  Xpath Should Match X Times  //img[@title="Test Image"]  1
+  Xpath Should Match X Times  //img[@title="Test Image"]  3
   Page Should Contain  Test Album
   Page Should Contain  Test Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  2
   Page Should Contain  Test Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  2
   Page Should Contain  Test Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  2
   Page Should Contain  Test Sub Album
   Page Should Contain  Test Sub Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  1
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  2
   Page Should Contain  Test Sub Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  1
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  2
   Page Should Contain  Test Sub Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  1
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  2
 
 Album should list all images and albums
   Page Should Contain  Test Image
-  Xpath Should Match X Times  //img[@title="Test Image"]  2
+  Xpath Should Match X Times  //img[@title="Test Image"]  3
   Page Should Contain  Test Album Image 1
   Xpath Should Match X Times  //div[@class="photoAlbumEntry" and not(@class="photoAlbumFolder")]//img[@title="Test Album Image 1"]  1
   Page Should Contain  Test Album Image 2


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-03-21T22:14:28+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/cefb3073828dff148c33730b151d935596705532

bump version after feature added

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 487ddce..a39cc92 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,7 +1,7 @@
 Changelog
 =========
 
-1.2.23 (unreleased)
+1.3.0 (unreleased)
 -------------------
 
 Breaking changes:
diff --git a/setup.py b/setup.py
index 6f403f7..ebd942d 100644
--- a/setup.py
+++ b/setup.py
@@ -5,7 +5,7 @@
 import os
 
 
-version = '1.2.23.dev0'
+version = '1.3.0.dev0'
 
 
 def read(*rnames):


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-03-21T22:15:47+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/6ed2ffbbcfffd79ff6e125513d61b7126844da10

Merge pull request #350 from plone/plip-1483-retina-image-scales

Plip 1483 retina image scales

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/leadimage.pt
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_album.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt
M plone/app/contenttypes/browser/templates/listing_tabular.pt
M plone/app/contenttypes/tests/robot/test_folderlisting.robot
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5c39611..a39cc92 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,7 +1,7 @@
 Changelog
 =========
 
-1.2.23 (unreleased)
+1.3.0 (unreleased)
 -------------------
 
 Breaking changes:
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Make use of plone.namedfile's tag() function to generate img tags. Part of plip 1483.
+  [didrix]
 
 Bug fixes:
 
diff --git a/plone/app/contenttypes/behaviors/leadimage.pt b/plone/app/contenttypes/behaviors/leadimage.pt
index a5768f0..38d5a63 100644
--- a/plone/app/contenttypes/behaviors/leadimage.pt
+++ b/plone/app/contenttypes/behaviors/leadimage.pt
@@ -7,7 +7,7 @@
     <a tal:define="here_url context/@@plone_context_state/object_url;
                    large_image python: scale_func.scale('image', scale='large');"
         class="pat-plone-modal" data-pat-plone-modal="image: true"
-        tal:attributes="href large_image/url">
+        tal:attributes="href large_image/url; data-modal-srcset large_image/srcset_attribute">
       <img tal:replace="structure python: scaled_image.tag(css_class='newsImage')" />
       <figcaption tal:condition="context/image_caption|nothing"
           tal:content="context/image_caption">
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
index 8368076..11662e0 100644
--- a/plone/app/contenttypes/browser/templates/listing.pt
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -21,7 +21,9 @@
   <metal:listingmacro define-macro="listing">
     <tal:results define="batch view/batch">
       <tal:listing condition="batch">
-        <div class="entries" metal:define-slot="entries">
+        <div class="entries" metal:define-slot="entries"
+            tal:define="portal context/@@plone_portal_state/portal;
+                        image_scale portal/@@image_scale">
           <tal:repeat repeat="item batch" metal:define-macro="entries">
             <tal:block tal:define="obj item/getObject;
                 item_url item/getURL;
@@ -43,9 +45,8 @@
                   <header metal:define-macro="listitem" tal:attributes="class python:'vevent' if item_is_event else None">
                     <span class="summary" tal:attributes="title item_type">
                      <a tal:attributes="href item_link">
-                      <img class="image-tile"
-                             tal:condition="item_has_image"
-                             tal:attributes="src  string:$item_url/@@images/image/tile">
+                        <img tal:condition="item_has_image"
+                             tal:replace="structure python:image_scale.tag(item, 'image', scale='tile', css_class='image-tile')">
                       </a>
                       <a tal:attributes="href item_link;
                                          class string:$item_type_class $item_wf_state_class url;
diff --git a/plone/app/contenttypes/browser/templates/listing_album.pt b/plone/app/contenttypes/browser/templates/listing_album.pt
index 9127208..1f0d608 100644
--- a/plone/app/contenttypes/browser/templates/listing_album.pt
+++ b/plone/app/contenttypes/browser/templates/listing_album.pt
@@ -20,17 +20,15 @@
     <div metal:define-slot="inside" tal:replace="structure text">The body</div>
   </div>
 
-  <metal:listingmacro define-macro="listing">
+  <metal:listingmacro define-macro="listing"
+      tal:define="portal context/@@plone_portal_state/portal;
+                  image_scale portal/@@image_scale">
   <tal:images tal:repeat="image images">
-    <div class="photoAlbumEntry"
-         tal:define="ob image/getObject;
-                     scale ob/@@images;
-                     img_tag python:scale.scale('image', scale='thumb')">
+    <div class="photoAlbumEntry">
       <a tal:attributes="href string:${image/getURL}/view;
                          title image/Description">
         <span class="photoAlbumEntryWrapper">
-          <img tal:condition="img_tag"
-              tal:replace="structure img_tag/tag" />
+          <img tal:replace="structure python:image_scale.tag(image, 'image', scale='thumb')" />
         </span>
         <span class="photoAlbumEntryTitle" tal:content="image/Title">
             Title
@@ -51,9 +49,7 @@
       <a tal:attributes="href album/getURL;
                          title album/Description">
         <span class="photoAlbumEntryWrapper">
-          <img tal:define="random_img_ob random_image/getObject;
-                           scales random_img_ob/@@images"
-               tal:replace="structure python:scales.tag(fieldname='image', scale='thumb')" />
+          <img tal:replace="structure python:image_scale.tag(random_image, fieldname='image', scale='thumb')" />
         </span>
         <span class="photoAlbumEntryTitle">
           <tal:title content="album/Title">Title</tal:title>
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
index 611519c..360f6e8 100644
--- a/plone/app/contenttypes/browser/templates/listing_summary.pt
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -11,10 +11,12 @@
 <metal:block use-macro="context/@@listing_view/macros/content-core">
 
   <metal:entries fill-slot="entries">
-    <metal:block use-macro="context/@@listing_view/macros/entries">
+    <metal:block use-macro="context/@@listing_view/macros/entries"
+        tal:define="portal context/@@plone_portal_state/portal;
+                    image_scale portal/@@image_scale">
       <metal:entry fill-slot="entry">
 
-        <article class="tileItem" tal:define="obj item/getObject">
+        <article class="tileItem">
           <h2 class="tileHeadline" metal:define-macro="listitem">
             <a class="summary url"
                 tal:attributes="href item_link;
@@ -30,9 +32,7 @@
                tal:condition="item_has_image"
                tal:attributes="class python: 'tileImage' if item_description else 'tileImageNoFloat'">
             <a tal:attributes="href item_link">
-              <img tal:define="scales obj/@@images;
-                               scale python:scales.scale('image', 'thumb')"
-                  tal:replace="structure python:scale and scale.tag() or None" />
+              <img tal:replace="structure python:image_scale.tag(item, 'image', scale='thumb')" />
             </a>
           </div>
 
diff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt
index 94d343c..31dd3ae 100644
--- a/plone/app/contenttypes/browser/templates/listing_tabular.pt
+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt
@@ -35,7 +35,8 @@
                   tal:content="field">Field name</th>
             </tr>
           </thead>
-          <tbody>
+          <tbody tal:define="portal context/@@plone_portal_state/portal;
+                             image_scale portal/@@image_scale">
             <tal:entries tal:repeat="item batch">
               <tal:block tal:define="item_url item/getURL;
                                      item_title item/Title;
@@ -56,13 +57,9 @@
                       <tal:block tal:replace="field_data/value" />
                     </td>
                     <td tal:condition="python:field == 'Title'">
-                      <img class="image-icon"
-                         tal:define="getIcon python:item.getURL()+'/@@images/image/icon'"
-                         tal:condition="python:  item.getIcon"
-                         tal:attributes="href item/getURL;
-                                         src  string:$getIcon"
-                      />
-                      <a href="#"
+                        <img tal:condition="python: item.getIcon"
+                             tal:replace="structure python:image_scale.tag(item, 'image', scale='icon', css_class='image-icon')">
+                        <a href="#"
                           tal:attributes="href item_link;
                           class string:$item_wf_state_class $item_type_class;
                           title item_description;"
diff --git a/plone/app/contenttypes/tests/robot/test_folderlisting.robot b/plone/app/contenttypes/tests/robot/test_folderlisting.robot
index aaa86f0..76b7a03 100644
--- a/plone/app/contenttypes/tests/robot/test_folderlisting.robot
+++ b/plone/app/contenttypes/tests/robot/test_folderlisting.robot
@@ -71,7 +71,7 @@ Listing should list contained content in detail
   Page Should Contain  this is a test document
   Page Should Contain  Test News Item
   Page Should Contain  this is a test news item
-  Xpath Should Match X Times  //img[@title="Test News Item"]  0
+  Xpath Should Match X Times  //img[@title="Test News Item"]  2
   Page Should Contain  Test Event
   Page Should Contain  this is a test event
   Page Should Contain  Test Collection
@@ -81,29 +81,29 @@ Listing should list contained content in detail
   Page Should Contain  Test File
   Page Should Contain  file.pdf
   Page Should Contain  Test Image
-  Xpath Should Match X Times  //img[@title="Test Image"]  1
+  Xpath Should Match X Times  //img[@title="Test Image"]  3
   Page Should Contain  Test Album
   Page Should Contain  Test Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  0
+  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  2
   Page Should Contain  Test Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  0
+  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  2
   Page Should Contain  Test Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  0
+  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  2
   Page Should Contain  Test Sub Album
   Page Should Contain  Test Sub Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  0
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  1
   Page Should Contain  Test Sub Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  0
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  1
   Page Should Contain  Test Sub Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  0
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  1
 
 Album should list contained images and albums
   Page Should Contain  Test Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  2
   Page Should Contain  Test Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  2
   Page Should Contain  Test Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  2
   Page Should Contain  Test Sub Album
 
 
@@ -129,7 +129,7 @@ Listing should list all content in detail
   Page Should Contain  this is a test document
   Page Should Contain  Test News Item
   Page Should Contain  this is a test news item
-  Xpath Should Match X Times  //img[@title="Test News Item"]  0
+  Xpath Should Match X Times  //img[@title="Test News Item"]  2
   Page Should Contain  Test Event
   Page Should Contain  this is a test event
   Page Should Contain  Test Collection
@@ -139,25 +139,25 @@ Listing should list all content in detail
   Page Should Contain  Test File
   Page Should Contain  file.pdf
   Page Should Contain  Test Image
-  Xpath Should Match X Times  //img[@title="Test Image"]  1
+  Xpath Should Match X Times  //img[@title="Test Image"]  3
   Page Should Contain  Test Album
   Page Should Contain  Test Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 1"]  2
   Page Should Contain  Test Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 2"]  2
   Page Should Contain  Test Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  1
+  Xpath Should Match X Times  //img[@title="Test Album Image 3"]  2
   Page Should Contain  Test Sub Album
   Page Should Contain  Test Sub Album Image 1
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  1
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 1"]  2
   Page Should Contain  Test Sub Album Image 2
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  1
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 2"]  2
   Page Should Contain  Test Sub Album Image 3
-  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  1
+  Xpath Should Match X Times  //img[@title="Test Sub Album Image 3"]  2
 
 Album should list all images and albums
   Page Should Contain  Test Image
-  Xpath Should Match X Times  //img[@title="Test Image"]  2
+  Xpath Should Match X Times  //img[@title="Test Image"]  3
   Page Should Contain  Test Album Image 1
   Xpath Should Match X Times  //div[@class="photoAlbumEntry" and not(@class="photoAlbumFolder")]//img[@title="Test Album Image 1"]  1
   Page Should Contain  Test Album Image 2
diff --git a/setup.py b/setup.py
index 6f403f7..ebd942d 100644
--- a/setup.py
+++ b/setup.py
@@ -5,7 +5,7 @@
 import os
 
 
-version = '1.2.23.dev0'
+version = '1.3.0.dev0'
 
 
 def read(*rnames):


