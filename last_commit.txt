Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-04-01T02:53:34+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/05fd90340c03afe071b2b7ffc66d8240225932c2

Fix problem in ConstrainTypesBehavior with getImmediatelyAddableTypes return type.

Files changed:
M CHANGES.rst
M plone/app/dexterity/behaviors/constrains.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d8bd04a..7c7d5e3 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,11 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix problem in ConstrainTypesBehavior: 
+  when mode was ENABLED but only setLocallyAllowedTypes were set, 
+  then getImmediatelyAddableTypes returned None, 
+  but all consuming code expect it to return a list
+  [jensens]
 
 
 2.1.20 (2016-03-31)
diff --git a/plone/app/dexterity/behaviors/constrains.py b/plone/app/dexterity/behaviors/constrains.py
index 863c62b..359e21f 100644
--- a/plone/app/dexterity/behaviors/constrains.py
+++ b/plone/app/dexterity/behaviors/constrains.py
@@ -144,6 +144,7 @@ def getImmediatelyAddableTypes(self, context=None):
             if hasattr(self.context, 'immediately_addable_types'):
                 return self._filterByDefaults(
                     self.context.immediately_addable_types, context)
+            return default_addable
         elif mode == ACQUIRE:
             parent = self.context.__parent__
             parent_constrain_adapter = ISelectableConstrainTypes(parent, None)


