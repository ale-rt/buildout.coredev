Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2016-02-06T01:12:45+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFEditions/commit/6a97fb7a24e9d03a878af0e32cbe4573f026b710

Fixed sometimes failing test15_storageStatistics.

Files changed:
M CHANGES.rst
M Products/CMFEditions/tests/test_ZVCStorageTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 587a201..a498e2e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,7 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed sometimes failing test.  [maurits]
 
 
 2.2.18 (2015-11-25)
diff --git a/Products/CMFEditions/tests/test_ZVCStorageTool.py b/Products/CMFEditions/tests/test_ZVCStorageTool.py
index 96bfbac..c2fd242 100644
--- a/Products/CMFEditions/tests/test_ZVCStorageTool.py
+++ b/Products/CMFEditions/tests/test_ZVCStorageTool.py
@@ -512,7 +512,8 @@ def test15_storageStatistics(self):
                         'deletedVersions': 0,
                         'existingVersions': 7,
                         'deletedHistories': 0,
-                        'time': '0.00',
+                        # time may easily be different
+                        # 'time': '0.00',
                         'totalVersions': 7,
                         'existingAverage': '1.8',
                         'existingHistories': 4,
@@ -549,7 +550,10 @@ def test15_storageStatistics(self):
                             'portal_type': 'Dummy',
                         }]}
         self.assertEqual(expected['deleted'], got['deleted'])
-        self.assertEqual(expected['summaries'], got['summaries'])
+        self.assertTrue('summaries' in got)
+        self.assertTrue('time' in got['summaries'])
+        for key, value in expected['summaries'].items():
+            self.assertEqual(value, got['summaries'][key])
         self.assertEqual(len(expected['existing']), len(got['existing']))
         for idx in range(len(expected['existing'])):
             exp = expected['existing'][idx]


Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2016-02-06T20:58:40+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/6955a18e64aecedbbc919680c6b434f2a907bf72

Merge pull request #34 from plone/maurits-fix-test15_storageStatistics

Fixed sometimes failing test15_storageStatistics.

Files changed:
M CHANGES.rst
M Products/CMFEditions/tests/test_ZVCStorageTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 587a201..a498e2e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,7 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed sometimes failing test.  [maurits]
 
 
 2.2.18 (2015-11-25)
diff --git a/Products/CMFEditions/tests/test_ZVCStorageTool.py b/Products/CMFEditions/tests/test_ZVCStorageTool.py
index 96bfbac..c2fd242 100644
--- a/Products/CMFEditions/tests/test_ZVCStorageTool.py
+++ b/Products/CMFEditions/tests/test_ZVCStorageTool.py
@@ -512,7 +512,8 @@ def test15_storageStatistics(self):
                         'deletedVersions': 0,
                         'existingVersions': 7,
                         'deletedHistories': 0,
-                        'time': '0.00',
+                        # time may easily be different
+                        # 'time': '0.00',
                         'totalVersions': 7,
                         'existingAverage': '1.8',
                         'existingHistories': 4,
@@ -549,7 +550,10 @@ def test15_storageStatistics(self):
                             'portal_type': 'Dummy',
                         }]}
         self.assertEqual(expected['deleted'], got['deleted'])
-        self.assertEqual(expected['summaries'], got['summaries'])
+        self.assertTrue('summaries' in got)
+        self.assertTrue('time' in got['summaries'])
+        for key, value in expected['summaries'].items():
+            self.assertEqual(value, got['summaries'][key])
         self.assertEqual(len(expected['existing']), len(got['existing']))
         for idx in range(len(expected['existing'])):
             exp = expected['existing'][idx]


