Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2017-10-21T14:57:56+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.querystring/commit/c2ba530d7b195761d096eba8c397a54e14db5ca7

fix tests for CMF 2.3

Files changed:
M CHANGES.rst
M plone/app/querystring/tests/testQueryParser.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 648b8ac..ba8cea1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix tests with CMF 2.3. [davisagli]
 
 
 1.4.6 (2017-09-08)
diff --git a/plone/app/querystring/tests/testQueryParser.py b/plone/app/querystring/tests/testQueryParser.py
index f728cf3..5cb63c2 100644
--- a/plone/app/querystring/tests/testQueryParser.py
+++ b/plone/app/querystring/tests/testQueryParser.py
@@ -1,5 +1,8 @@
 # -*- coding: utf-8 -*-
 from DateTime import DateTime
+from Products.CMFCore.interfaces import ICatalogTool
+from Products.CMFCore.interfaces import IMembershipTool
+from Products.CMFCore.interfaces import IURLTool
 from Products.CMFPlone.interfaces import IPloneSiteRoot
 from plone.app.layout.navigation.interfaces import INavigationRoot
 from plone.app.querystring import queryparser
@@ -13,6 +16,7 @@
     NOT_INSTALLED_PLONEAPPQUERYSTRING_INTEGRATION_TESTING
 
 from zope.component import getGlobalSiteManager
+from zope.component import getSiteManager
 from zope.interface import implementer
 
 import unittest
@@ -79,10 +83,14 @@ class MockSiteProperties(object):
 class MockSite(object):
 
     def __init__(self, portal_membership=None):
+        sm = getSiteManager()
         self.reference_catalog = MockCatalog()
         self.portal_catalog = MockCatalog()
+        sm.registerUtility(self.portal_catalog, ICatalogTool)
         self.portal_membership = portal_membership
+        sm.registerUtility(portal_membership, IMembershipTool)
         self.portal_url = MockPortalUrl()
+        sm.registerUtility(self.portal_url, IURLTool)
         self.portal_properties = MockSiteProperties()
 
     def getPhysicalPath(self):


