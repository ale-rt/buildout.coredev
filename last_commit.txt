Repository: plone.app.event


Branch: refs/heads/2.0.x
Date: 2016-08-12T10:50:07-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/b6d8744a8c2b3ba730391eb7c6c74630460bbccb

Fix bug when creating indexes on install. It was not detecting existing
  indexes correctly.

Files changed:
M CHANGES.rst
M plone/app/event/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e2c50b8..c7856ca 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix bug when creating indexes on install. It was not detecting existing
+  indexes correctly.
+  [vangheem]
 
 
 2.0.10 (2016-06-06)
diff --git a/plone/app/event/setuphandlers.py b/plone/app/event/setuphandlers.py
index 612f4d8..57ef96c 100644
--- a/plone/app/event/setuphandlers.py
+++ b/plone/app/event/setuphandlers.py
@@ -45,14 +45,14 @@ class extra(object):
         recurdef = 'recurrence'
         until = ''
 
-    idxobj = catalog.Indexes
+    _catalog = catalog._catalog
     for name in idxs:
-        if name in idxobj:
-            if idxobj[name].meta_type == 'DateIndex':
+        if name in catalog.indexes():
+            if _catalog.getIndex(name).meta_type == 'DateIndex':
                 # delete old standard DateIndex
                 catalog.delIndex(name)
                 logger.info('Old catalog DateIndex %s deleted.' % name)
-        if name not in idxobj:
+        if name not in catalog.indexes():
             if name in date_idxs:
                 # create new DateRecurringIndex
                 catalog.addIndex(name, 'DateRecurringIndex', extra=extra())


Repository: plone.app.event


Branch: refs/heads/2.0.x
Date: 2016-09-27T23:42:30-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/336b18ebb4c7b3c4fde259f252d562f20db51279

Merge pull request #237 from plone/fix-index-install-2

Fix bug when creating indexes on install(2.0.x branch)

Files changed:
M CHANGES.rst
M plone/app/event/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e2c50b8..c7856ca 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix bug when creating indexes on install. It was not detecting existing
+  indexes correctly.
+  [vangheem]
 
 
 2.0.10 (2016-06-06)
diff --git a/plone/app/event/setuphandlers.py b/plone/app/event/setuphandlers.py
index 612f4d8..57ef96c 100644
--- a/plone/app/event/setuphandlers.py
+++ b/plone/app/event/setuphandlers.py
@@ -45,14 +45,14 @@ class extra(object):
         recurdef = 'recurrence'
         until = ''
 
-    idxobj = catalog.Indexes
+    _catalog = catalog._catalog
     for name in idxs:
-        if name in idxobj:
-            if idxobj[name].meta_type == 'DateIndex':
+        if name in catalog.indexes():
+            if _catalog.getIndex(name).meta_type == 'DateIndex':
                 # delete old standard DateIndex
                 catalog.delIndex(name)
                 logger.info('Old catalog DateIndex %s deleted.' % name)
-        if name not in idxobj:
+        if name not in catalog.indexes():
             if name in date_idxs:
                 # create new DateRecurringIndex
                 catalog.addIndex(name, 'DateRecurringIndex', extra=extra())


