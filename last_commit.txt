Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2017-10-26T15:06:40+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.vocabularies/commit/5dc41f614e8083e8a06ee2af6007f2a36422d4c5

Fix test that breaks when catalog is not registered as a utility in CMF 2.3+

Files changed:
M CHANGES.rst
M plone/app/vocabularies/tests/test_subjects_under_context.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d867725..83ef634 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix test that breaks when catalog is not registered as a utility in CMF 2.3+
+  [pbauer]
 
 
 4.0.4 (2017-07-03)
@@ -49,7 +50,7 @@ Bug fixes:
   [seanupton]
 
 - plone/Products.CMFPlone#1268: use permissive vocabulary type
-  for ReallyUserFriendlyTypes, to avoid insertion of new types 
+  for ReallyUserFriendlyTypes, to avoid insertion of new types
   in plone.displayed_types (registry) from breaking GenericSetup
   profiles in add-ons.
   [seanupton]
diff --git a/plone/app/vocabularies/tests/test_subjects_under_context.py b/plone/app/vocabularies/tests/test_subjects_under_context.py
index 92039ff..6b7df0d 100644
--- a/plone/app/vocabularies/tests/test_subjects_under_context.py
+++ b/plone/app/vocabularies/tests/test_subjects_under_context.py
@@ -61,11 +61,11 @@ def setUp(self):
         from plone.registry.interfaces import IRegistry
         from zope.component import getSiteManager
         sm = getSiteManager()
+        from Products.CMFCore.interfaces import ICatalogTool
+        sm.registerUtility(tool, ICatalogTool)
         registry = Registry()
         sm.registerUtility(registry, IRegistry)
-        registry_patcher = mock.patch(
-            'plone.registry.registry.Registry.get'
-        )
+        registry_patcher = mock.patch('plone.registry.registry.Registry.get')
         self.addCleanup(registry_patcher.stop)
         self.registry_mock = registry_patcher.start()
 


