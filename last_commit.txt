Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-10-09T23:43:08+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/53ae082569ea7f34fd3819c48282c3b64742978e

Products.MimetypesRegistry has no longer a skins layer, remove it.

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 760d838..6ace74f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,9 @@ Breaking changes:
 
 New features:
 
+- Products.MimetypesRegistry has no longer a skins layer, remove it.
+  [jensens]
+
 - Add sort_on field to search controlpanel.
   [rodfersou]
 
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index 8ba9cf5..d17b02c 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from plone.app.upgrade.utils import cleanUpSkinsTool
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.registry.interfaces import IRegistry
 from Products.CMFCore.utils import getToolByName
@@ -17,7 +18,7 @@ def to51beta1(context):
 
 def addSortOnProperty(context):
     """Add sort_on field to search controlpanel.
-    
+
     The default value of this field is relevance.
     """
     # get the old site properties
@@ -45,3 +46,9 @@ def addSortOnProperty(context):
             settings.sort_on = 'relevance'
         logger.log(logging.INFO,
                    "Added 'sort_on' property to site_properties.")
+
+
+def remove_leftover_skin_layers(context):
+    """Products.MimetypesRegistry no longer has a skin layer, remove it.
+    """
+    cleanUpSkinsTool(context)
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 53b8399..6e2dcc9 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -57,6 +57,12 @@ Add new Mockup 2.4.0 relateditems resource url.
            handler=".betas.addSortOnProperty"
            />
 
+      <gs:upgradeStep
+           title="Remove skins layer converted to browser resources"
+           description="Products.MimetypesRegistry Icons no longer with skins"
+           handler=".betas.remove_leftover_skin_layers"
+           />
+
     </gs:upgradeSteps>
 
 </configure>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-10-18T16:31:41-04:00
Author: agitator (agitator) <hpeter@agitator.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/299c160da43431b57ac535aec41cb7632fa7211f

Merge pull request #90 from plone/remove-skins-of-mtr

Products.MimetypesRegistry has no longer a skins layer, remove it.

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 760d838..6ace74f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,9 @@ Breaking changes:
 
 New features:
 
+- Products.MimetypesRegistry has no longer a skins layer, remove it.
+  [jensens]
+
 - Add sort_on field to search controlpanel.
   [rodfersou]
 
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index 8ba9cf5..d17b02c 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from plone.app.upgrade.utils import cleanUpSkinsTool
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.registry.interfaces import IRegistry
 from Products.CMFCore.utils import getToolByName
@@ -17,7 +18,7 @@ def to51beta1(context):
 
 def addSortOnProperty(context):
     """Add sort_on field to search controlpanel.
-    
+
     The default value of this field is relevance.
     """
     # get the old site properties
@@ -45,3 +46,9 @@ def addSortOnProperty(context):
             settings.sort_on = 'relevance'
         logger.log(logging.INFO,
                    "Added 'sort_on' property to site_properties.")
+
+
+def remove_leftover_skin_layers(context):
+    """Products.MimetypesRegistry no longer has a skin layer, remove it.
+    """
+    cleanUpSkinsTool(context)
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 53b8399..6e2dcc9 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -57,6 +57,12 @@ Add new Mockup 2.4.0 relateditems resource url.
            handler=".betas.addSortOnProperty"
            />
 
+      <gs:upgradeStep
+           title="Remove skins layer converted to browser resources"
+           description="Products.MimetypesRegistry Icons no longer with skins"
+           handler=".betas.remove_leftover_skin_layers"
+           />
+
     </gs:upgradeSteps>
 
 </configure>


