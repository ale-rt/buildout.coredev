Repository: plone.app.z3cform


Branch: refs/heads/1.x
Date: 2016-09-29T13:18:16+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/3ed66a1dc8e2b111f1a482e2cb0c6d7e93f341c3

In select widget, accept items as property or method.

This avoids breaking on some z3c.form versions.
See https://github.com/zopefoundation/z3c.form/issues/44

Files changed:
M CHANGES.rst
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 880181e..82f18e9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,10 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- In select widget, accept items as property or method.
+  This avoids breaking on some z3c.form versions.
+  See https://github.com/zopefoundation/z3c.form/issues/44
+  [maurits]
 
 
 1.2.1 (2016-04-29)
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index f3b3e2e..253a779 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -255,8 +255,16 @@ def _base_args(self):
         if not self.required:
             options['allowClear'] = True
 
+        base_items = self.items
+        if callable(base_items):
+            # items used to be a property in all widgets, then in the select
+            # widget it became a method, then in a few others too, but never in
+            # all, so this was reverted to let it be a property again.  Let's
+            # support both here to avoid breaking on some z3c.form versions.
+            # See https://github.com/zopefoundation/z3c.form/issues/44
+            base_items = base_items()
         items = []
-        for item in self.items():
+        for item in base_items:
             if not isinstance(item['content'], basestring):
                 item['content'] = translate(
                     item['content'],


Repository: plone.app.z3cform


Branch: refs/heads/1.x
Date: 2016-09-29T16:06:41+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/4ae827f13f39bbab57074b48f316b15a6a072742

Merge pull request #50 from plone/select-widget-items-callable-1x

In select widget, accept items as property or method. [1.x]

Files changed:
M CHANGES.rst
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 880181e..82f18e9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,10 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- In select widget, accept items as property or method.
+  This avoids breaking on some z3c.form versions.
+  See https://github.com/zopefoundation/z3c.form/issues/44
+  [maurits]
 
 
 1.2.1 (2016-04-29)
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index f3b3e2e..253a779 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -255,8 +255,16 @@ def _base_args(self):
         if not self.required:
             options['allowClear'] = True
 
+        base_items = self.items
+        if callable(base_items):
+            # items used to be a property in all widgets, then in the select
+            # widget it became a method, then in a few others too, but never in
+            # all, so this was reverted to let it be a property again.  Let's
+            # support both here to avoid breaking on some z3c.form versions.
+            # See https://github.com/zopefoundation/z3c.form/issues/44
+            base_items = base_items()
         items = []
-        for item in self.items():
+        for item in base_items:
             if not isinstance(item['content'], basestring):
                 item['content'] = translate(
                     item['content'],


