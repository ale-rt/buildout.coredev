Repository: plone.namedfile


Branch: refs/heads/3.0.x
Date: 2017-01-05T09:17:49-02:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/836d41b95034516102b4044fcdd94101266a1fc5

Add test to show the error

Files changed:
M plone/namedfile/tests/test_scaling.py

diff --git a/plone/namedfile/tests/test_scaling.py b/plone/namedfile/tests/test_scaling.py
index 9eeaf31..4b384d0 100644
--- a/plone/namedfile/tests/test_scaling.py
+++ b/plone/namedfile/tests/test_scaling.py
@@ -63,6 +63,9 @@ def testCreateScale(self):
         foo = self.scaling.scale('image', width=100, height=80)
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/jpeg')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/jpeg')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 80)
         self.assertEqual(foo.height, 80)
         self.assertImage(foo.data.data, 'JPEG', (80, 80))
@@ -78,6 +81,9 @@ def testGetScaleByName(self):
         foo = self.scaling.scale('image', scale='foo')
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/jpeg')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/jpeg')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 60)
         self.assertEqual(foo.height, 60)
         self.assertImage(foo.data.data, 'JPEG', (60, 60))


Repository: plone.namedfile


Branch: refs/heads/3.0.x
Date: 2017-01-05T10:25:56-02:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/53b91d7d54c17ebe5a08e66519fbdf3de9c8cea9

* Add changelog
* Change contentType attribute to str type

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5162fc7..b84c09a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix contentType attribute should be str type, what leads to validation errors (fixes `#38`_).
+  [rodfersou]
 
 
 3.0.10 (2016-09-07)
@@ -379,3 +380,6 @@ Fixes:
 ------------------
 
 * Initial release
+
+
+.. _`#38`: https://github.com/plone/plone.namedfile/issues/38
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index c60bb42..1b42e42 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -296,7 +296,7 @@ def create(self,
             return
         if result is not None:
             data, format_, dimensions = result
-            mimetype = u'image/{0}'.format(format_.lower())
+            mimetype = 'image/{0}'.format(format_.lower())
             value = orig_value.__class__(
                 data, contentType=mimetype, filename=orig_value.filename)
             value.fieldname = fieldname


Repository: plone.namedfile


Branch: refs/heads/3.0.x
Date: 2017-04-26T00:24:49+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/705176663a43fc800815601259c1299300352aca

Merge pull request #41 from plone/issue_38

Issue 38 - Scales create NamedBlobImage with wrong contentType field

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py
M plone/namedfile/tests/test_scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5162fc7..b84c09a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix contentType attribute should be str type, what leads to validation errors (fixes `#38`_).
+  [rodfersou]
 
 
 3.0.10 (2016-09-07)
@@ -379,3 +380,6 @@ Fixes:
 ------------------
 
 * Initial release
+
+
+.. _`#38`: https://github.com/plone/plone.namedfile/issues/38
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index c60bb42..1b42e42 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -296,7 +296,7 @@ def create(self,
             return
         if result is not None:
             data, format_, dimensions = result
-            mimetype = u'image/{0}'.format(format_.lower())
+            mimetype = 'image/{0}'.format(format_.lower())
             value = orig_value.__class__(
                 data, contentType=mimetype, filename=orig_value.filename)
             value.fieldname = fieldname
diff --git a/plone/namedfile/tests/test_scaling.py b/plone/namedfile/tests/test_scaling.py
index 9eeaf31..4b384d0 100644
--- a/plone/namedfile/tests/test_scaling.py
+++ b/plone/namedfile/tests/test_scaling.py
@@ -63,6 +63,9 @@ def testCreateScale(self):
         foo = self.scaling.scale('image', width=100, height=80)
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/jpeg')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/jpeg')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 80)
         self.assertEqual(foo.height, 80)
         self.assertImage(foo.data.data, 'JPEG', (80, 80))
@@ -78,6 +81,9 @@ def testGetScaleByName(self):
         foo = self.scaling.scale('image', scale='foo')
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/jpeg')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/jpeg')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 60)
         self.assertEqual(foo.height, 60)
         self.assertImage(foo.data.data, 'JPEG', (60, 60))


