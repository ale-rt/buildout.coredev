Repository: plone.protect


Branch: refs/heads/master
Date: 2017-08-02T17:41:48-03:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/2ceb09a7c66183499b9e63a12c90e983c3c50fe5

Catch AttributeError on transform

Files changed:
M CHANGES.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d3f9518..f8cf653 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Catch ``AttributeError`` on transform.
+  [hvelarde]
 
 Bug fixes:
 
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 78e7f20..2a37578 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -114,7 +114,7 @@ def parseTree(self, result, encoding):
             # output does odd character encodings
             result.serializer = html.tostring
             return result
-        except (TypeError, etree.ParseError):
+        except (AttributeError, TypeError, etree.ParseError):
             # XXX handle something special?
             logger.warn('error parsing dom, failure to add csrf '
                         'token to response for url %s' % self.request.URL)


Repository: plone.protect


Branch: refs/heads/master
Date: 2017-08-03T10:08:12+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.protect/commit/2af6ba8009c2ce7dc11c422af617698ec3521feb

Merge pull request #65 from plone/hvelarde-attributeerror

Catch AttributeError on transform

Files changed:
M CHANGES.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d3f9518..f8cf653 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Catch ``AttributeError`` on transform.
+  [hvelarde]
 
 Bug fixes:
 
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 78e7f20..2a37578 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -114,7 +114,7 @@ def parseTree(self, result, encoding):
             # output does odd character encodings
             result.serializer = html.tostring
             return result
-        except (TypeError, etree.ParseError):
+        except (AttributeError, TypeError, etree.ParseError):
             # XXX handle something special?
             logger.warn('error parsing dom, failure to add csrf '
                         'token to response for url %s' % self.request.URL)


