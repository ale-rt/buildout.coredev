Repository: Products.Archetypes


Branch: refs/heads/1.9.x
Date: 2017-04-19T11:00:58+02:00
Author: Paul Grunewald (pgrunewald) <paul.grunewald@gmail.com>
Commit: https://github.com/plone/Products.Archetypes/commit/fa081effacee2c588b1427660e2e9b5335f6f7a2

Fix bug with Widget's postback attribute

Files changed:
M CHANGES.rst
M Products/Archetypes/skins/archetypes/widgets/field.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index ad600c1..591bcbe 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix bug with Widget's postback attribute, that prevented fields from
+  being populated with the submitted empty value in the case of an error.
+  [pgrunewald]
 
 
 1.9.14 (2017-04-08)
@@ -35,8 +37,6 @@ Bug fixes:
 - no allowable_content_types for description (avoid validation)
   [tschorr]
 
-- *add item here*
-
 
 1.9.12 (2016-08-12)
 -------------------
diff --git a/Products/Archetypes/skins/archetypes/widgets/field.pt b/Products/Archetypes/skins/archetypes/widgets/field.pt
index 39e6a68..939554f 100644
--- a/Products/Archetypes/skins/archetypes/widgets/field.pt
+++ b/Products/Archetypes/skins/archetypes/widgets/field.pt
@@ -67,7 +67,7 @@
                     edit_accessor python:field.getEditAccessor(here);
                     getMethod python:(widget.populate and (edit_accessor or accessor)) or None;
                     value python:getMethod and getMethod();
-                    value python:widget.postback and request.get(fieldName, value) or value;
+                    value python:request.get(fieldName, value) if widget.postback else value;
                     portal python:context.portal_url.getPortalObject();
                     visCondition python:field.widget.testCondition(context.aq_inner.getParentNode(), portal, context);
                     error_id python:errors.get(fieldName)">


