Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2017-11-09T09:47:24+01:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/a6b3a3377a466818d235bd1333918e2d1bacc907

Fix querybuilder if SearchableText is a dict

Files changed:
M CHANGES.rst
M plone/app/querystring/querybuilder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ba8cea1..710cab7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,6 +16,9 @@ Bug fixes:
 
 - Fix tests with CMF 2.3. [davisagli]
 
+- Fix querybuilder if SearchableText is a dict {'query': '...'}
+  [tomgross]
+
 
 1.4.6 (2017-09-08)
 ------------------
diff --git a/plone/app/querystring/querybuilder.py b/plone/app/querystring/querybuilder.py
index 082670a..31689be 100644
--- a/plone/app/querystring/querybuilder.py
+++ b/plone/app/querystring/querybuilder.py
@@ -190,6 +190,8 @@ def number_of_results(self, query):
 
     def filter_query(self, query):
         text = query.get('SearchableText', None)
+        if isinstance(text, dict):
+            text = text.get('query', '')
         if text:
             query['SearchableText'] = self.munge_search_term(text)
         return query


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2017-11-09T11:59:48+01:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.querystring/commit/6b853a14086a3ea6ebb02b083f6dd266e21d6123

Merge pull request #83 from plone/fix_searchabletext_query

Fix querybuilder if SearchableText is a dict

Files changed:
M CHANGES.rst
M plone/app/querystring/querybuilder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ba8cea1..710cab7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,6 +16,9 @@ Bug fixes:
 
 - Fix tests with CMF 2.3. [davisagli]
 
+- Fix querybuilder if SearchableText is a dict {'query': '...'}
+  [tomgross]
+
 
 1.4.6 (2017-09-08)
 ------------------
diff --git a/plone/app/querystring/querybuilder.py b/plone/app/querystring/querybuilder.py
index 082670a..31689be 100644
--- a/plone/app/querystring/querybuilder.py
+++ b/plone/app/querystring/querybuilder.py
@@ -190,6 +190,8 @@ def number_of_results(self, query):
 
     def filter_query(self, query):
         text = query.get('SearchableText', None)
+        if isinstance(text, dict):
+            text = text.get('query', '')
         if text:
             query['SearchableText'] = self.munge_search_term(text)
         return query


