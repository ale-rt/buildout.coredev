Repository: plone.api


Branch: refs/heads/master
Date: 2017-09-23T19:24:40+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/plone.api/commit/93feda393e67af2ae3c1ef6cebd745aff4823fba

Change content.delete to allow obj=None and objects=[] or objects=None.

Files changed:
M CHANGES.rst
M src/plone/api/content.py
M src/plone/api/tests/test_content.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b88dc19..24f9569 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Change content.delete to allow both obj=None and objects=[] or objects=None. Fixes #383
+  [jaroel]
+
 - Let ``zope.i18n`` do the language negotiation for our ``translate`` function.
   Our ``get_current_translation`` does not always give the correct one, especially with combined languages:
   ``nl-be`` (Belgian/Flemish) should fall back to ``nl`` (Dutch).
diff --git a/src/plone/api/content.py b/src/plone/api/content.py
index 7bfb219..0516a97 100644
--- a/src/plone/api/content.py
+++ b/src/plone/api/content.py
@@ -193,9 +193,9 @@ def move(source=None, target=None, id=None, safe_id=False):
 
     # If no target is given the object is probably renamed
     if target and source.aq_parent is not target:
-            target.manage_pasteObjects(
-                source.aq_parent.manage_cutObjects(source_id),
-            )
+        target.manage_pasteObjects(
+            source.aq_parent.manage_cutObjects(source_id),
+        )
     else:
         target = source.aq_parent
 
@@ -296,7 +296,11 @@ def delete(obj=None, objects=None, check_linkintegrity=True):
 
     :Example: :ref:`content_delete_example`
     """
-    objects = objects or [obj]
+    objects = [obj] if obj else objects
+
+    # Return early if we have no objects to delete.
+    if not objects:
+        return
 
     if check_linkintegrity and NEW_LINKINTEGRITY:
         site = portal.get()
diff --git a/src/plone/api/tests/test_content.py b/src/plone/api/tests/test_content.py
index df00abc..a48a53e 100644
--- a/src/plone/api/tests/test_content.py
+++ b/src/plone/api/tests/test_content.py
@@ -732,6 +732,11 @@ def test_delete_multiple(self):
         self.assertNotIn('copy_of_about', container)
         self.assertNotIn('about', container['events'])
 
+    def test_delete_no_objs(self):
+        # Check that we allow passing in an empty list of objects.
+        api.content.delete(obj=None, objects=[])
+        api.content.delete(obj=None, objects=None)
+
     def test_delete_ignore_linkintegrity(self):
         """Test deleting a content item with a link pointed at it."""
         self._set_text(self.team, '<a href="contact">contact</a>')


Repository: plone.api


Branch: refs/heads/master
Date: 2017-09-23T19:40:07+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/plone.api/commit/3842d623b004ed70d157d3cd8e06e98d82448b68

We need to call with obj or objects.

Files changed:
M src/plone/api/tests/test_content.py

diff --git a/src/plone/api/tests/test_content.py b/src/plone/api/tests/test_content.py
index a48a53e..3b347c2 100644
--- a/src/plone/api/tests/test_content.py
+++ b/src/plone/api/tests/test_content.py
@@ -735,7 +735,6 @@ def test_delete_multiple(self):
     def test_delete_no_objs(self):
         # Check that we allow passing in an empty list of objects.
         api.content.delete(obj=None, objects=[])
-        api.content.delete(obj=None, objects=None)
 
     def test_delete_ignore_linkintegrity(self):
         """Test deleting a content item with a link pointed at it."""


Repository: plone.api


Branch: refs/heads/master
Date: 2017-09-25T09:32:05+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.api/commit/482c27216f6576da4d0dbe623860c0143e6bea3a

Merge pull request #387 from plone/383-content-delete

Change content.delete to allow obj=None and objects=[] or objects=None.

Files changed:
M CHANGES.rst
M src/plone/api/content.py
M src/plone/api/tests/test_content.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b88dc19..24f9569 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Change content.delete to allow both obj=None and objects=[] or objects=None. Fixes #383
+  [jaroel]
+
 - Let ``zope.i18n`` do the language negotiation for our ``translate`` function.
   Our ``get_current_translation`` does not always give the correct one, especially with combined languages:
   ``nl-be`` (Belgian/Flemish) should fall back to ``nl`` (Dutch).
diff --git a/src/plone/api/content.py b/src/plone/api/content.py
index 7bfb219..0516a97 100644
--- a/src/plone/api/content.py
+++ b/src/plone/api/content.py
@@ -193,9 +193,9 @@ def move(source=None, target=None, id=None, safe_id=False):
 
     # If no target is given the object is probably renamed
     if target and source.aq_parent is not target:
-            target.manage_pasteObjects(
-                source.aq_parent.manage_cutObjects(source_id),
-            )
+        target.manage_pasteObjects(
+            source.aq_parent.manage_cutObjects(source_id),
+        )
     else:
         target = source.aq_parent
 
@@ -296,7 +296,11 @@ def delete(obj=None, objects=None, check_linkintegrity=True):
 
     :Example: :ref:`content_delete_example`
     """
-    objects = objects or [obj]
+    objects = [obj] if obj else objects
+
+    # Return early if we have no objects to delete.
+    if not objects:
+        return
 
     if check_linkintegrity and NEW_LINKINTEGRITY:
         site = portal.get()
diff --git a/src/plone/api/tests/test_content.py b/src/plone/api/tests/test_content.py
index df00abc..3b347c2 100644
--- a/src/plone/api/tests/test_content.py
+++ b/src/plone/api/tests/test_content.py
@@ -732,6 +732,10 @@ def test_delete_multiple(self):
         self.assertNotIn('copy_of_about', container)
         self.assertNotIn('about', container['events'])
 
+    def test_delete_no_objs(self):
+        # Check that we allow passing in an empty list of objects.
+        api.content.delete(obj=None, objects=[])
+
     def test_delete_ignore_linkintegrity(self):
         """Test deleting a content item with a link pointed at it."""
         self._set_text(self.team, '<a href="contact">contact</a>')


