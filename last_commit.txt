Repository: plone.app.caching


Branch: refs/heads/master
Date: 2016-03-03T18:11:15+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/e0b9069fa5a3ff30876c392955d0f597a9efff21

Show status after synchronous purge if it is an error status.

I had a misconfiguration, where all purge requests were denied by
varnish because my ip address was not in the allowed list.  This gave
a status 504 on all purge requests, but this was nowhere visible.  The
controlpanel only showed 'The following items were purged:' with the
list I expected, no errors.

Files changed:
M CHANGES.rst
M plone/app/caching/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 930eb18..ccf44d1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Show status after synchronous purge if it is an error status.
+  [maurits]
 
 Fixes:
 
diff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py
index 3096afd..9bdcd0e 100644
--- a/plone/app/caching/browser/controlpanel.py
+++ b/plone/app/caching/browser/controlpanel.py
@@ -530,6 +530,8 @@ def purge(url):
                     log += " (X-Cache header: " + xcache + ")"
                 if xerror:
                     log += " -- " + xerror
+                if not str(status).startswith('2'):
+                    log += " -- WARNING status " + str(status)
                 self.purgeLog.append(log)
             else:
                 purger.purgeAsync(url)


Repository: plone.app.caching


Branch: refs/heads/master
Date: 2016-03-13T21:55:28+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/e0081c3118000f9a9d452ee58a9df1f0cf8543da

Merge pull request #22 from plone/maurits-report-purge-error-status

Show status after synchronous purge if it is an error status.

Files changed:
M CHANGES.rst
M plone/app/caching/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 930eb18..ccf44d1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Show status after synchronous purge if it is an error status.
+  [maurits]
 
 Fixes:
 
diff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py
index 3096afd..9bdcd0e 100644
--- a/plone/app/caching/browser/controlpanel.py
+++ b/plone/app/caching/browser/controlpanel.py
@@ -530,6 +530,8 @@ def purge(url):
                     log += " (X-Cache header: " + xcache + ")"
                 if xerror:
                     log += " -- " + xerror
+                if not str(status).startswith('2'):
+                    log += " -- WARNING status " + str(status)
                 self.purgeLog.append(log)
             else:
                 purger.purgeAsync(url)


