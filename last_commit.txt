Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2017-01-14T20:25:53+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e49f7a58dff116c516282f94fae6f81d25cdc2d4

Fixed tests with newer plone.app.discussion.

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testPortalCreation.py
M Products/CMFPlone/tests/testWorkflowTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6cc20ea..6aaca47 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -31,6 +31,11 @@ New features:
 Bug fixes:
 
 - Load some patches earlier, instead of in our initialize method.
+- Fixed workflow tests for new ``comment_one_state_workflow``.  [maurits]
+
+- Fixed sometimes failing search order tests.  [maurits]
+
+- Load some Products.CMFPlone.patches earlier, instead of in our initialize method.
   This is part of PloneHotfix20161129.
   [maurits]
 
diff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py
index a8be7a8..afa1e9c 100644
--- a/Products/CMFPlone/tests/testPortalCreation.py
+++ b/Products/CMFPlone/tests/testPortalCreation.py
@@ -614,10 +614,10 @@ def testMemberHasViewGroupsPermission(self):
         self.assertTrue(member_has_permission['selected'])
 
     def testDiscussionItemWorkflow(self):
-        # By default the discussion item has the one_state_workflow
+        # By default the discussion item has the comment_one_state_workflow
         self.assertEqual(
             self.workflow.getChainForPortalType('Discussion Item'),
-            ('one_state_workflow',))
+            ('comment_one_state_workflow',))
 
     def testFolderHasFolderListingView(self):
         # Folder type should allow 'folder_listing'
diff --git a/Products/CMFPlone/tests/testWorkflowTool.py b/Products/CMFPlone/tests/testWorkflowTool.py
index dca6b3d..0b44aca 100644
--- a/Products/CMFPlone/tests/testWorkflowTool.py
+++ b/Products/CMFPlone/tests/testWorkflowTool.py
@@ -25,6 +25,7 @@ class IDocument(Interface):
     'one_state_workflow': ('published',),
     'plone_workflow': ('pending', 'private', 'published', 'visible',),
     'simple_publication_workflow': ('private', 'published', 'pending',),
+    'comment_one_state_workflow': ('published',),
     'comment_review_workflow': ('pending', 'published',)
 }
 # then we join all states into one master list


Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2017-01-16T16:39:37+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e4812d7e6415c2d0cbb6fc19e354006274ec65f1

Merge pull request #1910 from plone/comment-one-state-workflow-50

Fixed tests with newer plone.app.discussion.

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testPortalCreation.py
M Products/CMFPlone/tests/testWorkflowTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6cc20ea..6aaca47 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -31,6 +31,11 @@ New features:
 Bug fixes:
 
 - Load some patches earlier, instead of in our initialize method.
+- Fixed workflow tests for new ``comment_one_state_workflow``.  [maurits]
+
+- Fixed sometimes failing search order tests.  [maurits]
+
+- Load some Products.CMFPlone.patches earlier, instead of in our initialize method.
   This is part of PloneHotfix20161129.
   [maurits]
 
diff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py
index a8be7a8..afa1e9c 100644
--- a/Products/CMFPlone/tests/testPortalCreation.py
+++ b/Products/CMFPlone/tests/testPortalCreation.py
@@ -614,10 +614,10 @@ def testMemberHasViewGroupsPermission(self):
         self.assertTrue(member_has_permission['selected'])
 
     def testDiscussionItemWorkflow(self):
-        # By default the discussion item has the one_state_workflow
+        # By default the discussion item has the comment_one_state_workflow
         self.assertEqual(
             self.workflow.getChainForPortalType('Discussion Item'),
-            ('one_state_workflow',))
+            ('comment_one_state_workflow',))
 
     def testFolderHasFolderListingView(self):
         # Folder type should allow 'folder_listing'
diff --git a/Products/CMFPlone/tests/testWorkflowTool.py b/Products/CMFPlone/tests/testWorkflowTool.py
index dca6b3d..0b44aca 100644
--- a/Products/CMFPlone/tests/testWorkflowTool.py
+++ b/Products/CMFPlone/tests/testWorkflowTool.py
@@ -25,6 +25,7 @@ class IDocument(Interface):
     'one_state_workflow': ('published',),
     'plone_workflow': ('pending', 'private', 'published', 'visible',),
     'simple_publication_workflow': ('private', 'published', 'pending',),
+    'comment_one_state_workflow': ('published',),
     'comment_review_workflow': ('pending', 'published',)
 }
 # then we join all states into one master list


