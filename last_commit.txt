Repository: plone.api


Branch: refs/heads/master
Date: 2016-10-29T22:38:43+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.api/commit/3a530d2102eca0148cd57f863606cb56e063fd34

Fix an AttributeError in `api.user.revoke_roles`

Files changed:
M docs/CHANGES.rst
M src/plone/api/user.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 2a9c5d8..d4a2044 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -5,6 +5,8 @@ Changelog
 ------------------
 
 Fixes:
+- Fix an AttributeError in `api.user.revoke_roles`
+  [ale-rt]
 
 - Typo in the documentation.
   [ale-rt]
diff --git a/src/plone/api/user.py b/src/plone/api/user.py
index 85bcc06..f3f7b91 100644
--- a/src/plone/api/user.py
+++ b/src/plone/api/user.py
@@ -408,7 +408,8 @@ def revoke_roles(username=None, user=None, obj=None, roles=None):
     if obj is not None:
         # if obj, get only a list of local roles, without inherited ones
         inherit = False
-    actual_roles = get_roles(user=user, obj=obj, inherit=inherit)
+
+    actual_roles = list(get_roles(user=user, obj=obj, inherit=inherit))
     if actual_roles.count('Anonymous'):
         actual_roles.remove('Anonymous')
     if actual_roles.count('Authenticated'):


Repository: plone.api


Branch: refs/heads/master
Date: 2016-10-29T22:55:22+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.api/commit/58e49e769745a911faa83b13c3c22d3052985e1b

Merge pull request #321 from plone/fix-revoke-users

Fix an AttributeError in `api.user.revoke_roles`

Files changed:
M docs/CHANGES.rst
M src/plone/api/user.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index d485608..c757d89 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -5,6 +5,8 @@ Changelog
 ------------------
 
 Fixes:
+- Fix an AttributeError in `api.user.revoke_roles`
+  [ale-rt]
 
 - Remove print statements and use @security decorators to make
   code-analysis happy.
diff --git a/src/plone/api/user.py b/src/plone/api/user.py
index 85bcc06..f3f7b91 100644
--- a/src/plone/api/user.py
+++ b/src/plone/api/user.py
@@ -408,7 +408,8 @@ def revoke_roles(username=None, user=None, obj=None, roles=None):
     if obj is not None:
         # if obj, get only a list of local roles, without inherited ones
         inherit = False
-    actual_roles = get_roles(user=user, obj=obj, inherit=inherit)
+
+    actual_roles = list(get_roles(user=user, obj=obj, inherit=inherit))
     if actual_roles.count('Anonymous'):
         actual_roles.remove('Anonymous')
     if actual_roles.count('Authenticated'):


