Repository: plone.app.content


Branch: refs/heads/master
Date: 2016-08-23T16:52:57+02:00
Author: Rene Jochum (pcdummy) <rene@jochums.at>
Commit: https://github.com/plone/plone.app.content/commit/dafc7024a7daa96da38691015d16164cdcab6af2

Fix a circular reference error in the json dumper.

Signed-off-by: Rene Jochum &lt;rene@jochums.at&gt;

Files changed:
M CHANGES.rst
M plone/app/content/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index eb8fcc2..fc18cee 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix a json "circular reference detected" error which happened when the json dumper got unparsable data types.
+  [pcdummy]
 
 
 3.2 (2016-08-18)
diff --git a/plone/app/content/utils.py b/plone/app/content/utils.py
index 29ae09b..45d3237 100644
--- a/plone/app/content/utils.py
+++ b/plone/app/content/utils.py
@@ -1,4 +1,6 @@
 # -*- coding: utf-8 -*-
+from DateTime import DateTime
+
 import Missing
 import datetime
 import json
@@ -9,6 +11,11 @@ def custom_json_handler(obj):
         return None
     if type(obj) in (datetime.datetime, datetime.date):
         return obj.isoformat()
+    if type(obj) == DateTime:
+        dt = DateTime(obj)
+        return dt.ISO()
+    if type(obj) == set:
+        return list(obj)
     return obj
 
 


Repository: plone.app.content


Branch: refs/heads/master
Date: 2016-08-26T01:32:38+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/b87e937da9616183415b094df84f35114fa0be1f

Merge pull request #104 from plone/circular_reference_fix

Fix a circular reference error in the json dumper.

Files changed:
M CHANGES.rst
M plone/app/content/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index eb8fcc2..fc18cee 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix a json "circular reference detected" error which happened when the json dumper got unparsable data types.
+  [pcdummy]
 
 
 3.2 (2016-08-18)
diff --git a/plone/app/content/utils.py b/plone/app/content/utils.py
index 29ae09b..45d3237 100644
--- a/plone/app/content/utils.py
+++ b/plone/app/content/utils.py
@@ -1,4 +1,6 @@
 # -*- coding: utf-8 -*-
+from DateTime import DateTime
+
 import Missing
 import datetime
 import json
@@ -9,6 +11,11 @@ def custom_json_handler(obj):
         return None
     if type(obj) in (datetime.datetime, datetime.date):
         return obj.isoformat()
+    if type(obj) == DateTime:
+        dt = DateTime(obj)
+        return dt.ISO()
+    if type(obj) == set:
+        return list(obj)
     return obj
 
 


