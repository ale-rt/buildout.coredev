Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2016-12-08T11:29:50+01:00
Author: Sebastian Gottfried (sebasgo) <sebastian.gottfried@posteo.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/ad3251068dfd0c0db78af7c0b129e3ff709c98b7

WorkflowTool: Include Inactive Content In Worklists

WorkflowTool.getWorklistsResults uses the catalog to gather its results.
By default the catalog tool excludes inactive content from the search
results if the current user lacks the permission to view inactive
content in the current context. This can result in incomplete results,
since the method is supposed to return the work list results for the
whole site.

This commit bypasses the the catalog's inactive content filter.

Files changed:
M Products/CMFPlone/WorkflowTool.py
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/WorkflowTool.py b/Products/CMFPlone/WorkflowTool.py
index a691ff2..e5f5e82 100644
--- a/Products/CMFPlone/WorkflowTool.py
+++ b/Products/CMFPlone/WorkflowTool.py
@@ -228,6 +228,10 @@ def getWorklistsResults(self):
                     # content in *all* languages
                     if 'Language' not in catalog_vars:
                         catalog_vars['Language'] = 'all'
+                    # Include inactive content in result list. This is
+                    # especially important for content scheduled to go public
+                    # in the future, but needs to be reviewed before this.
+                    catalog_vars['show_inactive'] = True
                     for result in catalog.searchResults(catalog_vars):
                         o = result.getObject()
                         if o \
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 1933ea0..d02eeb0 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -32,6 +32,7 @@ Bug fixes:
 
 - Apply security hotfix 20160830 for ``isURLInPortal``.  [maurits]
 
+- Include inactive content in worklists.  [sebasgo]
 
 4.3.11 (2016-08-15)
 -------------------


Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2016-12-12T21:39:33+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/74c5f0e2787a244ca77479a72ed586dff992d28e

Merge pull request #1868 from sebasgo/4.3.x

WorkflowTool: Include Inactive Content In Worklists

Files changed:
M Products/CMFPlone/WorkflowTool.py
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/WorkflowTool.py b/Products/CMFPlone/WorkflowTool.py
index a691ff2..e5f5e82 100644
--- a/Products/CMFPlone/WorkflowTool.py
+++ b/Products/CMFPlone/WorkflowTool.py
@@ -228,6 +228,10 @@ def getWorklistsResults(self):
                     # content in *all* languages
                     if 'Language' not in catalog_vars:
                         catalog_vars['Language'] = 'all'
+                    # Include inactive content in result list. This is
+                    # especially important for content scheduled to go public
+                    # in the future, but needs to be reviewed before this.
+                    catalog_vars['show_inactive'] = True
                     for result in catalog.searchResults(catalog_vars):
                         o = result.getObject()
                         if o \
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 1933ea0..d02eeb0 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -32,6 +32,7 @@ Bug fixes:
 
 - Apply security hotfix 20160830 for ``isURLInPortal``.  [maurits]
 
+- Include inactive content in worklists.  [sebasgo]
 
 4.3.11 (2016-08-15)
 -------------------


