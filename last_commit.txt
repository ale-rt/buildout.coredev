Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2016-04-20T20:31:30+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.ATContentTypes/commit/4b17647d7365275022cbb3858204f0df19f6e0d9

Fixed AttributeError unmarkCreationFlag during installation.

This could happen when there was already a Members folder from
plone.app.contenttypes.

Fixes https://github.com/plone/Products.CMFPlone/issues/1519

Files changed:
M CHANGES.rst
M Products/ATContentTypes/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 33d47cd..9192c5b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,10 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed AttributeError ``unmarkCreationFlag`` during installation.
+  This could happen when there was already a Members folder from
+  ``plone.app.contenttypes``.  Fixes issue
+  https://github.com/plone/Products.CMFPlone/issues/1519 [maurits]
 
 
 2.2.11 (2016-02-14)
diff --git a/Products/ATContentTypes/setuphandlers.py b/Products/ATContentTypes/setuphandlers.py
index e332bcb..1463879 100644
--- a/Products/ATContentTypes/setuphandlers.py
+++ b/Products/ATContentTypes/setuphandlers.py
@@ -256,7 +256,11 @@ def setupPortalContent(p):
         members.setTitle(members_title)
         members.setDescription(members_desc)
         members.setOrdering('unordered')
-        members.unmarkCreationFlag()
+        if getattr(members, 'unmarkCreationFlag', None) is not None:
+            # An Archetypes object that we have just created.  If the attribute
+            # is not there, members is probably a plone.app.contenttypes
+            # folder, which does not need this.
+            members.unmarkCreationFlag()
         members.setLanguage(language)
         members.reindexObject()
 


