Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2017-07-20T13:49:39+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.contentmigration/commit/0b6d8f4a49dc5156f773c89e3c8e49aac2251dca

Unpack brains to be able to log broken catalog-records during migration

Files changed:
M Products/contentmigration/basemigrator/walker.py
M Products/contentmigration/walker.py

diff --git a/Products/contentmigration/basemigrator/walker.py b/Products/contentmigration/basemigrator/walker.py
index 2c32753..dbe5499 100644
--- a/Products/contentmigration/basemigrator/walker.py
+++ b/Products/contentmigration/basemigrator/walker.py
@@ -269,12 +269,18 @@ def walk(self):
         if limit:
             brains = brains[:limit]
 
+        # unpack to be able to log brains that break during migration
+        brains = [i for i in brains]
+
         for brain in brains:
             try:
                 obj = brain.getObject()
             except AttributeError:
                 LOG.error("Couldn't access %s" % brain.getPath())
                 continue
+            except KeyError:
+                LOG.error("Couldn't access RID %s" % brain.getRID())
+                continue
             try:
                 state = obj._p_changed
             except:
diff --git a/Products/contentmigration/walker.py b/Products/contentmigration/walker.py
index d94afb0..39acc0d 100644
--- a/Products/contentmigration/walker.py
+++ b/Products/contentmigration/walker.py
@@ -59,12 +59,18 @@ def walk(self):
         if limit:
             brains = brains[:limit]
 
+        # unpack to be able to log brains that break during migration
+        brains = [i for i in brains]
+
         for brain in brains:
             try:
                 obj = brain.getObject()
             except AttributeError:
                 LOG.error("Couldn't access %s" % brain.getPath())
                 continue
+            except KeyError:
+                LOG.error("Couldn't access RID %s" % brain.getRID())
+                continue
 
             if self.callBefore is not None and callable(self.callBefore):
                 if self.callBefore(obj, **self.kwargs) == False:


Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2017-08-29T19:39:46+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.contentmigration/commit/d50230ea719aacf469104447310311f91c369aa2

add changenote

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 8d334d2..16ed88b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Unpack brains to be able to log broken catalog-records during migration.
+  [pbauer]
 
 
 2.1.16 (2017-03-09)


Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2017-08-30T21:17:14-04:00
Author: Eric Steele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/Products.contentmigration/commit/c8c9e31fee9ed200f93c936e0da63785abcd8bdb

Merge pull request #15 from plone/unpack_brains_during_migration

Unpack brains to be able to log broken catalog-records during migration

Files changed:
M CHANGES.rst
M Products/contentmigration/basemigrator/walker.py
M Products/contentmigration/walker.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 8d334d2..16ed88b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Unpack brains to be able to log broken catalog-records during migration.
+  [pbauer]
 
 
 2.1.16 (2017-03-09)
diff --git a/Products/contentmigration/basemigrator/walker.py b/Products/contentmigration/basemigrator/walker.py
index 2c32753..dbe5499 100644
--- a/Products/contentmigration/basemigrator/walker.py
+++ b/Products/contentmigration/basemigrator/walker.py
@@ -269,12 +269,18 @@ def walk(self):
         if limit:
             brains = brains[:limit]
 
+        # unpack to be able to log brains that break during migration
+        brains = [i for i in brains]
+
         for brain in brains:
             try:
                 obj = brain.getObject()
             except AttributeError:
                 LOG.error("Couldn't access %s" % brain.getPath())
                 continue
+            except KeyError:
+                LOG.error("Couldn't access RID %s" % brain.getRID())
+                continue
             try:
                 state = obj._p_changed
             except:
diff --git a/Products/contentmigration/walker.py b/Products/contentmigration/walker.py
index d94afb0..39acc0d 100644
--- a/Products/contentmigration/walker.py
+++ b/Products/contentmigration/walker.py
@@ -59,12 +59,18 @@ def walk(self):
         if limit:
             brains = brains[:limit]
 
+        # unpack to be able to log brains that break during migration
+        brains = [i for i in brains]
+
         for brain in brains:
             try:
                 obj = brain.getObject()
             except AttributeError:
                 LOG.error("Couldn't access %s" % brain.getPath())
                 continue
+            except KeyError:
+                LOG.error("Couldn't access RID %s" % brain.getRID())
+                continue
 
             if self.callBefore is not None and callable(self.callBefore):
                 if self.callBefore(obj, **self.kwargs) == False:


