Repository: plone.formwidget.querystring


Branch: refs/heads/master
Date: 2016-05-09T15:23:00+02:00
Author: Beno√Æt Suttor (bsuttor) <bsuttor@imio.be>
Commit: https://github.com/plone/plone.formwidget.querystring/commit/b0f82fdf5697494175f03f901280dd4222857c07

Fix way to decode utf8 into template

Files changed:
M CHANGES.rst
M plone/formwidget/querystring/input.pt
M plone/formwidget/querystring/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index dfc6b63..9f56b24 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,13 +4,10 @@ Changelog
 1.1.6 (unreleased)
 ------------------
 
-New:
-
-- *add item here*
-
 Fixes:
 
-- *add item here*
+- Fix way to decode utf-8 into template.
+  [bsuttor]
 
 
 1.1.5 (2015-07-18)
diff --git a/plone/formwidget/querystring/input.pt b/plone/formwidget/querystring/input.pt
index 13e21bf..73474c4 100644
--- a/plone/formwidget/querystring/input.pt
+++ b/plone/formwidget/querystring/input.pt
@@ -44,7 +44,7 @@
                         <tal:values repeat="index python:indexes[row.i]['values'].keys()">
                             <label>
                                 <input type="checkbox" name="form.widgets.query.v:records:list"
-                                       tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:index.decode('utf-8');
+                                       tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:view.decode(index);
                                        checked python: row.has_key('v') and index in row.v and 'checked' or nothing"/>
                                 <span tal:content="python:indexes[row.i]['values'][index]['title']"/>
                             </label>
@@ -80,7 +80,7 @@
 			    tal:attributes="name python:str(fieldName)+'.v:records'; value python:row['v']"/>
 		     <span i18n:translate="">days</span>
 		</div>
-		
+
                 <input class="querywidget queryvalue relativePathWidget"
                        autocomplete="off" type="text" name="form.widgets.query.v:records"
                        tal:attributes="name python:str(fieldName)+'.v:records'; value python:row['v']"
@@ -123,7 +123,7 @@
                 <dd>
                     <tal:values repeat="index python:indexes[request.form['addindex']]['values'].keys()">
                         <label>
-                            <input type="checkbox" name="form.widgets.query.v:records:list" tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:index.decode('utf-8')" />
+                            <input type="checkbox" name="form.widgets.query.v:records:list" tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:view.decode(index)" />
                             <span tal:content="python:indexes[request.form['addindex']]['values'][index]['title']"/>
                         </label>
                     </tal:values>
@@ -141,7 +141,7 @@
             <div class="querywidget queryvalue dateWidget"
                  tal:condition="python:indexes[request.form['addindex']]['operators'][request.form['addoperator']]['widget'] == 'DateWidget'">
                 <input autocomplete="off" type="text" class="queryvalue" tal:attributes="name python:str(fieldName)+'.v:records';" name="form.widgets.query.v:records" />
-		
+
             </div>
 
             <div class="querywidget queryvalue dateRangeWidget"
diff --git a/plone/formwidget/querystring/widget.py b/plone/formwidget/querystring/widget.py
index d84ecee..fcf2311 100644
--- a/plone/formwidget/querystring/widget.py
+++ b/plone/formwidget/querystring/widget.py
@@ -11,6 +11,7 @@
 from plone.app.querystring.interfaces import IQuerystringRegistryReader
 from plone.formwidget.querystring.interfaces import IQueryStringWidget
 from plone.registry.interfaces import IRegistry
+from Products.CMFPlone.utils import safe_unicode
 
 
 class QueryStringWidget(Widget):
@@ -54,7 +55,6 @@ def SearchResults(self):
         return getMultiAdapter((listing, self.request),
             name='display_query_results')(**options)
 
-
     def js(self):
         language = getattr(self.request, 'LANGUAGE', 'en')
         calendar = self.request.locale.dates.calendars[self.calendar_type]
@@ -81,6 +81,9 @@ def js(self):
                 });
             </script>''' % dict(defaultlang=defaultlang, localize=localize)
 
+    def decode(self, value):
+        return safe_unicode(value)
+
 
 @implementer(z3c.form.interfaces.IFieldWidget)
 def QueryStringFieldWidget(field, request):


Repository: plone.formwidget.querystring


Branch: refs/heads/master
Date: 2016-05-10T23:06:40+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.formwidget.querystring/commit/09312ce9be572bb09eb0c8bcec38e1b803f0e8fa

Merge pull request #12 from plone/fix-decode-utf8-template

Fix way to decode utf8 into template

Files changed:
M CHANGES.rst
M plone/formwidget/querystring/input.pt
M plone/formwidget/querystring/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index dfc6b63..9f56b24 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,13 +4,10 @@ Changelog
 1.1.6 (unreleased)
 ------------------
 
-New:
-
-- *add item here*
-
 Fixes:
 
-- *add item here*
+- Fix way to decode utf-8 into template.
+  [bsuttor]
 
 
 1.1.5 (2015-07-18)
diff --git a/plone/formwidget/querystring/input.pt b/plone/formwidget/querystring/input.pt
index 13e21bf..73474c4 100644
--- a/plone/formwidget/querystring/input.pt
+++ b/plone/formwidget/querystring/input.pt
@@ -44,7 +44,7 @@
                         <tal:values repeat="index python:indexes[row.i]['values'].keys()">
                             <label>
                                 <input type="checkbox" name="form.widgets.query.v:records:list"
-                                       tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:index.decode('utf-8');
+                                       tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:view.decode(index);
                                        checked python: row.has_key('v') and index in row.v and 'checked' or nothing"/>
                                 <span tal:content="python:indexes[row.i]['values'][index]['title']"/>
                             </label>
@@ -80,7 +80,7 @@
 			    tal:attributes="name python:str(fieldName)+'.v:records'; value python:row['v']"/>
 		     <span i18n:translate="">days</span>
 		</div>
-		
+
                 <input class="querywidget queryvalue relativePathWidget"
                        autocomplete="off" type="text" name="form.widgets.query.v:records"
                        tal:attributes="name python:str(fieldName)+'.v:records'; value python:row['v']"
@@ -123,7 +123,7 @@
                 <dd>
                     <tal:values repeat="index python:indexes[request.form['addindex']]['values'].keys()">
                         <label>
-                            <input type="checkbox" name="form.widgets.query.v:records:list" tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:index.decode('utf-8')" />
+                            <input type="checkbox" name="form.widgets.query.v:records:list" tal:attributes="name python:str(fieldName)+'.v:records:list'; value python:view.decode(index)" />
                             <span tal:content="python:indexes[request.form['addindex']]['values'][index]['title']"/>
                         </label>
                     </tal:values>
@@ -141,7 +141,7 @@
             <div class="querywidget queryvalue dateWidget"
                  tal:condition="python:indexes[request.form['addindex']]['operators'][request.form['addoperator']]['widget'] == 'DateWidget'">
                 <input autocomplete="off" type="text" class="queryvalue" tal:attributes="name python:str(fieldName)+'.v:records';" name="form.widgets.query.v:records" />
-		
+
             </div>
 
             <div class="querywidget queryvalue dateRangeWidget"
diff --git a/plone/formwidget/querystring/widget.py b/plone/formwidget/querystring/widget.py
index d84ecee..fcf2311 100644
--- a/plone/formwidget/querystring/widget.py
+++ b/plone/formwidget/querystring/widget.py
@@ -11,6 +11,7 @@
 from plone.app.querystring.interfaces import IQuerystringRegistryReader
 from plone.formwidget.querystring.interfaces import IQueryStringWidget
 from plone.registry.interfaces import IRegistry
+from Products.CMFPlone.utils import safe_unicode
 
 
 class QueryStringWidget(Widget):
@@ -54,7 +55,6 @@ def SearchResults(self):
         return getMultiAdapter((listing, self.request),
             name='display_query_results')(**options)
 
-
     def js(self):
         language = getattr(self.request, 'LANGUAGE', 'en')
         calendar = self.request.locale.dates.calendars[self.calendar_type]
@@ -81,6 +81,9 @@ def js(self):
                 });
             </script>''' % dict(defaultlang=defaultlang, localize=localize)
 
+    def decode(self, value):
+        return safe_unicode(value)
+
 
 @implementer(z3c.form.interfaces.IFieldWidget)
 def QueryStringFieldWidget(field, request):


