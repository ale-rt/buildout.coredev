Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2017-02-24T15:36:25+01:00
Author: Harald Friessnegger (frisi) <harald@webmeisterei.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/22e6eeefccd91e706f6a7b1b1194cd5818cd5033

improve listing in link dialog

* crop description to transmit less json data
* show path in alt-text to distinguish articles with the same title

Files changed:
M CHANGES.rst
M Products/TinyMCE/adapters/JSONFolderListing.py
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js

diff --git a/CHANGES.rst b/CHANGES.rst
index ec81c15..8667bbe 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,7 +11,12 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Crop description text in link dialog to 60 chars
+  (less json data to transmit for folders containing a lot of articles)
+  [fRiSi]
+
+- Show path in alt-text of articles too (to distinguish Items having the
+  same title) [fRiSi]
 
 Bug fixes:
 
diff --git a/Products/TinyMCE/adapters/JSONFolderListing.py b/Products/TinyMCE/adapters/JSONFolderListing.py
index 8db9699..22967e5 100644
--- a/Products/TinyMCE/adapters/JSONFolderListing.py
+++ b/Products/TinyMCE/adapters/JSONFolderListing.py
@@ -106,9 +106,9 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
             results['path'] = self.getBreadcrumbs()
 
         plone_layout = self.context.restrictedTraverse('@@plone_layout', None)
+        plone_view = self.context.restrictedTraverse('@@plone')
         if plone_layout is None:
             # Plone 3
-            plone_view = self.context.restrictedTraverse('@@plone')
             getIcon = lambda brain: plone_view.getIcon(brain).html_tag()
         else:
             # Plone >= 4
@@ -120,6 +120,7 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
         query.update({'portal_type': filter_portal_types,
                       'sort_on': 'getObjPositionInParent',
                       'path': {'query': path, 'depth': 1}})
+
         for brain in portal_catalog(**query):
 
             description = ''
@@ -128,6 +129,7 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
                     description = unicode(brain.Description, 'utf-8', 'ignore')
                 elif type(brain.Description) == unicode:
                     description = brain.Description
+                description = plone_view.cropText(description, 60)
 
             catalog_results.append({
                 'id': brain.getId,
@@ -140,6 +142,7 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
                 'icon': getIcon(brain),
                 'description': description,
                 'is_folderish': brain.is_folderish,
+                'path': brain.getPath(),
                 })
 
         # add catalog_ressults
diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
index 13f3403..5551aa3 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
@@ -882,7 +882,7 @@ BrowserDialog.prototype.getFolderListing = function (context_url, method) {
                                 ]);
                             } else {
                                 jq.merge(item_html, [
-                                    '<div class="item list ' + (i % 2 === 0 ? 'even' : 'odd') + '" title="' + item.description + '">',
+                                    '<div class="item list ' + (i % 2 === 0 ? 'even' : 'odd') + '" title="' + item.description + ((item.description) ? '&#13;&#13;' : '') + item.path + '">',
                                         '<input href="' + item.url + '" ',
                                             'type="radio" class="noborder" style="margin: 0; width: 16px" name="internallink" value="',
                                             'resolveuid/' + item.uid ,


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2017-02-24T17:54:23+01:00
Author: Harald Friessnegger (frisi) <harald@webmeisterei.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/a2fb93c6854ca6f2470b6a9e0c36522c29504755

add path on search results too

Files changed:
M Products/TinyMCE/adapters/JSONSearch.py

diff --git a/Products/TinyMCE/adapters/JSONSearch.py b/Products/TinyMCE/adapters/JSONSearch.py
index 82daa75..0c8b299 100644
--- a/Products/TinyMCE/adapters/JSONSearch.py
+++ b/Products/TinyMCE/adapters/JSONSearch.py
@@ -51,6 +51,7 @@ def getSearchResults(self, filter_portal_types, searchtext):
                     'icon': getIcon(brain),
                     'description': brain.Description,
                     'is_folderish': brain.is_folderish,
+                    'path': brain.getPath(),
                     } for brain in brains if brain]
 
         # add catalog_results


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2017-02-25T17:37:52+01:00
Author: Harald Friessnegger (frisi) <harald@webmeisterei.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/53e9694ab319256504f4e579d5b7f8f817e68824

show description and path on folderish items too

Files changed:
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js

diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
index 5551aa3..17f3d6c 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
@@ -875,7 +875,7 @@ BrowserDialog.prototype.getFolderListing = function (context_url, method) {
                                 }
                                 jq.merge(folder_html, [
                                         item.icon,
-                                        '<a href="' + item.url + '" class="folderlink contenttype-' + item.normalized_type + ' state-' + item.review_state + '">',
+                                        '<a href="' + item.url + '" class="folderlink contenttype-' + item.normalized_type + ' state-' + item.review_state + '" title="' + item.description + ((item.description) ? '&#13;&#13;' : '') + item.path + '">',
                                             item.title,
                                         '</a>',
                                     '</div>'


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2017-02-27T09:05:13+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.TinyMCE/commit/18df15e06c2826a82fc7ae9bb1d01cdf5413d864

Merge pull request #152 from plone/display-path

improve item-listing in link dialog

Files changed:
M CHANGES.rst
M Products/TinyMCE/adapters/JSONFolderListing.py
M Products/TinyMCE/adapters/JSONSearch.py
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js

diff --git a/CHANGES.rst b/CHANGES.rst
index ec81c15..8667bbe 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,7 +11,12 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Crop description text in link dialog to 60 chars
+  (less json data to transmit for folders containing a lot of articles)
+  [fRiSi]
+
+- Show path in alt-text of articles too (to distinguish Items having the
+  same title) [fRiSi]
 
 Bug fixes:
 
diff --git a/Products/TinyMCE/adapters/JSONFolderListing.py b/Products/TinyMCE/adapters/JSONFolderListing.py
index 8db9699..22967e5 100644
--- a/Products/TinyMCE/adapters/JSONFolderListing.py
+++ b/Products/TinyMCE/adapters/JSONFolderListing.py
@@ -106,9 +106,9 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
             results['path'] = self.getBreadcrumbs()
 
         plone_layout = self.context.restrictedTraverse('@@plone_layout', None)
+        plone_view = self.context.restrictedTraverse('@@plone')
         if plone_layout is None:
             # Plone 3
-            plone_view = self.context.restrictedTraverse('@@plone')
             getIcon = lambda brain: plone_view.getIcon(brain).html_tag()
         else:
             # Plone >= 4
@@ -120,6 +120,7 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
         query.update({'portal_type': filter_portal_types,
                       'sort_on': 'getObjPositionInParent',
                       'path': {'query': path, 'depth': 1}})
+
         for brain in portal_catalog(**query):
 
             description = ''
@@ -128,6 +129,7 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
                     description = unicode(brain.Description, 'utf-8', 'ignore')
                 elif type(brain.Description) == unicode:
                     description = brain.Description
+                description = plone_view.cropText(description, 60)
 
             catalog_results.append({
                 'id': brain.getId,
@@ -140,6 +142,7 @@ def getListing(self, filter_portal_types, rooted, document_base_url, upload_type
                 'icon': getIcon(brain),
                 'description': description,
                 'is_folderish': brain.is_folderish,
+                'path': brain.getPath(),
                 })
 
         # add catalog_ressults
diff --git a/Products/TinyMCE/adapters/JSONSearch.py b/Products/TinyMCE/adapters/JSONSearch.py
index 82daa75..0c8b299 100644
--- a/Products/TinyMCE/adapters/JSONSearch.py
+++ b/Products/TinyMCE/adapters/JSONSearch.py
@@ -51,6 +51,7 @@ def getSearchResults(self, filter_portal_types, searchtext):
                     'icon': getIcon(brain),
                     'description': brain.Description,
                     'is_folderish': brain.is_folderish,
+                    'path': brain.getPath(),
                     } for brain in brains if brain]
 
         # add catalog_results
diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
index 13f3403..17f3d6c 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
@@ -875,14 +875,14 @@ BrowserDialog.prototype.getFolderListing = function (context_url, method) {
                                 }
                                 jq.merge(folder_html, [
                                         item.icon,
-                                        '<a href="' + item.url + '" class="folderlink contenttype-' + item.normalized_type + ' state-' + item.review_state + '">',
+                                        '<a href="' + item.url + '" class="folderlink contenttype-' + item.normalized_type + ' state-' + item.review_state + '" title="' + item.description + ((item.description) ? '&#13;&#13;' : '') + item.path + '">',
                                             item.title,
                                         '</a>',
                                     '</div>'
                                 ]);
                             } else {
                                 jq.merge(item_html, [
-                                    '<div class="item list ' + (i % 2 === 0 ? 'even' : 'odd') + '" title="' + item.description + '">',
+                                    '<div class="item list ' + (i % 2 === 0 ? 'even' : 'odd') + '" title="' + item.description + ((item.description) ? '&#13;&#13;' : '') + item.path + '">',
                                         '<input href="' + item.url + '" ',
                                             'type="radio" class="noborder" style="margin: 0; width: 16px" name="internallink" value="',
                                             'resolveuid/' + item.uid ,


