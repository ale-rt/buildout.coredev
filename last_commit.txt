Repository: plone.app.vocabularies


Branch: refs/heads/2.1.x
Date: 2016-04-04T14:32:59+02:00
Author: Beno√Æt Suttor (bsuttor) <bsuttor@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.vocabularies/commit/2a1c073e652ec512584e5ab1a1783441aca400ce

Add images scales vocabulary

* Add ImagesScales vocabulary

* Add test for ImagesScales vocabulary

* Update changelog

* Fix, add number for format for python 2.6 compatibility

* Add new vocabulary into Readme doc

* Add plone.app.imaging dependency

* Translate image scale for vocabulary

* Add ImagesScales vocabulary

Add test for ImagesScales vocabulary

Update changelog

Fix, add number for format for python 2.6 compatibility

Add new vocabulary into Readme doc

Add plone.app.imaging dependency

Translate image scale for vocabulary

Files changed:
A plone/app/vocabularies/images.py
A plone/app/vocabularies/tests/test_imagesvocabularies.py
M CHANGES.rst
M README.rst
M plone/app/vocabularies/configure.zcml
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index deef1de..e38a669 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Add ImagesScales vocabulary.
+  [bsuttor]
 
 Fixes:
 
diff --git a/README.rst b/README.rst
index 8b09420..80e93f4 100644
--- a/README.rst
+++ b/README.rst
@@ -132,6 +132,12 @@ Date/Time Related
 ``plone.app.vocabularies.MonthAbbr``
    same as above but with 3 character abbreviations.
 
+Images
+------
+
+``plone.app.vocabularies.ImagesScales``
+   All image scales which are avaiable on Plone site.
+
 
 Source Code
 ===========
diff --git a/plone/app/vocabularies/configure.zcml b/plone/app/vocabularies/configure.zcml
index bbe3570..d7040f5 100644
--- a/plone/app/vocabularies/configure.zcml
+++ b/plone/app/vocabularies/configure.zcml
@@ -143,6 +143,12 @@
     name="plone.app.vocabularies.MonthAbbr"
     />
 
+  <utility
+    component=".images.ScalesVocabulary"
+    name="plone.app.vocabularies.ImagesScales"
+    />
+
+
   <!-- All source implementations will be deprecated -->
   <adapter
       for=".catalog.SearchableTextSource
diff --git a/plone/app/vocabularies/images.py b/plone/app/vocabularies/images.py
new file mode 100644
index 0000000..cd234d7
--- /dev/null
+++ b/plone/app/vocabularies/images.py
@@ -0,0 +1,24 @@
+# -*- coding: utf-8 -*-
+from plone.app.imaging.utils import getAllowedSizes
+from zope.i18nmessageid import MessageFactory
+from zope.interface import provider
+from zope.schema.interfaces import IVocabularyFactory
+from zope.schema.vocabulary import SimpleTerm
+from zope.schema.vocabulary import SimpleVocabulary
+
+_ = MessageFactory('plone')
+
+
+@provider(IVocabularyFactory)
+def ScalesVocabulary(context):
+    """Obtains available scales from plone.app.imaging
+    """
+    terms = []
+    for scale, (width, height) in getAllowedSizes().iteritems():
+        translated = _(
+            'imagescale_{0:s}'.format(scale),
+            default='{0:s} ${{width}}x${{height}}'.format(scale),
+            mapping={'width': str(width), 'height': str(height)})
+        terms.append(SimpleTerm(scale, scale, translated))
+
+    return SimpleVocabulary(terms)
diff --git a/plone/app/vocabularies/tests/test_imagesvocabularies.py b/plone/app/vocabularies/tests/test_imagesvocabularies.py
new file mode 100644
index 0000000..a6ab83e
--- /dev/null
+++ b/plone/app/vocabularies/tests/test_imagesvocabularies.py
@@ -0,0 +1,23 @@
+# -*- coding: utf-8 -*-
+from plone.app.vocabularies.testing import PAVocabularies_INTEGRATION_TESTING
+from plone.registry.interfaces import IRegistry
+from zope.component import getUtility
+from zope.schema.interfaces import IVocabularyFactory
+import unittest
+
+
+class ImagesTest(unittest.TestCase):
+    layer = PAVocabularies_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.portal = self.layer['portal']
+
+    def test_images_scales_vocabulary(self):
+        images_scales_voc = getUtility(
+            IVocabularyFactory,
+            'plone.app.vocabularies.ImagesScales'
+        )
+        scales_list = [item.value for item in images_scales_voc(self.portal)]
+        self.assertTrue('thumb' in scales_list)
+        self.assertTrue('large' in scales_list)
+        self.assertTrue('preview' in scales_list)
diff --git a/setup.py b/setup.py
index b401eb2..b451f25 100644
--- a/setup.py
+++ b/setup.py
@@ -35,6 +35,7 @@
     install_requires=[
         'Acquisition',
         'plone.app.querystring',
+        'plone.app.imaging',
         'Products.CMFCore',
         'pytz',
         'setuptools',


