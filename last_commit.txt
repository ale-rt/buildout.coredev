Repository: plone.rfc822


Branch: refs/heads/master
Date: 2016-01-25T17:53:48+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.rfc822/commit/0bc362c3df0d3a9560d89764ff525014a6d96747

Replace deprecated zope.testing.doctest import with doctest module from stdlib.

Files changed:
M docs/HISTORY.txt
M plone/rfc822/tests.py

diff --git a/docs/HISTORY.txt b/docs/HISTORY.txt
index 58b77e5..7644ecf 100644
--- a/docs/HISTORY.txt
+++ b/docs/HISTORY.txt
@@ -4,7 +4,9 @@ Changelog
 1.1.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Replace deprecated ``zope.testing.doctest`` import with ``doctest`` module
+  from stdlib.
+  [thet]
 
 
 1.1.1 (2015-03-21)
diff --git a/plone/rfc822/tests.py b/plone/rfc822/tests.py
index 62f442a..fc7c711 100644
--- a/plone/rfc822/tests.py
+++ b/plone/rfc822/tests.py
@@ -1,5 +1,5 @@
 import unittest
-from zope.testing import doctest
+import doctest
 import zope.component.testing
 
 def test_suite():


Repository: plone.rfc822


Branch: refs/heads/master
Date: 2016-01-26T14:09:02+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.rfc822/commit/8914d58bb7f2e0be20cd47e02f73a863579773d6

Fix test isolation problem.

Files changed:
M docs/HISTORY.txt
M plone/rfc822/tests.py
M setup.py

diff --git a/docs/HISTORY.txt b/docs/HISTORY.txt
index 7644ecf..a6c7e6e 100644
--- a/docs/HISTORY.txt
+++ b/docs/HISTORY.txt
@@ -4,8 +4,10 @@ Changelog
 1.1.2 (unreleased)
 ------------------
 
-- Replace deprecated ``zope.testing.doctest`` import with ``doctest`` module
-  from stdlib.
+- Fix test isolation problem.
+  [thet]
+
+- Replace deprecated ``zope.testing.doctest`` import with ``doctest`` module from stdlib.
   [thet]
 
 
diff --git a/plone/rfc822/tests.py b/plone/rfc822/tests.py
index fc7c711..3679ca6 100644
--- a/plone/rfc822/tests.py
+++ b/plone/rfc822/tests.py
@@ -1,23 +1,29 @@
 import unittest
 import doctest
-import zope.component.testing
+from plone.testing import layered
+from plone.testing.zca import UNIT_TESTING
+
+
+DOCFILES = [
+    'message.txt',
+    'fields.txt',
+    'supermodel.txt',
+]
+
+optionflags = doctest.ELLIPSIS
+
 
 def test_suite():
 
-    return unittest.TestSuite((
-            doctest.DocFileSuite(
-                'message.txt',
-                tearDown=zope.component.testing.tearDown(),
-                optionflags=doctest.ELLIPSIS
-            ),
-            doctest.DocFileSuite(
-                'fields.txt',
-                tearDown=zope.component.testing.tearDown(),
-                optionflags=doctest.ELLIPSIS
-            ),
+    suite = unittest.TestSuite()
+    suite.addTests([
+        layered(
             doctest.DocFileSuite(
-                'supermodel.txt',
-                tearDown=zope.component.testing.tearDown(),
-                optionflags=doctest.ELLIPSIS
+                docfile,
+                optionflags=optionflags,
             ),
-        ))
+            layer=UNIT_TESTING
+        )
+        for docfile in DOCFILES
+    ])
+    return suite
diff --git a/setup.py b/setup.py
index 7390cb1..ff34541 100644
--- a/setup.py
+++ b/setup.py
@@ -27,6 +27,7 @@
       zip_safe=False,
       extras_require={
         'supermodel': ['plone.supermodel'],
+        'test': ['plone.testing'],
       },
       install_requires=[
           'setuptools',


Repository: plone.rfc822


Branch: refs/heads/master
Date: 2016-01-29T02:26:58+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.rfc822/commit/345b087127f55abeea57d87616f2bf8165bb01d5

Merge pull request #1 from plone/thet-zope4

Zope4

Files changed:
M docs/HISTORY.txt
M plone/rfc822/tests.py
M setup.py

diff --git a/docs/HISTORY.txt b/docs/HISTORY.txt
index 58b77e5..a6c7e6e 100644
--- a/docs/HISTORY.txt
+++ b/docs/HISTORY.txt
@@ -4,7 +4,11 @@ Changelog
 1.1.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fix test isolation problem.
+  [thet]
+
+- Replace deprecated ``zope.testing.doctest`` import with ``doctest`` module from stdlib.
+  [thet]
 
 
 1.1.1 (2015-03-21)
diff --git a/plone/rfc822/tests.py b/plone/rfc822/tests.py
index 62f442a..3679ca6 100644
--- a/plone/rfc822/tests.py
+++ b/plone/rfc822/tests.py
@@ -1,23 +1,29 @@
 import unittest
-from zope.testing import doctest
-import zope.component.testing
+import doctest
+from plone.testing import layered
+from plone.testing.zca import UNIT_TESTING
+
+
+DOCFILES = [
+    'message.txt',
+    'fields.txt',
+    'supermodel.txt',
+]
+
+optionflags = doctest.ELLIPSIS
+
 
 def test_suite():
 
-    return unittest.TestSuite((
-            doctest.DocFileSuite(
-                'message.txt',
-                tearDown=zope.component.testing.tearDown(),
-                optionflags=doctest.ELLIPSIS
-            ),
-            doctest.DocFileSuite(
-                'fields.txt',
-                tearDown=zope.component.testing.tearDown(),
-                optionflags=doctest.ELLIPSIS
-            ),
+    suite = unittest.TestSuite()
+    suite.addTests([
+        layered(
             doctest.DocFileSuite(
-                'supermodel.txt',
-                tearDown=zope.component.testing.tearDown(),
-                optionflags=doctest.ELLIPSIS
+                docfile,
+                optionflags=optionflags,
             ),
-        ))
+            layer=UNIT_TESTING
+        )
+        for docfile in DOCFILES
+    ])
+    return suite
diff --git a/setup.py b/setup.py
index 7390cb1..ff34541 100644
--- a/setup.py
+++ b/setup.py
@@ -27,6 +27,7 @@
       zip_safe=False,
       extras_require={
         'supermodel': ['plone.supermodel'],
+        'test': ['plone.testing'],
       },
       install_requires=[
           'setuptools',


