Repository: Products.CMFDiffTool


Branch: refs/heads/2.2.x
Date: 2016-09-01T14:42:08-07:00
Author: deankarlen (deankarlen) <karlen@uvic.ca>
Commit: https://github.com/plone/Products.CMFDiffTool/commit/fbcdbf874e9127b1396c1c7b034f1e8a889c3e3c

Fix error when there are changes in objects of type "set"

Dexterity types that use selectable elements (zope.schema.Set) have
objects of type "set". When using CMFDiff tool to examine changes
between versions having differences between these set objects,
FieldDiff.inline_diff() fails as it assumes the objects a and b can be
indexed. This is solved by passing a list of the object, if the object
is of type "set".

Files changed:
M CHANGES.rst
M Products/CMFDiffTool/ListDiff.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6c452d0..31d49d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix error when showing changes to objects of type "set" [deankarlen]
 
 
 2.2.0 (2016-04-15)
diff --git a/Products/CMFDiffTool/ListDiff.py b/Products/CMFDiffTool/ListDiff.py
index bc39337..5cdbaab 100644
--- a/Products/CMFDiffTool/ListDiff.py
+++ b/Products/CMFDiffTool/ListDiff.py
@@ -11,6 +11,10 @@ class ListDiff(FieldDiff):
     def _parseField(self, value, filename=None):
         """Parse a field value in preparation for diffing"""
         # Return the list as is for diffing
-        return value
+        if type(value) is set:
+            # A set cannot be indexed, so return a list of a set
+            return list(value)
+        else:
+            return value
 
 InitializeClass(ListDiff)


Repository: Products.CMFDiffTool


Branch: refs/heads/2.2.x
Date: 2016-09-01T15:24:05-07:00
Author: Dean Karlen (deankarlen) <karlen@uvic.ca>
Commit: https://github.com/plone/Products.CMFDiffTool/commit/10570cdc521ecfc2e2959a748b2a9d56ab3d037d

Merge pull request #20 from plone/2.2.x-karlen20160901

Fix error when there are changes in objects of type "set"

Files changed:
M CHANGES.rst
M Products/CMFDiffTool/ListDiff.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6c452d0..31d49d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix error when showing changes to objects of type "set" [deankarlen]
 
 
 2.2.0 (2016-04-15)
diff --git a/Products/CMFDiffTool/ListDiff.py b/Products/CMFDiffTool/ListDiff.py
index bc39337..5cdbaab 100644
--- a/Products/CMFDiffTool/ListDiff.py
+++ b/Products/CMFDiffTool/ListDiff.py
@@ -11,6 +11,10 @@ class ListDiff(FieldDiff):
     def _parseField(self, value, filename=None):
         """Parse a field value in preparation for diffing"""
         # Return the list as is for diffing
-        return value
+        if type(value) is set:
+            # A set cannot be indexed, so return a list of a set
+            return list(value)
+        else:
+            return value
 
 InitializeClass(ListDiff)


