Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-04-25T13:26:44+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/932af67ca062b40730174b5d505764e0daeea095

Refactor

Files changed:
M plone/app/contentrules/actions/__init__.py

diff --git a/plone/app/contentrules/actions/__init__.py b/plone/app/contentrules/actions/__init__.py
index dbfedb5..6fb9699 100644
--- a/plone/app/contentrules/actions/__init__.py
+++ b/plone/app/contentrules/actions/__init__.py
@@ -16,17 +16,12 @@ class ContentWrapper(object):
     """
 
     def __init__(self, content):
-        self.content = content
+        self.__dict__['content'] = content
 
-    def __getattr__(self, name, default=None):
-        if name == 'content':
-            return self.__dict__['content']
-        if name == 'target_folder':
-            return self._get_target_folder()
-        return getattr(self.__dict__['content'], name, default)
+    @property
+    def target_folder(self):
+        content = self.content
 
-    def _get_target_folder(self):
-        content = self.__dict__['content']
         if content.target_folder and content.target_folder[0] == '/':
             # need to convert to uuid
             site = getSite()
@@ -36,6 +31,9 @@ def _get_target_folder(self):
             if target is not None:
                 return IUUID(target, None)
 
+    def __getattr__(self, name, default=None):
+        return getattr(self.__dict__['content'], name, default)
+
 
 class ActionAddForm(AddForm):
     Type = None


Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-04-25T13:28:33+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/9676e1749b874444e6b2e5f750312433bb1f311e

Content wrapper must proxy changes to content object

Previously, setting an attribute on the content would simply
add the entry to the content wrapper's own dictionary instead
of proxying the change to the content object.

This fixes action editing such that changes are persisted correctly.

Files changed:
M CHANGES.rst
M plone/app/contentrules/actions/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 97e6c38..aba4a18 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Fix action edit form. Previously, changes would not be persisted due
+  to a bug.
+  [malthe]
+
 - Ensure error message is an unicode object
   [mtrebron]
 
diff --git a/plone/app/contentrules/actions/__init__.py b/plone/app/contentrules/actions/__init__.py
index 6fb9699..9089cfe 100644
--- a/plone/app/contentrules/actions/__init__.py
+++ b/plone/app/contentrules/actions/__init__.py
@@ -34,6 +34,9 @@ def target_folder(self):
     def __getattr__(self, name, default=None):
         return getattr(self.__dict__['content'], name, default)
 
+    def __setattr__(self, name, value):
+        setattr(self.__dict__['content'], name, value)
+
 
 class ActionAddForm(AddForm):
     Type = None


Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-05-08T09:29:54+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/c7304706b6bf8b25c37eec3d436d093f468658dd

Merge branch 'master' into fix-action-edit-form

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index aba4a18..761544b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,7 +1,7 @@
 Changelog
 =========
 
-4.0.15 (unreleased)
+4.0.16 (unreleased)
 -------------------
 
 Breaking changes:
@@ -18,6 +18,12 @@ Bug fixes:
   to a bug.
   [malthe]
 
+
+4.0.15 (2017-05-06)
+-------------------
+
+Bug fixes:
+
 - Ensure error message is an unicode object
   [mtrebron]
 
diff --git a/setup.py b/setup.py
index 6cb70b9..9ee5d21 100644
--- a/setup.py
+++ b/setup.py
@@ -1,7 +1,7 @@
 # -*- coding: utf-8 -*-
 from setuptools import setup, find_packages
 
-version = '4.0.15.dev0'
+version = '4.0.16.dev0'
 
 setup(
     name='plone.app.contentrules',


Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-05-11T23:45:25+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/e261b03b7fe0e8f17b7044dea23742f1549ded79

Merge pull request #31 from plone/fix-action-edit-form

Fix action edit form

Files changed:
M CHANGES.rst
M plone/app/contentrules/actions/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c4e1587..761544b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix action edit form. Previously, changes would not be persisted due
+  to a bug.
+  [malthe]
 
 
 4.0.15 (2017-05-06)
diff --git a/plone/app/contentrules/actions/__init__.py b/plone/app/contentrules/actions/__init__.py
index dbfedb5..9089cfe 100644
--- a/plone/app/contentrules/actions/__init__.py
+++ b/plone/app/contentrules/actions/__init__.py
@@ -16,17 +16,12 @@ class ContentWrapper(object):
     """
 
     def __init__(self, content):
-        self.content = content
+        self.__dict__['content'] = content
 
-    def __getattr__(self, name, default=None):
-        if name == 'content':
-            return self.__dict__['content']
-        if name == 'target_folder':
-            return self._get_target_folder()
-        return getattr(self.__dict__['content'], name, default)
+    @property
+    def target_folder(self):
+        content = self.content
 
-    def _get_target_folder(self):
-        content = self.__dict__['content']
         if content.target_folder and content.target_folder[0] == '/':
             # need to convert to uuid
             site = getSite()
@@ -36,6 +31,12 @@ def _get_target_folder(self):
             if target is not None:
                 return IUUID(target, None)
 
+    def __getattr__(self, name, default=None):
+        return getattr(self.__dict__['content'], name, default)
+
+    def __setattr__(self, name, value):
+        setattr(self.__dict__['content'], name, value)
+
 
 class ActionAddForm(AddForm):
     Type = None


