Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-09-16T12:34:50+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/761ef0258c516579f08f75859a6916350f131475

use safe_unicode
replace https://github.com/plone/plone.app.upgrade/pull/105
due to missing contributors agreement.
Thanks @b0n

Files changed:
M plone/app/upgrade/v50/alphas.py

diff --git a/plone/app/upgrade/v50/alphas.py b/plone/app/upgrade/v50/alphas.py
index 7fab2ee..c6fae6c 100644
--- a/plone/app/upgrade/v50/alphas.py
+++ b/plone/app/upgrade/v50/alphas.py
@@ -9,6 +9,7 @@
 from Products.CMFPlone.interfaces import INavigationSchema
 from Products.CMFPlone.interfaces import ISearchSchema
 from Products.CMFPlone.interfaces import ISiteSchema
+from Products.CMFPlone.utils import safe_unicode
 from plone.app.theming.interfaces import IThemeSettings
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.app.upgrade.utils import get_property
@@ -404,9 +405,9 @@ def upgrade_site_controlpanel_settings(context):
         )
     except KeyError:
         settings = False
-    settings.site_title = unicode(portal.title)
+    settings.site_title = safe_unicode(portal.title)
     webstat_js = get_property(site_properties, 'webstats_js', '')
-    settings.webstats_js = unicode(webstat_js)
+    settings.webstats_js = safe_unicode(webstat_js)
     settings.enable_sitemap = get_property(site_properties, 'enable_sitemap')
     if site_properties.hasProperty('exposeDCMetaTags'):
         settings.exposeDCMetaTags = site_properties.exposeDCMetaTags


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-09-16T12:40:27+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/78f1e7e883798c56b1e5fa981318fb58144a6ed9

changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index fc3663c..6bf30dd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,9 @@ Bug fixes:
   See discussion at https://github.com/plone/plone.app.iterate/pull/53
   [pbauer]
 
+- Use safe_unicode to migrate some settings. Fixes https://github.com/plone/plone.app.upgrade/issues/104
+  [pbauer]
+
 2.0.7 (2017-09-10)
 ------------------
 


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-09-18T08:33:33+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/99a31e5ebf36ffc02e2dbf578012126c517ef861

Merge pull request #138 from plone/safe_unicode

use safe_unicode

Files changed:
M CHANGES.rst
M plone/app/upgrade/v50/alphas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index fc3663c..6bf30dd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,9 @@ Bug fixes:
   See discussion at https://github.com/plone/plone.app.iterate/pull/53
   [pbauer]
 
+- Use safe_unicode to migrate some settings. Fixes https://github.com/plone/plone.app.upgrade/issues/104
+  [pbauer]
+
 2.0.7 (2017-09-10)
 ------------------
 
diff --git a/plone/app/upgrade/v50/alphas.py b/plone/app/upgrade/v50/alphas.py
index 7fab2ee..c6fae6c 100644
--- a/plone/app/upgrade/v50/alphas.py
+++ b/plone/app/upgrade/v50/alphas.py
@@ -9,6 +9,7 @@
 from Products.CMFPlone.interfaces import INavigationSchema
 from Products.CMFPlone.interfaces import ISearchSchema
 from Products.CMFPlone.interfaces import ISiteSchema
+from Products.CMFPlone.utils import safe_unicode
 from plone.app.theming.interfaces import IThemeSettings
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.app.upgrade.utils import get_property
@@ -404,9 +405,9 @@ def upgrade_site_controlpanel_settings(context):
         )
     except KeyError:
         settings = False
-    settings.site_title = unicode(portal.title)
+    settings.site_title = safe_unicode(portal.title)
     webstat_js = get_property(site_properties, 'webstats_js', '')
-    settings.webstats_js = unicode(webstat_js)
+    settings.webstats_js = safe_unicode(webstat_js)
     settings.enable_sitemap = get_property(site_properties, 'enable_sitemap')
     if site_properties.hasProperty('exposeDCMetaTags'):
         settings.exposeDCMetaTags = site_properties.exposeDCMetaTags


