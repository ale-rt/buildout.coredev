Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-08-13T18:57:02+03:00
Author: Petri Savolainen (petri) <petri.savolainen@koodaamo.fi>
Commit: https://github.com/plone/plone.app.contenttypes/commit/fb590703dab9e2c64e64a3587babe134c793ca4b

fix value/mimetype inconsistency (see #357)

Files changed:
M CHANGES.rst
M plone/app/contenttypes/indexers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 857c9b9..a4ad2ff 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -45,6 +45,10 @@ Bug fixes:
 - corrected typos in the documentation
   [kkhan]
 
+- Correct the SearchableText base indexer: use mime type of RichText output
+  (rather than raw) value in plaintext conversion. Fixes #357.
+  [petri]
+
 
 1.2.16 (2016-06-12)
 -------------------
diff --git a/plone/app/contenttypes/indexers.py b/plone/app/contenttypes/indexers.py
index c5f7895..2d7f66a 100644
--- a/plone/app/contenttypes/indexers.py
+++ b/plone/app/contenttypes/indexers.py
@@ -45,7 +45,7 @@ def SearchableText(obj):
             text = transforms.convertTo(
                 'text/plain',
                 safe_unicode(textvalue.output).encode('utf8'),
-                mimetype=textvalue.mimeType,
+                mimetype=textvalue.outputMimeType,
             ).getData().strip()
 
     subject = u' '.join(


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-08-23T16:52:23+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/d9ae6d53bb4a12dc37a743371f5f630637bd42a2

Merge pull request #365 from plone/fix-richtext-conversion

fix value/mimetype inconsistency (see #357)

Files changed:
M CHANGES.rst
M plone/app/contenttypes/indexers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1b547f8..848f4cc 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -57,6 +57,10 @@ Bug fixes:
 - corrected typos in the documentation
   [kkhan]
 
+- Correct the SearchableText base indexer: use mime type of RichText output
+  (rather than raw) value in plaintext conversion. Fixes #357.
+  [petri]
+
 
 1.2.16 (2016-06-12)
 -------------------
diff --git a/plone/app/contenttypes/indexers.py b/plone/app/contenttypes/indexers.py
index c5f7895..2d7f66a 100644
--- a/plone/app/contenttypes/indexers.py
+++ b/plone/app/contenttypes/indexers.py
@@ -45,7 +45,7 @@ def SearchableText(obj):
             text = transforms.convertTo(
                 'text/plain',
                 safe_unicode(textvalue.output).encode('utf8'),
-                mimetype=textvalue.mimeType,
+                mimetype=textvalue.outputMimeType,
             ).getData().strip()
 
     subject = u' '.join(


