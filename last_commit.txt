Repository: plone.app.imaging


Branch: refs/heads/1.0.x
Date: 2015-12-13T23:42:30+01:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.app.imaging/commit/30ca8146b52e36ca1617f6bea873d6007ecc51fe

Revert "Merge branch 'write-on-read' into 1.0.x"

This reverts commit 37f1acdb9745d0fb6ab60c11098f100b9c6a3372, reversing
changes made to cdb315a94bd2a0903f02be0cb3ac80073ef6a257.

Files changed:
M docs/HISTORY.txt
M setup.py
M src/plone/app/imaging/traverse.py

diff --git a/docs/HISTORY.txt b/docs/HISTORY.txt
index 8c55bf7..68079a6 100644
--- a/docs/HISTORY.txt
+++ b/docs/HISTORY.txt
@@ -10,8 +10,7 @@ New:
 
 Fixes:
 
-- Disable csrf protection when scale is generated and traversed to.
-  [vangheem]
+- *add item here*
 
 
 1.0.12 (2015-11-26)
diff --git a/setup.py b/setup.py
index 533bc47..c4a1176 100644
--- a/setup.py
+++ b/setup.py
@@ -35,7 +35,6 @@
         'setuptools',
         'plone.scale [storage]',
         'z3c.caching',
-        'five.globalrequest'
       ],
       extras_require = {'test':
           ['collective.testcaselayer',
diff --git a/src/plone/app/imaging/traverse.py b/src/plone/app/imaging/traverse.py
index e967754..4cfe2c8 100644
--- a/src/plone/app/imaging/traverse.py
+++ b/src/plone/app/imaging/traverse.py
@@ -9,9 +9,6 @@
 from plone.app.imaging.interfaces import IBaseObject
 from plone.app.imaging.interfaces import IImageScaleHandler
 from plone.app.imaging.scale import ImageScale
-from plone.protect.interfaces import IDisableCSRFProtection
-from zope.interface import alsoProvides
-from zope.globalrequest import getRequest
 
 
 class ImageTraverser(DefaultPublishTraverse):
@@ -63,10 +60,6 @@ def getScale(self, instance, scale):
     def createScale(self, instance, scale, width, height, data=None):
         """ create & return a scaled version of the image as retrieved
             from the field or optionally given data """
-        # disable CRSF on scale generation
-        req = getRequest()
-        if req:
-            alsoProvides(req, IDisableCSRFProtection)
         field = self.context
         if HAS_PIL and width and height:
             if data is None:


