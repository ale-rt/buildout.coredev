Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2016-07-22T10:46:19-06:00
Author: Sean Upton (seanupton) <sdupton@gmail.com>
Commit: https://github.com/plone/Products.PortalTransforms/commit/555076af97cabf783d87e7824a38f46d2491ef37

Fix rest heading level regression introduced in 2.2.0, levels in body
headings now match what was previously output by old Zope2
reStructuredText wrapper, which means Products.Archetypes tests for
transforms will pass again.

Files changed:
M CHANGES.rst
M Products/PortalTransforms/transforms/rest.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0495fc8..ceafaee 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,12 @@ New:
 
 Fixes:
 
+- Fix regression in rest transform vs. old Zope2 reStructuredText wrapper:
+  headings now proper level in settings for body, which was necessary to
+  preserve levels assumed in downstream use of this transform
+  (e.g. Archetypes).  Behavior now matches that of previous wrapper.
+  [seanupton]
+
 - *add item here*
 
 
diff --git a/Products/PortalTransforms/transforms/rest.py b/Products/PortalTransforms/transforms/rest.py
index ed28b23..9610552 100644
--- a/Products/PortalTransforms/transforms/rest.py
+++ b/Products/PortalTransforms/transforms/rest.py
@@ -100,7 +100,7 @@ def convert(self, orig, data, **kwargs):
             'raw_enabled': 0,
             'language_code': language,
             # starting level for <H> elements:
-            'initial_header_level': initial_header_level,
+            'initial_header_level': initial_header_level + 1,
             # set the reporting level to something sane:
             'report_level': report_level,
             # don't break if we get errors:


Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2016-08-11T22:48:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.PortalTransforms/commit/14a4e26d4389addc6157a047b7d63a34bb73f906

Merge pull request #15 from seanupton/master

Fix rest heading level regression introduced in 2.2.0

Files changed:
M CHANGES.rst
M Products/PortalTransforms/transforms/rest.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0495fc8..ceafaee 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,12 @@ New:
 
 Fixes:
 
+- Fix regression in rest transform vs. old Zope2 reStructuredText wrapper:
+  headings now proper level in settings for body, which was necessary to
+  preserve levels assumed in downstream use of this transform
+  (e.g. Archetypes).  Behavior now matches that of previous wrapper.
+  [seanupton]
+
 - *add item here*
 
 
diff --git a/Products/PortalTransforms/transforms/rest.py b/Products/PortalTransforms/transforms/rest.py
index ed28b23..9610552 100644
--- a/Products/PortalTransforms/transforms/rest.py
+++ b/Products/PortalTransforms/transforms/rest.py
@@ -100,7 +100,7 @@ def convert(self, orig, data, **kwargs):
             'raw_enabled': 0,
             'language_code': language,
             # starting level for <H> elements:
-            'initial_header_level': initial_header_level,
+            'initial_header_level': initial_header_level + 1,
             # set the reporting level to something sane:
             'report_level': report_level,
             # don't break if we get errors:


