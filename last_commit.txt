Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2017-08-27T23:29:58+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/9b6648522084045adb16b84df7c227da08293d29

Field reorderable, missing delete confirmation
Fix fields not being reorderable and missing their delete confirmation until a fieldset was added.
Fixes #81, #82.

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/schemaeditor.js

diff --git a/CHANGES.rst b/CHANGES.rst
index c392f44..a80219b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix fields not being reorderable and missing their delete confirmation until a fieldset was added.
+  Fixes https://github.com/collective/collective.easyform/issues/81 and https://github.com/collective/collective.easyform/issues/82
+  [thet]
 
 
 2.0.17 (2017-05-23)
diff --git a/plone/schemaeditor/browser/schema/schemaeditor.js b/plone/schemaeditor/browser/schema/schemaeditor.js
index ae8b72e..af9955f 100644
--- a/plone/schemaeditor/browser/schema/schemaeditor.js
+++ b/plone/schemaeditor/browser/schema/schemaeditor.js
@@ -275,14 +275,19 @@ require(['jquery'], function($) {
 
     $(document).ready(function() {
 
-        // Initialize only after autotoc has been initialized
-        if ($('#form .autotoc-nav > a').length) {
-            // pat-autotoc already initialized, script probably run after
-            // mockup initialization.
-            init_schemaeditor();
+        if ($('#form fieldset').length >= 2) {
+            // If multiple fieldsets, release after autotoc has been initialized
+            if ($('#form .autotoc-nav > a').length) {
+                // pat-autotoc already initialized, script probably run after
+                // mockup initialization.
+                init_schemaeditor();
+            } else {
+                // Otherwise, wait until autotoc is ready.
+                $(window).on('init.autotoc.patterns', init_schemaeditor);
+            }
         } else {
-            // Otherwise, wait until autotoc is ready.
-            $(window).on('init.autotoc.patterns', init_schemaeditor);
+            // If only one fieldset, initialize immediately
+            init_schemaeditor();
         }
 
     });


Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2017-08-28T21:11:10+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/56ab8245601e9e1c1f8f30e40c94de19426f8810

Merge pull request #56 from plone/thet-fixes

Field reorderable, missing delete confirmation

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/schemaeditor.js

diff --git a/CHANGES.rst b/CHANGES.rst
index c392f44..a80219b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix fields not being reorderable and missing their delete confirmation until a fieldset was added.
+  Fixes https://github.com/collective/collective.easyform/issues/81 and https://github.com/collective/collective.easyform/issues/82
+  [thet]
 
 
 2.0.17 (2017-05-23)
diff --git a/plone/schemaeditor/browser/schema/schemaeditor.js b/plone/schemaeditor/browser/schema/schemaeditor.js
index ae8b72e..af9955f 100644
--- a/plone/schemaeditor/browser/schema/schemaeditor.js
+++ b/plone/schemaeditor/browser/schema/schemaeditor.js
@@ -275,14 +275,19 @@ require(['jquery'], function($) {
 
     $(document).ready(function() {
 
-        // Initialize only after autotoc has been initialized
-        if ($('#form .autotoc-nav > a').length) {
-            // pat-autotoc already initialized, script probably run after
-            // mockup initialization.
-            init_schemaeditor();
+        if ($('#form fieldset').length >= 2) {
+            // If multiple fieldsets, release after autotoc has been initialized
+            if ($('#form .autotoc-nav > a').length) {
+                // pat-autotoc already initialized, script probably run after
+                // mockup initialization.
+                init_schemaeditor();
+            } else {
+                // Otherwise, wait until autotoc is ready.
+                $(window).on('init.autotoc.patterns', init_schemaeditor);
+            }
         } else {
-            // Otherwise, wait until autotoc is ready.
-            $(window).on('init.autotoc.patterns', init_schemaeditor);
+            // If only one fieldset, initialize immediately
+            init_schemaeditor();
         }
 
     });


