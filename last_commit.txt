Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-02-01T22:22:52+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/64cebb2b0e22a6b1ac500d97f81b6d7919696ed3

Be more careful when migrating site properties in Plone 5.

Do not fail when the property is not there.
It might have been removed by the user.
Or a developer is running the migration twice to test something.

Files changed:
M plone/app/upgrade/v50/alphas.py

diff --git a/plone/app/upgrade/v50/alphas.py b/plone/app/upgrade/v50/alphas.py
index 4e76980..06ac9a4 100644
--- a/plone/app/upgrade/v50/alphas.py
+++ b/plone/app/upgrade/v50/alphas.py
@@ -84,15 +84,18 @@ def migrate_registry_settings(portal):
     registry = portal.portal_registry
     portal_types = portal.portal_types
     registry['plone.site_title'] = portal.title.decode('utf8')
-    registry['plone.webstats_js'] = site_props.webstats_js.decode('utf8')
-    registry['plone.enable_sitemap'] = site_props.enable_sitemap
+    if site_props.hasProperty('webstats_js'):
+        registry['plone.webstats_js'] = site_props.webstats_js.decode('utf8')
+    if site_props.hasProperty('enable_sitemap'):
+        registry['plone.enable_sitemap'] = site_props.enable_sitemap
 
     if site_props.hasProperty('exposeDCMetaTags'):
         registry['plone.exposeDCMetaTags'] = site_props.exposeDCMetaTags
     if site_props.hasProperty('enable_livesearch'):
         registry['plone.enable_livesearch'] = site_props.enable_livesearch
-    registry['plone.types_not_searched'] = tuple(
-        t for t in site_props.types_not_searched if t in portal_types)
+    if site_props.hasProperty('types_not_searched'):
+        registry['plone.types_not_searched'] = tuple(
+            t for t in site_props.types_not_searched if t in portal_types)
 
     # Migrate first weekday setting
     # First, look, if plone.app.event < 2.0 was already installed.


