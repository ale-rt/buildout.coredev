Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-08-26T11:28:18+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/465df4876cebd648f7346f794c708b3ec087c7fe

Cast smtp port to int

Files changed:
M CHANGES.rst
M plone/app/upgrade/v50/betas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d5aaf7d..2a0adec 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Be sure smtp_port is an integer.
+  [ale-rt]
 
 
 1.3.27 (2016-08-16)
diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index e7eff8b..54cf111 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -96,7 +96,9 @@ def upgrade_mail_controlpanel_settings(context):
     mail_settings.smtp_host = unicode(smtp_host)
 
     smtp_port = getattr(portal.MailHost, 'smtp_port', 25)
-    mail_settings.smtp_port = smtp_port
+    # It may happen that smtp_port is a string, maybe empty,
+    # but we need an integer here to match the record constraints
+    mail_settings.smtp_port = int(smtp_port or 25)
 
     smtp_user_id = portal.MailHost.get('smtp_user_id')
     mail_settings.smtp_user_id = smtp_user_id


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-08-26T17:02:08+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/bc7ad4de1d2f035a67b131686263dc78e28911ae

Merge pull request #82 from plone/cast-smtp_port-to-int

Cast smtp port to int

Files changed:
M CHANGES.rst
M plone/app/upgrade/v50/betas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d5aaf7d..2a0adec 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Be sure smtp_port is an integer.
+  [ale-rt]
 
 
 1.3.27 (2016-08-16)
diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index e7eff8b..54cf111 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -96,7 +96,9 @@ def upgrade_mail_controlpanel_settings(context):
     mail_settings.smtp_host = unicode(smtp_host)
 
     smtp_port = getattr(portal.MailHost, 'smtp_port', 25)
-    mail_settings.smtp_port = smtp_port
+    # It may happen that smtp_port is a string, maybe empty,
+    # but we need an integer here to match the record constraints
+    mail_settings.smtp_port = int(smtp_port or 25)
 
     smtp_user_id = portal.MailHost.get('smtp_user_id')
     mail_settings.smtp_user_id = smtp_user_id


