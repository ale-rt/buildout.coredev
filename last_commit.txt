Repository: plone.session


Branch: refs/heads/master
Date: 2016-11-08T14:42:03+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.session/commit/d2477462c4c6aac8b6a8cf5bc9b427c17c20b937

minor cleanup

Files changed:
M plone/__init__.py
M plone/session/tktauth.py

diff --git a/plone/__init__.py b/plone/__init__.py
index f48ad10..e31cc00 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,6 +1,2 @@
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/session/tktauth.py b/plone/session/tktauth.py
index e5f8989..d2d474a 100755
--- a/plone/session/tktauth.py
+++ b/plone/session/tktauth.py
@@ -188,7 +188,7 @@ def createTicket(secret, userid, tokens=(), user_data='', ip='0.0.0.0',
         digest = mod_auth_tkt_digest(secret, data1, data2)
     else:
         # a sha256 digest is the same length as an md5 hexdigest
-        digest = hmac.new(secret, data1+data2, hashlib.sha256).digest()
+        digest = hmac.new(secret, data1 + data2, hashlib.sha256).digest()
 
     # digest + timestamp as an eight character hexadecimal + userid + !
     ticket = "%s%08x%s!" % (digest, timestamp, userid)
@@ -257,5 +257,6 @@ def _test():
         optionflags=doctest.ELLIPSIS + doctest.NORMALIZE_WHITESPACE
     )
 
+
 if __name__ == "__main__":
     _test()


Repository: plone.session


Branch: refs/heads/master
Date: 2016-11-08T16:43:24+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.session/commit/0531b01c21eeb66b70b116a8c068ea6734c6e0c2

Hide uninstall profile in install listings

Files changed:
A plone/session/profiles.py
M CHANGES.rst
M plone/session/profiles.zcml
M plone/session/tktauth.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e8b1cf6..4ca0f4c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Hide uninstall profile in install listings.
+  [jensens]
 
 
 3.6.0 (2016-05-26)
diff --git a/plone/session/profiles.py b/plone/session/profiles.py
new file mode 100644
index 0000000..34f028d
--- /dev/null
+++ b/plone/session/profiles.py
@@ -0,0 +1,16 @@
+# -*- coding: utf-8 -*-
+from zope.interface import implementer
+from Products.CMFPlone.interfaces import INonInstallable
+
+
+@implementer(INonInstallable)
+class HiddenProfiles(object):
+
+    def getNonInstallableProfiles(self):
+        """Prevents uninstall profile from showing up in the profile list
+        when creating a Plone site.
+
+        """
+        return [
+            u'plone.session:uninstall',
+        ]
diff --git a/plone/session/profiles.zcml b/plone/session/profiles.zcml
index f91f85e..3b00dfc 100644
--- a/plone/session/profiles.zcml
+++ b/plone/session/profiles.zcml
@@ -1,8 +1,9 @@
 <configure
     i18n_domain="plone"
-    xmlns="http://namespaces.zope.org/genericsetup">
+    xmlns="http://namespaces.zope.org/zope"
+    xmlns:gs="http://namespaces.zope.org/genericsetup">
 
-  <registerProfile
+  <gs:registerProfile
       description="Optional plone.session refresh support."
       directory="profiles/default"
       name="default"
@@ -10,7 +11,7 @@
       title="Session refresh support"
   />
 
-  <registerProfile
+  <gs:registerProfile
       description="Optional plone.session refresh support. [uninstall]"
       directory="profiles/uninstall"
       name="uninstall"
@@ -18,4 +19,9 @@
       title="Session refresh support [uninstall]"
   />
 
+  <utility
+      name="plone.session"
+      factory=".profiles.HiddenProfiles"
+    />
+
 </configure>
diff --git a/plone/session/tktauth.py b/plone/session/tktauth.py
index d2d474a..0dd51bd 100755
--- a/plone/session/tktauth.py
+++ b/plone/session/tktauth.py
@@ -182,7 +182,7 @@ def createTicket(secret, userid, tokens=(), user_data='', ip='0.0.0.0',
     # Unfortunately, some older versions of Python assume that longs are always
     # 32 bits, so we need to trucate the result in case we are on a 64-bit
     # naive system.
-    data1 = inet_aton(ip)[:4] + pack("!I", timestamp)
+    data1 = inet_aton(ip)[:4] + pack('!I', timestamp)
     data2 = '\0'.join((userid, token_list, user_data))
     if mod_auth_tkt:
         digest = mod_auth_tkt_digest(secret, data1, data2)
@@ -191,7 +191,7 @@ def createTicket(secret, userid, tokens=(), user_data='', ip='0.0.0.0',
         digest = hmac.new(secret, data1 + data2, hashlib.sha256).digest()
 
     # digest + timestamp as an eight character hexadecimal + userid + !
-    ticket = "%s%08x%s!" % (digest, timestamp, userid)
+    ticket = '%s%08x%s!' % (digest, timestamp, userid)
     if tokens:
         ticket += token_list + '!'
     ticket += user_data
@@ -258,5 +258,5 @@ def _test():
     )
 
 
-if __name__ == "__main__":
+if __name__ == '__main__':
     _test()
diff --git a/setup.py b/setup.py
index 56f5d5e..6af354b 100644
--- a/setup.py
+++ b/setup.py
@@ -3,26 +3,26 @@
 from setuptools import setup
 
 version = '3.6.1.dev0'
-longdescription = open("README.rst").read()
+longdescription = open('README.rst').read()
 longdescription += '\n'
-longdescription += open("CHANGES.rst").read()
+longdescription += open('CHANGES.rst').read()
 
 setup(
     name='plone.session',
     version=version,
-    description="Session based auth tkt authentication for Zope",
+    description='Session based auth tkt authentication for Zope',
     long_description=longdescription,
     classifiers=[
-        "Environment :: Web Environment",
-        "Framework :: Plone :: 5.0",
-        "Framework :: Plone :: 5.1",
-        "Framework :: Plone",
-        "Framework :: Zope2",
-        "License :: OSI Approved :: BSD License",
-        "Operating System :: OS Independent",
-        "Programming Language :: Python :: 2.7",
-        "Programming Language :: Python",
-        "Topic :: System :: Systems Administration :: Authentication/Directory",  # noqa
+        'Environment :: Web Environment',
+        'Framework :: Plone :: 5.0',
+        'Framework :: Plone :: 5.1',
+        'Framework :: Plone',
+        'Framework :: Zope2',
+        'License :: OSI Approved :: BSD License',
+        'Operating System :: OS Independent',
+        'Programming Language :: Python :: 2.7',
+        'Programming Language :: Python',
+        'Topic :: System :: Systems Administration :: Authentication/Directory',  # noqa
     ],
     keywords='PAS session authentication Zope auth_tkt',
     author='Plone Foundation',


Repository: plone.session


Branch: refs/heads/master
Date: 2016-11-08T16:59:58+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.session/commit/92e736b285dcfe2ebefcbc1e2208c5b12fc2858a

Merge pull request #8 from plone/hide-uninstall-profile-on-install

Hide uninstall profile on install

Files changed:
A plone/session/profiles.py
M CHANGES.rst
M plone/__init__.py
M plone/session/profiles.zcml
M plone/session/tktauth.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e8b1cf6..4ca0f4c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Hide uninstall profile in install listings.
+  [jensens]
 
 
 3.6.0 (2016-05-26)
diff --git a/plone/__init__.py b/plone/__init__.py
index f48ad10..e31cc00 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,6 +1,2 @@
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/session/profiles.py b/plone/session/profiles.py
new file mode 100644
index 0000000..34f028d
--- /dev/null
+++ b/plone/session/profiles.py
@@ -0,0 +1,16 @@
+# -*- coding: utf-8 -*-
+from zope.interface import implementer
+from Products.CMFPlone.interfaces import INonInstallable
+
+
+@implementer(INonInstallable)
+class HiddenProfiles(object):
+
+    def getNonInstallableProfiles(self):
+        """Prevents uninstall profile from showing up in the profile list
+        when creating a Plone site.
+
+        """
+        return [
+            u'plone.session:uninstall',
+        ]
diff --git a/plone/session/profiles.zcml b/plone/session/profiles.zcml
index f91f85e..3b00dfc 100644
--- a/plone/session/profiles.zcml
+++ b/plone/session/profiles.zcml
@@ -1,8 +1,9 @@
 <configure
     i18n_domain="plone"
-    xmlns="http://namespaces.zope.org/genericsetup">
+    xmlns="http://namespaces.zope.org/zope"
+    xmlns:gs="http://namespaces.zope.org/genericsetup">
 
-  <registerProfile
+  <gs:registerProfile
       description="Optional plone.session refresh support."
       directory="profiles/default"
       name="default"
@@ -10,7 +11,7 @@
       title="Session refresh support"
   />
 
-  <registerProfile
+  <gs:registerProfile
       description="Optional plone.session refresh support. [uninstall]"
       directory="profiles/uninstall"
       name="uninstall"
@@ -18,4 +19,9 @@
       title="Session refresh support [uninstall]"
   />
 
+  <utility
+      name="plone.session"
+      factory=".profiles.HiddenProfiles"
+    />
+
 </configure>
diff --git a/plone/session/tktauth.py b/plone/session/tktauth.py
index e5f8989..0dd51bd 100755
--- a/plone/session/tktauth.py
+++ b/plone/session/tktauth.py
@@ -182,16 +182,16 @@ def createTicket(secret, userid, tokens=(), user_data='', ip='0.0.0.0',
     # Unfortunately, some older versions of Python assume that longs are always
     # 32 bits, so we need to trucate the result in case we are on a 64-bit
     # naive system.
-    data1 = inet_aton(ip)[:4] + pack("!I", timestamp)
+    data1 = inet_aton(ip)[:4] + pack('!I', timestamp)
     data2 = '\0'.join((userid, token_list, user_data))
     if mod_auth_tkt:
         digest = mod_auth_tkt_digest(secret, data1, data2)
     else:
         # a sha256 digest is the same length as an md5 hexdigest
-        digest = hmac.new(secret, data1+data2, hashlib.sha256).digest()
+        digest = hmac.new(secret, data1 + data2, hashlib.sha256).digest()
 
     # digest + timestamp as an eight character hexadecimal + userid + !
-    ticket = "%s%08x%s!" % (digest, timestamp, userid)
+    ticket = '%s%08x%s!' % (digest, timestamp, userid)
     if tokens:
         ticket += token_list + '!'
     ticket += user_data
@@ -257,5 +257,6 @@ def _test():
         optionflags=doctest.ELLIPSIS + doctest.NORMALIZE_WHITESPACE
     )
 
-if __name__ == "__main__":
+
+if __name__ == '__main__':
     _test()
diff --git a/setup.py b/setup.py
index 56f5d5e..6af354b 100644
--- a/setup.py
+++ b/setup.py
@@ -3,26 +3,26 @@
 from setuptools import setup
 
 version = '3.6.1.dev0'
-longdescription = open("README.rst").read()
+longdescription = open('README.rst').read()
 longdescription += '\n'
-longdescription += open("CHANGES.rst").read()
+longdescription += open('CHANGES.rst').read()
 
 setup(
     name='plone.session',
     version=version,
-    description="Session based auth tkt authentication for Zope",
+    description='Session based auth tkt authentication for Zope',
     long_description=longdescription,
     classifiers=[
-        "Environment :: Web Environment",
-        "Framework :: Plone :: 5.0",
-        "Framework :: Plone :: 5.1",
-        "Framework :: Plone",
-        "Framework :: Zope2",
-        "License :: OSI Approved :: BSD License",
-        "Operating System :: OS Independent",
-        "Programming Language :: Python :: 2.7",
-        "Programming Language :: Python",
-        "Topic :: System :: Systems Administration :: Authentication/Directory",  # noqa
+        'Environment :: Web Environment',
+        'Framework :: Plone :: 5.0',
+        'Framework :: Plone :: 5.1',
+        'Framework :: Plone',
+        'Framework :: Zope2',
+        'License :: OSI Approved :: BSD License',
+        'Operating System :: OS Independent',
+        'Programming Language :: Python :: 2.7',
+        'Programming Language :: Python',
+        'Topic :: System :: Systems Administration :: Authentication/Directory',  # noqa
     ],
     keywords='PAS session authentication Zope auth_tkt',
     author='Plone Foundation',


