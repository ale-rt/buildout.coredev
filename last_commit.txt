Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-09-13T10:03:22+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/9d5a9c78e1eeb5c15a4aab3a56e81dcc252b5d93

Register Plone 5.1 upgrade steps

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index bdc8e5d..cc12fc6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Register Plone 5.1 upgrade steps.
+  [thet]
+
 - Register settings for safe_html-Transform when migrating from 5107 to 5108
   [pbauer]
 
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 370f797..80d3633 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -181,4 +181,18 @@ Add image scaling options to image handling control panel.
             />
 
     </gs:upgradeSteps>
+
+    <gs:upgradeSteps
+        source="5108"
+        destination="5109"
+        profile="Products.CMFPlone:plone">
+
+        <gs:upgradeDepends
+            title="Run to51rc1 upgrade profile."
+            description=""
+            import_profile="plone.app.upgrade.v51:to51rc1"
+            />
+
+    </gs:upgradeSteps>
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index 7cee992..d082c0b 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -59,4 +59,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to51rc1"
+      title="Upgrade profile for Plone 5.1beta5 to Plone 5.1rc1"
+      description=""
+      directory="profiles/to_rc1"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-09-13T10:52:33+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/76a04130481a91e16272c8d7ebdee11f40533e43

Fix deletion of registry records in ``remove_duplicate_iterate_settings`` from the ``5108`` upgrade.

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cc12fc6..19251d8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Fix deletion of registry records in ``remove_duplicate_iterate_settings``
+  from the ``5108`` upgrade.
+  [thet]
+
 - Register Plone 5.1 upgrade steps.
   [thet]
 
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index cd3abf6..9adc617 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -212,9 +212,10 @@ def remove_duplicate_iterate_settings(context):
     registry = getUtility(IRegistry)
     from plone.app.iterate.interfaces import IIterateSettings
     try:
-        registry.forInterface(IIterateSettings, prefix='plone')
-        del registry['plone.checkout_workflow_policy']
-        del registry['plone.enable_checkout_workflow']
+        if 'plone.checkout_workflow_policy' in registry.records:
+            del registry.records['plone.checkout_workflow_policy']
+        if 'plone.enable_checkout_workflow' in registry.records:
+            del registry.records['plone.enable_checkout_workflow']
     except KeyError:
         pass
     # Make sure the correct settings are actually initialized


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-09-16T11:38:19+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/d0b1db9210f455ef05c4075b9a7200b4d1f0abe2

Merge pull request #137 from plone/thet-51rc1

5.1 Upgrade + Fixes

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index bdc8e5d..19251d8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,13 @@ New features:
 
 Bug fixes:
 
+- Fix deletion of registry records in ``remove_duplicate_iterate_settings``
+  from the ``5108`` upgrade.
+  [thet]
+
+- Register Plone 5.1 upgrade steps.
+  [thet]
+
 - Register settings for safe_html-Transform when migrating from 5107 to 5108
   [pbauer]
 
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index cd3abf6..9adc617 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -212,9 +212,10 @@ def remove_duplicate_iterate_settings(context):
     registry = getUtility(IRegistry)
     from plone.app.iterate.interfaces import IIterateSettings
     try:
-        registry.forInterface(IIterateSettings, prefix='plone')
-        del registry['plone.checkout_workflow_policy']
-        del registry['plone.enable_checkout_workflow']
+        if 'plone.checkout_workflow_policy' in registry.records:
+            del registry.records['plone.checkout_workflow_policy']
+        if 'plone.enable_checkout_workflow' in registry.records:
+            del registry.records['plone.enable_checkout_workflow']
     except KeyError:
         pass
     # Make sure the correct settings are actually initialized
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 370f797..80d3633 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -181,4 +181,18 @@ Add image scaling options to image handling control panel.
             />
 
     </gs:upgradeSteps>
+
+    <gs:upgradeSteps
+        source="5108"
+        destination="5109"
+        profile="Products.CMFPlone:plone">
+
+        <gs:upgradeDepends
+            title="Run to51rc1 upgrade profile."
+            description=""
+            import_profile="plone.app.upgrade.v51:to51rc1"
+            />
+
+    </gs:upgradeSteps>
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index 7cee992..d082c0b 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -59,4 +59,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to51rc1"
+      title="Upgrade profile for Plone 5.1beta5 to Plone 5.1rc1"
+      description=""
+      directory="profiles/to_rc1"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>


