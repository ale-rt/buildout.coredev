Repository: mockup


Branch: refs/heads/2.1.x
Date: 2017-11-14T11:27:15-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/mockup/commit/191e93d62d93fd833ed18f1e07f09c4f733a1730

Mark special links: Do not mark anchors as special links. fixes gh-707

Files changed:
M CHANGES.rst
M mockup/patterns/markspeciallinks/pattern.js
M mockup/tests/pattern-markspeciallinks-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index d0f9ca5b..945826de 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,10 +18,14 @@ New features:
   - Add contextual menu to theme files in the file tree.
   [b4oshany]
 
+- Mark special links pattern: Do not mark anchors as special links
+  [frapell]
+
 Bug fixes:
 
 - * Add item here *
 
+
 2.1.8 (2017-08-05)
 ------------------
 
diff --git a/mockup/patterns/markspeciallinks/pattern.js b/mockup/patterns/markspeciallinks/pattern.js
index 6a0217f7..e98e5e3f 100644
--- a/mockup/patterns/markspeciallinks/pattern.js
+++ b/mockup/patterns/markspeciallinks/pattern.js
@@ -135,11 +135,11 @@ define([
         // All links without an http href (without the link-plain class), not within this site,
         // and no img children should be wrapped in a link-[protocol] span
         contentarea.find(
-            'a[href]:not([href^="http:"]):not(.link-plain):not([href^="' + url + '"]):not(:has(img))')
+            'a[href]:not([href^="http:"]):not(.link-plain):not([href^="' + url + '"]):not(:has(img)):not([href^="#"])')
             .each(function() {
                 // those without a http link may have another interesting protocol
                 // wrap these in a link-[protocol] span
-                res = protocols.exec(this.href);
+                res = protocols.exec($(this).attr('href'));
                 if (res) {
                     var iconclass = 'glyphicon link-' + res[0];
                     $(this).before('<i class="' + iconclass + '"></i>');
diff --git a/mockup/tests/pattern-markspeciallinks-test.js b/mockup/tests/pattern-markspeciallinks-test.js
index 4fe355c7..b1e11c87 100644
--- a/mockup/tests/pattern-markspeciallinks-test.js
+++ b/mockup/tests/pattern-markspeciallinks-test.js
@@ -45,6 +45,11 @@ define([
         '      <li><a href="feed://www.plone.org">feed</a></li>' +
         '      <li><a href="webcal://www.plone.org">webcal</a></li>' +
         '    </ul>' +
+        '</div>' +
+        '<div class="anchors pat-markspeciallinks">' +
+        '  <p>Find out What&#39s new in <a href="#anchor">Plone</a>.<br>' +
+        '     Plone is written in <a class="link-plain" href="http://www.python.org">Python</a>.' +
+        '  </p>' +
         '</div>');
 
 
@@ -76,5 +81,10 @@ define([
       expect(listel.eq(9).find('i').hasClass('link-feed')).to.be.equal(true);
       expect(listel.eq(10).find('i').hasClass('link-webcal')).to.be.equal(true);
     });
+    it('do not show the lock icon for anchor links', function() {
+      registry.scan(this.$el);
+      var link = this.$el.next('.anchors').find('p').find('a');
+      expect(link.eq(0).prev().length).to.be.equal(0);
+    });
   });
 });


Repository: mockup


Branch: refs/heads/2.1.x
Date: 2017-11-14T22:36:31+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/mockup/commit/f24c9fc9e0a8cba76935a0d52c7c3e567e30e298

Merge pull request #822 from plone/frapell-markspeciallinks-2.1

Mark special links: Do not mark anchors as special links. fixes gh-707

Files changed:
M CHANGES.rst
M mockup/patterns/markspeciallinks/pattern.js
M mockup/tests/pattern-markspeciallinks-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index d0f9ca5b..945826de 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,10 +18,14 @@ New features:
   - Add contextual menu to theme files in the file tree.
   [b4oshany]
 
+- Mark special links pattern: Do not mark anchors as special links
+  [frapell]
+
 Bug fixes:
 
 - * Add item here *
 
+
 2.1.8 (2017-08-05)
 ------------------
 
diff --git a/mockup/patterns/markspeciallinks/pattern.js b/mockup/patterns/markspeciallinks/pattern.js
index 6a0217f7..e98e5e3f 100644
--- a/mockup/patterns/markspeciallinks/pattern.js
+++ b/mockup/patterns/markspeciallinks/pattern.js
@@ -135,11 +135,11 @@ define([
         // All links without an http href (without the link-plain class), not within this site,
         // and no img children should be wrapped in a link-[protocol] span
         contentarea.find(
-            'a[href]:not([href^="http:"]):not(.link-plain):not([href^="' + url + '"]):not(:has(img))')
+            'a[href]:not([href^="http:"]):not(.link-plain):not([href^="' + url + '"]):not(:has(img)):not([href^="#"])')
             .each(function() {
                 // those without a http link may have another interesting protocol
                 // wrap these in a link-[protocol] span
-                res = protocols.exec(this.href);
+                res = protocols.exec($(this).attr('href'));
                 if (res) {
                     var iconclass = 'glyphicon link-' + res[0];
                     $(this).before('<i class="' + iconclass + '"></i>');
diff --git a/mockup/tests/pattern-markspeciallinks-test.js b/mockup/tests/pattern-markspeciallinks-test.js
index 4fe355c7..b1e11c87 100644
--- a/mockup/tests/pattern-markspeciallinks-test.js
+++ b/mockup/tests/pattern-markspeciallinks-test.js
@@ -45,6 +45,11 @@ define([
         '      <li><a href="feed://www.plone.org">feed</a></li>' +
         '      <li><a href="webcal://www.plone.org">webcal</a></li>' +
         '    </ul>' +
+        '</div>' +
+        '<div class="anchors pat-markspeciallinks">' +
+        '  <p>Find out What&#39s new in <a href="#anchor">Plone</a>.<br>' +
+        '     Plone is written in <a class="link-plain" href="http://www.python.org">Python</a>.' +
+        '  </p>' +
         '</div>');
 
 
@@ -76,5 +81,10 @@ define([
       expect(listel.eq(9).find('i').hasClass('link-feed')).to.be.equal(true);
       expect(listel.eq(10).find('i').hasClass('link-webcal')).to.be.equal(true);
     });
+    it('do not show the lock icon for anchor links', function() {
+      registry.scan(this.$el);
+      var link = this.$el.next('.anchors').find('p').find('a');
+      expect(link.eq(0).prev().length).to.be.equal(0);
+    });
   });
 });


