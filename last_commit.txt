Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-04-25T00:36:50+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/de49234d206b6189942c8d7c9798cf7a887d0909

More graceful dates_for_display when no start/end
Don't break ``base.dates_for_display`` and the ``formatted_date`` content provider, if event object has no start or end dates.
It might come from a potential event.

Files changed:
M CHANGES.rst
M plone/app/event/base.py
M plone/app/event/browser/formatted_date.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 44e5e3c..15c96dd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Don't break ``base.dates_for_display`` and the ``formatted_date`` content provider, if event object has no start or end dates.
+  It might come from a potential event.
+  [thet]
 
 
 2.0.7 (2016-03-31)
diff --git a/plone/app/event/base.py b/plone/app/event/base.py
index b166c10..ba4ca0b 100644
--- a/plone/app/event/base.py
+++ b/plone/app/event/base.py
@@ -792,6 +792,10 @@ def dates_for_display(occurrence):
     else:
         acc = IEventAccessor(occurrence)
 
+    if acc.start is None or acc.end is None:
+        # Eventually optional start/end dates from a potentially Event.
+        return None
+
     # this needs to separate date and time as ulocalized_time does
     DT_start = DT(acc.start)
     DT_end = DT(acc.end)
diff --git a/plone/app/event/browser/formatted_date.py b/plone/app/event/browser/formatted_date.py
index 63a657d..b404776 100644
--- a/plone/app/event/browser/formatted_date.py
+++ b/plone/app/event/browser/formatted_date.py
@@ -21,6 +21,9 @@ def __call__(self, occ):
 
         """
         self.date_dict = dates_for_display(occ)
+        if self.date_dict is None:
+            # Don't break for potential Events without start/end.
+            return u""
         return self.template(self)
 
 


Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-04-25T09:28:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/649407c96da571c4d64fe1366a6f5053f3828196

Merge pull request #223 from plone/thet-datesfordisplay-startendless

More graceful dates_for_display when no start/end

Files changed:
M CHANGES.rst
M plone/app/event/base.py
M plone/app/event/browser/formatted_date.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 44e5e3c..15c96dd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Don't break ``base.dates_for_display`` and the ``formatted_date`` content provider, if event object has no start or end dates.
+  It might come from a potential event.
+  [thet]
 
 
 2.0.7 (2016-03-31)
diff --git a/plone/app/event/base.py b/plone/app/event/base.py
index b166c10..ba4ca0b 100644
--- a/plone/app/event/base.py
+++ b/plone/app/event/base.py
@@ -792,6 +792,10 @@ def dates_for_display(occurrence):
     else:
         acc = IEventAccessor(occurrence)
 
+    if acc.start is None or acc.end is None:
+        # Eventually optional start/end dates from a potentially Event.
+        return None
+
     # this needs to separate date and time as ulocalized_time does
     DT_start = DT(acc.start)
     DT_end = DT(acc.end)
diff --git a/plone/app/event/browser/formatted_date.py b/plone/app/event/browser/formatted_date.py
index 63a657d..b404776 100644
--- a/plone/app/event/browser/formatted_date.py
+++ b/plone/app/event/browser/formatted_date.py
@@ -21,6 +21,9 @@ def __call__(self, occ):
 
         """
         self.date_dict = dates_for_display(occ)
+        if self.date_dict is None:
+            # Don't break for potential Events without start/end.
+            return u""
         return self.template(self)
 
 


