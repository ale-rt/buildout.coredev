Repository: plone.app.contentlisting


Branch: refs/heads/1.3.x
Date: 2017-11-25T16:46:23-05:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.contentlisting/commit/25fe3d1860f3e4457b75157e9590135fcedb28d0

Revert "It seems that in zope4 brains can not longer acquire the REQUEST."

This reverts commit 4b965b3596cc686f678883afdc6ebc952be1308f.

Files changed:
M CHANGES.rst
M plone/app/contentlisting/catalog.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5e7f8b9..88fc15b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,8 +14,7 @@ New features:
 
 Bug fixes:
 
-- In Zope4 brains can not longer acquire the REQUEST.
-  [pbauer]
+- *add item here*
 
 - Fix tests after collective.indexing moved into core.
   [pbauer]
diff --git a/plone/app/contentlisting/catalog.py b/plone/app/contentlisting/catalog.py
index b2ef910..77341bd 100644
--- a/plone/app/contentlisting/catalog.py
+++ b/plone/app/contentlisting/catalog.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_base
+from Acquisition import aq_get
 from plone.app.contentlisting.contentlisting import BaseContentListingObject
 from plone.app.contentlisting.interfaces import IContentListingObject
 from plone.registry.interfaces import IRegistry
@@ -7,7 +8,6 @@
 from Products.CMFCore.utils import getToolByName
 from zope.component import getMultiAdapter
 from zope.component import queryUtility
-from zope.globalrequest import getRequest
 from zope.interface import implementer
 
 
@@ -25,7 +25,7 @@ class CatalogContentListingObject(BaseContentListingObject):
     def __init__(self, brain):
         self._brain = brain
         self._cached_realobject = None
-        self.request = getRequest()
+        self.request = aq_get(brain, 'REQUEST')
 
     def __repr__(self):
         return '<plone.app.contentlisting.catalog.'\


