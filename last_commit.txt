Repository: plone.formwidget.contenttree


Branch: refs/heads/master
Date: 2015-10-20T18:28:43+02:00
Author: Gaudenz Steinlin () <gaudenz.steinlin@cirrax.com>
Commit: https://github.com/plone/plone.formwidget.contenttree/commit/da75494638e04efcd80828a74c6aeb44349b7305

Fix HTML entities in browse button title

With plone.protect auto protection enabled all non-ascii characters in
the output get replaced by their HTML entities. But when setting an
attribute with the jQuery attr method HTML entities are not resolved.
See http://bugs.jquery.com/ticket/6780 for more information about this
issue.

This commit works around this by changeing the JS code to not use the
attr method the set the button title.

Files changed:
M docs/HISTORY.rst
M plone/formwidget/contenttree/widget.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 92981cd..c9328a2 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -7,6 +7,8 @@ Changelog
 - Remove unnecessary test setup.
   [timo] 
 
+- Fix HTML entities in browse button title
+  [gaudenz]
 
 1.0.11 (2015-02-09)
 -------------------
diff --git a/plone/formwidget/contenttree/widget.py b/plone/formwidget/contenttree/widget.py
index bea4597..e1de64a 100644
--- a/plone/formwidget/contenttree/widget.py
+++ b/plone/formwidget/contenttree/widget.py
@@ -123,13 +123,7 @@ def __call__(self):
     if ($(this).siblings('input.searchButton').length != 0) {
         return;
     }
-    var input = document.createElement('input');
-    $(input)
-        .attr({
-            'type': 'button',
-            'value': '%(button_val)s'
-        })
-        .addClass('searchButton')
+    $('<input type="button" value="%(button_val)s" class="searchButton">')
         .click(function () {
             var parent = $(this).parents("*[id$='-autocomplete']");
             var window = parent.siblings("*[id$='-contenttree-window']");


Repository: plone.formwidget.contenttree


Branch: refs/heads/master
Date: 2015-10-20T22:27:42+02:00
Author: Gaudenz Steinlin () <gaudenz.steinlin@cirrax.com>
Commit: https://github.com/plone/plone.formwidget.contenttree/commit/23cd9cf6a4513340527b7d4c5767cc83e150eac0

Implement __len__ for PathSource

PathSource implements IContentSource which derives from
IIterableVocabulary. Thus it must implement __len__.

As the number of valid terms for a PathSource is not known this always
returns len(self._default_terms) analogous to the __iter__ method.

Files changed:
M docs/HISTORY.rst
M plone/formwidget/contenttree/source.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index c9328a2..46ea6bb 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -10,6 +10,9 @@ Changelog
 - Fix HTML entities in browse button title
   [gaudenz]
 
+- Implement __len__ for PathSource
+  [gaudenz]
+
 1.0.11 (2015-02-09)
 -------------------
 
diff --git a/plone/formwidget/contenttree/source.py b/plone/formwidget/contenttree/source.py
index eb2e520..6ae80b0 100644
--- a/plone/formwidget/contenttree/source.py
+++ b/plone/formwidget/contenttree/source.py
@@ -106,6 +106,9 @@ def __init__(self, context, selectable_filter, navigation_tree_query=None, defau
     def __iter__(self):
         return iter(self._default_terms)
 
+    def __len__(self):
+        return len(self._default_terms)
+
     def __contains__(self, value):
         try:
             brain = self._getBrainByValue(value)


Repository: plone.formwidget.contenttree


Branch: refs/heads/master
Date: 2015-12-01T16:02:25Z
Author: Matthew Wilkes (MatthewWilkes) <git@matthewwilkes.name>
Commit: https://github.com/plone/plone.formwidget.contenttree/commit/75e96285298ceedb5f928d8545d82a1471399f26

Merge pull request #21 from plone/fix-csrf-protection-encoding

Fix csrf protection encoding

Files changed:
M docs/HISTORY.rst
M plone/formwidget/contenttree/source.py
M plone/formwidget/contenttree/widget.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 92981cd..46ea6bb 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -7,6 +7,11 @@ Changelog
 - Remove unnecessary test setup.
   [timo] 
 
+- Fix HTML entities in browse button title
+  [gaudenz]
+
+- Implement __len__ for PathSource
+  [gaudenz]
 
 1.0.11 (2015-02-09)
 -------------------
diff --git a/plone/formwidget/contenttree/source.py b/plone/formwidget/contenttree/source.py
index eb2e520..6ae80b0 100644
--- a/plone/formwidget/contenttree/source.py
+++ b/plone/formwidget/contenttree/source.py
@@ -106,6 +106,9 @@ def __init__(self, context, selectable_filter, navigation_tree_query=None, defau
     def __iter__(self):
         return iter(self._default_terms)
 
+    def __len__(self):
+        return len(self._default_terms)
+
     def __contains__(self, value):
         try:
             brain = self._getBrainByValue(value)
diff --git a/plone/formwidget/contenttree/widget.py b/plone/formwidget/contenttree/widget.py
index bea4597..e1de64a 100644
--- a/plone/formwidget/contenttree/widget.py
+++ b/plone/formwidget/contenttree/widget.py
@@ -123,13 +123,7 @@ def __call__(self):
     if ($(this).siblings('input.searchButton').length != 0) {
         return;
     }
-    var input = document.createElement('input');
-    $(input)
-        .attr({
-            'type': 'button',
-            'value': '%(button_val)s'
-        })
-        .addClass('searchButton')
+    $('<input type="button" value="%(button_val)s" class="searchButton">')
         .click(function () {
             var parent = $(this).parents("*[id$='-autocomplete']");
             var window = parent.siblings("*[id$='-contenttree-window']");


