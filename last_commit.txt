Repository: plone.api


Branch: refs/heads/master
Date: 2017-02-01T11:53:35+01:00
Author: Matthew Wilkes (MatthewWilkes) <git@matthewwilkes.name>
Commit: https://github.com/plone/plone.api/commit/88ce18c75007ae034f95ddc66cc15af934038282

No longer try to add Member and Manager roles in role tests, as in Zope4 adding a duplicate role raises an exception.

Files changed:
M docs/CHANGES.rst
M src/plone/api/tests/test_env.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index be0fbad..f5814b9 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -20,6 +20,9 @@ Bug fixes:
 - Fix imports from Globals that was removed in Zope4
   [pbauer]
 
+- Fix error in tests that try to add built-in roles, which no longer fails
+  silently in Zope4.
+  [MatthewWilkes]
 
 1.5.1 (2016-12-06)
 ------------------
diff --git a/src/plone/api/tests/test_env.py b/src/plone/api/tests/test_env.py
index 7f97a29..1e16351 100644
--- a/src/plone/api/tests/test_env.py
+++ b/src/plone/api/tests/test_env.py
@@ -70,8 +70,8 @@ def setUp(self):
 
         # Roles need to be created by name before we can assign permissions
         # to them or grant them to users.
-        for role in ('Member', 'VIP', 'Manager'):
-            portal._addRole(role)
+        # 'Member' and 'Manager' already exist by default, we need to add 'VIP'
+        portal._addRole('VIP')
 
         for permission, roles in role_mapping:
             portal.manage_permission(permission, roles, 1)


Repository: plone.api


Branch: refs/heads/master
Date: 2017-02-01T16:26:39+01:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.api/commit/10381498450011fa998ea871469a8b002001036e

Merge pull request #348 from plone/role-duplication-in-tests

Fix env tests in Zope4

Files changed:
M docs/CHANGES.rst
M src/plone/api/tests/test_env.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index be0fbad..f5814b9 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -20,6 +20,9 @@ Bug fixes:
 - Fix imports from Globals that was removed in Zope4
   [pbauer]
 
+- Fix error in tests that try to add built-in roles, which no longer fails
+  silently in Zope4.
+  [MatthewWilkes]
 
 1.5.1 (2016-12-06)
 ------------------
diff --git a/src/plone/api/tests/test_env.py b/src/plone/api/tests/test_env.py
index 7f97a29..1e16351 100644
--- a/src/plone/api/tests/test_env.py
+++ b/src/plone/api/tests/test_env.py
@@ -70,8 +70,8 @@ def setUp(self):
 
         # Roles need to be created by name before we can assign permissions
         # to them or grant them to users.
-        for role in ('Member', 'VIP', 'Manager'):
-            portal._addRole(role)
+        # 'Member' and 'Manager' already exist by default, we need to add 'VIP'
+        portal._addRole('VIP')
 
         for permission, roles in role_mapping:
             portal.manage_permission(permission, roles, 1)


