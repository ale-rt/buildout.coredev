Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-10-22T14:44:13+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contentlisting/commit/89205792c00561ece9ce54722d5fb32fdfb2d191

Fix tests where brain.review_state == Missing.Value due to deferred indexing

Files changed:
M CHANGES.rst
M plone/app/contentlisting/tests/base.py
M plone/app/contentlisting/tests/integration.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index c80c75d..5e7f8b9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - In Zope4 brains can not longer acquire the REQUEST.
   [pbauer]
 
+- Fix tests after collective.indexing moved into core.
+  [pbauer]
+
 
 1.3.1 (2017-08-08)
 ------------------
diff --git a/plone/app/contentlisting/tests/base.py b/plone/app/contentlisting/tests/base.py
index ff8c435..1dcce31 100644
--- a/plone/app/contentlisting/tests/base.py
+++ b/plone/app/contentlisting/tests/base.py
@@ -37,6 +37,8 @@ def setUpPloneSite(self, portal):
         wftool.doActionFor(portal.news, 'publish')
         portal.news.invokeFactory('News Item', 'news1')
         setRoles(portal, TEST_USER_ID, ['Member'])
+        from Products.CMFCore.indexing import processQueue
+        processQueue()
 
 
 CONTENTLISTING_INTEGRATION_FIXTURE = ContentListingIntegrationLayer()
diff --git a/plone/app/contentlisting/tests/integration.rst b/plone/app/contentlisting/tests/integration.rst
index a5c8f6e..f161999 100644
--- a/plone/app/contentlisting/tests/integration.rst
+++ b/plone/app/contentlisting/tests/integration.rst
@@ -19,6 +19,7 @@ common cases) the sequence will be a catalog search result set.
     >>> portal = layer['portal']
     >>> catalog = getToolByName(portal, 'portal_catalog')
     >>> results = catalog.searchResults(dict(is_default_page=False))
+    >>> import pdb; pdb.set_trace()
     >>> contentlist = IContentListing(results)
     >>> print(contentlist)
     <plone.app.contentlisting.contentlisting.ContentListing object ...>


