Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2016-10-22T13:14:24-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/756ba4952fc1948af31acb4eddd44bbf4213ec42

remove hard dependency on Archetypes (again)

Files changed:
A plone/app/linkintegrity/compat.py
M CHANGES.rst
M plone/app/linkintegrity/handlers.py
M plone/app/linkintegrity/retriever.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3429a7b..b48995e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Add coding headers on python files.
   [gforcada]
 
+- Remove hard dependency on Archetypes (again).
+  [davisagli]
+
 
 3.0.7 (2016-09-16)
 ------------------
diff --git a/plone/app/linkintegrity/compat.py b/plone/app/linkintegrity/compat.py
new file mode 100644
index 0000000..5f43af7
--- /dev/null
+++ b/plone/app/linkintegrity/compat.py
@@ -0,0 +1,14 @@
+# If Archetypes is not installed, define dummy objects
+# to replace Archetypes imports.
+
+try:
+    from Products.Archetypes.interfaces import IBaseObject
+    from Products.Archtypes.Field import TextField
+except ImportError:
+    from zope.interface import Interface
+
+    class IBaseObject(Interface):
+        pass
+
+    class TextField(object):
+        pass
diff --git a/plone/app/linkintegrity/handlers.py b/plone/app/linkintegrity/handlers.py
index 5e12ffd..4c9845f 100644
--- a/plone/app/linkintegrity/handlers.py
+++ b/plone/app/linkintegrity/handlers.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_get
 from Acquisition import aq_parent
-from Products.Archetypes.interfaces import IBaseObject
 from Products.CMFCore.utils import getToolByName
 from Products.CMFPlone.interfaces import IPloneSiteRoot
 from ZODB.POSException import ConflictError
@@ -19,6 +18,7 @@
 from zope.intid.interfaces import IIntIds
 from zope.keyreference.interfaces import NotYet
 from zope.publisher.interfaces import NotFound as ztkNotFound
+from .compat import IBaseObject
 import logging
 
 logger = logging.getLogger(__name__)
diff --git a/plone/app/linkintegrity/retriever.py b/plone/app/linkintegrity/retriever.py
index ade2a57..afd6307 100644
--- a/plone/app/linkintegrity/retriever.py
+++ b/plone/app/linkintegrity/retriever.py
@@ -5,14 +5,14 @@
 from plone.app.linkintegrity.parser import extractLinks
 from zope.component import adapter
 from zope.interface import implementer
-from Products.Archetypes.Field import TextField
-from Products.Archetypes.interfaces import IBaseObject
 from plone.dexterity.interfaces import IDexterityContent
 from zope.component import getUtility
 from plone.dexterity.interfaces import IDexterityFTI
 from plone.dexterity.utils import getAdditionalSchemata
 from zope.schema import getFieldsInOrder
 from plone.app.textfield import RichText
+from .compat import IBaseObject
+from .compat import TextField
 
 
 @implementer(IRetriever)


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2016-10-22T14:48:32-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/a08d2a2ec00fefe56c3c978c1d883fe5d9c43141

fix typo

Files changed:
M plone/app/linkintegrity/compat.py

diff --git a/plone/app/linkintegrity/compat.py b/plone/app/linkintegrity/compat.py
index 5f43af7..c19cf2f 100644
--- a/plone/app/linkintegrity/compat.py
+++ b/plone/app/linkintegrity/compat.py
@@ -3,7 +3,7 @@
 
 try:
     from Products.Archetypes.interfaces import IBaseObject
-    from Products.Archtypes.Field import TextField
+    from Products.Archetypes.Field import TextField
 except ImportError:
     from zope.interface import Interface
 


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2016-10-22T17:48:15-04:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/de15b7e15675289b0a6e56f0b20d6f276fc228ec

Merge pull request #44 from plone/davisagli-AT-cleanup

remove hard dependency on Archetypes (again)

Files changed:
A plone/app/linkintegrity/compat.py
M CHANGES.rst
M plone/app/linkintegrity/handlers.py
M plone/app/linkintegrity/retriever.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3429a7b..b48995e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Add coding headers on python files.
   [gforcada]
 
+- Remove hard dependency on Archetypes (again).
+  [davisagli]
+
 
 3.0.7 (2016-09-16)
 ------------------
diff --git a/plone/app/linkintegrity/compat.py b/plone/app/linkintegrity/compat.py
new file mode 100644
index 0000000..c19cf2f
--- /dev/null
+++ b/plone/app/linkintegrity/compat.py
@@ -0,0 +1,14 @@
+# If Archetypes is not installed, define dummy objects
+# to replace Archetypes imports.
+
+try:
+    from Products.Archetypes.interfaces import IBaseObject
+    from Products.Archetypes.Field import TextField
+except ImportError:
+    from zope.interface import Interface
+
+    class IBaseObject(Interface):
+        pass
+
+    class TextField(object):
+        pass
diff --git a/plone/app/linkintegrity/handlers.py b/plone/app/linkintegrity/handlers.py
index 5e12ffd..4c9845f 100644
--- a/plone/app/linkintegrity/handlers.py
+++ b/plone/app/linkintegrity/handlers.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_get
 from Acquisition import aq_parent
-from Products.Archetypes.interfaces import IBaseObject
 from Products.CMFCore.utils import getToolByName
 from Products.CMFPlone.interfaces import IPloneSiteRoot
 from ZODB.POSException import ConflictError
@@ -19,6 +18,7 @@
 from zope.intid.interfaces import IIntIds
 from zope.keyreference.interfaces import NotYet
 from zope.publisher.interfaces import NotFound as ztkNotFound
+from .compat import IBaseObject
 import logging
 
 logger = logging.getLogger(__name__)
diff --git a/plone/app/linkintegrity/retriever.py b/plone/app/linkintegrity/retriever.py
index ade2a57..afd6307 100644
--- a/plone/app/linkintegrity/retriever.py
+++ b/plone/app/linkintegrity/retriever.py
@@ -5,14 +5,14 @@
 from plone.app.linkintegrity.parser import extractLinks
 from zope.component import adapter
 from zope.interface import implementer
-from Products.Archetypes.Field import TextField
-from Products.Archetypes.interfaces import IBaseObject
 from plone.dexterity.interfaces import IDexterityContent
 from zope.component import getUtility
 from plone.dexterity.interfaces import IDexterityFTI
 from plone.dexterity.utils import getAdditionalSchemata
 from zope.schema import getFieldsInOrder
 from plone.app.textfield import RichText
+from .compat import IBaseObject
+from .compat import TextField
 
 
 @implementer(IRetriever)


