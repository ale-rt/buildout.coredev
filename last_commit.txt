Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-02-08T11:57:39-06:00
Author: Chrissy Wainwright (cdw9) <chrissy@sixfeetup.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/5307a8af035d162e9b228635d5afb7a43a0257b9

Add condition so custom folder migration does not fail if there is not an 'excludeFromNav'

Files changed:
M plone/app/contenttypes/migration/migration.py

diff --git a/plone/app/contenttypes/migration/migration.py b/plone/app/contenttypes/migration/migration.py
index 9fff3e0..e250646 100644
--- a/plone/app/contenttypes/migration/migration.py
+++ b/plone/app/contenttypes/migration/migration.py
@@ -162,7 +162,8 @@ def beforeChange_store_comments_on_portal(self):
 
     def migrate_atctmetadata(self):
         field = self.old.getField('excludeFromNav')
-        self.new.exclude_from_nav = field.get(self.old)
+        if field:
+            self.new.exclude_from_nav = field.get(self.old)
 
     def migrate_custom(self):
         """Get all ICustomMigrator registered migrators and run the migration.


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-02-10T17:02:52-06:00
Author: Chrissy Wainwright (cdw9) <chrissy@sixfeetup.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/659298cf013fe6704c5ca1ce947109cc34aab6c1

add changelog entry for checking excludeFromNav

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index fed3025..ce174a4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,10 @@ Bug fixes:
 - Only wake up event objects (this is needed for a the date math) in listings
   [tomgross]
 
+- Add condition so custom folder migration does not fail if there is not
+  an 'excludeFromNav'
+  [cdw9]
+
 
 1.2.21 (2017-02-05)
 -------------------


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-02-16T18:09:39+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/9c08a935da0b8ad92b6ff2c599723c646b8d4f39

Merge pull request #389 from sixfeetup/master

Prevent custom folder migration from failing

Files changed:
M CHANGES.rst
M plone/app/contenttypes/migration/migration.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3da502d..1990ceb 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,6 +16,10 @@ Bug fixes:
 
 - *add item here*
 
+- Add condition so custom folder migration does not fail if there is not
+  an 'excludeFromNav'
+  [cdw9]
+
 
 1.2.21 (2017-02-05)
 -------------------
diff --git a/plone/app/contenttypes/migration/migration.py b/plone/app/contenttypes/migration/migration.py
index 9fff3e0..e250646 100644
--- a/plone/app/contenttypes/migration/migration.py
+++ b/plone/app/contenttypes/migration/migration.py
@@ -162,7 +162,8 @@ def beforeChange_store_comments_on_portal(self):
 
     def migrate_atctmetadata(self):
         field = self.old.getField('excludeFromNav')
-        self.new.exclude_from_nav = field.get(self.old)
+        if field:
+            self.new.exclude_from_nav = field.get(self.old)
 
     def migrate_custom(self):
         """Get all ICustomMigrator registered migrators and run the migration.


