Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2016-05-17T11:53:11+02:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.app.multilingual/commit/42c22679d38985224dda058701e17ccd936d359d

Revert "Merge pull request #229 from plone/create_lang_folders_on_install"

This reverts commit 81e9d15a0d3c24cea8268aeade9d99acb9bd53cc, reversing
changes made to 169b753f91803223eecf28c6735f883bfbf605b5.

Files changed:
M CHANGES.rst
M setup.py
M src/plone/app/multilingual/browser/add.py
M src/plone/app/multilingual/browser/controlpanel.py
M src/plone/app/multilingual/browser/edit.py
M src/plone/app/multilingual/browser/helper_views.py
M src/plone/app/multilingual/browser/menu.py
M src/plone/app/multilingual/browser/translate.py
M src/plone/app/multilingual/browser/utils.py
M src/plone/app/multilingual/browser/vocabularies.py
M src/plone/app/multilingual/configure.zcml
M src/plone/app/multilingual/factory.py
M src/plone/app/multilingual/manager.py
M src/plone/app/multilingual/setuphandlers.py
M src/plone/app/multilingual/subscriber.py
M src/plone/app/multilingual/testing.py
M src/plone/app/multilingual/tests/test_directives.py
M src/plone/app/multilingual/tests/test_form.py
M src/plone/app/multilingual/tests/test_selector.py
M src/plone/app/multilingual/tests/test_setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index accab9e..a80051d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,14 +6,11 @@ Changelog
 
 Breaking changes:
 
-- No more compatible with GenericSetup below 1.8.2.
-  [iham]
+- *add item here*
 
 New features:
 
-- Creating language folder(s) on installation.
-  (fixes https://github.com/plone/plone.app.multilingual/issues/214)
-  [iham]
+- *add item here*
 
 Bug fixes:
 
@@ -28,7 +25,7 @@ Fixes:
 - Wait for visibility of select2 result, instead of time.
   [jensens]
 
-- Workaroud in robot test for TinyMCE overlap bug see
+- Workaroud in robot test for TinyMCE overlap bug see 
   https://github.com/plone/plone.app.multilingual/issues/227
   for details
   [jensens]
@@ -42,7 +39,7 @@ Fixes:
 - Fixed compatibility issue with archetypes contents: wrong URL were generated.
   [keul, hvelarde]
 
-- Really don't show the Google Translate button when no API key set
+- Really don't show the Google Translate button when no API key set 
   [djowett]
 
 
diff --git a/setup.py b/setup.py
index b39f9b4..2445b54 100755
--- a/setup.py
+++ b/setup.py
@@ -1,14 +1,11 @@
-"""Setup plone.app.multilingual."""
-
-import os
 from setuptools import setup, find_packages
+import os
 
-
-VERSION = '3.0.18.dev0'
+version = '3.0.18.dev0'
 
 setup(
     name='plone.app.multilingual',
-    version=VERSION,
+    version=version,
     description="Multilingual Plone UI package, enables maintenance of "
                 "translations for both Dexterity types and Archetypes",
     long_description="\n\n".join([
@@ -35,7 +32,6 @@
     zip_safe=False,
     install_requires=[
         'Products.CMFPlone>=5.0b1',
-        'Products.GenericSetup>=1.8.2',
         'archetypes.multilingual',
         'plone.app.registry',
         'plone.app.z3cform',
diff --git a/src/plone/app/multilingual/browser/add.py b/src/plone/app/multilingual/browser/add.py
index 2abab08..269c54f 100644
--- a/src/plone/app/multilingual/browser/add.py
+++ b/src/plone/app/multilingual/browser/add.py
@@ -71,8 +71,7 @@ def traverse(self, name, ignored):
         if not IDexterityContent.providedBy(source):
             # we are not on DX content, assume AT
             baseUrl = self.context.absolute_url()
-            url = '%s/@@add_at_translation?type=%s' % (baseUrl,
-                                                       source.portal_type)
+            url = '%s/@@add_at_translation?type=%s' % (baseUrl, source.portal_type)
             return self.request.response.redirect(url)
 
         # set the self.context to the place where it should be stored
@@ -90,8 +89,7 @@ def traverse(self, name, ignored):
             raise TraversalError(self.context, name)
 
         registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                         prefix="plone")
+        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
 
         if not settings.redirect_babel_view:
             add_view = None
@@ -136,8 +134,7 @@ def render(self):
     @property
     def max_nr_of_buttons(self):
         registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                         prefix="plone")
+        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         return settings.buttons_babel_view_up_to_nr_translations
 
     def _process_language_independent(self, fields, widgets):
diff --git a/src/plone/app/multilingual/browser/controlpanel.py b/src/plone/app/multilingual/browser/controlpanel.py
index ed607f8..775e133 100644
--- a/src/plone/app/multilingual/browser/controlpanel.py
+++ b/src/plone/app/multilingual/browser/controlpanel.py
@@ -1,10 +1,10 @@
 # -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
+from Products.CMFPlone import PloneMessageFactory as _Plone
 from Products.Five import BrowserView
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from Products.statusmessages.interfaces import IStatusMessage
-from Products.CMFPlone.controlpanel.browser.language import \
-    LanguageControlPanelForm
+from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm
 from plone.app.registry.browser import controlpanel
 
 from plone.app.multilingual import isLPinstalled
diff --git a/src/plone/app/multilingual/browser/edit.py b/src/plone/app/multilingual/browser/edit.py
index 96c0c32..6fb190e 100644
--- a/src/plone/app/multilingual/browser/edit.py
+++ b/src/plone/app/multilingual/browser/edit.py
@@ -84,8 +84,7 @@ def render(self):
     @property
     def max_nr_of_buttons(self):
         registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                         prefix="plone")
+        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         return settings.buttons_babel_view_up_to_nr_translations
 
 DefaultMultilingualEditView = layout.wrap_form(MultilingualEditForm)
diff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py
index 4b74b6d..cc065bf 100644
--- a/src/plone/app/multilingual/browser/helper_views.py
+++ b/src/plone/app/multilingual/browser/helper_views.py
@@ -211,8 +211,7 @@ def __call__(self):
             url = self.wrapDestination(url)
         else:
             registry = getUtility(IRegistry)
-            policies = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                             prefix="plone")
+            policies = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
             if policies.selector_lookup_translations_policy == 'closest':
                 url = self.getClosestDestination()
             else:
diff --git a/src/plone/app/multilingual/browser/menu.py b/src/plone/app/multilingual/browser/menu.py
index f6493ed..d67ee05 100644
--- a/src/plone/app/multilingual/browser/menu.py
+++ b/src/plone/app/multilingual/browser/menu.py
@@ -45,13 +45,12 @@ def getMenuItems(self, context, request):
         showflags = lt.showFlags
         context_id = ITranslationManager(context).tg
         registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                         prefix="plone")
+        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         edit_view = 'babel_edit' if settings.redirect_babel_view else 'edit'
         # In case is neutral language show set language menu only
         is_neutral_content = (
-            ILanguage(context).get_language() == LANGUAGE_INDEPENDENT or
-            is_language_independent(context)
+            ILanguage(context).get_language() == LANGUAGE_INDEPENDENT
+            or is_language_independent(context)
         )
 
         shared_folder_url = site_url + '/folder_contents'
diff --git a/src/plone/app/multilingual/browser/translate.py b/src/plone/app/multilingual/browser/translate.py
index 0114d99..688c899 100644
--- a/src/plone/app/multilingual/browser/translate.py
+++ b/src/plone/app/multilingual/browser/translate.py
@@ -55,8 +55,7 @@ def __call__(self):
         else:
             manager = ITranslationManager(self.context)
             registry = getUtility(IRegistry)
-            settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                             prefix="plone")
+            settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
             lang_target = ILanguage(self.context).get_language()
             lang_source = self.request.form['lang_source']
             orig_object = manager.get_translation(lang_source)
diff --git a/src/plone/app/multilingual/browser/utils.py b/src/plone/app/multilingual/browser/utils.py
index a2d7523..0ea5a24 100644
--- a/src/plone/app/multilingual/browser/utils.py
+++ b/src/plone/app/multilingual/browser/utils.py
@@ -56,8 +56,7 @@ def objToTranslate(self):
 
     def gtenabled(self):
         registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                         prefix="plone")
+        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         key = settings.google_translation_key
         return key is not None and len(key.strip()) > 0
 
@@ -129,8 +128,8 @@ def translated_languages(self):
                 None
             )
             context_language = ILanguage(context).get_language()
-            if (portal_factory is None or
-                    not portal_factory.isTemporary(self.context)) \
+            if (portal_factory is None
+                or not portal_factory.isTemporary(self.context)) \
                and lang_info['code'] == context_language:
                 continue
 
@@ -155,8 +154,7 @@ def current_language_name(self):
 
     def max_nr_of_buttons(self):
         registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema,
-                                         prefix="plone")
+        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         return settings.buttons_babel_view_up_to_nr_translations
 
 
diff --git a/src/plone/app/multilingual/browser/vocabularies.py b/src/plone/app/multilingual/browser/vocabularies.py
index 2b260ea..e1aa5e1 100644
--- a/src/plone/app/multilingual/browser/vocabularies.py
+++ b/src/plone/app/multilingual/browser/vocabularies.py
@@ -6,6 +6,7 @@
 from plone.app.vocabularies.catalog import CatalogVocabularyFactory
 from plone.i18n.locales.interfaces import ILanguageAvailability
 from zope.component import getGlobalSiteManager
+from zope.component.hooks import getSite
 from zope.interface import implementer
 from zope.interface import provider
 from zope.schema.interfaces import IContextSourceBinder
diff --git a/src/plone/app/multilingual/configure.zcml b/src/plone/app/multilingual/configure.zcml
index 9a26917..703e6c6 100644
--- a/src/plone/app/multilingual/configure.zcml
+++ b/src/plone/app/multilingual/configure.zcml
@@ -147,8 +147,7 @@
       description="Install to enable multilingual content support"
       directory="profiles/default"
       provides="Products.GenericSetup.interfaces.EXTENSION"
-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
-      post_handler=".setuphandlers.init_pam"/>
+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"/>
 
   <genericsetup:registerProfile
       name="uninstall"
diff --git a/src/plone/app/multilingual/factory.py b/src/plone/app/multilingual/factory.py
index cb14eb9..02cd2b3 100644
--- a/src/plone/app/multilingual/factory.py
+++ b/src/plone/app/multilingual/factory.py
@@ -39,8 +39,8 @@ def __call__(self, language):
         parent = aq_parent(self.context)
         translated_parent = parent
         found = False
-        while not (IPloneSiteRoot.providedBy(parent) and
-                   not ILanguageRootFolder.providedBy(parent))\
+        while not (IPloneSiteRoot.providedBy(parent)
+                   and not ILanguageRootFolder.providedBy(parent))\
                 and not found:
             parent_translation = ITranslationManager(parent)
             if parent_translation.has_translation(language):
diff --git a/src/plone/app/multilingual/manager.py b/src/plone/app/multilingual/manager.py
index 76022aa..c644c92 100644
--- a/src/plone/app/multilingual/manager.py
+++ b/src/plone/app/multilingual/manager.py
@@ -16,6 +16,8 @@
 from zope.event import notify
 from zope.interface import implementer
 from zope.site.hooks import getSite
+from plone.protect.interfaces import IDisableCSRFProtection
+from zope.interface import alsoProvides
 
 
 @implementer(ITranslationManager)
diff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py
index 9032fd4..26798c5 100644
--- a/src/plone/app/multilingual/setuphandlers.py
+++ b/src/plone/app/multilingual/setuphandlers.py
@@ -1,7 +1,5 @@
 # -*- coding: utf-8 -*-
-from plone.api import portal
 from Products.CMFPlone.interfaces import INonInstallable
-from plone.app.multilingual.browser.setup import SetupMultilingualSite
 from zope.interface import implementer
 import pkg_resources
 
@@ -26,12 +24,6 @@ def getNonInstallableProfiles(self):
         ]
 
 
-def init_pam(tool):
-    """After installation run setup to create LRF and LIF."""
-    setup_tool = SetupMultilingualSite()
-    setup_tool.setupSite(portal.get())
-
-
 def step_default_various(context):
     if context.readDataFile('plone.app.multilingual_default.txt') is None:
         return
diff --git a/src/plone/app/multilingual/subscriber.py b/src/plone/app/multilingual/subscriber.py
index 66ccf91..d4eaa40 100644
--- a/src/plone/app/multilingual/subscriber.py
+++ b/src/plone/app/multilingual/subscriber.py
@@ -16,6 +16,7 @@
 from zope.globalrequest import getRequest
 from zope.lifecycleevent import modified
 from zope.lifecycleevent.interfaces import IObjectRemovedEvent
+from plone.browserlayer.utils import registered_layers
 from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled
 
 
@@ -159,9 +160,11 @@ def createdEvent(obj, event):
     # AT check
     portal = getSite()
     portal_factory = getToolByName(portal, 'portal_factory', None)
-    if (not IDexterityContent.providedBy(obj) and
-            portal_factory is not None and
-            not portal_factory.isTemporary(obj)):
+    if (
+        not IDexterityContent.providedBy(obj)
+        and portal_factory is not None
+        and not portal_factory.isTemporary(obj)
+    ):
         return
 
     IMutableTG(obj).set(ti['tg'])
diff --git a/src/plone/app/multilingual/testing.py b/src/plone/app/multilingual/testing.py
index 876ac43..2ef49c1 100644
--- a/src/plone/app/multilingual/testing.py
+++ b/src/plone/app/multilingual/testing.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
+from Testing import ZopeTestCase
 from email.header import Header
 from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_FIXTURE
 from plone.app.multilingual.browser.setup import SetupMultilingualSite
@@ -80,59 +81,6 @@ def setUpPloneSite(self, portal):
     name="plone.app.multilingual:Integration")
 
 
-class PloneAppMultiLingualPresetLayer(PloneSandboxLayer):
-    """Test installation with preset languages."""
-
-    defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)
-
-    def setUpZope(self, app, configurationContext):
-        # Configure ZCML
-        xmlconfig.file('testing.zcml', plone.app.multilingual,
-                       context=configurationContext)
-
-        xmlconfig.file('overrides.zcml', plone.app.multilingual,
-                       context=configurationContext)
-
-        # Enable languageindependent-field on IRelatedItems-behavior
-        from plone.app.relationfield.behavior import IRelatedItems
-        alsoProvides(IRelatedItems['relatedItems'], ILanguageIndependentField)
-
-    def setUpPloneSite(self, portal):
-        # Define available languages before installing PAM
-        # This simulates the behavior of having predefined languages
-        # in GenericSetup before installing PAM
-        language_tool = getToolByName(portal, 'portal_languages')
-        language_tool.addSupportedLanguage('ca')
-        language_tool.addSupportedLanguage('es')
-
-        # Enable request negotiator
-        language_tool.use_request_negotiation = True
-
-        # Activate product
-        applyProfile(portal, 'plone.app.multilingual:default')
-
-        # Empower test user
-        setRoles(portal, TEST_USER_ID, ['Manager'])
-
-        # Enable all errors
-        error_log = getToolByName(portal, 'error_log')
-        error_log._ignored_exceptions = ()
-
-        # Set default workflow
-        wftool = getToolByName(portal, 'portal_workflow')
-        wftool.setDefaultChain('simple_publication_workflow')
-
-        # Cleanup p.a.contenttypes stuff
-        if 'robot-test-folder' in portal.objectIds():
-            portal.manage_delObjects('robot-test-folder')
-
-PLONE_APP_MULTILINGUAL_PRESET_FIXTURE = PloneAppMultiLingualPresetLayer()
-
-PLONE_APP_MULTILINGUAL_PRESET_INTEGRATION_TESTING = IntegrationTesting(
-    bases=(PLONE_APP_MULTILINGUAL_PRESET_FIXTURE,),
-    name="plone.app.multilingual:PresetIntegration")
-
-
 class MultipleLanguagesLayer(z2.Layer):
 
     defaultBases = (PLONE_APP_MULTILINGUAL_FIXTURE,)
@@ -255,7 +203,5 @@ def create_translation(self, *args, **kwargs):
 
 
 PAM_INTEGRATION_TESTING = PLONE_APP_MULTILINGUAL_INTEGRATION_TESTING
-PAM_INTEGRATION_PRESET_TESTING = \
-    PLONE_APP_MULTILINGUAL_PRESET_INTEGRATION_TESTING
 PAM_FUNCTIONAL_TESTING = PLONE_APP_MULTILINGUAL_FUNCTIONAL_TESTING
 PAM_ROBOT_TESTING = PLONE_APP_MULTILINGUAL_ROBOT_TESTING
diff --git a/src/plone/app/multilingual/tests/test_directives.py b/src/plone/app/multilingual/tests/test_directives.py
index 492194c..01abe67 100644
--- a/src/plone/app/multilingual/tests/test_directives.py
+++ b/src/plone/app/multilingual/tests/test_directives.py
@@ -7,6 +7,8 @@
 from zope import schema
 from zope.interface import Interface
 import unittest
+from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled
+from zope.interface import alsoProvides
 
 
 class TestDirectives(unittest.TestCase):
diff --git a/src/plone/app/multilingual/tests/test_form.py b/src/plone/app/multilingual/tests/test_form.py
index 57e4529..3b0302e 100644
--- a/src/plone/app/multilingual/tests/test_form.py
+++ b/src/plone/app/multilingual/tests/test_form.py
@@ -92,8 +92,9 @@ def test_translation_can_be_unregistered(self):
         transaction.commit()
 
         # Create translation
-        self.browser.open(a_ca.absolute_url() +
-                          '/@@create_translation?language=en')
+        self.browser.open(
+            a_ca.absolute_url()
+            + '/@@create_translation?language=en')
 
         # Fill in translation details
         self.browser.getControl(
@@ -101,8 +102,8 @@ def test_translation_can_be_unregistered(self):
         self.browser.getControl(name="form.buttons.save").click()
 
         # Unregister translation
-        self.browser.open(a_ca.absolute_url() +
-                          '/remove_translations?set_language=en')
+        self.browser.open(a_ca.absolute_url()
+                          + '/remove_translations?set_language=en')
 
         self.portal._p_jar.sync()
 
@@ -170,8 +171,9 @@ def test_translation_can_be_removed_by_deleting(self):
         transaction.commit()
 
         # Translate content
-        self.browser.open(a_ca.absolute_url() +
-                          '/@@create_translation?language=en')
+        self.browser.open(
+            a_ca.absolute_url()
+            + '/@@create_translation?language=en')
 
         # Fill in translation details
         self.browser.getControl(
@@ -195,8 +197,9 @@ def test_folderish_content_can_be_translated(self):
 
         transaction.commit()
 
-        self.browser.open(self.portal.absolute_url() +
-                          '/ca/test-folder/@@create_translation?language=en')
+        self.browser.open(
+            self.portal.absolute_url()
+            + '/ca/test-folder/@@create_translation?language=en')
 
         self.browser.getControl(
             name="form.widgets.IDublinCore.title").value = u"Test folder"
@@ -216,8 +219,9 @@ def test_content_in_folders_can_be_translated(self):
 
         transaction.commit()
 
-        self.browser.open(af_ca.absolute_url() + '/' + b_ca.id +
-                          '/@@create_translation?language=en')
+        self.browser.open(
+            af_ca.absolute_url() + '/' + b_ca.id
+            + '/@@create_translation?language=en')
 
         self.browser.getControl(
             name="form.widgets.IDublinCore.title").value = u"Test folder"
diff --git a/src/plone/app/multilingual/tests/test_selector.py b/src/plone/app/multilingual/tests/test_selector.py
index 92af4e0..991e0e1 100644
--- a/src/plone/app/multilingual/tests/test_selector.py
+++ b/src/plone/app/multilingual/tests/test_selector.py
@@ -163,16 +163,14 @@ def assertFullyTranslatedPages(self):
 
     def test_languages_fully_translated_by_closest(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         self.assertFullyTranslatedPages()
 
     def test_languages_fully_translated_by_dialog(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'dialog'
 
         self.assertFullyTranslatedPages()
@@ -220,8 +218,7 @@ def setUpFullyTranslatedContent(self):
     def test_languages_untranslated_by_closest(self):
         # Define selector policy
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         wftool = getToolByName(self.portal, "portal_workflow")
@@ -256,8 +253,7 @@ def test_languages_untranslated_by_closest(self):
 
     def test_languages_partially_translated_by_closest(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         # Setup content
@@ -299,8 +295,7 @@ def test_languages_partially_translated_by_closest(self):
 
     def test_languages_partially_translated_by_dialog(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'dialog'
 
         # Setup content
@@ -361,8 +356,8 @@ def assertSiteRoot(self):
         # Check EN root
         self.assertEqual(
             selector_languages[0]['url'],
-            (self.portal.absolute_url() +
-             '/@@multilingual-selector/notg/en?set_language=en')
+            (self.portal.absolute_url()
+             + '/@@multilingual-selector/notg/en?set_language=en')
         )
         self.browser.open(selector_languages[0]['url'])
         self.assertIn(
@@ -374,8 +369,8 @@ def assertSiteRoot(self):
         # Check CA root
         self.assertEqual(
             selector_languages[1]['url'],
-            (self.portal.absolute_url() +
-             '/@@multilingual-selector/notg/ca?set_language=ca')
+            (self.portal.absolute_url()
+             + '/@@multilingual-selector/notg/ca?set_language=ca')
         )
         self.browser.open(selector_languages[1]['url'])
         self.assertIn(
@@ -387,8 +382,8 @@ def assertSiteRoot(self):
         self.browser.open(selector_languages[2]['url'])
         self.assertEqual(
             selector_languages[2]['url'],
-            (self.portal.absolute_url() +
-             '/@@multilingual-selector/notg/es?set_language=es')
+            (self.portal.absolute_url()
+             + '/@@multilingual-selector/notg/es?set_language=es')
         )
         self.assertIn(
             u'lang="es"'.encode("utf-8"),
@@ -397,16 +392,14 @@ def assertSiteRoot(self):
 
     def test_siteroot_by_closest(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         self.assertSiteRoot()
 
     def test_siteroot_by_dialog(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'dialog'
 
         self.assertSiteRoot()
@@ -496,24 +489,21 @@ def assertRootFolders(self):
 
     def test_languages_root_folders_by_dialog(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'dialog'
 
         self.assertRootFolders()
 
     def test_languages_root_folders_by_closest(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         self.assertRootFolders()
 
     def test_languages_preserve_view(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         self.setUpPartiallyTranslatedContent()
@@ -567,8 +557,7 @@ def test_languages_preserve_view(self):
 
         # Shouldn't do for the not-translated-yet thingie when dialog is on
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'dialog'
 
         selector = LanguageSelectorViewlet(f_en, self.request, None, None)
@@ -631,11 +620,11 @@ def assertLanguagesPreserveQuery(self, policy):
 
         tgid = selector_languages[2]['url'].split('/')[-3]
         untranslated_url = {
-            'closest': (self.portal['es'].absolute_url() +
-                        '?int=1&uni=pres%C3%98rved&set_language=es'),
-            'dialog': (self.portal.absolute_url() +
-                       NOT_TRANSLATED_YET_TEMPLATE + '/' + tgid +
-                       '?int=1&uni=pres%C3%98rved&set_language=es')
+            'closest': (self.portal['es'].absolute_url()
+                        + '?int=1&uni=pres%C3%98rved&set_language=es'),
+            'dialog': (self.portal.absolute_url()
+                       + NOT_TRANSLATED_YET_TEMPLATE + '/' + tgid
+                       + '?int=1&uni=pres%C3%98rved&set_language=es')
         }
 
         transaction.commit()
@@ -644,8 +633,8 @@ def assertLanguagesPreserveQuery(self, policy):
         self.browser.open(selector_languages[0]['url'])
         self.assertEqual(
             self.browser.url,
-            (f_en.absolute_url() +
-             '/contact-info?int=1&uni=pres%C3%98rved&set_language=en')
+            (f_en.absolute_url()
+             + '/contact-info?int=1&uni=pres%C3%98rved&set_language=en')
         )
         self.assertIn(
             u'lang="en"'.encode("utf-8"),
@@ -657,8 +646,8 @@ def assertLanguagesPreserveQuery(self, policy):
         self.browser.open(selector_languages[1]['url'])
         self.assertEqual(
             self.browser.url,
-            (f_ca.absolute_url() +
-             '/contact-info?int=1&uni=pres%C3%98rved&set_language=ca')
+            (f_ca.absolute_url()
+             + '/contact-info?int=1&uni=pres%C3%98rved&set_language=ca')
         )
         self.assertIn(
             u'lang="ca"'.encode("utf-8"),
@@ -679,16 +668,14 @@ def assertLanguagesPreserveQuery(self, policy):
 
     def test_languages_preserve_by_closest(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'closest'
 
         self.assertLanguagesPreserveQuery('closest')
 
     def test_languages_preserve_by_dialog(self):
         self.registry = getUtility(IRegistry)
-        self.settings = self.registry.forInterface(
-            IMultiLanguageExtraOptionsSchema, prefix="plone")
+        self.settings = self.registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
         self.settings.selector_lookup_translations_policy = 'dialog'
 
         self.assertLanguagesPreserveQuery('dialog')
diff --git a/src/plone/app/multilingual/tests/test_setup.py b/src/plone/app/multilingual/tests/test_setup.py
index ca0aeb4..65556d4 100644
--- a/src/plone/app/multilingual/tests/test_setup.py
+++ b/src/plone/app/multilingual/tests/test_setup.py
@@ -1,105 +1,39 @@
 # -*- coding: utf-8 -*-
-import unittest2 as unittest
-from zope.interface import alsoProvides
-
 from Products.CMFCore.utils import getToolByName
-
 from plone.app.multilingual.browser.setup import SetupMultilingualSite
-from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled
 from plone.app.multilingual.browser.vocabularies import\
     AllContentLanguageVocabulary
-from plone.app.multilingual.testing import (PAM_INTEGRATION_TESTING,
-                                            PAM_INTEGRATION_PRESET_TESTING)
+from plone.app.multilingual.testing import PAM_INTEGRATION_TESTING
+import unittest2 as unittest
+from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled
+from zope.interface import alsoProvides
 
 
 class TestSetupMultilingualSite(unittest.TestCase):
-    """Testing multilingual site without predefined languages."""
 
     layer = PAM_INTEGRATION_TESTING
 
     def setUp(self):
-        """Setting up the test."""
         self.portal = self.layer['portal']
         self.request = self.layer['request']
-        self.language_tool = getToolByName(self.portal, 'portal_languages')
-        self.languages = self.language_tool.getSupportedLanguages()
         alsoProvides(self.layer['request'], IPloneAppMultilingualInstalled)
 
-    def test_single_language(self):
-        """Only one language is set."""
-        self.assertEqual(len(self.languages), 1)
-
-    def test_no_languagefolder_created(self):
-        """On a single language no folder creation is done."""
-        portal_objects = self.portal.objectIds()
-        for lang in self.languages:
-            self.assertNotIn(lang, portal_objects)
-
-    def test_all_supported_languages(self):
-        """There was a language which code is 'id'.
-        This broke the root language folder setup process.
-        To get rid of that the folder is 'id-id'.
+    def test_add_all_supported_languages(self):
+        """There was a language which code is 'id' and it broke the root
+        language folder setup process
         """
-        all_langs = AllContentLanguageVocabulary()(self.portal)
-        for lang in all_langs:
-            self.language_tool.addSupportedLanguage(lang.value)
-
-        workflow_tool = getToolByName(self.portal, "portal_workflow")
-        workflow_tool.setDefaultChain('simple_publication_workflow')
+        language_tool = getToolByName(self.portal, 'portal_languages')
+        for lang in AllContentLanguageVocabulary()(self.portal):
+            language_tool.addSupportedLanguage(lang.value)
 
-        setup_tool = SetupMultilingualSite()
-        setup_tool.setupSite(self.portal)
+        workflowTool = getToolByName(self.portal, "portal_workflow")
+        workflowTool.setDefaultChain('simple_publication_workflow')
 
-        portal_objects = self.portal.objectIds()
+        setupTool = SetupMultilingualSite()
+        setupTool.setupSite(self.portal)
 
-        for lang in all_langs.by_value.keys():
-            if lang == 'id':
-                self.assertIn('id-id', portal_objects)
+        for lang in AllContentLanguageVocabulary()(self.portal):
+            if lang.value == 'id':
+                self.assertIn('id-id', self.portal.objectIds())
             else:
-                self.assertIn(lang, portal_objects)
-
-    def test_type_of_language_folders(self):
-        """The created objects have to be 'Language Root Folder'."""
-        all_langs = AllContentLanguageVocabulary()(self.portal)
-        for lang in all_langs:
-            self.language_tool.addSupportedLanguage(lang.value)
-
-        workflow_tool = getToolByName(self.portal, "portal_workflow")
-        workflow_tool.setDefaultChain('simple_publication_workflow')
-
-        setup_tool = SetupMultilingualSite()
-        setup_tool.setupSite(self.portal)
-
-        for lang in all_langs.by_value.keys():
-            if lang == 'id':
-                self.assertEqual(self.portal.get('id-id').portal_type, 'LRF')
-            else:
-                self.assertEqual(self.portal.get(lang).portal_type, 'LRF')
-
-
-class TestSetupMultilingualPresetSite(unittest.TestCase):
-    """Testing multilingual site with predefined languages."""
-
-    layer = PAM_INTEGRATION_PRESET_TESTING
-
-    def setUp(self):
-        """Setting up the test."""
-        self.portal = self.layer['portal']
-        self.request = self.layer['request']
-        self.language_tool = getToolByName(self.portal, 'portal_languages')
-        self.languages = self.language_tool.getSupportedLanguages()
-        alsoProvides(self.layer['request'], IPloneAppMultilingualInstalled)
-
-    def test_language_folders_created(self):
-        """Available languages are: 'en', 'ca', 'es'.
-        After setup has run there should be
-        new objects in the portal named after the languages.
-        """
-        portal_objects = self.portal.objectIds()
-        for lang in self.languages:
-            self.assertIn(lang, portal_objects)
-
-    def test_type_of_language_folders(self):
-        """The created objects have to be 'Language Root Folder'."""
-        for lang in self.languages:
-            self.assertEqual(self.portal.get(lang).portal_type, 'LRF')
+                self.assertIn(lang.value, self.portal.objectIds())


