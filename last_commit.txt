Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-21T09:34:08+01:00
Author: Marc Sommerhalder (msom) <marc.sommerhalder@seantis.ch>
Commit: https://github.com/plone/Products.TinyMCE/commit/64509e2ed8dbb4b1048871f595a4776b7f690eac

Show anchor dropdown for internal links again if it was empty once

Files changed:
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js

diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
index a36c8b8..fdaf1ee 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
@@ -800,6 +800,7 @@ BrowserDialog.prototype.setDetails = function (url) {
                     html += '<option value="' + data.anchors[i] + '">' + data.anchors[i] + '</option>';
                 }
                 jq('#pageanchor', document).append(html);
+                jq('#pageanchorcontainer', document).parents('.field').removeClass('hide');
             } else {
                 jq('#pageanchorcontainer', document).parents('.field').addClass('hide');
             }


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-22T08:05:36+01:00
Author: Marc Sommerhalder (msom) <marc.sommerhalder@seantis.ch>
Commit: https://github.com/plone/Products.TinyMCE/commit/cd934e4ff4c620cae2bca350d8eb5309053768b0

Update history

Files changed:
M HISTORY.rst

diff --git a/HISTORY.rst b/HISTORY.rst
index 251fa0d..2fa2795 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -11,7 +11,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Show the anchor dropdown for internal links again if it was empty once.
+  [msom]
 
 
 1.3.17 (2016-01-08)


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-02-01T09:03:04+01:00
Author: Marc Sommerhalder (msom) <marc.sommerhalder@seantis.ch>
Commit: https://github.com/plone/Products.TinyMCE/commit/2ec86e4ce68b014d42d033dcad9ffc06bb5a67d3

Merge branch '1.3.x' into 1.3.x-fix-internal-anchors

Files changed:
M HISTORY.rst
M Products/TinyMCE/browser/atanchors.py

diff --git a/HISTORY.rst b/HISTORY.rst
index 2fa2795..84ca5b1 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -11,6 +11,10 @@ New:
 
 Fixes:
 
+- Fixed bug where the plonebrowser dialog wouldn't properly populate the
+  anchors if the HTML5 schema was used.
+  [msom]
+
 - Show the anchor dropdown for internal links again if it was empty once.
   [msom]
 
diff --git a/Products/TinyMCE/browser/atanchors.py b/Products/TinyMCE/browser/atanchors.py
index 0ca7e2b..a55cb58 100644
--- a/Products/TinyMCE/browser/atanchors.py
+++ b/Products/TinyMCE/browser/atanchors.py
@@ -18,6 +18,7 @@ def fromstring(text):
 
     SEARCHPATTERN = "*/a"
 
+
 class ATAnchorView(BrowserView):
     implements(IAnchorView)
 
@@ -38,5 +39,11 @@ def listAnchorNames(self, fieldname=None):
             raise
         except Exception:
             return []
-        return [anchor.get('name') for anchor in tree.findall(SEARCHPATTERN)
-                if "name" in anchor.keys()]
+
+        anchors = []
+        for anchor in tree.findall(SEARCHPATTERN):
+            if "name" in anchor.keys():
+                anchors.append(anchor.get('name'))
+            if "id" in anchor.keys():
+                anchors.append(anchor.get('id'))
+        return anchors


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-02-01T09:14:42+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.TinyMCE/commit/c3f50cbaa40b865c9ad24176ba95dc89764f39a1

Merge pull request #131 from plone/1.3.x-fix-internal-anchors

Show anchor dropdown for internal links again if it was empty once

Files changed:
M HISTORY.rst
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js

diff --git a/HISTORY.rst b/HISTORY.rst
index f516a27..84ca5b1 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -15,6 +15,9 @@ Fixes:
   anchors if the HTML5 schema was used.
   [msom]
 
+- Show the anchor dropdown for internal links again if it was empty once.
+  [msom]
+
 
 1.3.17 (2016-01-08)
 -------------------
diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
index a36c8b8..fdaf1ee 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
@@ -800,6 +800,7 @@ BrowserDialog.prototype.setDetails = function (url) {
                     html += '<option value="' + data.anchors[i] + '">' + data.anchors[i] + '</option>';
                 }
                 jq('#pageanchor', document).append(html);
+                jq('#pageanchorcontainer', document).parents('.field').removeClass('hide');
             } else {
                 jq('#pageanchorcontainer', document).parents('.field').addClass('hide');
             }


