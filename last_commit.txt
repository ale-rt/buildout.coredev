Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-05-29T11:36:49+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/f3b0468b090b6ba22b494db2d8166f98ab77c9b9

Fixed KeyError for render_body on syndication-controlpanel.

This happens on a site created before 5.0rc1.

Files changed:
A plone/app/upgrade/v50/profiles/to_508/registry.xml
M CHANGES.rst
M plone/app/upgrade/v50/configure.zcml
M plone/app/upgrade/v50/profiles.zcml
M plone/app/upgrade/v51/profiles/to_beta4/registry.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 1e4021e..e2b20f9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,12 @@ New features:
 
 Bug fixes:
 
+- Register ``ISiteSyndicationSettings`` again.
+  This interface was updated in 5.0rc3.
+  On older sites, this would cause an error on the ``syndication-controlpanel``:
+  KeyError: 'Interface `Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings` defines a field `render_body`, for which there is no record.
+  [maurits]
+
 - Catch warning the pythonic way.
   Makes it work with latest CMFCore.
   [jensens]
diff --git a/plone/app/upgrade/v50/configure.zcml b/plone/app/upgrade/v50/configure.zcml
index 31ad537..4ff240d 100644
--- a/plone/app/upgrade/v50/configure.zcml
+++ b/plone/app/upgrade/v50/configure.zcml
@@ -350,6 +350,11 @@
           handler=".final.fix_double_smaxage"
           />
 
+      <gs:upgradeDepends
+           title="Run to508 upgrade profile."
+           import_profile="plone.app.upgrade.v50:to508"
+           />
+
     </gs:upgradeSteps>
 
 </configure>
diff --git a/plone/app/upgrade/v50/profiles.zcml b/plone/app/upgrade/v50/profiles.zcml
index 77ff768..c45f02c 100644
--- a/plone/app/upgrade/v50/profiles.zcml
+++ b/plone/app/upgrade/v50/profiles.zcml
@@ -120,4 +120,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to508"
+      title="Upgrade profile for Plone 5.0.7 to Plone 5.0.8"
+      description=""
+      directory="profiles/to_508"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v50/profiles/to_508/registry.xml b/plone/app/upgrade/v50/profiles/to_508/registry.xml
new file mode 100644
index 0000000..b0cb3d6
--- /dev/null
+++ b/plone/app/upgrade/v50/profiles/to_508/registry.xml
@@ -0,0 +1,5 @@
+<?xml version="1.0"?>
+<registry>
+  <!-- add missing render_body field -->
+  <records interface="Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings" />
+</registry>
diff --git a/plone/app/upgrade/v51/profiles/to_beta4/registry.xml b/plone/app/upgrade/v51/profiles/to_beta4/registry.xml
index 97a1be5..385f1a5 100644
--- a/plone/app/upgrade/v51/profiles/to_beta4/registry.xml
+++ b/plone/app/upgrade/v51/profiles/to_beta4/registry.xml
@@ -22,9 +22,12 @@
   </records>
 
   <!-- Remove TinyMCE layer resource -->
-  <records 
+  <records
       remove="True"
       prefix="plone.resources/tinymce-layer"
       interface='Products.CMFPlone.interfaces.IResourceRegistry'/>
 
+  <!-- add missing render_body field -->
+  <records interface="Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings" />
+
 </registry>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-06-01T00:21:04+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/2b16fdc4179afe86cee053368d0e6c808e0b825e

Merge pull request #122 from plone/register-isitesyndication

Fixed KeyError for render_body on syndication-controlpanel.

Files changed:
A plone/app/upgrade/v50/profiles/to_508/registry.xml
M CHANGES.rst
M plone/app/upgrade/v50/configure.zcml
M plone/app/upgrade/v50/profiles.zcml
M plone/app/upgrade/v51/profiles/to_beta4/registry.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 1e4021e..e2b20f9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,12 @@ New features:
 
 Bug fixes:
 
+- Register ``ISiteSyndicationSettings`` again.
+  This interface was updated in 5.0rc3.
+  On older sites, this would cause an error on the ``syndication-controlpanel``:
+  KeyError: 'Interface `Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings` defines a field `render_body`, for which there is no record.
+  [maurits]
+
 - Catch warning the pythonic way.
   Makes it work with latest CMFCore.
   [jensens]
diff --git a/plone/app/upgrade/v50/configure.zcml b/plone/app/upgrade/v50/configure.zcml
index 31ad537..4ff240d 100644
--- a/plone/app/upgrade/v50/configure.zcml
+++ b/plone/app/upgrade/v50/configure.zcml
@@ -350,6 +350,11 @@
           handler=".final.fix_double_smaxage"
           />
 
+      <gs:upgradeDepends
+           title="Run to508 upgrade profile."
+           import_profile="plone.app.upgrade.v50:to508"
+           />
+
     </gs:upgradeSteps>
 
 </configure>
diff --git a/plone/app/upgrade/v50/profiles.zcml b/plone/app/upgrade/v50/profiles.zcml
index 77ff768..c45f02c 100644
--- a/plone/app/upgrade/v50/profiles.zcml
+++ b/plone/app/upgrade/v50/profiles.zcml
@@ -120,4 +120,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to508"
+      title="Upgrade profile for Plone 5.0.7 to Plone 5.0.8"
+      description=""
+      directory="profiles/to_508"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v50/profiles/to_508/registry.xml b/plone/app/upgrade/v50/profiles/to_508/registry.xml
new file mode 100644
index 0000000..b0cb3d6
--- /dev/null
+++ b/plone/app/upgrade/v50/profiles/to_508/registry.xml
@@ -0,0 +1,5 @@
+<?xml version="1.0"?>
+<registry>
+  <!-- add missing render_body field -->
+  <records interface="Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings" />
+</registry>
diff --git a/plone/app/upgrade/v51/profiles/to_beta4/registry.xml b/plone/app/upgrade/v51/profiles/to_beta4/registry.xml
index 97a1be5..385f1a5 100644
--- a/plone/app/upgrade/v51/profiles/to_beta4/registry.xml
+++ b/plone/app/upgrade/v51/profiles/to_beta4/registry.xml
@@ -22,9 +22,12 @@
   </records>
 
   <!-- Remove TinyMCE layer resource -->
-  <records 
+  <records
       remove="True"
       prefix="plone.resources/tinymce-layer"
       interface='Products.CMFPlone.interfaces.IResourceRegistry'/>
 
+  <!-- add missing render_body field -->
+  <records interface="Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings" />
+
 </registry>


