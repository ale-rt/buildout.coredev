Repository: Products.PlacelessTranslationService


Branch: refs/heads/master
Date: 2016-10-23T00:05:12-04:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.PlacelessTranslationService/commit/25a342127c72f8652b0f5c88c146f4ca0b939322

Fix import from Globals that is removed in Zope4

Files changed:
M CHANGES.rst
M Products/PlacelessTranslationService/GettextMessageCatalog.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ccff1f2..5af8b5b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix import from Globals that is removed in Zope4
+  [pbauer]
 
 
 2.0.6 (2016-08-11)
diff --git a/Products/PlacelessTranslationService/GettextMessageCatalog.py b/Products/PlacelessTranslationService/GettextMessageCatalog.py
index 81f3515..f004002 100644
--- a/Products/PlacelessTranslationService/GettextMessageCatalog.py
+++ b/Products/PlacelessTranslationService/GettextMessageCatalog.py
@@ -15,9 +15,8 @@
 from AccessControl import ClassSecurityInfo
 from AccessControl.Permissions import view_management_screens
 from App.class_init import InitializeClass
-from Globals import INSTANCE_HOME
 from App.Common import package_home
-import Globals
+from App.config import getConfiguration
 from OFS.Traversable import Traversable
 from Persistence import Persistent
 from App.Management import Tabs
@@ -110,7 +109,7 @@ def _getPoFile(self):
         if prefix == 'ZOPE_HOME':
             return os.path.join(ZOPE_HOME, pofile)
         elif prefix == 'INSTANCE_HOME':
-            return os.path.join(INSTANCE_HOME, pofile)
+            return os.path.join(os.environ.get('INSTANCE_HOME'), pofile)
         else:
             return os.path.normpath(pofile)
 
@@ -332,7 +331,7 @@ def _getPoFile(self):
         if prefix == 'ZOPE_HOME':
             return os.path.join(ZOPE_HOME, pofile)
         elif prefix == 'INSTANCE_HOME':
-            return os.path.join(INSTANCE_HOME, pofile)
+            return os.path.join(os.environ.get('INSTANCE_HOME'), pofile)
         else:
             return os.path.normpath(pofile)
 
@@ -354,7 +353,7 @@ def _updateFromFS(self):
 
         if the file is newer and we are running in debug mode.
         """
-        if Globals.DevelopmentMode:
+        if getConfiguration().debug_mode:
             mtime = self._getModTime()
             if mtime != self._mod_time:
                 self._mod_time = mtime


