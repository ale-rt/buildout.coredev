Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-12-18T00:03:25+01:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/bead28cc44e6e64224c0d145b74b90117f6fb163

wait for zeo connection (backport from ZEO's pack script)

Files changed:
M src/plone/recipe/zeoserver/pack.py

diff --git a/src/plone/recipe/zeoserver/pack.py b/src/plone/recipe/zeoserver/pack.py
index 5b7628a..4098112 100644
--- a/src/plone/recipe/zeoserver/pack.py
+++ b/src/plone/recipe/zeoserver/pack.py
@@ -6,6 +6,7 @@
 import os
 import socket
 import sys
+import time
 
 
 def _main(host, port, unix=None, days=1, username=None, password=None,
@@ -30,9 +31,14 @@ def _main(host, port, unix=None, days=1, username=None, password=None,
             username=username, password=password, realm=realm,
             blob_dir=blob_dir, shared_blob_dir=shared_blob_dir,
         )
-        if not cs.is_connected():
+        for i in range(60):
+            if cs.is_connected():
+                break
+            time.sleep(1)
+        else:
             logger.error("Could not connect to zeoserver. Please make sure it "
                          "is running.")
+            cs.close()
             sys.exit(1)
         try:
             # The script should not exit until the packing is done.


Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-12-18T18:12:11+01:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/c9304cf3ab3357644878b9f98f9252a24b6e2a35

Merge remote-tracking branch 'upstream/master'

Files changed:
M CHANGES.rst
M src/plone/recipe/zeoserver/tests/test_docs.py
M src/plone/recipe/zeoserver/tests/zeoserver.txt

diff --git a/CHANGES.rst b/CHANGES.rst
index c688ace..f659df0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fixed Travis tests by installing the ``hyperlink`` package.  [maurits]
 
 
 1.4.0 (2017-06-16)
diff --git a/src/plone/recipe/zeoserver/tests/test_docs.py b/src/plone/recipe/zeoserver/tests/test_docs.py
index 5b0991e..fafee1c 100644
--- a/src/plone/recipe/zeoserver/tests/test_docs.py
+++ b/src/plone/recipe/zeoserver/tests/test_docs.py
@@ -26,6 +26,7 @@ def setUp(test):
     install('constantly', test)
     install('attrs', test)
     install('Twisted', test)
+    install('hyperlink', test)
     dependencies = pkg_resources.working_set.require('ZODB3')
     for dep in dependencies:
         try:
diff --git a/src/plone/recipe/zeoserver/tests/zeoserver.txt b/src/plone/recipe/zeoserver/tests/zeoserver.txt
index c753552..f5bb8f4 100644
--- a/src/plone/recipe/zeoserver/tests/zeoserver.txt
+++ b/src/plone/recipe/zeoserver/tests/zeoserver.txt
@@ -614,4 +614,3 @@ The main script should have the initialization.
 
     >>> 'foo = 1' in open(join('bin', 'zeo' + suffix)).read()
     True
-


Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-12-18T18:15:04+01:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/4a1e5ccf28a63c2a1187f76f052398f72ce6e349

changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index f659df0..9ea7417 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,6 +16,8 @@ Bug fixes:
 
 - Fixed Travis tests by installing the ``hyperlink`` package.  [maurits]
 
+- Fixed zeopack script for ZEO >= 5 (backport from original ZEO's script) [mamico]
+
 
 1.4.0 (2017-06-16)
 ------------------


Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-12-18T18:33:01+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/45774a459dee55c9338fe190283865d818070026

Merge pull request #25 from mamico/master

wait for zeo connection (backport from ZEO's pack script)

Files changed:
M CHANGES.rst
M src/plone/recipe/zeoserver/pack.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f659df0..9ea7417 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,6 +16,8 @@ Bug fixes:
 
 - Fixed Travis tests by installing the ``hyperlink`` package.  [maurits]
 
+- Fixed zeopack script for ZEO >= 5 (backport from original ZEO's script) [mamico]
+
 
 1.4.0 (2017-06-16)
 ------------------
diff --git a/src/plone/recipe/zeoserver/pack.py b/src/plone/recipe/zeoserver/pack.py
index 5b7628a..4098112 100644
--- a/src/plone/recipe/zeoserver/pack.py
+++ b/src/plone/recipe/zeoserver/pack.py
@@ -6,6 +6,7 @@
 import os
 import socket
 import sys
+import time
 
 
 def _main(host, port, unix=None, days=1, username=None, password=None,
@@ -30,9 +31,14 @@ def _main(host, port, unix=None, days=1, username=None, password=None,
             username=username, password=password, realm=realm,
             blob_dir=blob_dir, shared_blob_dir=shared_blob_dir,
         )
-        if not cs.is_connected():
+        for i in range(60):
+            if cs.is_connected():
+                break
+            time.sleep(1)
+        else:
             logger.error("Could not connect to zeoserver. Please make sure it "
                          "is running.")
+            cs.close()
             sys.exit(1)
         try:
             # The script should not exit until the packing is done.


