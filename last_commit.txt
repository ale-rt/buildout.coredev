Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-08T12:15:07-02:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/5f84f21e9a87d10b6f4922d23c462e6e562b1bc1

Change default search method and results order used when searching for content on internal links

Now we search by Title (as it is faster than SearchableText) and return results sorted by relevance instead of sortable_title.

Files changed:
M HISTORY.rst
M Products/TinyMCE/adapters/JSONSearch.py

diff --git a/HISTORY.rst b/HISTORY.rst
index 7186acb..71f463e 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -7,6 +7,10 @@ HISTORY
 
 Fixes:
 
+- Change default search method and results order used when searching for content on internal links.
+  Now we search by ``Title`` (as it is faster than ``SearchableText``) and return results sorted by relevance instead of ``sortable_title``.
+  [hvelarde]
+
 - Fixed bug where the plonebrowser dialog wouldn't properly populate the
   anchors if the HTML5 schema was used.
   [msom]
@@ -21,7 +25,7 @@ Fixes:
   [tschorr]
 
 - fix `path` expression in `wysiwyg_support`;
-  `plone.app.z3cform` support for `collective.ckeditor` where 
+  `plone.app.z3cform` support for `collective.ckeditor` where
   `ckeditor_wysiwyg_support` is a view rather than a skin
 
 
diff --git a/Products/TinyMCE/adapters/JSONSearch.py b/Products/TinyMCE/adapters/JSONSearch.py
index 9c7e731..45e422a 100644
--- a/Products/TinyMCE/adapters/JSONSearch.py
+++ b/Products/TinyMCE/adapters/JSONSearch.py
@@ -32,9 +32,8 @@ def getSearchResults(self, filter_portal_types, searchtext):
         query = self.listing_base_query.copy()
         query.update({
             'portal_type': filter_portal_types,
-            'sort_on': 'sortable_title',
             'path': '/'.join(self.context.getPhysicalPath()),
-            'SearchableText': searchtext,
+            'Title': searchtext,
         })
         if searchtext:
             plone_layout = self.context.restrictedTraverse('@@plone_layout',


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-08T12:15:07-02:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/495683fe2a14604f10436a577f7534b28eaeb1c4

Clean up code (this branch will never run under Plone 3)

Files changed:
M Products/TinyMCE/adapters/JSONSearch.py

diff --git a/Products/TinyMCE/adapters/JSONSearch.py b/Products/TinyMCE/adapters/JSONSearch.py
index 45e422a..82daa75 100644
--- a/Products/TinyMCE/adapters/JSONSearch.py
+++ b/Products/TinyMCE/adapters/JSONSearch.py
@@ -38,14 +38,8 @@ def getSearchResults(self, filter_portal_types, searchtext):
         if searchtext:
             plone_layout = self.context.restrictedTraverse('@@plone_layout',
                                                            None)
-            if plone_layout is None:
-                # Plone 3
-                plone_view = self.context.restrictedTraverse('@@plone')
-                getIcon = lambda brain: plone_view.getIcon(brain).html_tag()
-            else:
-                # Plone >= 4
-                getIcon = lambda brain: plone_layout.getIcon(brain)()
 
+            getIcon = lambda brain: plone_layout.getIcon(brain)()
             brains = self.context.portal_catalog.searchResults(**query)
 
             catalog_results = [


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-08T08:32:54-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/d622a09365a00afb3dec5f81b5fb71a91213f405

Merge pull request #128 from plone/issue_127_plone_43

Change default search method and results order used when searching for content on internal links

Files changed:
M HISTORY.rst
M Products/TinyMCE/adapters/JSONSearch.py

diff --git a/HISTORY.rst b/HISTORY.rst
index 7186acb..71f463e 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -7,6 +7,10 @@ HISTORY
 
 Fixes:
 
+- Change default search method and results order used when searching for content on internal links.
+  Now we search by ``Title`` (as it is faster than ``SearchableText``) and return results sorted by relevance instead of ``sortable_title``.
+  [hvelarde]
+
 - Fixed bug where the plonebrowser dialog wouldn't properly populate the
   anchors if the HTML5 schema was used.
   [msom]
@@ -21,7 +25,7 @@ Fixes:
   [tschorr]
 
 - fix `path` expression in `wysiwyg_support`;
-  `plone.app.z3cform` support for `collective.ckeditor` where 
+  `plone.app.z3cform` support for `collective.ckeditor` where
   `ckeditor_wysiwyg_support` is a view rather than a skin
 
 
diff --git a/Products/TinyMCE/adapters/JSONSearch.py b/Products/TinyMCE/adapters/JSONSearch.py
index 9c7e731..82daa75 100644
--- a/Products/TinyMCE/adapters/JSONSearch.py
+++ b/Products/TinyMCE/adapters/JSONSearch.py
@@ -32,21 +32,14 @@ def getSearchResults(self, filter_portal_types, searchtext):
         query = self.listing_base_query.copy()
         query.update({
             'portal_type': filter_portal_types,
-            'sort_on': 'sortable_title',
             'path': '/'.join(self.context.getPhysicalPath()),
-            'SearchableText': searchtext,
+            'Title': searchtext,
         })
         if searchtext:
             plone_layout = self.context.restrictedTraverse('@@plone_layout',
                                                            None)
-            if plone_layout is None:
-                # Plone 3
-                plone_view = self.context.restrictedTraverse('@@plone')
-                getIcon = lambda brain: plone_view.getIcon(brain).html_tag()
-            else:
-                # Plone >= 4
-                getIcon = lambda brain: plone_layout.getIcon(brain)()
 
+            getIcon = lambda brain: plone_layout.getIcon(brain)()
             brains = self.context.portal_catalog.searchResults(**query)
 
             catalog_results = [


