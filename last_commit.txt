Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2016-07-05T11:10:33+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentlisting/commit/4e21353c95246502f81fadd7969a57ebd342cc86

Added missing implementation for getSize

Files changed:
M CHANGES.rst
M plone/app/contentlisting/realobject.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4b44962..65dc7e1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Added missing implementation for getSize on RealContentListingObject.
+  Interface was not fullfilled here.
+  [jensens]
 
 
 1.2.5 (2016-05-12)
diff --git a/plone/app/contentlisting/realobject.py b/plone/app/contentlisting/realobject.py
index f55ee6e..b71cea7 100644
--- a/plone/app/contentlisting/realobject.py
+++ b/plone/app/contentlisting/realobject.py
@@ -3,6 +3,7 @@
 from Acquisition import aq_get
 from plone.app.contentlisting.contentlisting import BaseContentListingObject
 from plone.app.contentlisting.interfaces import IContentListingObject
+from plone.rfc822.interfaces import IPrimaryFieldInfo
 from plone.uuid.interfaces import IUUID
 from Products.CMFCore.utils import getToolByName
 from zope.interface import implementer
@@ -62,6 +63,15 @@ def uuid(self):
             return uuid
         return self.getPath()
 
+    def getSize(self):
+        # return size of the primary field content.
+        # this works the same way as the indexer works
+        obj = self.getObject()
+        primary_field_info = IPrimaryFieldInfo(obj)
+        if primary_field_info is None or not primary_field_info.value:
+            return 0
+        return obj.getObjSize(None, primary_field_info.value.size)
+
     def review_state(self):
         obj = self.getObject()
         wftool = getToolByName(obj, 'portal_workflow')


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2016-07-05T12:06:07+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/ee94b648f56ef46c56f22e10fd3fdb8ccde1bf5a

Merge pull request #16 from plone/fix-add-missing-getsize

Added missing implementation for getSize

Files changed:
M CHANGES.rst
M plone/app/contentlisting/realobject.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4b44962..65dc7e1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Added missing implementation for getSize on RealContentListingObject.
+  Interface was not fullfilled here.
+  [jensens]
 
 
 1.2.5 (2016-05-12)
diff --git a/plone/app/contentlisting/realobject.py b/plone/app/contentlisting/realobject.py
index f55ee6e..b71cea7 100644
--- a/plone/app/contentlisting/realobject.py
+++ b/plone/app/contentlisting/realobject.py
@@ -3,6 +3,7 @@
 from Acquisition import aq_get
 from plone.app.contentlisting.contentlisting import BaseContentListingObject
 from plone.app.contentlisting.interfaces import IContentListingObject
+from plone.rfc822.interfaces import IPrimaryFieldInfo
 from plone.uuid.interfaces import IUUID
 from Products.CMFCore.utils import getToolByName
 from zope.interface import implementer
@@ -62,6 +63,15 @@ def uuid(self):
             return uuid
         return self.getPath()
 
+    def getSize(self):
+        # return size of the primary field content.
+        # this works the same way as the indexer works
+        obj = self.getObject()
+        primary_field_info = IPrimaryFieldInfo(obj)
+        if primary_field_info is None or not primary_field_info.value:
+            return 0
+        return obj.getObjSize(None, primary_field_info.value.size)
+
     def review_state(self):
         obj = self.getObject()
         wftool = getToolByName(obj, 'portal_workflow')


