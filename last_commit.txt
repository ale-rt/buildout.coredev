Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-02-21T22:19:54+01:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/5afb7c9e5c38510c430ad963ab25ac70fdf89b25

Adapt tests

With PLIP 1343 being merged some tests need to be adapted.

Now the catalog no longer processes indexing operations right away.

Some tests rely on that, so a minimal adaptation was needed.

References:
https://github.com/plone/Products.CMFPlone/issues/1343

Files changed:
M CHANGES.rst
M plone/app/upgrade/v43/tests.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f5b12f4..376b6c5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,8 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
-
+- Adapt tests to the new indexing operations queueing.
+  Part of PLIP 1343: https://github.com/plone/Products.CMFPlone/issues/1343
+  [gforcada]
 
 2.0.0 (2017-02-20)
 ------------------
diff --git a/plone/app/upgrade/v43/tests.py b/plone/app/upgrade/v43/tests.py
index 89436b3..e075d43 100644
--- a/plone/app/upgrade/v43/tests.py
+++ b/plone/app/upgrade/v43/tests.py
@@ -14,6 +14,13 @@
 
 import alphas
 
+try:
+    from Products.CMFCore.indexing import processQueue
+except ImportError:
+    def processQueue():
+        pass
+
+
 PLONE5 = getFSVersionTuple()[0] >= 5
 
 
@@ -112,6 +119,7 @@ def testReindexNumericalTitle(self):
             id='accidentally-fall', type_name='Document',
             title='And if one green bottle should accidentally fall',
         )
+        processQueue()
 
         # Change title of both, shouldn't be reindexed yet
         portal['accidentally-fall'].title = 'fell'


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-02-21T22:20:44+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/eccbbc27a5fd53357466cec56dd928627e79076c

Merge pull request #75 from plone/merge-collective-indexing

Merge collective indexing

Files changed:
M CHANGES.rst
M plone/app/upgrade/v43/tests.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f5b12f4..376b6c5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,8 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
-
+- Adapt tests to the new indexing operations queueing.
+  Part of PLIP 1343: https://github.com/plone/Products.CMFPlone/issues/1343
+  [gforcada]
 
 2.0.0 (2017-02-20)
 ------------------
diff --git a/plone/app/upgrade/v43/tests.py b/plone/app/upgrade/v43/tests.py
index 89436b3..e075d43 100644
--- a/plone/app/upgrade/v43/tests.py
+++ b/plone/app/upgrade/v43/tests.py
@@ -14,6 +14,13 @@
 
 import alphas
 
+try:
+    from Products.CMFCore.indexing import processQueue
+except ImportError:
+    def processQueue():
+        pass
+
+
 PLONE5 = getFSVersionTuple()[0] >= 5
 
 
@@ -112,6 +119,7 @@ def testReindexNumericalTitle(self):
             id='accidentally-fall', type_name='Document',
             title='And if one green bottle should accidentally fall',
         )
+        processQueue()
 
         # Change title of both, shouldn't be reindexed yet
         portal['accidentally-fall'].title = 'fell'


