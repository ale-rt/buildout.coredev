Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2017-10-20T13:28:05+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/80a424a59c5312717f7ae87f95d6fecfdab5900b

fix encoding

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/selector.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3af7d99f..a1da6b73 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix serialization of query variables for selector links in Zope 4.
+  [davisagli]
 
 
 5.1.2 (2017-08-05)
diff --git a/src/plone/app/multilingual/browser/selector.py b/src/plone/app/multilingual/browser/selector.py
index e3236dab..64550bf2 100644
--- a/src/plone/app/multilingual/browser/selector.py
+++ b/src/plone/app/multilingual/browser/selector.py
@@ -18,7 +18,11 @@ def addQuery(request, url, exclude=tuple(), **extras):
                 formvariables[k] = v.encode('utf-8')
             else:
                 formvariables[k] = v
-    formvariables.update(extras)
+    for k, v in extras.items():
+        if isinstance(v, unicode):
+            formvariables[k] = v.encode('utf-8')
+        else:
+            formvariables[k] = v
     try:
         if len(formvariables) > 0:
             url += '?' + make_query(formvariables)


Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2017-10-20T14:56:48+02:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.app.multilingual/commit/83b9af74da05a63d6538d359ad00a801802b9c0c

Merge pull request #295 from plone/plonezope4

encode language for selector links so they aren't marshalled differently in Zope 4

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/selector.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3af7d99..a1da6b7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix serialization of query variables for selector links in Zope 4.
+  [davisagli]
 
 
 5.1.2 (2017-08-05)
diff --git a/src/plone/app/multilingual/browser/selector.py b/src/plone/app/multilingual/browser/selector.py
index e3236da..64550bf 100644
--- a/src/plone/app/multilingual/browser/selector.py
+++ b/src/plone/app/multilingual/browser/selector.py
@@ -18,7 +18,11 @@ def addQuery(request, url, exclude=tuple(), **extras):
                 formvariables[k] = v.encode('utf-8')
             else:
                 formvariables[k] = v
-    formvariables.update(extras)
+    for k, v in extras.items():
+        if isinstance(v, unicode):
+            formvariables[k] = v.encode('utf-8')
+        else:
+            formvariables[k] = v
     try:
         if len(formvariables) > 0:
             url += '?' + make_query(formvariables)


