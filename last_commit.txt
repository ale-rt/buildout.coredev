Repository: borg.localrole


Branch: refs/heads/master
Date: 2017-10-26T15:45:00+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/borg.localrole/commit/45b7509625b8b55d9d9776f41db63ef8512d7832

fix another test for zope4

Files changed:
M CHANGES.rst
M borg/localrole/workspace.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6d9832a..727d400 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix test for Zope 4.
+  [pbauer]
 
 
 3.1.4 (2017-10-17)
diff --git a/borg/localrole/workspace.py b/borg/localrole/workspace.py
index f4ed036..744a127 100644
--- a/borg/localrole/workspace.py
+++ b/borg/localrole/workspace.py
@@ -110,8 +110,8 @@ def clra_cache_key(method, self, user, obj, object_roles):
           >>> print rm.checkLocalRolesAllowed(john, obj, ['foo', 'bar'])
           checkLocalRolesAllowed called...
           None
-          >>> IAnnotations(request)
-          {"borg.localrole.workspace.checkLocalRolesAllowed:('john', '42!', ('foo', 'bar'))": None}
+          >>> [i for i in IAnnotations(request)]
+          ["borg.localrole.workspace.checkLocalRolesAllowed:('john', '42!', ('foo', 'bar'))"]
 
         Calling the method a second time should directly return the cached
         value, i.e. the logger shouldn't print anything:


