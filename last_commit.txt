Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2016-08-09T10:59:49+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/e2ce3211f5613f5341dc847dffe93f49decd39ce

Refactor

Files changed:
M plone/portlet/collection/collection.py

diff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py
index 2507a9e..b4753f3 100644
--- a/plone/portlet/collection/collection.py
+++ b/plone/portlet/collection/collection.py
@@ -148,9 +148,8 @@ def available(self):
     def collection_url(self):
         collection = self.collection()
         if collection is None:
-            return None
-        else:
-            return collection.absolute_url()
+            return
+        return collection.absolute_url()
 
     def css_class(self):
         header = self.data.header


Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2016-08-09T11:33:28+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/1f090d33d85701fbbb4f00de9690bc8dfce15ab3

If collection is default page in parent, link to parent

Files changed:
M CHANGES.rst
M plone/portlet/collection/collection.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 831c9c9..0e10b89 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- If collection is default page in parent, link to parent.
+  [malthe]
 
 Fixes:
 
diff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py
index b4753f3..78813ff 100644
--- a/plone/portlet/collection/collection.py
+++ b/plone/portlet/collection/collection.py
@@ -1,4 +1,5 @@
 from ComputedAttribute import ComputedAttribute
+from plone.app.layout.navigation.defaultpage import isDefaultPage
 from plone.app.portlets.browser import formhelper
 from plone.app.portlets.portlets import base
 from plone.app.uuid.utils import uuidToObject
@@ -149,6 +150,9 @@ def collection_url(self):
         collection = self.collection()
         if collection is None:
             return
+        parent = collection.aq_parent
+        if isDefaultPage(parent, collection):
+            collection = parent
         return collection.absolute_url()
 
     def css_class(self):


