Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2016-04-08T00:20:55+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/48a37c56c87bb52a1208322b4fbb3a6961e4d41a

Reduce dependency on plone.app.widgets in tests.

Files changed:
M CHANGES.rst
M plone/app/z3cform/tests/test_widgets.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2b95fb4..a7f2f21 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -25,6 +25,9 @@ New:
 
 Fixes:
 
+- Reduce dependency on plone.app.widgets in tests.
+  [thet]
+
 - Enhance test in order to show problem in RelatedItemsWidget with 
   navigation-roots
   [jensens]
diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index 619184e..8bbafeb 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -4,9 +4,7 @@
 from mock import Mock
 from plone.app.testing import setRoles
 from plone.app.testing import TEST_USER_ID
-from plone.app.widgets.testing import ExampleVocabulary
-from plone.app.widgets.testing import PLONEAPPWIDGETS_DX_INTEGRATION_TESTING
-from plone.app.widgets.testing import TestRequest
+from zope.publisher.browser import TestRequest as BaseTestRequest
 from plone.app.z3cform.tests.layer import PAZ3CForm_INTEGRATION_TESTING
 from plone.app.z3cform.widget import BaseWidget
 from plone.dexterity.fti import DexterityFTI
@@ -19,6 +17,7 @@
 from zope.component import provideUtility
 from zope.component.globalregistry import base
 from zope.interface import alsoProvides
+from zope.interface import implements
 from zope.interface import Interface
 from zope.schema import Choice
 from zope.schema import Date
@@ -27,12 +26,34 @@
 from zope.schema import Set
 from zope.schema import TextLine
 from zope.schema import Tuple
+from zope.schema.interfaces import IVocabularyFactory
+from zope.schema.vocabulary import SimpleTerm
+from zope.schema.vocabulary import SimpleVocabulary
 
 import mock
 import pytz
 import unittest
 
 
+class ExampleVocabulary(object):
+    implements(IVocabularyFactory)
+
+    def __call__(self, context, query=None):
+        items = [u'One', u'Two', u'Three']
+        tmp = SimpleVocabulary([
+            SimpleTerm(it.lower(), it.lower(), it)
+            for it in items
+            if query is None
+            or query.lower() in it.lower()
+        ])
+        tmp.test = 1
+        return tmp
+
+
+class TestRequest(BaseTestRequest):
+    pass
+
+
 class BaseWidgetTests(unittest.TestCase):
 
     def setUp(self):
@@ -1226,7 +1247,7 @@ def _custom_field_widget(field, request):
 
 class RichTextWidgetTests(unittest.TestCase):
 
-    layer = PLONEAPPWIDGETS_DX_INTEGRATION_TESTING
+    layer = PAZ3CForm_INTEGRATION_TESTING
 
     def setUp(self):
         from plone.app.textfield import RichText as RichTextField


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2016-04-08T00:21:54+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/cec262e8ade0d7ce55f04ef3fbe0759d81bd2444

Merge pull request #44 from plone/thet-rmwidgetsdep

remove test dep on plone.app.widgets

Files changed:
M CHANGES.rst
M plone/app/z3cform/tests/test_widgets.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2b95fb4..a7f2f21 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -25,6 +25,9 @@ New:
 
 Fixes:
 
+- Reduce dependency on plone.app.widgets in tests.
+  [thet]
+
 - Enhance test in order to show problem in RelatedItemsWidget with 
   navigation-roots
   [jensens]
diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index 619184e..8bbafeb 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -4,9 +4,7 @@
 from mock import Mock
 from plone.app.testing import setRoles
 from plone.app.testing import TEST_USER_ID
-from plone.app.widgets.testing import ExampleVocabulary
-from plone.app.widgets.testing import PLONEAPPWIDGETS_DX_INTEGRATION_TESTING
-from plone.app.widgets.testing import TestRequest
+from zope.publisher.browser import TestRequest as BaseTestRequest
 from plone.app.z3cform.tests.layer import PAZ3CForm_INTEGRATION_TESTING
 from plone.app.z3cform.widget import BaseWidget
 from plone.dexterity.fti import DexterityFTI
@@ -19,6 +17,7 @@
 from zope.component import provideUtility
 from zope.component.globalregistry import base
 from zope.interface import alsoProvides
+from zope.interface import implements
 from zope.interface import Interface
 from zope.schema import Choice
 from zope.schema import Date
@@ -27,12 +26,34 @@
 from zope.schema import Set
 from zope.schema import TextLine
 from zope.schema import Tuple
+from zope.schema.interfaces import IVocabularyFactory
+from zope.schema.vocabulary import SimpleTerm
+from zope.schema.vocabulary import SimpleVocabulary
 
 import mock
 import pytz
 import unittest
 
 
+class ExampleVocabulary(object):
+    implements(IVocabularyFactory)
+
+    def __call__(self, context, query=None):
+        items = [u'One', u'Two', u'Three']
+        tmp = SimpleVocabulary([
+            SimpleTerm(it.lower(), it.lower(), it)
+            for it in items
+            if query is None
+            or query.lower() in it.lower()
+        ])
+        tmp.test = 1
+        return tmp
+
+
+class TestRequest(BaseTestRequest):
+    pass
+
+
 class BaseWidgetTests(unittest.TestCase):
 
     def setUp(self):
@@ -1226,7 +1247,7 @@ def _custom_field_widget(field, request):
 
 class RichTextWidgetTests(unittest.TestCase):
 
-    layer = PLONEAPPWIDGETS_DX_INTEGRATION_TESTING
+    layer = PAZ3CForm_INTEGRATION_TESTING
 
     def setUp(self):
         from plone.app.textfield import RichText as RichTextField


