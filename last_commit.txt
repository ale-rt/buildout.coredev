Repository: Products.Archetypes


Branch: refs/heads/1.10.x
Date: 2017-05-30T17:40:46+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/Products.Archetypes/commit/29167a3f8b3546e4a27a21652feed927a48f0059

Look up view using lower-level API to check for existence

Files changed:
M CHANGES.rst
M Products/Archetypes/BaseObject.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 30be8e6b..c063ff94 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Don't instantiate browser view to check for existence.
+  [malthe]
 
 
 1.10.17 (2017-05-23)
diff --git a/Products/Archetypes/BaseObject.py b/Products/Archetypes/BaseObject.py
index 77231d9d..e8ef3210 100644
--- a/Products/Archetypes/BaseObject.py
+++ b/Products/Archetypes/BaseObject.py
@@ -54,9 +54,9 @@
 from webdav.NullResource import NullResource
 
 from zope import event
-from zope.interface import implements, Interface
+from zope.interface import implementer, Interface, providedBy
+from zope.component import getSiteManager
 from zope.component import subscribers
-from zope.component import queryMultiAdapter
 from zope.component import queryUtility
 
 # Import conditionally, so we don't introduce a hard depdendency
@@ -1147,8 +1147,11 @@ def __bobo_traverse__(self, REQUEST, name):
             if shasattr(self, name):  # attributes of self come first
                 target = getattr(self, name)
             else:  # then views
-                target = queryMultiAdapter((self, REQUEST), Interface, name)
-                if target is not None:
+                gsm = getSiteManager()
+                factory = gsm.adapters.lookup(
+                    (providedBy(self), providedBy(REQUEST)), Interface, name
+                )
+                if factory is not None:
                     # We don't return the view, we raise an
                     # AttributeError instead (below)
                     target = None


