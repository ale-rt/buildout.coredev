Repository: archetypes.querywidget


Branch: refs/heads/master
Date: 2016-07-29T16:00:40-03:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/archetypes.querywidget/commit/4f1af2948c85e76a883c1e24c53fa4d1961c60cb

Fix base_url variable when editing a collection

Files changed:
M CHANGES.rst
M archetypes/querywidget/querywidget.js

diff --git a/CHANGES.rst b/CHANGES.rst
index dab34c9..c1e51ca 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.1.3 (unreleased)
 ------------------
 
+- Fix base_url variable when editing a collection.
+  [rodfersou]
+
 - Added 'safe_unicode' call for raw query values.
   [rodfersou]
 
diff --git a/archetypes/querywidget/querywidget.js b/archetypes/querywidget/querywidget.js
index 7101f31..1bb6940 100644
--- a/archetypes/querywidget/querywidget.js
+++ b/archetypes/querywidget/querywidget.js
@@ -157,6 +157,7 @@
 
     $.querywidget.updateSearch = function () {
         var base_url = $("base").attr("href");
+        base_url = base_url.replace(/\/edit$/, '');
         if (base_url.indexOf("portal_factory") !== -1) {
             base_url = base_url.split("/").slice(0, -2).join("/");
         }


Repository: archetypes.querywidget


Branch: refs/heads/master
Date: 2016-08-01T14:56:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/archetypes.querywidget/commit/1a288732851fdfc3f1488fe36af1ae51ae21a859

Merge pull request #13 from plone/fix_baseurl_variable

Fix base_url variable when editing a collection

Files changed:
M CHANGES.rst
M archetypes/querywidget/querywidget.js

diff --git a/CHANGES.rst b/CHANGES.rst
index dab34c9..c1e51ca 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.1.3 (unreleased)
 ------------------
 
+- Fix base_url variable when editing a collection.
+  [rodfersou]
+
 - Added 'safe_unicode' call for raw query values.
   [rodfersou]
 
diff --git a/archetypes/querywidget/querywidget.js b/archetypes/querywidget/querywidget.js
index 7101f31..1bb6940 100644
--- a/archetypes/querywidget/querywidget.js
+++ b/archetypes/querywidget/querywidget.js
@@ -157,6 +157,7 @@
 
     $.querywidget.updateSearch = function () {
         var base_url = $("base").attr("href");
+        base_url = base_url.replace(/\/edit$/, '');
         if (base_url.indexOf("portal_factory") !== -1) {
             base_url = base_url.split("/").slice(0, -2).join("/");
         }


