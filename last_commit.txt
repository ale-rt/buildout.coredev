Repository: plone.app.layout


Branch: refs/heads/2.3.x
Date: 2016-06-27T16:28:10-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.layout/commit/d6087f0358e5f3c66993583f1291486584b00391

Backport fix from d06c2bde001034f4d0585a196dbe87ac78b7ce79, handle spaces in role names

Files changed:
M CHANGES.rst
M plone/app/layout/globals/layout.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 980a90f..7967bb8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix body class attribute errors when the user role contains space.
+  [Jian Aijun]
 
 
 2.3.14 (2016-02-15)
diff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py
index 9a62ea4..8d722d8 100644
--- a/plone/app/layout/globals/layout.py
+++ b/plone/app/layout/globals/layout.py
@@ -189,6 +189,6 @@ def bodyClass(self, template, view):
         else:
             user = membership.getAuthenticatedMember()
             for role in user.getRolesInContext(self.context):
-                body_class += ' userrole-' + role.lower()
+                body_class += ' userrole-' + role.lower().replace(' ', '-')
 
         return body_class


