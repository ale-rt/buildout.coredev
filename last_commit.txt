Repository: Products.LinguaPlone


Branch: refs/heads/master
Date: 2016-11-07T10:53:37+01:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.LinguaPlone/commit/ed616bf9ba1beefc64481883fbfb3bcc170fcea0

show also link to self in hreflang link

Files changed:
M Products/LinguaPlone/browser/contentlinkviewlet.py
M Products/LinguaPlone/tests/test_contentlinkviewlet.py

diff --git a/Products/LinguaPlone/browser/contentlinkviewlet.py b/Products/LinguaPlone/browser/contentlinkviewlet.py
index a3108eb..99e5b95 100644
--- a/Products/LinguaPlone/browser/contentlinkviewlet.py
+++ b/Products/LinguaPlone/browser/contentlinkviewlet.py
@@ -9,9 +9,8 @@ def update(self):
         # We have to check the view permission on the translated object, because
         # getTranslations returns all objects, no matter the workflow state
         context = aq_inner(self.context)
-        current = context.Language()
         _checkPermission = getSecurityManager().checkPermission
         self.translations = []
         for lang, content in context.getTranslations(review_state=False).items():
-            if lang != current and _checkPermission('View', content):
-                self.translations.append(content)
\ No newline at end of file
+            if _checkPermission('View', content):
+                self.translations.append(content)
diff --git a/Products/LinguaPlone/tests/test_contentlinkviewlet.py b/Products/LinguaPlone/tests/test_contentlinkviewlet.py
index 131fb6c..704f4c4 100644
--- a/Products/LinguaPlone/tests/test_contentlinkviewlet.py
+++ b/Products/LinguaPlone/tests/test_contentlinkviewlet.py
@@ -26,4 +26,4 @@ def testViewletGeneratesTranslationList(self):
     def testViewletGeneratedLinks(self):
         viewlet = MultilingualContentViewlet(self.english, self.app.REQUEST, None, None)
         viewlet.update()
-        self.assertEqual(len(viewlet.translations), 1)
+        self.assertEqual(len(viewlet.translations), 2)


Repository: Products.LinguaPlone


Branch: refs/heads/master
Date: 2016-11-07T10:53:49+01:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.LinguaPlone/commit/956a1fb770d5b5012b64297f98c78e9042113c05

changelog entry

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index bb9c30e..41879d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,17 +4,10 @@ Changelog
 4.1.6 (unreleased)
 ------------------
 
-Breaking changes:
-
-- *add item here*
-
-New features:
-
-- *add item here*
-
 Bug fixes:
 
-- *add item here*
+- Show also current language link in header hreflang links.
+  [erral]
 
 
 4.1.5 (2016-08-11)


Repository: Products.LinguaPlone


Branch: refs/heads/master
Date: 2016-11-07T20:30:53+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.LinguaPlone/commit/56b07f87ac6cd64218d5c676d7dbba88112b94e4

Merge pull request #19 from erral/hreflang-fixes

Fix hreflang links

Files changed:
M CHANGES.rst
M Products/LinguaPlone/browser/contentlinkviewlet.py
M Products/LinguaPlone/tests/test_contentlinkviewlet.py

diff --git a/CHANGES.rst b/CHANGES.rst
index bb9c30e..41879d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,17 +4,10 @@ Changelog
 4.1.6 (unreleased)
 ------------------
 
-Breaking changes:
-
-- *add item here*
-
-New features:
-
-- *add item here*
-
 Bug fixes:
 
-- *add item here*
+- Show also current language link in header hreflang links.
+  [erral]
 
 
 4.1.5 (2016-08-11)
diff --git a/Products/LinguaPlone/browser/contentlinkviewlet.py b/Products/LinguaPlone/browser/contentlinkviewlet.py
index a3108eb..99e5b95 100644
--- a/Products/LinguaPlone/browser/contentlinkviewlet.py
+++ b/Products/LinguaPlone/browser/contentlinkviewlet.py
@@ -9,9 +9,8 @@ def update(self):
         # We have to check the view permission on the translated object, because
         # getTranslations returns all objects, no matter the workflow state
         context = aq_inner(self.context)
-        current = context.Language()
         _checkPermission = getSecurityManager().checkPermission
         self.translations = []
         for lang, content in context.getTranslations(review_state=False).items():
-            if lang != current and _checkPermission('View', content):
-                self.translations.append(content)
\ No newline at end of file
+            if _checkPermission('View', content):
+                self.translations.append(content)
diff --git a/Products/LinguaPlone/tests/test_contentlinkviewlet.py b/Products/LinguaPlone/tests/test_contentlinkviewlet.py
index 131fb6c..704f4c4 100644
--- a/Products/LinguaPlone/tests/test_contentlinkviewlet.py
+++ b/Products/LinguaPlone/tests/test_contentlinkviewlet.py
@@ -26,4 +26,4 @@ def testViewletGeneratesTranslationList(self):
     def testViewletGeneratedLinks(self):
         viewlet = MultilingualContentViewlet(self.english, self.app.REQUEST, None, None)
         viewlet.update()
-        self.assertEqual(len(viewlet.translations), 1)
+        self.assertEqual(len(viewlet.translations), 2)


