Repository: plone.app.blob


Branch: refs/heads/master
Date: 2016-04-12T15:23:16+02:00
Author: Martin Opstad Reistadbakk (martior) <martior@gmail.com>
Commit: https://github.com/plone/plone.app.blob/commit/a0fb3b38b68a54aae9cb448acdb85983a087c2cb

Blob images should also reset EXIF data on save (#26)

* Update exif data on save
* refresh_exif should default to True

Files changed:
M CHANGES.rst
M src/plone/app/blob/subtypes/image.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6eb8752..a9e6b13 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -12,6 +12,8 @@ Fixes:
 
 - *add item here*
 
+- Blob images now reset EXIF data on save [martior]
+
 
 1.6.1 (2015-11-26)
 ------------------
diff --git a/src/plone/app/blob/subtypes/image.py b/src/plone/app/blob/subtypes/image.py
index 0daee42..2d39ded 100644
--- a/src/plone/app/blob/subtypes/image.py
+++ b/src/plone/app/blob/subtypes/image.py
@@ -17,9 +17,10 @@ class ExtensionBlobField(ExtensionField, BlobField, ImageFieldMixin):
     """ derivative of blobfield for extending schemas """
     implements(IBlobImageField)
 
-    def set(self, instance, value, **kwargs):
+    def set(self, instance, value, refresh_exif=True, **kwargs):
         super(ExtensionBlobField, self).set(instance, value, **kwargs)
         self.fixAutoId(instance)
+        instance.getEXIF(value, refresh=refresh_exif)
         if hasattr(aq_base(instance), blobScalesAttr):
             delattr(aq_base(instance), blobScalesAttr)
 


