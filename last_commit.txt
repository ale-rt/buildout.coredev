Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-04-27T17:12:46+02:00
Author: Alexander Loechel (loechel) <Alexander.Loechel@lmu.de>
Commit: https://github.com/plone/plone.app.dexterity/commit/b40214439a8e56d29f63a97f103071f9f4519c6e

Correct how Type is looked Up

Files changed:
M plone/app/dexterity/factories.py

diff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py
index 76e1ef0..782a102 100644
--- a/plone/app/dexterity/factories.py
+++ b/plone/app/dexterity/factories.py
@@ -24,7 +24,7 @@ def __init__(self, context):
 
     def __call__(self, name, content_type, data):
         ctr = getToolByName(self.context, 'content_type_registry')
-        type_ = ctr.findTypeName(name.lower(), '', '') or 'File'
+        type_ = ctr.findTypeName(name.lower(), content_type, data) or 'File'
 
         name = name.decode("utf8")
 


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-04-27T23:09:11+02:00
Author: Alexander Loechel (loechel) <Alexander.Loechel@lmu.de>
Commit: https://github.com/plone/plone.app.dexterity/commit/11afb1cf412d1841c1a208f9169a1e800c878932

Add Change Log

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 2ba00a1..c4f5d7e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,12 +18,15 @@ Fixes:
 - Remove dups from TTW behavior FTI editor.
   [jensens]
 
-- Fix problem in ConstrainTypesBehavior: 
-  when mode was ENABLED but only setLocallyAllowedTypes were set, 
-  then getImmediatelyAddableTypes returned None, 
+- Fix problem in ConstrainTypesBehavior:
+  when mode was ENABLED but only setLocallyAllowedTypes were set,
+  then getImmediatelyAddableTypes returned None,
   but all consuming code expect it to return a list
   [jensens]
 
+- Lookup of Content Type from MIME-Type for using right Plone Content Type to store Images (especially Tiff) correct as Images not Files.
+  [loechel]
+
 
 2.1.20 (2016-03-31)
 -------------------


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-04-28T15:11:18+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/2357a5af2eefada22db41f6f308eccdc0e27abaa

Merge pull request #212 from plone/check_content_type

Correct how Type is looked Up

Files changed:
M CHANGES.rst
M plone/app/dexterity/factories.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2ba00a1..c4f5d7e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,12 +18,15 @@ Fixes:
 - Remove dups from TTW behavior FTI editor.
   [jensens]
 
-- Fix problem in ConstrainTypesBehavior: 
-  when mode was ENABLED but only setLocallyAllowedTypes were set, 
-  then getImmediatelyAddableTypes returned None, 
+- Fix problem in ConstrainTypesBehavior:
+  when mode was ENABLED but only setLocallyAllowedTypes were set,
+  then getImmediatelyAddableTypes returned None,
   but all consuming code expect it to return a list
   [jensens]
 
+- Lookup of Content Type from MIME-Type for using right Plone Content Type to store Images (especially Tiff) correct as Images not Files.
+  [loechel]
+
 
 2.1.20 (2016-03-31)
 -------------------
diff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py
index 76e1ef0..782a102 100644
--- a/plone/app/dexterity/factories.py
+++ b/plone/app/dexterity/factories.py
@@ -24,7 +24,7 @@ def __init__(self, context):
 
     def __call__(self, name, content_type, data):
         ctr = getToolByName(self.context, 'content_type_registry')
-        type_ = ctr.findTypeName(name.lower(), '', '') or 'File'
+        type_ = ctr.findTypeName(name.lower(), content_type, data) or 'File'
 
         name = name.decode("utf8")
 


