Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-04T10:37:56+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/e0daaa866d5d39339bcf10b019423f7147223a6b

Remove hasattr

Files changed:
M plone/app/contentlisting/catalog.py

diff --git a/plone/app/contentlisting/catalog.py b/plone/app/contentlisting/catalog.py
index e9ac53c..9f9a91c 100644
--- a/plone/app/contentlisting/catalog.py
+++ b/plone/app/contentlisting/catalog.py
@@ -39,12 +39,13 @@ def __getattr__(self, name):
 
         if name.startswith('_'):
             raise AttributeError(name)
-        if hasattr(aq_base(self._brain), name):
-            return getattr(self._brain, name)
-        elif hasattr(aq_base(self.getObject()), name):
-            return getattr(aq_base(self.getObject()), name)
-        else:
-            raise AttributeError(name)
+        brain_name = getattr(aq_base(self._brain), name, None)
+        if brain_name is not None:
+            return brain_name
+        object_name = getattr(aq_base(self.getObject()), name, None)
+        if object_name is not None:
+            return object_name
+        raise AttributeError(name)
 
     def getDataOrigin(self):
         # The origin of the data for the object.


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-04T11:00:52+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/be8ac0a43073b55ddaae47689e4f51a3dc8e7797

Fix E305 2 blank lines after class or function definition

Files changed:
M plone/app/contentlisting/tests/base.py

diff --git a/plone/app/contentlisting/tests/base.py b/plone/app/contentlisting/tests/base.py
index bc2e41b..be4e326 100644
--- a/plone/app/contentlisting/tests/base.py
+++ b/plone/app/contentlisting/tests/base.py
@@ -21,6 +21,7 @@ def setUpZope(self, app, configurationContext):
         xmlconfig.file('configure.zcml',
                        plone.app.contentlisting, context=configurationContext)
 
+
 CONTENTLISTING_FIXTURE = ContentListingLayer()
 
 
@@ -40,6 +41,7 @@ def setUpPloneSite(self, portal):
         portal.news.invokeFactory('News Item', 'news1')
         setRoles(portal, TEST_USER_ID, ['Member'])
 
+
 CONTENTLISTING_INTEGRATION_FIXTURE = ContentListingIntegrationLayer()
 CONTENTLISTING_INTEGRATION_TESTING = IntegrationTesting(
     bases=(CONTENTLISTING_INTEGRATION_FIXTURE, ),


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-04T11:06:14+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/138b0146e23441ca6710a4ae5697a491f263d106

Fix D001 use self.loadZCML

Files changed:
M plone/app/contentlisting/tests/base.py

diff --git a/plone/app/contentlisting/tests/base.py b/plone/app/contentlisting/tests/base.py
index be4e326..0fa6c82 100644
--- a/plone/app/contentlisting/tests/base.py
+++ b/plone/app/contentlisting/tests/base.py
@@ -15,11 +15,9 @@ class ContentListingLayer(PloneSandboxLayer):
 
     def setUpZope(self, app, configurationContext):
         import plone.app.layout
+        self.loadZCML(package=plone.app.layout)
         import plone.app.contentlisting
-        xmlconfig.file('configure.zcml',
-                       plone.app.layout, context=configurationContext)
-        xmlconfig.file('configure.zcml',
-                       plone.app.contentlisting, context=configurationContext)
+        self.loadZCML(package=plone.app.contentlisting)
 
 
 CONTENTLISTING_FIXTURE = ContentListingLayer()


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-04T11:08:26+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/8ebf3ce623bb10d9e459d00610f5aa734702ded7

Fix F401 remove unused import

Files changed:
M plone/app/contentlisting/tests/base.py

diff --git a/plone/app/contentlisting/tests/base.py b/plone/app/contentlisting/tests/base.py
index 0fa6c82..35ae724 100644
--- a/plone/app/contentlisting/tests/base.py
+++ b/plone/app/contentlisting/tests/base.py
@@ -6,7 +6,6 @@
 from plone.app.testing import setRoles
 from plone.app.testing import TEST_USER_ID
 from Products.CMFCore.utils import getToolByName
-from zope.configuration import xmlconfig
 
 
 class ContentListingLayer(PloneSandboxLayer):


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-04T11:22:11+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/672a5a395e388100965aac457be638b6e635b8fc

Update changelog.

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 53dd1a4..5cace04 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Remove hasattr.
+  [ivanteoh]
 
 
 1.2.8 (2016-11-19)


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-05T08:48:35+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/4f61c7e71335949397c7ecea12e175e63c681814

Use marker object instead of None

Files changed:
M plone/app/contentlisting/catalog.py

diff --git a/plone/app/contentlisting/catalog.py b/plone/app/contentlisting/catalog.py
index 9f9a91c..d6b6c51 100644
--- a/plone/app/contentlisting/catalog.py
+++ b/plone/app/contentlisting/catalog.py
@@ -10,6 +10,8 @@
 from zope.component import queryUtility
 from zope.interface import implementer
 
+missing = object()
+
 
 @implementer(IContentListingObject)
 class CatalogContentListingObject(BaseContentListingObject):
@@ -39,11 +41,11 @@ def __getattr__(self, name):
 
         if name.startswith('_'):
             raise AttributeError(name)
-        brain_name = getattr(aq_base(self._brain), name, None)
-        if brain_name is not None:
+        brain_name = getattr(aq_base(self._brain), name, missing)
+        if brain_name is not missing:
             return brain_name
-        object_name = getattr(aq_base(self.getObject()), name, None)
-        if object_name is not None:
+        object_name = getattr(aq_base(self.getObject()), name, missing)
+        if object_name is not missing:
             return object_name
         raise AttributeError(name)
 


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-05T10:57:29+08:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/e14e72ae82e7e246c0e264f9e92335ad57b01453

Fix I003

Files changed:
M plone/app/contentlisting/catalog.py

diff --git a/plone/app/contentlisting/catalog.py b/plone/app/contentlisting/catalog.py
index d6b6c51..c233a73 100644
--- a/plone/app/contentlisting/catalog.py
+++ b/plone/app/contentlisting/catalog.py
@@ -10,6 +10,7 @@
 from zope.component import queryUtility
 from zope.interface import implementer
 
+
 missing = object()
 
 


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-05T08:14:57+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/5743a1058bdb4aea0b7e633841cf088159df426e

Merge pull request #21 from plone/remove-hasattr

Remove hasattr

Files changed:
M CHANGES.rst
M plone/app/contentlisting/catalog.py
M plone/app/contentlisting/tests/base.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 53dd1a4..5cace04 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Remove hasattr.
+  [ivanteoh]
 
 
 1.2.8 (2016-11-19)
diff --git a/plone/app/contentlisting/catalog.py b/plone/app/contentlisting/catalog.py
index e9ac53c..c233a73 100644
--- a/plone/app/contentlisting/catalog.py
+++ b/plone/app/contentlisting/catalog.py
@@ -11,6 +11,9 @@
 from zope.interface import implementer
 
 
+missing = object()
+
+
 @implementer(IContentListingObject)
 class CatalogContentListingObject(BaseContentListingObject):
     """A Catalog-results based content object representation.
@@ -39,12 +42,13 @@ def __getattr__(self, name):
 
         if name.startswith('_'):
             raise AttributeError(name)
-        if hasattr(aq_base(self._brain), name):
-            return getattr(self._brain, name)
-        elif hasattr(aq_base(self.getObject()), name):
-            return getattr(aq_base(self.getObject()), name)
-        else:
-            raise AttributeError(name)
+        brain_name = getattr(aq_base(self._brain), name, missing)
+        if brain_name is not missing:
+            return brain_name
+        object_name = getattr(aq_base(self.getObject()), name, missing)
+        if object_name is not missing:
+            return object_name
+        raise AttributeError(name)
 
     def getDataOrigin(self):
         # The origin of the data for the object.
diff --git a/plone/app/contentlisting/tests/base.py b/plone/app/contentlisting/tests/base.py
index bc2e41b..35ae724 100644
--- a/plone/app/contentlisting/tests/base.py
+++ b/plone/app/contentlisting/tests/base.py
@@ -6,7 +6,6 @@
 from plone.app.testing import setRoles
 from plone.app.testing import TEST_USER_ID
 from Products.CMFCore.utils import getToolByName
-from zope.configuration import xmlconfig
 
 
 class ContentListingLayer(PloneSandboxLayer):
@@ -15,11 +14,10 @@ class ContentListingLayer(PloneSandboxLayer):
 
     def setUpZope(self, app, configurationContext):
         import plone.app.layout
+        self.loadZCML(package=plone.app.layout)
         import plone.app.contentlisting
-        xmlconfig.file('configure.zcml',
-                       plone.app.layout, context=configurationContext)
-        xmlconfig.file('configure.zcml',
-                       plone.app.contentlisting, context=configurationContext)
+        self.loadZCML(package=plone.app.contentlisting)
+
 
 CONTENTLISTING_FIXTURE = ContentListingLayer()
 
@@ -40,6 +38,7 @@ def setUpPloneSite(self, portal):
         portal.news.invokeFactory('News Item', 'news1')
         setRoles(portal, TEST_USER_ID, ['Member'])
 
+
 CONTENTLISTING_INTEGRATION_FIXTURE = ContentListingIntegrationLayer()
 CONTENTLISTING_INTEGRATION_TESTING = IntegrationTesting(
     bases=(CONTENTLISTING_INTEGRATION_FIXTURE, ),


