Repository: plone.app.theming


Branch: refs/heads/master
Date: 2016-09-01T09:53:20+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.theming/commit/d10299b220e3442a9805c7d6f71d7a6c9a8e1e1c

Fix issue where global resource directory overrides broke control panel

Files changed:
M CHANGES.rst
M src/plone/app/theming/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2433860..cca7d7b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -20,6 +20,10 @@ Fixes:
 - Small fix in documentation
   [staeff]
 
+- Fix issue where theming control panel errored when a packaged
+  theme was overidden with a global resource directory theme
+  [datakurre]
+
 1.3.0 (2016-06-07)
 ------------------
 
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index 4bf8798..b7c809d 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -433,8 +433,12 @@ def themeList(self):
             # Is there more than one theme with the same name?
             if len(filter(lambda x: x.__name__ == theme.__name__, self.availableThemes)) > 1:
                 # Then we make sure we're using the TTW version, not the filesystem version.
-                theme = filter(lambda x: x.__name__ == theme.__name__, self.zodbThemes)[0]
-                override = True
+                try:
+                    theme = filter(lambda x: x.__name__ == theme.__name__, self.zodbThemes)[0]
+                    override = True
+                # Or when TTW is not available, the first available filesystem version.
+                except IndexError:
+                    theme = filter(lambda x: x.__name__ == theme.__name__, self.availableThemes)[0]
 
             previewUrl = "++resource++plone.app.theming/defaultPreview.png"
             if theme.preview:


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2016-09-16T23:35:28+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.theming/commit/e00e090028ace8bc588bf8915ba229b4a8fdd2a8

Merge pull request #113 from plone/datakurre-fix-overrides

Fix issue where global resource directory overrides broke control panel

Files changed:
M CHANGES.rst
M src/plone/app/theming/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1cdd41c..cc18017 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,10 @@ Fixes:
 - Small fix in documentation
   [staeff]
 
+- Fix issue where theming control panel errored when a packaged
+  theme was overidden with a global resource directory theme
+  [datakurre]
+
 1.3.0 (2016-06-07)
 ------------------
 
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index 4bf8798..b7c809d 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -433,8 +433,12 @@ def themeList(self):
             # Is there more than one theme with the same name?
             if len(filter(lambda x: x.__name__ == theme.__name__, self.availableThemes)) > 1:
                 # Then we make sure we're using the TTW version, not the filesystem version.
-                theme = filter(lambda x: x.__name__ == theme.__name__, self.zodbThemes)[0]
-                override = True
+                try:
+                    theme = filter(lambda x: x.__name__ == theme.__name__, self.zodbThemes)[0]
+                    override = True
+                # Or when TTW is not available, the first available filesystem version.
+                except IndexError:
+                    theme = filter(lambda x: x.__name__ == theme.__name__, self.availableThemes)[0]
 
             previewUrl = "++resource++plone.app.theming/defaultPreview.png"
             if theme.preview:


