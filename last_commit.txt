Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-08-27T00:45:59-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/b385f1af0d953cb057e54e6a6507b76612d8c25b

introduce 5.1 beta1 changes, fix mockup 2.4.0 changes

Files changed:
A plone/app/upgrade/v51/betas.py
A plone/app/upgrade/v51/profiles/to_beta1/registry.xml
M CHANGES.rst
M plone/app/upgrade/v51/alphas.py
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 2a0adec..69b5c8a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,12 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Add new Mockup 2.4.0 relateditems resource url.
+  [thet]
+
+- Update ``last_compilation`` to deliver new bundles.
+  [thet]
+
 
 Bug fixes:
 
diff --git a/plone/app/upgrade/v51/alphas.py b/plone/app/upgrade/v51/alphas.py
index bd4c036..d7d81c5 100644
--- a/plone/app/upgrade/v51/alphas.py
+++ b/plone/app/upgrade/v51/alphas.py
@@ -29,11 +29,9 @@ def _fix_typo_in_toolbar_less_variable(context):
 
 
 def to51alpha1(context):
-    """5.0.4 -> 5.1a1"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v51:to51alpha1')
     _fix_typo_in_toolbar_less_variable(context)
 
 
 def to51alpha2(context):
-    """5.0.4 -> 5.1a1"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v51:to51alpha2')
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
new file mode 100644
index 0000000..f14fc64
--- /dev/null
+++ b/plone/app/upgrade/v51/betas.py
@@ -0,0 +1,11 @@
+# -*- coding: utf-8 -*-
+from plone.app.upgrade.utils import loadMigrationProfile
+
+import logging
+
+
+logger = logging.getLogger('plone.app.upgrade')
+
+
+def to51beta1(context):
+    loadMigrationProfile(context, 'profile-plone.app.upgrade.v51:to51beta1')
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 499110e..4de223a 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -37,4 +37,20 @@ Remove deprecated ``mockup-registry`` and ``mockup-parser`` resources.
 
     </gs:upgradeSteps>
 
+    <gs:upgradeSteps
+        source="5102"
+        destination="5103"
+        profile="Products.CMFPlone:plone">
+
+      <gs:upgradeStep
+           title="Run to51beta1 upgrade profile."
+           description="
+Update ``last_compilation`` to deliver new bundles,
+Add new Mockup 2.4.0 relateditems resource url.
+           "
+           handler=".betas.to51beta1"
+           />
+
+    </gs:upgradeSteps>
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index 2427c7b..d731936 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -14,11 +14,20 @@
 
   <genericsetup:registerProfile
       name="to51alpha2"
-      title="Upgrade profile for Plone Plone 5.1alpha1 to Plone 5.1alpha2"
+      title="Upgrade profile for Plone 5.1alpha1 to Plone 5.1alpha2"
       description=""
       directory="profiles/to_alpha2"
       for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to51beta1"
+      title="Upgrade profile for Plone 5.1alpha2 to Plone 5.1beta1"
+      description=""
+      directory="profiles/to_beta1"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_beta1/registry.xml b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
new file mode 100644
index 0000000..fab9c06
--- /dev/null
+++ b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<registry>
+
+  <!-- Update ``last_compilation`` to deliver new bundles -->
+  <records prefix="plone.bundles/plone" interface="Products.CMFPlone.interfaces.IBundleRegistry" purge="False">
+    <value key="last_compilation">2016-08-27 00:00:00</value>
+  </records>
+  <records prefix="plone.bundles/plone-logged-in" interface="Products.CMFPlone.interfaces.IBundleRegistry" purge="False">
+    <value key="last_compilation">2016-08-27 00:00:00</value>
+  </records>
+
+  <!-- Add new Mockup 2.4.0 relateditems resource url -->
+  <records prefix="plone.resources/mockup-patterns-relateditems" interface="Products.CMFPlone.interfaces.IResourceRegistry" purge="False">
+    <value key="url">++resource++mockup/relateditems</value>
+  </records>
+
+</registry>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-08-28T20:44:08-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/c9490e81056e9df379225daa232d27eb795a6c77

Merge pull request #83 from plone/thet-mockup240

introduce 5.1 beta1 changes, fix mockup 2.4.0 changes

Files changed:
A plone/app/upgrade/v51/betas.py
A plone/app/upgrade/v51/profiles/to_beta1/registry.xml
M CHANGES.rst
M plone/app/upgrade/v51/alphas.py
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 2a0adec..69b5c8a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,12 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Add new Mockup 2.4.0 relateditems resource url.
+  [thet]
+
+- Update ``last_compilation`` to deliver new bundles.
+  [thet]
+
 
 Bug fixes:
 
diff --git a/plone/app/upgrade/v51/alphas.py b/plone/app/upgrade/v51/alphas.py
index bd4c036..d7d81c5 100644
--- a/plone/app/upgrade/v51/alphas.py
+++ b/plone/app/upgrade/v51/alphas.py
@@ -29,11 +29,9 @@ def _fix_typo_in_toolbar_less_variable(context):
 
 
 def to51alpha1(context):
-    """5.0.4 -> 5.1a1"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v51:to51alpha1')
     _fix_typo_in_toolbar_less_variable(context)
 
 
 def to51alpha2(context):
-    """5.0.4 -> 5.1a1"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v51:to51alpha2')
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
new file mode 100644
index 0000000..f14fc64
--- /dev/null
+++ b/plone/app/upgrade/v51/betas.py
@@ -0,0 +1,11 @@
+# -*- coding: utf-8 -*-
+from plone.app.upgrade.utils import loadMigrationProfile
+
+import logging
+
+
+logger = logging.getLogger('plone.app.upgrade')
+
+
+def to51beta1(context):
+    loadMigrationProfile(context, 'profile-plone.app.upgrade.v51:to51beta1')
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 499110e..4de223a 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -37,4 +37,20 @@ Remove deprecated ``mockup-registry`` and ``mockup-parser`` resources.
 
     </gs:upgradeSteps>
 
+    <gs:upgradeSteps
+        source="5102"
+        destination="5103"
+        profile="Products.CMFPlone:plone">
+
+      <gs:upgradeStep
+           title="Run to51beta1 upgrade profile."
+           description="
+Update ``last_compilation`` to deliver new bundles,
+Add new Mockup 2.4.0 relateditems resource url.
+           "
+           handler=".betas.to51beta1"
+           />
+
+    </gs:upgradeSteps>
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index 2427c7b..d731936 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -14,11 +14,20 @@
 
   <genericsetup:registerProfile
       name="to51alpha2"
-      title="Upgrade profile for Plone Plone 5.1alpha1 to Plone 5.1alpha2"
+      title="Upgrade profile for Plone 5.1alpha1 to Plone 5.1alpha2"
       description=""
       directory="profiles/to_alpha2"
       for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to51beta1"
+      title="Upgrade profile for Plone 5.1alpha2 to Plone 5.1beta1"
+      description=""
+      directory="profiles/to_beta1"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_beta1/registry.xml b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
new file mode 100644
index 0000000..fab9c06
--- /dev/null
+++ b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<registry>
+
+  <!-- Update ``last_compilation`` to deliver new bundles -->
+  <records prefix="plone.bundles/plone" interface="Products.CMFPlone.interfaces.IBundleRegistry" purge="False">
+    <value key="last_compilation">2016-08-27 00:00:00</value>
+  </records>
+  <records prefix="plone.bundles/plone-logged-in" interface="Products.CMFPlone.interfaces.IBundleRegistry" purge="False">
+    <value key="last_compilation">2016-08-27 00:00:00</value>
+  </records>
+
+  <!-- Add new Mockup 2.4.0 relateditems resource url -->
+  <records prefix="plone.resources/mockup-patterns-relateditems" interface="Products.CMFPlone.interfaces.IResourceRegistry" purge="False">
+    <value key="url">++resource++mockup/relateditems</value>
+  </records>
+
+</registry>


