Repository: Products.LinguaPlone


Branch: refs/heads/master
Date: 2016-02-17T11:43:35+01:00
Author: Godefroid Chapelle (gotcha) <gotcha@bubblenet.be>
Commit: https://github.com/plone/Products.LinguaPlone/commit/bed0cfd64a0d0d35543a1ad83f09258f2a00a76c

fix broken tests

Files changed:
M Products/LinguaPlone/browser/selector.py
M Products/LinguaPlone/tests/test_selector.py

diff --git a/Products/LinguaPlone/browser/selector.py b/Products/LinguaPlone/browser/selector.py
index fba0153..310bfa3 100644
--- a/Products/LinguaPlone/browser/selector.py
+++ b/Products/LinguaPlone/browser/selector.py
@@ -173,7 +173,7 @@ def languages(self):
 
 def get_formvariables(request):
     formvariables = {}
-    if request["REQUEST_METHOD"] == "GET":
+    if request.get("REQUEST_METHOD", "").upper() == "GET":
         for k, v in request.form.items():
             if isinstance(v, unicode):
                 formvariables[k] = v.encode('utf-8')
diff --git a/Products/LinguaPlone/tests/test_selector.py b/Products/LinguaPlone/tests/test_selector.py
index a67b4cc..87fcab9 100644
--- a/Products/LinguaPlone/tests/test_selector.py
+++ b/Products/LinguaPlone/tests/test_selector.py
@@ -212,6 +212,7 @@ def test_languages_vhr(self):
         self.request.PATH_INFO = vbase + 'fake/path/VirtualHostRoot/to/object'
         self.request.form['uni'] = u'pres\xd8rved'
         self.request.form['int'] = '1'
+        self.request.REQUEST_METHOD = "GET"
         self.selector.update()
         self.selector.tool = MockLanguageTool()
         base = 'object_url/to/object?int=1&uni='


