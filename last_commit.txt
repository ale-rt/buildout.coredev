Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-04-22T10:24:50+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/d914c0e8339d79afeecba0c8442974c007583f44

Don't fail replace_link_variables_by_paths with empty value
Don't fail for ``utils.replace_link_variables_by_paths``, if value is ``None``.
The value can be ``None`` when creating a ``Link`` type with ``invokeFactory`` without ``remoteUrl`` set and calling the indexer before setting the URL.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2ae5df8..2a234e3 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Don't fail for ``utils.replace_link_variables_by_paths``, if value is ``None``.
+  The value can be ``None`` when creating a ``Link`` type with ``invokeFactory`` without ``remoteUrl`` set and calling the indexer before setting the URL.
+  [thet]
 
 
 1.2.12 (2016-04-13)
diff --git a/plone/app/contenttypes/utils.py b/plone/app/contenttypes/utils.py
index 154d829..586eaaa 100644
--- a/plone/app/contenttypes/utils.py
+++ b/plone/app/contenttypes/utils.py
@@ -17,6 +17,9 @@ def replace_link_variables_by_paths(context, url):
     "${portal_url}" by the corresponding paths. `context` is the acquisition
     context.
     """
+    if not url:
+        return None
+
     portal_state = context.restrictedTraverse('@@plone_portal_state')
 
     if '${navigation_root_url}' in url:


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-04-22T13:22:44+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/dacd8f2d7b10722818e1264582537ac6cfcc97ac

better return url as is (empty strong or None)

Files changed:
M plone/app/contenttypes/utils.py

diff --git a/plone/app/contenttypes/utils.py b/plone/app/contenttypes/utils.py
index 586eaaa..262fac8 100644
--- a/plone/app/contenttypes/utils.py
+++ b/plone/app/contenttypes/utils.py
@@ -18,7 +18,7 @@ def replace_link_variables_by_paths(context, url):
     context.
     """
     if not url:
-        return None
+        return url
 
     portal_state = context.restrictedTraverse('@@plone_portal_state')
 


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-04-22T13:22:58+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/de7982fa8da4a8364231c92a10f5bca2c0f63a21

Merge pull request #346 from plone/thet-replace-linkvars-fix

Don't fail replace_link_variables_by_paths with empty value

Files changed:
M CHANGES.rst
M plone/app/contenttypes/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2ae5df8..2a234e3 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Don't fail for ``utils.replace_link_variables_by_paths``, if value is ``None``.
+  The value can be ``None`` when creating a ``Link`` type with ``invokeFactory`` without ``remoteUrl`` set and calling the indexer before setting the URL.
+  [thet]
 
 
 1.2.12 (2016-04-13)
diff --git a/plone/app/contenttypes/utils.py b/plone/app/contenttypes/utils.py
index 154d829..262fac8 100644
--- a/plone/app/contenttypes/utils.py
+++ b/plone/app/contenttypes/utils.py
@@ -17,6 +17,9 @@ def replace_link_variables_by_paths(context, url):
     "${portal_url}" by the corresponding paths. `context` is the acquisition
     context.
     """
+    if not url:
+        return url
+
     portal_state = context.restrictedTraverse('@@plone_portal_state')
 
     if '${navigation_root_url}' in url:


