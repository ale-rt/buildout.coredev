Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-05-23T10:24:10+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/6fafbc9bad10d8c6cb84a137bc0af7c7096d0056

utf8 headers

Files changed:
M setup.py
M src/plone/__init__.py
M src/plone/recipe/__init__.py
M src/plone/recipe/zeoserver/__init__.py
M src/plone/recipe/zeoserver/ctl.py
M src/plone/recipe/zeoserver/pack.py
M src/plone/recipe/zeoserver/tests/__init__.py

diff --git a/setup.py b/setup.py
index b4a255d..4a29354 100644
--- a/setup.py
+++ b/setup.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 import sys
 from setuptools import setup, find_packages
 
diff --git a/src/plone/__init__.py b/src/plone/__init__.py
index f48ad10..85880ef 100644
--- a/src/plone/__init__.py
+++ b/src/plone/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
 try:
     __import__('pkg_resources').declare_namespace(__name__)
diff --git a/src/plone/recipe/__init__.py b/src/plone/recipe/__init__.py
index f48ad10..85880ef 100644
--- a/src/plone/recipe/__init__.py
+++ b/src/plone/recipe/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
 try:
     __import__('pkg_resources').declare_namespace(__name__)
diff --git a/src/plone/recipe/zeoserver/__init__.py b/src/plone/recipe/zeoserver/__init__.py
index a830188..9df70df 100644
--- a/src/plone/recipe/zeoserver/__init__.py
+++ b/src/plone/recipe/zeoserver/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 import logging
 import os
 import shutil
diff --git a/src/plone/recipe/zeoserver/ctl.py b/src/plone/recipe/zeoserver/ctl.py
index dedb1c3..c787b27 100644
--- a/src/plone/recipe/zeoserver/ctl.py
+++ b/src/plone/recipe/zeoserver/ctl.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 """zeocltl -- control a ZEO server using zdaemon.
 
 Usage: zeocltl [options] [action [arguments]]
diff --git a/src/plone/recipe/zeoserver/pack.py b/src/plone/recipe/zeoserver/pack.py
index 4c364d0..ad87042 100644
--- a/src/plone/recipe/zeoserver/pack.py
+++ b/src/plone/recipe/zeoserver/pack.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 import logging
 import socket
 import sys
diff --git a/src/plone/recipe/zeoserver/tests/__init__.py b/src/plone/recipe/zeoserver/tests/__init__.py
index 792d600..ec51c5a 100644
--- a/src/plone/recipe/zeoserver/tests/__init__.py
+++ b/src/plone/recipe/zeoserver/tests/__init__.py
@@ -1 +1,2 @@
+# -*- coding: utf-8 -*-
 #


Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-05-23T10:24:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/6435f20b51347cf09f0be7379681d6b62767293f

isort

Files changed:
M setup.py
M src/plone/recipe/zeoserver/__init__.py
M src/plone/recipe/zeoserver/ctl.py
M src/plone/recipe/zeoserver/pack.py
M src/plone/recipe/zeoserver/tests/test_docs.py

diff --git a/setup.py b/setup.py
index 4a29354..fe08f46 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,9 @@
 # -*- coding: utf-8 -*-
+from setuptools import find_packages
+from setuptools import setup
+
 import sys
-from setuptools import setup, find_packages
+
 
 version = '1.3.2.dev0'
 
diff --git a/src/plone/recipe/zeoserver/__init__.py b/src/plone/recipe/zeoserver/__init__.py
index 9df70df..05c8ab8 100644
--- a/src/plone/recipe/zeoserver/__init__.py
+++ b/src/plone/recipe/zeoserver/__init__.py
@@ -1,14 +1,15 @@
 # -*- coding: utf-8 -*-
+from pkg_resources import get_distribution
+from pkg_resources import parse_version
+
 import logging
 import os
 import shutil
 import sys
-
-from pkg_resources import get_distribution
-from pkg_resources import parse_version
 import zc.buildout
 import zc.recipe.egg
 
+
 try:
     import zc.zrs
     HAS_ZRS = True
diff --git a/src/plone/recipe/zeoserver/ctl.py b/src/plone/recipe/zeoserver/ctl.py
index c787b27..291f706 100644
--- a/src/plone/recipe/zeoserver/ctl.py
+++ b/src/plone/recipe/zeoserver/ctl.py
@@ -11,11 +11,11 @@
 typed interactively is started. Use the action "help" to find out about
 available actions. """
 
-import sys
-import os
-
-from ZEO import zeoctl
 from ZEO import runzeo
+from ZEO import zeoctl
+
+import os
+import sys
 
 
 if sys.platform[:3].lower() == "win":
diff --git a/src/plone/recipe/zeoserver/pack.py b/src/plone/recipe/zeoserver/pack.py
index ad87042..5b7628a 100644
--- a/src/plone/recipe/zeoserver/pack.py
+++ b/src/plone/recipe/zeoserver/pack.py
@@ -1,11 +1,11 @@
 # -*- coding: utf-8 -*-
+from ZEO.ClientStorage import ClientStorage
+from ZEO.Exceptions import ClientDisconnected
+
 import logging
+import os
 import socket
 import sys
-import os
-
-from ZEO.ClientStorage import ClientStorage
-from ZEO.Exceptions import ClientDisconnected
 
 
 def _main(host, port, unix=None, days=1, username=None, password=None,
diff --git a/src/plone/recipe/zeoserver/tests/test_docs.py b/src/plone/recipe/zeoserver/tests/test_docs.py
index dd2febe..aca3e89 100644
--- a/src/plone/recipe/zeoserver/tests/test_docs.py
+++ b/src/plone/recipe/zeoserver/tests/test_docs.py
@@ -1,16 +1,16 @@
 # -*- coding: utf-8 -*-
 
-import doctest
-import unittest
-import shutil
-import sys
-
-import pkg_resources
 from zc.buildout.testing import buildoutSetUp
 from zc.buildout.testing import buildoutTearDown
 from zc.buildout.testing import install
 from zc.buildout.testing import install_develop
 
+import doctest
+import pkg_resources
+import shutil
+import sys
+import unittest
+
 
 def setUp(test):
     buildoutSetUp(test)


Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-05-23T10:27:37+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/d75bb478a2d3f65d971255b877bdcce1c5cc580f

autopep8 -iar *

Files changed:
M src/plone/recipe/zeoserver/__init__.py
M src/plone/recipe/zeoserver/tests/test_docs.py

diff --git a/src/plone/recipe/zeoserver/__init__.py b/src/plone/recipe/zeoserver/__init__.py
index 05c8ab8..736a21e 100644
--- a/src/plone/recipe/zeoserver/__init__.py
+++ b/src/plone/recipe/zeoserver/__init__.py
@@ -29,10 +29,9 @@ def __init__(self, buildout, name, options):
         options['location'] = os.path.join(
             buildout['buildout']['parts-directory'],
             self.name,
-            )
+        )
         options['bin-directory'] = buildout['buildout']['bin-directory']
-        options['scripts'] = '' # suppress script generation.
-
+        options['scripts'] = ''  # suppress script generation.
 
         # Relative path support for the generated scripts
         relative_paths = options.get(
@@ -79,9 +78,9 @@ def install(self):
             "zodb3_home": self.zodb3_home,
             'zdaemon_home': zdaemon_home,
             "instance_home": location,
-            "address": '8100', # will be overwritten later
+            "address": '8100',  # will be overwritten later
             "python": options['executable'],
-            }
+        }
         from zope.mkzeoinstance import ZEOInstanceBuilder
         ZEOInstanceBuilder().create(location, params)
 
@@ -99,8 +98,7 @@ def install(self):
             # Install extra scripts
             self.install_scripts()
 
-        except:
-            # clean up
+        except Exception:            # clean up
             shutil.rmtree(location)
             raise
 
@@ -183,7 +181,8 @@ def build_zeo_conf(self):
                 os.makedirs(z_log_dir)
 
             # zeo-log-custom superseeds zeo-log
-            logformat=options.get('zeo-log-format', '%(asctime)s %(message)s')
+            logformat = options.get(
+                'zeo-log-format', '%(asctime)s %(message)s')
             if zeo_log_custom is None:
                 zeo_log_rotate = ''
                 zeo_log_max_size = options.get('zeo-log-max-size', None)
@@ -208,8 +207,8 @@ def build_zeo_conf(self):
 
             if options.get('authentication-database', ''):
                 authentication = authentication_template % \
-                        dict(database=options.get('authentication-database'),
-                             realm=options.get('authentication-realm', 'ZEO'))
+                    dict(database=options.get('authentication-database'),
+                         realm=options.get('authentication-realm', 'ZEO'))
             else:
                 authentication = ''
 
@@ -233,12 +232,12 @@ def build_zeo_conf(self):
                 pack_keep_old = 'pack-keep-old false'
 
             storage = storage_template % dict(
-                storage_number = storage_number,
-                file_storage = file_storage,
-                blob_storage = blob_storage,
-                pack_gc = pack_gc,
-                pack_keep_old = pack_keep_old,
-                )
+                storage_number=storage_number,
+                file_storage=file_storage,
+                blob_storage=blob_storage,
+                pack_gc=pack_gc,
+                pack_keep_old=pack_keep_old,
+            )
 
             # ZRS config
             rfrom = options.get('replicate-from')
@@ -255,25 +254,25 @@ def build_zeo_conf(self):
                     keep_alive=keep_alive,
                     replicate=replicate,
                     storage_number=storage_number
-                    )
+                )
 
             read_only = options.get('read-only', 'false')
             zeo_conf = zeo_conf_template % dict(
-                instance_home = instance_home,
-                effective_user = effective_user,
-                invalidation_queue_size = invalidation_queue_size,
-                socket_name = socket_name,
-                z_log = z_log,
-                z_log_filename = z_log_filename,
-                authentication = authentication,
-                storage = storage,
-                zeo_address = zeo_address,
-                pid_file = self.pid_file,
-                zeo_conf_additional = zeo_conf_additional,
-                monitor_address = monitor_address,
-                zeo_log_level = zeo_log_level,
-                read_only = read_only
-                )
+                instance_home=instance_home,
+                effective_user=effective_user,
+                invalidation_queue_size=invalidation_queue_size,
+                socket_name=socket_name,
+                z_log=z_log,
+                z_log_filename=z_log_filename,
+                authentication=authentication,
+                storage=storage,
+                zeo_address=zeo_address,
+                pid_file=self.pid_file,
+                zeo_conf_additional=zeo_conf_additional,
+                monitor_address=monitor_address,
+                zeo_log_level=zeo_log_level,
+                read_only=read_only
+            )
 
         zeo_conf_path = os.path.join(location, 'etc', 'zeo.conf')
         open(zeo_conf_path, 'w').write(zeo_conf)
@@ -314,11 +313,11 @@ def install_scripts(self):
         zc.buildout.easy_install.scripts(
             [(self.name, 'plone.recipe.zeoserver.ctl', 'main')],
             ws, options['executable'], options['bin-directory'],
-            initialization = '\n'.join(
+            initialization='\n'.join(
                 [initialization, options.get('initialization', ''), '']),
-            arguments = ('\n        ["-C", %r]'
-                         '\n        + sys.argv[1:]'
-                         % self.zeo_conf),
+            arguments=('\n        ["-C", %r]'
+                       '\n        + sys.argv[1:]'
+                       % self.zeo_conf),
             extra_paths=self.module_paths,
             relative_paths=self._relative_paths)
 
@@ -333,9 +332,9 @@ def install_scripts(self):
                     [('zeopack', os.path.splitext(filename)[0], 'main')],
                     ws, options['executable'], options['bin-directory'],
                     scripts=zeopack_scripts,
-                    extra_paths = ws + [directory] + self.module_paths,
+                    extra_paths=ws + [directory] + self.module_paths,
                     relative_paths=self._relative_paths,
-                    )
+                )
         else:
             host = port = socket_path = ''
             zeo_address = options.get('zeo-address', '8100')
@@ -399,7 +398,8 @@ def install_scripts(self):
                                )
 
             # Make sure the recipe itself and its dependencies are on the path
-            extra_paths = [ws.by_key[options['recipe'].replace('[zrs]', '')].location]
+            extra_paths = [
+                ws.by_key[options['recipe'].replace('[zrs]', '')].location]
             try:
                 extra_paths.append(ws.by_key['zc.buildout'].location)
             except KeyError:
@@ -414,7 +414,7 @@ def install_scripts(self):
                 arguments=', '.join(arg_list),
                 relative_paths=self._relative_paths,
                 extra_paths=extra_paths + self.module_paths,
-                )
+            )
 
         # The backup script, pointing to repozo.py
         repozo = options.get('repozo', None)
@@ -434,9 +434,9 @@ def install_scripts(self):
             [('repozo', repozo, 'main')],
             self.zodb_ws, options['executable'], options['bin-directory'],
             scripts=repozo_scripts,
-            extra_paths = extra_paths + self.module_paths,
+            extra_paths=extra_paths + self.module_paths,
             relative_paths=self._relative_paths,
-            )
+        )
 
         if sys.platform == 'win32':
             self.install_win32_scripts()
@@ -462,7 +462,7 @@ def install_win32_scripts(self):
         zeo_filename = '%s_service' % self.name
         zeo_service = open(join(curdir, 'zeoservice.py.in')).read()
         zeo_file = os.path.join(self.options['bin-directory'],
-                                    '%s.py' % zeo_filename)
+                                '%s.py' % zeo_filename)
         self._write_file(zeo_file, zeo_service % arguments)
 
         initialization = """
@@ -474,10 +474,10 @@ def install_win32_scripts(self):
             self.zodb_ws,
             self.options['executable'],
             self.options['bin-directory'],
-            extra_paths = path,
+            extra_paths=path,
             relative_paths=self._relative_paths,
-            initialization = initialization,
-            )
+            initialization=initialization,
+        )
 
     def _write_file(self, path, content):
         logger = logging.getLogger('zc.buildout.easy_install')
@@ -487,7 +487,7 @@ def _write_file(self, path, content):
         finally:
             f.close()
         logger.debug('Wrote file %s' % path)
-        os.chmod(path, 0755)
+        os.chmod(path, 0o755)
         logger.warning('Changed mode for %s to 755' % path)
 
 
diff --git a/src/plone/recipe/zeoserver/tests/test_docs.py b/src/plone/recipe/zeoserver/tests/test_docs.py
index aca3e89..5b0991e 100644
--- a/src/plone/recipe/zeoserver/tests/test_docs.py
+++ b/src/plone/recipe/zeoserver/tests/test_docs.py
@@ -47,6 +47,6 @@ def test_suite():
     flags = (doctest.ELLIPSIS | doctest.NORMALIZE_WHITESPACE)
 
     suite.append(doctest.DocFileSuite('zeoserver.txt', optionflags=flags,
-                 setUp=setUp, tearDown=buildoutTearDown))
+                                      setUp=setUp, tearDown=buildoutTearDown))
 
     return unittest.TestSuite(suite)


Repository: plone.recipe.zeoserver


Branch: refs/heads/master
Date: 2017-05-23T10:29:46+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.recipe.zeoserver/commit/3a815a6e1694e709bca265d135b9abff9c6bc03a

state changes

Files changed:
M CHANGES.rst
M src/plone/recipe/zeoserver/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d8dce09..736268b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Cleanup: utf8 headers, isort, pep8.
+  [jensens]
 
 
 1.3.1 (2017-04-08)
diff --git a/src/plone/recipe/zeoserver/__init__.py b/src/plone/recipe/zeoserver/__init__.py
index 736a21e..887505a 100644
--- a/src/plone/recipe/zeoserver/__init__.py
+++ b/src/plone/recipe/zeoserver/__init__.py
@@ -281,9 +281,11 @@ def patch_binaries(self):
         location = self.options['location']
         # XXX We need to patch the windows specific batch scripts
         # and they need a different path seperator
-        path = (os.path.pathsep.join(self.ws_locations)
-                + os.path.pathsep
-                + os.path.pathsep.join(self.module_paths))
+        path = (
+            os.path.pathsep.join(self.ws_locations) +
+            os.path.pathsep +
+            os.path.pathsep.join(self.module_paths)
+        )
 
         for script_name in ('runzeo', 'zeoctl'):
             script_path = os.path.join(location, 'bin', script_name)
@@ -304,9 +306,11 @@ def install_scripts(self):
 
         _, ws = self.egg.working_set(['plone.recipe.zeoserver'])
 
-        path = (os.path.pathsep.join(self.ws_locations)
-                + os.path.pathsep
-                + os.path.pathsep.join(self.module_paths))
+        path = (
+            os.path.pathsep.join(self.ws_locations) +
+            os.path.pathsep +
+            os.path.pathsep.join(self.module_paths)
+        )
         initialization = """
         import os; os.environ['PYTHONPATH'] = %r
         """.strip() % path


