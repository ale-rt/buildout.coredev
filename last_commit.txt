Repository: plone.app.caching


Branch: refs/heads/master
Date: 2016-06-20T20:03:22+02:00
Author: Diederik Veeze (didrix) <d.veeze@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.caching/commit/c0da422bc5265147cd888ac242237747d4a5a70d

Use plone.namedfile for testing

Files changed:
M plone/app/caching/tests/test_integration.py

diff --git a/plone/app/caching/tests/test_integration.py b/plone/app/caching/tests/test_integration.py
index 3db6b25..5aca104 100644
--- a/plone/app/caching/tests/test_integration.py
+++ b/plone/app/caching/tests/test_integration.py
@@ -15,6 +15,7 @@
 
 from zope.globalrequest import setRequest
 
+from plone.namedfile.file import NamedImage
 from plone.registry.interfaces import IRegistry
 from plone.caching.interfaces import ICacheSettings
 from plone.cachepurging.interfaces import ICachePurgingSettings
@@ -114,8 +115,8 @@ def test_disabled(self):
         self.portal['f1'].invokeFactory('Image', 'i1')
         self.portal['f1']['i1'].title = u"Image one"
         self.portal['f1']['i1'].description = u"Image one description"
-        self.portal['f1']['i1'].image = OFS.Image.Image(
-            'test.gif', 'test.gif', open(TEST_IMAGE, 'rb'))
+        self.portal['f1']['i1'].image = NamedImage(
+            open(TEST_IMAGE, 'rb'), 'image/gif', u'test.gif')
         self.portal['f1']['i1'].reindexObject()
 
         # Content file
@@ -135,6 +136,7 @@ def test_disabled(self):
         import transaction
         transaction.commit()
         browser = Browser(self.app)
+        browser.handleErrors = False
 
         # Check that we can open all without errors and without cache headers
         browser.open(self.portal.absolute_url())


