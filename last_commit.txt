Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2016-04-04T13:57:03+02:00
Author: Beno√Æt Suttor (bsuttor) <bsuttor@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.vocabularies/commit/b5f4c8c18e8adebca0c9c27c585255a3018e7284

Add images scales vocabulary to master

Add ImagesScales vocabulary:
* test for ImagesScales vocabulary
* doc new vocabulary in Readme
* new plone.app.imaging dependency
* translate image scale for vocabulary

Files changed:
A plone/app/vocabularies/images.py
A plone/app/vocabularies/tests/test_imagesvocabularies.py
M CHANGES.rst
M README.rst
M plone/app/vocabularies/configure.zcml
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3d203ec..a67001a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Incompatibilities:
 
 New:
 
-- *add item here*
+- Add ImagesScales vocabulary.
+  [bsuttor]
 
 Fixes:
 
diff --git a/README.rst b/README.rst
index 8188932..914baf5 100644
--- a/README.rst
+++ b/README.rst
@@ -142,6 +142,12 @@ Date/Time Related
 ``plone.app.vocabularies.MonthAbbr``
    same as above but with 3 character abbreviations.
 
+Images
+------
+
+``plone.app.vocabularies.ImagesScales``
+   All image scales which are avaiable on Plone site.
+
 
 Source Code
 ===========
diff --git a/plone/app/vocabularies/configure.zcml b/plone/app/vocabularies/configure.zcml
index 7dbc17b..b54ae7d 100644
--- a/plone/app/vocabularies/configure.zcml
+++ b/plone/app/vocabularies/configure.zcml
@@ -153,6 +153,12 @@
     name="plone.app.vocabularies.MonthAbbr"
     />
 
+  <utility
+    component=".images.ScalesVocabulary"
+    name="plone.app.vocabularies.ImagesScales"
+    />
+
+
   <!-- All source implementations will be deprecated -->
   <adapter
       for=".catalog.SearchableTextSource
diff --git a/plone/app/vocabularies/images.py b/plone/app/vocabularies/images.py
new file mode 100644
index 0000000..cd234d7
--- /dev/null
+++ b/plone/app/vocabularies/images.py
@@ -0,0 +1,24 @@
+# -*- coding: utf-8 -*-
+from plone.app.imaging.utils import getAllowedSizes
+from zope.i18nmessageid import MessageFactory
+from zope.interface import provider
+from zope.schema.interfaces import IVocabularyFactory
+from zope.schema.vocabulary import SimpleTerm
+from zope.schema.vocabulary import SimpleVocabulary
+
+_ = MessageFactory('plone')
+
+
+@provider(IVocabularyFactory)
+def ScalesVocabulary(context):
+    """Obtains available scales from plone.app.imaging
+    """
+    terms = []
+    for scale, (width, height) in getAllowedSizes().iteritems():
+        translated = _(
+            'imagescale_{0:s}'.format(scale),
+            default='{0:s} ${{width}}x${{height}}'.format(scale),
+            mapping={'width': str(width), 'height': str(height)})
+        terms.append(SimpleTerm(scale, scale, translated))
+
+    return SimpleVocabulary(terms)
diff --git a/plone/app/vocabularies/tests/test_imagesvocabularies.py b/plone/app/vocabularies/tests/test_imagesvocabularies.py
new file mode 100644
index 0000000..a6ab83e
--- /dev/null
+++ b/plone/app/vocabularies/tests/test_imagesvocabularies.py
@@ -0,0 +1,23 @@
+# -*- coding: utf-8 -*-
+from plone.app.vocabularies.testing import PAVocabularies_INTEGRATION_TESTING
+from plone.registry.interfaces import IRegistry
+from zope.component import getUtility
+from zope.schema.interfaces import IVocabularyFactory
+import unittest
+
+
+class ImagesTest(unittest.TestCase):
+    layer = PAVocabularies_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.portal = self.layer['portal']
+
+    def test_images_scales_vocabulary(self):
+        images_scales_voc = getUtility(
+            IVocabularyFactory,
+            'plone.app.vocabularies.ImagesScales'
+        )
+        scales_list = [item.value for item in images_scales_voc(self.portal)]
+        self.assertTrue('thumb' in scales_list)
+        self.assertTrue('large' in scales_list)
+        self.assertTrue('preview' in scales_list)
diff --git a/setup.py b/setup.py
index 9bf3ad2..19aba36 100644
--- a/setup.py
+++ b/setup.py
@@ -32,6 +32,7 @@
     install_requires=[
         'Acquisition',
         'plone.app.querystring',
+        'plone.app.imaging',
         'Products.CMFCore',
         'pytz',
         'setuptools',


