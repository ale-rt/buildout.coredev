Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2016-06-06T11:06:41+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/aabd2b1713023860b2139cbe013625d106b4170e

Added publishing patch from Products.PloneHotfix20160419.

This avoids publishing some methods inherited from Zope or CMF.

Files changed:
A Products/CMFPlone/patches/publishing.py
M CHANGES.rst
M Products/CMFPlone/patches/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d5b4251..c84250e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -41,10 +41,14 @@ New features:
 
 Bug fixes:
 
+- Added publishing patch from Products.PloneHotfix20160419.
+  This avoids publishing some methods inherited from Zope or CMF.  [maurits]
+
 - Fix issue where incorrectly configured formats would cause TinyMCE to error
   [vangheem]
 
 
+
 5.0.4 (2016-04-06)
 ------------------
 
diff --git a/Products/CMFPlone/patches/__init__.py b/Products/CMFPlone/patches/__init__.py
index 30becca..ec14a45 100644
--- a/Products/CMFPlone/patches/__init__.py
+++ b/Products/CMFPlone/patches/__init__.py
@@ -27,3 +27,5 @@
 
 import templatecookcheck        # Make sure templates aren't re-read in
 # production sites
+
+import publishing
diff --git a/Products/CMFPlone/patches/publishing.py b/Products/CMFPlone/patches/publishing.py
new file mode 100644
index 0000000..3eae7e0
--- /dev/null
+++ b/Products/CMFPlone/patches/publishing.py
@@ -0,0 +1,64 @@
+# From Products.PloneHotfix20160419
+from OFS.ZDOM import Document
+from OFS.ZDOM import Node
+from Products.CMFPlone.Portal import PloneSite
+
+
+try:
+    from plone.dexterity.content import Item
+    from plone.dexterity.content import Container
+except ImportError:
+    class Item(object):
+        pass
+
+    class Container(object):
+        pass
+
+try:
+    from Products.ATContentTypes.content.base import ATCTContent
+    from Products.ATContentTypes.content.base import ATCTBTreeFolder
+except ImportError:
+
+    class ATCTContent(object):
+        pass
+
+    class ATCTBTreeFolder(object):
+        pass
+
+
+klasses = (
+    Node,
+    Document,
+    PloneSite,
+    Item,
+    Container,
+    ATCTContent,
+    ATCTBTreeFolder
+)
+methods = (
+    'EffectiveDate',
+    'ExpirationDate',
+    'getAttributes',
+    'getChildNodes',
+    'getFirstChild',
+    'getLastChild',
+    'getLayout',
+    'getNextSibling',
+    'getNodeName',
+    'getNodeType',
+    'getNodeValue',
+    'getOwnerDocument',
+    'getParentNode',
+    'getPhysicalPath',
+    'getPreviousSibling',
+    'getTagName',
+    'hasChildNodes',
+    'Type'
+)
+
+for klass in klasses:
+    for method_name in methods:
+        method = getattr(klass, method_name, None)
+        if (method is not None and hasattr(method, 'im_func') and
+                hasattr(method.im_func, '__doc__')):
+            del method.im_func.__doc__


Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2016-06-06T20:52:49+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/d951034e5a00a9bd3c181d199e56fba52a712c0f

Merge pull request #1625 from plone/maurits-hotfix-20160419-zope-cmf-50

Added publishing patch from Products.PloneHotfix20160419. [5.0]

Files changed:
A Products/CMFPlone/patches/publishing.py
M CHANGES.rst
M Products/CMFPlone/patches/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d5b4251..c84250e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -41,10 +41,14 @@ New features:
 
 Bug fixes:
 
+- Added publishing patch from Products.PloneHotfix20160419.
+  This avoids publishing some methods inherited from Zope or CMF.  [maurits]
+
 - Fix issue where incorrectly configured formats would cause TinyMCE to error
   [vangheem]
 
 
+
 5.0.4 (2016-04-06)
 ------------------
 
diff --git a/Products/CMFPlone/patches/__init__.py b/Products/CMFPlone/patches/__init__.py
index 30becca..ec14a45 100644
--- a/Products/CMFPlone/patches/__init__.py
+++ b/Products/CMFPlone/patches/__init__.py
@@ -27,3 +27,5 @@
 
 import templatecookcheck        # Make sure templates aren't re-read in
 # production sites
+
+import publishing
diff --git a/Products/CMFPlone/patches/publishing.py b/Products/CMFPlone/patches/publishing.py
new file mode 100644
index 0000000..3eae7e0
--- /dev/null
+++ b/Products/CMFPlone/patches/publishing.py
@@ -0,0 +1,64 @@
+# From Products.PloneHotfix20160419
+from OFS.ZDOM import Document
+from OFS.ZDOM import Node
+from Products.CMFPlone.Portal import PloneSite
+
+
+try:
+    from plone.dexterity.content import Item
+    from plone.dexterity.content import Container
+except ImportError:
+    class Item(object):
+        pass
+
+    class Container(object):
+        pass
+
+try:
+    from Products.ATContentTypes.content.base import ATCTContent
+    from Products.ATContentTypes.content.base import ATCTBTreeFolder
+except ImportError:
+
+    class ATCTContent(object):
+        pass
+
+    class ATCTBTreeFolder(object):
+        pass
+
+
+klasses = (
+    Node,
+    Document,
+    PloneSite,
+    Item,
+    Container,
+    ATCTContent,
+    ATCTBTreeFolder
+)
+methods = (
+    'EffectiveDate',
+    'ExpirationDate',
+    'getAttributes',
+    'getChildNodes',
+    'getFirstChild',
+    'getLastChild',
+    'getLayout',
+    'getNextSibling',
+    'getNodeName',
+    'getNodeType',
+    'getNodeValue',
+    'getOwnerDocument',
+    'getParentNode',
+    'getPhysicalPath',
+    'getPreviousSibling',
+    'getTagName',
+    'hasChildNodes',
+    'Type'
+)
+
+for klass in klasses:
+    for method_name in methods:
+        method = getattr(klass, method_name, None)
+        if (method is not None and hasattr(method, 'im_func') and
+                hasattr(method.im_func, '__doc__')):
+            del method.im_func.__doc__


