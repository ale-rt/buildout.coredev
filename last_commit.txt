Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2016-06-06T10:58:35+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e9e1793a85f1b88bd9058261392b24b520f6fa1b

Added publishing patch from Products.PloneHotfix20160419.

This avoids publishing some methods inherited from Zope or CMF.

Files changed:
A Products/CMFPlone/patches/publishing.py
M Products/CMFPlone/patches/__init__.py
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/patches/__init__.py b/Products/CMFPlone/patches/__init__.py
index 4c80d4d..fd661fe 100644
--- a/Products/CMFPlone/patches/__init__.py
+++ b/Products/CMFPlone/patches/__init__.py
@@ -31,4 +31,5 @@
 except ImportError:
     pass
 
-import addMember
\ No newline at end of file
+import addMember
+import publishing
diff --git a/Products/CMFPlone/patches/publishing.py b/Products/CMFPlone/patches/publishing.py
new file mode 100644
index 0000000..3eae7e0
--- /dev/null
+++ b/Products/CMFPlone/patches/publishing.py
@@ -0,0 +1,64 @@
+# From Products.PloneHotfix20160419
+from OFS.ZDOM import Document
+from OFS.ZDOM import Node
+from Products.CMFPlone.Portal import PloneSite
+
+
+try:
+    from plone.dexterity.content import Item
+    from plone.dexterity.content import Container
+except ImportError:
+    class Item(object):
+        pass
+
+    class Container(object):
+        pass
+
+try:
+    from Products.ATContentTypes.content.base import ATCTContent
+    from Products.ATContentTypes.content.base import ATCTBTreeFolder
+except ImportError:
+
+    class ATCTContent(object):
+        pass
+
+    class ATCTBTreeFolder(object):
+        pass
+
+
+klasses = (
+    Node,
+    Document,
+    PloneSite,
+    Item,
+    Container,
+    ATCTContent,
+    ATCTBTreeFolder
+)
+methods = (
+    'EffectiveDate',
+    'ExpirationDate',
+    'getAttributes',
+    'getChildNodes',
+    'getFirstChild',
+    'getLastChild',
+    'getLayout',
+    'getNextSibling',
+    'getNodeName',
+    'getNodeType',
+    'getNodeValue',
+    'getOwnerDocument',
+    'getParentNode',
+    'getPhysicalPath',
+    'getPreviousSibling',
+    'getTagName',
+    'hasChildNodes',
+    'Type'
+)
+
+for klass in klasses:
+    for method_name in methods:
+        method = getattr(klass, method_name, None)
+        if (method is not None and hasattr(method, 'im_func') and
+                hasattr(method.im_func, '__doc__')):
+            del method.im_func.__doc__
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 5f15872..5abde8b 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -14,6 +14,9 @@ Changelog
 
 Fixes:
 
+- Added publishing patch from Products.PloneHotfix20160419.
+  This avoids publishing some methods inherited from Zope or CMF.  [maurits]
+
 - Removed docstrings from some methods to avoid publishing them.  [maurits]
 
 - Ensured front-page is English when creating an English site.


Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2016-06-06T20:52:27+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/da0d411e804df371152a9cfca42b07bebd4e8bc5

Merge pull request #1624 from plone/maurits-hotfix-20160419-zope-cmf-43

Added publishing patch from Products.PloneHotfix20160419. [4.3]

Files changed:
A Products/CMFPlone/patches/publishing.py
M Products/CMFPlone/patches/__init__.py
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/patches/__init__.py b/Products/CMFPlone/patches/__init__.py
index 4c80d4d..fd661fe 100644
--- a/Products/CMFPlone/patches/__init__.py
+++ b/Products/CMFPlone/patches/__init__.py
@@ -31,4 +31,5 @@
 except ImportError:
     pass
 
-import addMember
\ No newline at end of file
+import addMember
+import publishing
diff --git a/Products/CMFPlone/patches/publishing.py b/Products/CMFPlone/patches/publishing.py
new file mode 100644
index 0000000..3eae7e0
--- /dev/null
+++ b/Products/CMFPlone/patches/publishing.py
@@ -0,0 +1,64 @@
+# From Products.PloneHotfix20160419
+from OFS.ZDOM import Document
+from OFS.ZDOM import Node
+from Products.CMFPlone.Portal import PloneSite
+
+
+try:
+    from plone.dexterity.content import Item
+    from plone.dexterity.content import Container
+except ImportError:
+    class Item(object):
+        pass
+
+    class Container(object):
+        pass
+
+try:
+    from Products.ATContentTypes.content.base import ATCTContent
+    from Products.ATContentTypes.content.base import ATCTBTreeFolder
+except ImportError:
+
+    class ATCTContent(object):
+        pass
+
+    class ATCTBTreeFolder(object):
+        pass
+
+
+klasses = (
+    Node,
+    Document,
+    PloneSite,
+    Item,
+    Container,
+    ATCTContent,
+    ATCTBTreeFolder
+)
+methods = (
+    'EffectiveDate',
+    'ExpirationDate',
+    'getAttributes',
+    'getChildNodes',
+    'getFirstChild',
+    'getLastChild',
+    'getLayout',
+    'getNextSibling',
+    'getNodeName',
+    'getNodeType',
+    'getNodeValue',
+    'getOwnerDocument',
+    'getParentNode',
+    'getPhysicalPath',
+    'getPreviousSibling',
+    'getTagName',
+    'hasChildNodes',
+    'Type'
+)
+
+for klass in klasses:
+    for method_name in methods:
+        method = getattr(klass, method_name, None)
+        if (method is not None and hasattr(method, 'im_func') and
+                hasattr(method.im_func, '__doc__')):
+            del method.im_func.__doc__
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 5f15872..5abde8b 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -14,6 +14,9 @@ Changelog
 
 Fixes:
 
+- Added publishing patch from Products.PloneHotfix20160419.
+  This avoids publishing some methods inherited from Zope or CMF.  [maurits]
+
 - Removed docstrings from some methods to avoid publishing them.  [maurits]
 
 - Ensured front-page is English when creating an English site.


