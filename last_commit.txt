Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-03-27T19:20:36-03:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/dcae8acff86466abcb7e0749f5accd8f2a7d878a

Update twitter_username, facebook_app_id and facebook_username field values as they are now declared as ASCIILine instead of TextLine

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 6f9d70c..94d8b15 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,7 +16,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Update ``twitter_username``, ``facebook_app_id`` and ``facebook_username`` field values as they are now declared as ``ASCIILine`` instead of ``TextLine``.
+  [hvelarde]
 
 
 2.0.1 (2017-03-09)
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index a81f078..d003ad1 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -117,3 +117,17 @@ def remove_displayContentsTab_from_action_expressions(context):
         logger.warn('Action at %s references removed script %s in available. '
                     'expression %r. Please change it',
                     path, text, ac.available_expr)
+
+
+def update_social_media_fields(context):
+    """Update twitter_username, facebook_app_id and facebook_username
+    field values as they are now declared as ASCIILine instead of
+    TextLine.
+    """
+    from Products.CMFPlone.interfaces.controlpanel import ISocialMediaSchema
+    registry = getUtility(IRegistry)
+    settings = registry.forInterface(ISocialMediaSchema, prefix='plone')
+    settings.twitter_username = str(settings.twitter_username)
+    settings.facebook_app_id = str(settings.facebook_app_id)
+    settings.facebook_username = str(settings.facebook_username)
+    logger.log(logging.INFO, 'Field types updated on social media schema')
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index d6c018a..e890051 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -120,6 +120,12 @@ Add image scaling options to image handling control panel.
             import_profile="plone.app.upgrade.v51:to51beta3"
             />
 
+        <gs:upgradeStep
+            title="Update social media fields"
+            description=""
+            handler="betas.update_social_media_fields"
+            />
+
     </gs:upgradeSteps>
 
 </configure>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-03-28T10:20:33-03:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/f8d4dfdea307c8a0491731b23f1a8deaa8c14ed4

Fix typo

Files changed:
M plone/app/upgrade/v51/configure.zcml

diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index e890051..f714645 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -123,7 +123,7 @@ Add image scaling options to image handling control panel.
         <gs:upgradeStep
             title="Update social media fields"
             description=""
-            handler="betas.update_social_media_fields"
+            handler=".betas.update_social_media_fields"
             />
 
     </gs:upgradeSteps>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-03-29T07:01:07+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/76b4ffddb1d3b1b0dbfd64c2c09132366a11f57e

Merge pull request #107 from plone/cmfplone_issue_1967

Update social media field values

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 6f9d70c..94d8b15 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,7 +16,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Update ``twitter_username``, ``facebook_app_id`` and ``facebook_username`` field values as they are now declared as ``ASCIILine`` instead of ``TextLine``.
+  [hvelarde]
 
 
 2.0.1 (2017-03-09)
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index a81f078..d003ad1 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -117,3 +117,17 @@ def remove_displayContentsTab_from_action_expressions(context):
         logger.warn('Action at %s references removed script %s in available. '
                     'expression %r. Please change it',
                     path, text, ac.available_expr)
+
+
+def update_social_media_fields(context):
+    """Update twitter_username, facebook_app_id and facebook_username
+    field values as they are now declared as ASCIILine instead of
+    TextLine.
+    """
+    from Products.CMFPlone.interfaces.controlpanel import ISocialMediaSchema
+    registry = getUtility(IRegistry)
+    settings = registry.forInterface(ISocialMediaSchema, prefix='plone')
+    settings.twitter_username = str(settings.twitter_username)
+    settings.facebook_app_id = str(settings.facebook_app_id)
+    settings.facebook_username = str(settings.facebook_username)
+    logger.log(logging.INFO, 'Field types updated on social media schema')
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index d6c018a..f714645 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -120,6 +120,12 @@ Add image scaling options to image handling control panel.
             import_profile="plone.app.upgrade.v51:to51beta3"
             />
 
+        <gs:upgradeStep
+            title="Update social media fields"
+            description=""
+            handler=".betas.update_social_media_fields"
+            />
+
     </gs:upgradeSteps>
 
 </configure>


