Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2016-06-20T18:24:43+02:00
Author: Ida Ebkes (ida) <contact@ida-ebkes.eu>
Commit: https://github.com/plone/Products.CMFPlone/commit/050be5eda75d458c69aa3c14957e8d923abcc102

Correct formTabs-links, fixes #1640.

Files changed:
M Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js b/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
index a511359..f564f03 100644
--- a/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
+++ b/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
@@ -51,7 +51,8 @@ ploneFormTabbing._buildTabs = function(container, legends) {
             tab = '<option '+className+' id="'+lid+'" value="'+lid+'">';
             tab += $(legend).text()+'</option>';
         } else {
-            tab = '<li '+className+'><a id="'+lid+'" href="#'+lid+'"><span>';
+            tab = '<li ' + className + '><a id="'+ lid + '" href="';
+            tab += window.location.href + '#' + lid + '"><span>';
             tab += $(legend).text()+'</span></a></li>';
         }
 
@@ -159,7 +160,7 @@ $.fn.ploneTabInit = function(pbo) {
         item.find("dl.enableFormTabbing").each(ploneFormTabbing.initializeDL);
 
         //Select tab if it's part of the URL or designated in a hidden input
-        var targetPane = item.find('.enableFormTabbing input[name="fieldset"]').val() || window.location.hash;
+        var targetPane = window.location.hash || item.find('.enableFormTabbing input[name="fieldset"]').val();
         if (targetPane) {
             item.find('.enableFormTabbing .formTabs [id="' +
              targetPane.replace('#','').replace('"', '').replace(/^fieldset-/, "fieldsetlegend-") + '"]').click();
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 2894efb..9153728 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -14,6 +14,10 @@ Changelog
 
 Fixes:
 
+- Render correct links in form-tabs, so they can be opened with a
+  right mouse-click and regard if hash is in URL. Fixes #1640.
+  [ida]
+
 - jquery.highlightsearchterms.js was skipping words that simply *contains* reserved ``filterTerms`` terms.
    [keul]
 


Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2016-06-21T12:07:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/f635a80c7bf4131aebb72960e55d6239cfd98182

Merge pull request #1643 from ida/4.3.x

Correct formTabs-links, fixes #1640.

Files changed:
M Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js b/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
index a511359..f564f03 100644
--- a/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
+++ b/Products/CMFPlone/skins/plone_ecmascript/form_tabbing.js
@@ -51,7 +51,8 @@ ploneFormTabbing._buildTabs = function(container, legends) {
             tab = '<option '+className+' id="'+lid+'" value="'+lid+'">';
             tab += $(legend).text()+'</option>';
         } else {
-            tab = '<li '+className+'><a id="'+lid+'" href="#'+lid+'"><span>';
+            tab = '<li ' + className + '><a id="'+ lid + '" href="';
+            tab += window.location.href + '#' + lid + '"><span>';
             tab += $(legend).text()+'</span></a></li>';
         }
 
@@ -159,7 +160,7 @@ $.fn.ploneTabInit = function(pbo) {
         item.find("dl.enableFormTabbing").each(ploneFormTabbing.initializeDL);
 
         //Select tab if it's part of the URL or designated in a hidden input
-        var targetPane = item.find('.enableFormTabbing input[name="fieldset"]').val() || window.location.hash;
+        var targetPane = window.location.hash || item.find('.enableFormTabbing input[name="fieldset"]').val();
         if (targetPane) {
             item.find('.enableFormTabbing .formTabs [id="' +
              targetPane.replace('#','').replace('"', '').replace(/^fieldset-/, "fieldsetlegend-") + '"]').click();
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 30e4a1f..a2d7303 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -14,6 +14,10 @@ Changelog
 
 Fixes:
 
+- Render correct links in form-tabs, so they can be opened with a
+  right mouse-click and regard if hash is in URL. Fixes #1640.
+  [ida]
+
 - jquery.highlightsearchterms.js was skipping words that simply *contains* reserved ``filterTerms`` terms.
   [keul]
 


