Repository: Products.LinguaPlone


Branch: refs/heads/master
Date: 2017-03-24T23:39:48+01:00
Author: Harald Friessnegger (frisi) <harald@webmeisterei.com>
Commit: https://github.com/plone/Products.LinguaPlone/commit/1e385c456a21958a5257bb94598649e2290a7fb3

fix translation menu for combined language codes

Files changed:
M CHANGES.rst
M Products/LinguaPlone/browser/menu.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a500662..ae601af 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix translation menu for combined language codes [fRiSi]
 
 
 4.2 (2017-03-09)
diff --git a/Products/LinguaPlone/browser/menu.py b/Products/LinguaPlone/browser/menu.py
index 414aab3..25c0f50 100644
--- a/Products/LinguaPlone/browser/menu.py
+++ b/Products/LinguaPlone/browser/menu.py
@@ -1,7 +1,7 @@
 from plone.browserlayer.utils import registered_layers
 from zope.interface import implementer
 from zope.component import queryUtility
-from Products.CMFCore.permissions import AddPortalContent, ModifyPortalContent,\
+from Products.CMFCore.permissions import AddPortalContent, ModifyPortalContent, \
     DeleteObjects
 
 # BBB Zope 2.12
@@ -46,26 +46,26 @@ def getMenuItems(self, context, request):
         if not (can_translate or can_set_language or can_delete):
             return []
 
-        lang_util = queryUtility(IContentLanguageAvailability)        
+        lang_util = queryUtility(IContentLanguageAvailability)
         if lang_util is not None:
-            all_languages_dict = lang_util.getLanguages()
+            all_languages_dict = lang_util.getLanguages(combined=lt.use_combined_language_codes)
 
         langs = self.getUntranslatedLanguages(context)
         if can_translate:
             showflags = lt.showFlags()
 
             for (lang_id, lang_name) in langs:
-                if lang_util is not None:                    
+                if lang_util is not None:
                     lang_info = all_languages_dict.get(lang_id, {})
                     lang_name = lang_info.get('native', '') or lang_info.get('name')
 
-                icon=showflags and lt.getFlagForLanguageCode(lang_id) or None
-                item={
+                icon = showflags and lt.getFlagForLanguageCode(lang_id) or None
+                item = {
                     "title": lang_name,
                     "description": _(u"title_translate_into",
                                      default=u"Translate into ${lang_name}",
                                      mapping={"lang_name": lang_name}),
-                    "action": url+"/@@translate?newlanguage=%s" % lang_id,
+                    "action": url + "/@@translate?newlanguage=%s" % lang_id,
                     "selected": False,
                     "icon": icon,
                     "extra": {"id": "translate_into_%s" % lang_id,
@@ -83,7 +83,7 @@ def getMenuItems(self, context, request):
                 "title": _(u"label_manage_translations",
                            default=u"Manage translations..."),
                 "description": u"",
-                "action": url+"/manage_translations_form",
+                "action": url + "/manage_translations_form",
                 "selected": False,
                 "icon": None,
                 "extra": {"id": "_manage_translations",


Repository: Products.LinguaPlone


Branch: refs/heads/master
Date: 2017-04-03T11:45:53+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.LinguaPlone/commit/a74354818694c023d384f3682545a8e4fa20264f

Merge pull request #25 from plone/fix-combined-language-codes

fix translation menu for combined language codes

Files changed:
M CHANGES.rst
M Products/LinguaPlone/browser/menu.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a500662..ae601af 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix translation menu for combined language codes [fRiSi]
 
 
 4.2 (2017-03-09)
diff --git a/Products/LinguaPlone/browser/menu.py b/Products/LinguaPlone/browser/menu.py
index 414aab3..25c0f50 100644
--- a/Products/LinguaPlone/browser/menu.py
+++ b/Products/LinguaPlone/browser/menu.py
@@ -1,7 +1,7 @@
 from plone.browserlayer.utils import registered_layers
 from zope.interface import implementer
 from zope.component import queryUtility
-from Products.CMFCore.permissions import AddPortalContent, ModifyPortalContent,\
+from Products.CMFCore.permissions import AddPortalContent, ModifyPortalContent, \
     DeleteObjects
 
 # BBB Zope 2.12
@@ -46,26 +46,26 @@ def getMenuItems(self, context, request):
         if not (can_translate or can_set_language or can_delete):
             return []
 
-        lang_util = queryUtility(IContentLanguageAvailability)        
+        lang_util = queryUtility(IContentLanguageAvailability)
         if lang_util is not None:
-            all_languages_dict = lang_util.getLanguages()
+            all_languages_dict = lang_util.getLanguages(combined=lt.use_combined_language_codes)
 
         langs = self.getUntranslatedLanguages(context)
         if can_translate:
             showflags = lt.showFlags()
 
             for (lang_id, lang_name) in langs:
-                if lang_util is not None:                    
+                if lang_util is not None:
                     lang_info = all_languages_dict.get(lang_id, {})
                     lang_name = lang_info.get('native', '') or lang_info.get('name')
 
-                icon=showflags and lt.getFlagForLanguageCode(lang_id) or None
-                item={
+                icon = showflags and lt.getFlagForLanguageCode(lang_id) or None
+                item = {
                     "title": lang_name,
                     "description": _(u"title_translate_into",
                                      default=u"Translate into ${lang_name}",
                                      mapping={"lang_name": lang_name}),
-                    "action": url+"/@@translate?newlanguage=%s" % lang_id,
+                    "action": url + "/@@translate?newlanguage=%s" % lang_id,
                     "selected": False,
                     "icon": icon,
                     "extra": {"id": "translate_into_%s" % lang_id,
@@ -83,7 +83,7 @@ def getMenuItems(self, context, request):
                 "title": _(u"label_manage_translations",
                            default=u"Manage translations..."),
                 "description": u"",
-                "action": url+"/manage_translations_form",
+                "action": url + "/manage_translations_form",
                 "selected": False,
                 "icon": None,
                 "extra": {"id": "_manage_translations",


