Repository: Products.CMFPlone


Branch: refs/heads/5.0.x
Date: 2016-05-21T22:47:55+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/9dcb4d269798e3596726b265b340fe2f18d359bf

Supported 'remove' keyword for configlets in controlpanel.xml.

Files changed:
M CHANGES.rst
M Products/CMFPlone/exportimport/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e15cb41..f74545b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,6 +21,10 @@ Fixes:
 - Fix issue where incorrectly configured formats would cause TinyMCE to error
   [vangheem]
 
+New:
+
+- Supported ``remove`` keyword for configlets in controlpanel.xml.  [maurits]
+
 - Fixed displaying the body text of a feed item.  This is when
   ``render_body`` is switched on in the Syndication settings.
   [maurits]
diff --git a/Products/CMFPlone/exportimport/controlpanel.py b/Products/CMFPlone/exportimport/controlpanel.py
index cac7675..ecf8107 100644
--- a/Products/CMFPlone/exportimport/controlpanel.py
+++ b/Products/CMFPlone/exportimport/controlpanel.py
@@ -113,6 +113,12 @@ def _initConfiglets(self, node):
                 domain = default_domain
 
             action_id = str(child.getAttribute('action_id'))
+            # Remove previous action with same id and category.
+            controlpanel.unregisterConfiglet(action_id)
+            remove = str(child.getAttribute('remove'))
+            if remove.lower() == 'true':
+                continue
+
             title = Message(str(child.getAttribute('title')), domain=domain)
             url_expr = str(child.getAttribute('url_expr'))
             condition_expr = str(child.getAttribute('condition_expr'))
@@ -137,9 +143,6 @@ def _initConfiglets(self, node):
                     if permission:
                         break
 
-            # Remove previous action with same id and category.
-            controlpanel.unregisterConfiglet(action_id)
-
             controlpanel.registerConfiglet(id=action_id,
                                            name=title,
                                            action=url_expr,


