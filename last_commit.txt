Repository: plone.dexterity


Branch: refs/heads/master
Date: 2017-10-20T16:13:06+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.dexterity/commit/f67c5deba0a3755a9be9a208182819b15a35006d

fix tests

Files changed:
M CHANGES.rst
M plone/dexterity/tests/test_content.py
M plone/dexterity/tests/test_webdav.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1a75ea8..4d70212 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix tests on Zope 4. [davisagli]
 
 
 2.5.3 (2017-10-17)
diff --git a/plone/dexterity/tests/test_content.py b/plone/dexterity/tests/test_content.py
index e9102a1..8b746fb 100644
--- a/plone/dexterity/tests/test_content.py
+++ b/plone/dexterity/tests/test_content.py
@@ -15,6 +15,7 @@
 from plone.dexterity.interfaces import IDexterityFTI
 from plone.dexterity.schema import SCHEMA_CACHE
 from plone.folder.default import DefaultOrdering
+from Products.CMFCore.interfaces import ITypesTool
 from pytz import timezone
 from zope.annotation.attribute import AttributeAnnotations
 from zope.component import getUtility
@@ -1060,6 +1061,7 @@ def test_verifyObjectPaste_fti_does_not_allow_content(self):
         mock_pt = Mock()
         mock_pt.getTypeInfo = Mock(return_value=None)
         self.mock_tool(mock_pt, 'portal_types')
+        self.mock_utility(mock_pt, ITypesTool)
 
         self.assertRaises(
             ValueError,
@@ -1088,5 +1090,6 @@ def test_verifyObjectPaste_fti_does_allow_content(self):
         mock_pt = Mock()
         mock_pt.getTypeInfo = Mock(return_value=None)
         self.mock_tool(mock_pt, 'portal_types')
+        self.mock_utility(mock_pt, ITypesTool)
 
         container._verifyObjectPaste(content, True)
diff --git a/plone/dexterity/tests/test_webdav.py b/plone/dexterity/tests/test_webdav.py
index db71a2a..05ad573 100644
--- a/plone/dexterity/tests/test_webdav.py
+++ b/plone/dexterity/tests/test_webdav.py
@@ -455,7 +455,8 @@ def content_type(self):
             'close',
             response.getHeader('Connection', literal=True)
         )
-        self.assertEqual('text/foo', response.getHeader('Content-Type'))
+        self.assertTrue(
+            response.getHeader('Content-Type').startswith('text/foo'))
         self.assertEqual('10', response.getHeader('Content-Length'))
 
     def test_OPTIONS(self):


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2017-10-21T11:45:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/85f5698ffee7e15e1620dbc3aa2387d4f92bd30e

Merge pull request #73 from plone/plonezope4

fix tests

Files changed:
M CHANGES.rst
M plone/dexterity/tests/test_content.py
M plone/dexterity/tests/test_webdav.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1a75ea8..4d70212 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix tests on Zope 4. [davisagli]
 
 
 2.5.3 (2017-10-17)
diff --git a/plone/dexterity/tests/test_content.py b/plone/dexterity/tests/test_content.py
index e9102a1..8b746fb 100644
--- a/plone/dexterity/tests/test_content.py
+++ b/plone/dexterity/tests/test_content.py
@@ -15,6 +15,7 @@
 from plone.dexterity.interfaces import IDexterityFTI
 from plone.dexterity.schema import SCHEMA_CACHE
 from plone.folder.default import DefaultOrdering
+from Products.CMFCore.interfaces import ITypesTool
 from pytz import timezone
 from zope.annotation.attribute import AttributeAnnotations
 from zope.component import getUtility
@@ -1060,6 +1061,7 @@ def test_verifyObjectPaste_fti_does_not_allow_content(self):
         mock_pt = Mock()
         mock_pt.getTypeInfo = Mock(return_value=None)
         self.mock_tool(mock_pt, 'portal_types')
+        self.mock_utility(mock_pt, ITypesTool)
 
         self.assertRaises(
             ValueError,
@@ -1088,5 +1090,6 @@ def test_verifyObjectPaste_fti_does_allow_content(self):
         mock_pt = Mock()
         mock_pt.getTypeInfo = Mock(return_value=None)
         self.mock_tool(mock_pt, 'portal_types')
+        self.mock_utility(mock_pt, ITypesTool)
 
         container._verifyObjectPaste(content, True)
diff --git a/plone/dexterity/tests/test_webdav.py b/plone/dexterity/tests/test_webdav.py
index db71a2a..05ad573 100644
--- a/plone/dexterity/tests/test_webdav.py
+++ b/plone/dexterity/tests/test_webdav.py
@@ -455,7 +455,8 @@ def content_type(self):
             'close',
             response.getHeader('Connection', literal=True)
         )
-        self.assertEqual('text/foo', response.getHeader('Content-Type'))
+        self.assertTrue(
+            response.getHeader('Content-Type').startswith('text/foo'))
         self.assertEqual('10', response.getHeader('Content-Length'))
 
     def test_OPTIONS(self):


