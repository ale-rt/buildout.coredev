Repository: mockup


Branch: refs/heads/master
Date: 2017-11-06T15:29:00+01:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/mockup/commit/f187d544608079ec7de83dbb75c39df3a39b9dab

Allow more flexible anchors in TinyMCE

Files changed:
M mockup/patterns/tinymce/js/links.js

diff --git a/mockup/patterns/tinymce/js/links.js b/mockup/patterns/tinymce/js/links.js
index 0896d58d..e82dbcfe 100644
--- a/mockup/patterns/tinymce/js/links.js
+++ b/mockup/patterns/tinymce/js/links.js
@@ -224,7 +224,7 @@ define([
       self.anchorData = [];
       var node, i, j, name, title;
 
-      var nodes = self.tiny.dom.select('a.mceItemAnchor,img.mceItemAnchor,a.mce-item-anchor,img.mce-item-anchor');
+      var nodes = self.tiny.dom.select('.mceItemAnchor,.mce-item-anchor');
       for (i = 0; i < nodes.length; i = i + 1) {
         node = nodes[i];
         name = self.tiny.dom.getAttrib(node, 'name');


Repository: mockup


Branch: refs/heads/master
Date: 2017-11-06T15:37:46+01:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/mockup/commit/a3665698b64df0afae3474656828f432804bf873

Document changes

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index ac295d8e..fabc0ce6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,11 @@ New features:
   - Added options to change sorting.
   [Gagaro]
 
+- TinyMCE pattern:
+
+  - Make anchor handling more flexible
+  [tomgross]
+
 Bug fixes:
 
 - Structure pattern:


Repository: mockup


Branch: refs/heads/master
Date: 2017-11-14T14:34:42+01:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/mockup/commit/54f9a2dc8d3285ae96a1d31ecb5224486a3f762e

Merge branch 'master' into flexible_anchors

Files changed:
M CHANGES.rst
M mockup/patterns/markspeciallinks/pattern.js
M mockup/patterns/querystring/pattern.js
M mockup/patterns/relateditems/pattern.js
M mockup/tests/pattern-markspeciallinks-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index fabc0ce6..87d638ef 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -22,9 +22,19 @@ New features:
 
   - Make anchor handling more flexible
   [tomgross]
+  
+  - Mark special links
+  - Do not mark anchors as special links
+  [frapell]
 
 Bug fixes:
 
+- Related items widget: Fix case, where ``initSelection`` broke on an error in Select2.
+  [thet]
+
+- Querystring pattern: Fix #716, where the path-depth was added to string values like the title when a path criteria was present.
+  [thet]
+
 - Structure pattern:
 
   - Set default page icon on item row. Fixes: https://github.com/plone/Products.CMFPlone/issues/2131
diff --git a/mockup/patterns/markspeciallinks/pattern.js b/mockup/patterns/markspeciallinks/pattern.js
index 6a0217f7..e98e5e3f 100644
--- a/mockup/patterns/markspeciallinks/pattern.js
+++ b/mockup/patterns/markspeciallinks/pattern.js
@@ -135,11 +135,11 @@ define([
         // All links without an http href (without the link-plain class), not within this site,
         // and no img children should be wrapped in a link-[protocol] span
         contentarea.find(
-            'a[href]:not([href^="http:"]):not(.link-plain):not([href^="' + url + '"]):not(:has(img))')
+            'a[href]:not([href^="http:"]):not(.link-plain):not([href^="' + url + '"]):not(:has(img)):not([href^="#"])')
             .each(function() {
                 // those without a http link may have another interesting protocol
                 // wrap these in a link-[protocol] span
-                res = protocols.exec(this.href);
+                res = protocols.exec($(this).attr('href'));
                 if (res) {
                     var iconclass = 'glyphicon link-' + res[0];
                     $(this).before('<i class="' + iconclass + '"></i>');
diff --git a/mockup/patterns/querystring/pattern.js b/mockup/patterns/querystring/pattern.js
index 58139405..ca6b2bd9 100644
--- a/mockup/patterns/querystring/pattern.js
+++ b/mockup/patterns/querystring/pattern.js
@@ -608,7 +608,7 @@ define([
       }
       else if (typeof self.$value !== 'undefined') {
         var value = self.$value.val();
-        if(typeof(value) === 'string'){
+        if(ival === 'path' && value) {
           var depth = self.getDepthString();
           if(depth){
             value += depth;
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 9be8bc91..1b7d348b 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -588,15 +588,23 @@ define([
                 prev[item.UID] = item;
                 return prev;
               }, {});
-              callback(
-                ids
-                .map(function(uid) {
-                  return results[uid];
-                })
-                .filter(function(item) {
-                  return item !== undefined;
-                })
-              );
+
+              try {
+                callback(
+                  ids
+                  .map(function(uid) {
+                    return results[uid];
+                  })
+                  .filter(function(item) {
+                    return item !== undefined;
+                  })
+                );
+              } catch (e) {
+                // Select2 3.5.4 throws an error in some cases in
+                // updateSelection, ``this.selection.find(".select2-search-choice").remove();``
+                // No idea why, hard to track.
+                console.log(data);
+              }
 
               if (self.openAfterInit) {
                 // open after initialization
diff --git a/mockup/tests/pattern-markspeciallinks-test.js b/mockup/tests/pattern-markspeciallinks-test.js
index 4fe355c7..b1e11c87 100644
--- a/mockup/tests/pattern-markspeciallinks-test.js
+++ b/mockup/tests/pattern-markspeciallinks-test.js
@@ -45,6 +45,11 @@ define([
         '      <li><a href="feed://www.plone.org">feed</a></li>' +
         '      <li><a href="webcal://www.plone.org">webcal</a></li>' +
         '    </ul>' +
+        '</div>' +
+        '<div class="anchors pat-markspeciallinks">' +
+        '  <p>Find out What&#39s new in <a href="#anchor">Plone</a>.<br>' +
+        '     Plone is written in <a class="link-plain" href="http://www.python.org">Python</a>.' +
+        '  </p>' +
         '</div>');
 
 
@@ -76,5 +81,10 @@ define([
       expect(listel.eq(9).find('i').hasClass('link-feed')).to.be.equal(true);
       expect(listel.eq(10).find('i').hasClass('link-webcal')).to.be.equal(true);
     });
+    it('do not show the lock icon for anchor links', function() {
+      registry.scan(this.$el);
+      var link = this.$el.next('.anchors').find('p').find('a');
+      expect(link.eq(0).prev().length).to.be.equal(0);
+    });
   });
 });


Repository: mockup


Branch: refs/heads/master
Date: 2017-11-17T17:57:56-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/mockup/commit/8be49acf88867e3c019a6ba493606403c2fae906

Merge pull request #819 from plone/flexible_anchors

Allow more flexible anchors in TinyMCE

Files changed:
M CHANGES.rst
M mockup/patterns/tinymce/js/links.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 86c6bab7..3355adf9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,8 +21,12 @@ New features:
   - Added options to change sorting.
   [Gagaro]
 
-- Mark special links
+- TinyMCE pattern:
 
+  - Make anchor handling more flexible
+  [tomgross]
+  
+  - Mark special links
   - Do not mark anchors as special links
   [frapell]
 
diff --git a/mockup/patterns/tinymce/js/links.js b/mockup/patterns/tinymce/js/links.js
index 0896d58d..e82dbcfe 100644
--- a/mockup/patterns/tinymce/js/links.js
+++ b/mockup/patterns/tinymce/js/links.js
@@ -224,7 +224,7 @@ define([
       self.anchorData = [];
       var node, i, j, name, title;
 
-      var nodes = self.tiny.dom.select('a.mceItemAnchor,img.mceItemAnchor,a.mce-item-anchor,img.mce-item-anchor');
+      var nodes = self.tiny.dom.select('.mceItemAnchor,.mce-item-anchor');
       for (i = 0; i < nodes.length; i = i + 1) {
         node = nodes[i];
         name = self.tiny.dom.getAttrib(node, 'name');


