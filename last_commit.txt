Repository: plone.app.users


Branch: refs/heads/1.2.x
Date: 2016-02-15T08:31:26+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.users/commit/2231098923c3fd22f5aba6d054a7bcd045ac2f30

Fixed possible test failure by opening a file in a standard way instead of via pkg_resources.

Files changed:
M CHANGES.rst
M plone/app/users/tests/test_doctests.py
M plone/app/users/tests/userdata_prefs_user_details.txt

diff --git a/CHANGES.rst b/CHANGES.rst
index 7f45e50..86dde28 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed possible test failure by opening a file in a standard way
+  instead of via pkg_resources.  [maurits]
 
 
 1.2.3 (2015-10-28)
diff --git a/plone/app/users/tests/test_doctests.py b/plone/app/users/tests/test_doctests.py
index a4f3c6d..cb929a0 100644
--- a/plone/app/users/tests/test_doctests.py
+++ b/plone/app/users/tests/test_doctests.py
@@ -1,10 +1,11 @@
-import doctest
+from plone.app.users.tests import TestCase
+from Products.PloneTestCase.PloneTestCase import setupPloneSite
+from Testing.ZopeTestCase import FunctionalDocFileSuite
 from unittest import TestSuite
 
-from Testing.ZopeTestCase import FunctionalDocFileSuite
-from Products.PloneTestCase.PloneTestCase import setupPloneSite
+import doctest
+import os
 
-from plone.app.users.tests import TestCase
 
 setupPloneSite()
 
@@ -12,8 +13,11 @@
 
 
 class DocTestCase(TestCase):
-    # just here to work around a weird error message
-    pass
+    # Just here to work around a weird error message.
+    # And now an extra helper method.
+
+    def get_test_file(self, filename):
+        return open(os.path.join(os.path.dirname(__file__), filename))
 
 
 def test_suite():
diff --git a/plone/app/users/tests/userdata_prefs_user_details.txt b/plone/app/users/tests/userdata_prefs_user_details.txt
index a165f3e..b35cd6f 100644
--- a/plone/app/users/tests/userdata_prefs_user_details.txt
+++ b/plone/app/users/tests/userdata_prefs_user_details.txt
@@ -1,7 +1,7 @@
-Admin modifies user information thru 'Users and groups' 
----------------------------------------------------------------------
+Admin modifies user information through 'Users and groups'
+----------------------------------------------------------
 
-An admin can modify user information thru the @@user-information form in Users and Groups
+An admin can modify user information through the @@user-information form in Users and Groups
 config page.
 
 So let's login as Plone admin:
@@ -53,8 +53,7 @@ Modifying user data
     >>> location = 'Somewhere'
     >>> self.browser.getControl(name='form.location').value = location
 
-    >>> from pkg_resources import resource_stream
-    >>> portrait_file = resource_stream("plone.app.users.tests", 'onepixel.jpg')
+    >>> portrait_file = self.get_test_file('onepixel.jpg')
     >>> self.browser.getControl(name='form.portrait').add_file(portrait_file, "image/jpg", "onepixel.jpg")
 
     >>> self.browser.getControl(name="form.actions.save").click()


