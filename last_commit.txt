Repository: Products.CMFQuickInstallerTool


Branch: refs/heads/master
Date: 2017-02-02T18:57:19+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFQuickInstallerTool/commit/4a4f6b6a42011e614b7f585bf5d740cdff012b1a

Fixed test that got redirected wrongly.

This went wrong on the Zope4 PLIP.
It looks like self.browser.post changed to not only post,
but also handle any redirects that are done afterwards.
This meant that portal_quickinstaller/installProducts got loaded as GET, which is not allowed.
So we do a GET ourselves first, so a referer is set that is then redirected to.

Files changed:
M Products/CMFQuickInstallerTool/tests/test_browser.py

diff --git a/Products/CMFQuickInstallerTool/tests/test_browser.py b/Products/CMFQuickInstallerTool/tests/test_browser.py
index e3cc1bc..3e69c5e 100644
--- a/Products/CMFQuickInstallerTool/tests/test_browser.py
+++ b/Products/CMFQuickInstallerTool/tests/test_browser.py
@@ -88,6 +88,11 @@ def test_installProducts_post(self):
         product = self._get_product_for_install(qi)
         url = '%s/installProducts' % qi.absolute_url()
         csrf_token = createToken()
+        # First we need to get a url so we have a referer to get back to.
+        # Otherwise we get a redirect to '', which means to 'installProducts',
+        # which will fail because it is a GET request.
+        self.browser.open(qi.absolute_url())
+        # Now the POST.
         self.browser.post(url, 'products:list=%s&_authenticator=%s' % (
             product, csrf_token))
         # The product must have successfully been installed.


