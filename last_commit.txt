Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-28T09:39:56+01:00
Author: Marc Sommerhalder (msom) <marc.sommerhalder@seantis.ch>
Commit: https://github.com/plone/Products.TinyMCE/commit/258588c2d525f0d783317ca4c21c101d1ffbe377

Fixed bug where the plonebrowser dialog wouldn't properly populate the anchors if the HTML5 schema was used

Files changed:
M HISTORY.rst
M Products/TinyMCE/browser/atanchors.py

diff --git a/HISTORY.rst b/HISTORY.rst
index 251fa0d..f516a27 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -11,7 +11,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed bug where the plonebrowser dialog wouldn't properly populate the
+  anchors if the HTML5 schema was used.
+  [msom]
 
 
 1.3.17 (2016-01-08)
diff --git a/Products/TinyMCE/browser/atanchors.py b/Products/TinyMCE/browser/atanchors.py
index 0ca7e2b..a55cb58 100644
--- a/Products/TinyMCE/browser/atanchors.py
+++ b/Products/TinyMCE/browser/atanchors.py
@@ -18,6 +18,7 @@ def fromstring(text):
 
     SEARCHPATTERN = "*/a"
 
+
 class ATAnchorView(BrowserView):
     implements(IAnchorView)
 
@@ -38,5 +39,11 @@ def listAnchorNames(self, fieldname=None):
             raise
         except Exception:
             return []
-        return [anchor.get('name') for anchor in tree.findall(SEARCHPATTERN)
-                if "name" in anchor.keys()]
+
+        anchors = []
+        for anchor in tree.findall(SEARCHPATTERN):
+            if "name" in anchor.keys():
+                anchors.append(anchor.get('name'))
+            if "id" in anchor.keys():
+                anchors.append(anchor.get('id'))
+        return anchors


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2016-01-31T23:56:40+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.TinyMCE/commit/b0e4db1f406da8798ab4c2f549e006cfe16e6d62

Merge pull request #132 from plone/1.3.x-fix-anchors

Fix listing of internal anchors in the plonebrowser dialog

Files changed:
M HISTORY.rst
M Products/TinyMCE/browser/atanchors.py

diff --git a/HISTORY.rst b/HISTORY.rst
index 251fa0d..f516a27 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -11,7 +11,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed bug where the plonebrowser dialog wouldn't properly populate the
+  anchors if the HTML5 schema was used.
+  [msom]
 
 
 1.3.17 (2016-01-08)
diff --git a/Products/TinyMCE/browser/atanchors.py b/Products/TinyMCE/browser/atanchors.py
index 0ca7e2b..a55cb58 100644
--- a/Products/TinyMCE/browser/atanchors.py
+++ b/Products/TinyMCE/browser/atanchors.py
@@ -18,6 +18,7 @@ def fromstring(text):
 
     SEARCHPATTERN = "*/a"
 
+
 class ATAnchorView(BrowserView):
     implements(IAnchorView)
 
@@ -38,5 +39,11 @@ def listAnchorNames(self, fieldname=None):
             raise
         except Exception:
             return []
-        return [anchor.get('name') for anchor in tree.findall(SEARCHPATTERN)
-                if "name" in anchor.keys()]
+
+        anchors = []
+        for anchor in tree.findall(SEARCHPATTERN):
+            if "name" in anchor.keys():
+                anchors.append(anchor.get('name'))
+            if "id" in anchor.keys():
+                anchors.append(anchor.get('id'))
+        return anchors


