Repository: plone.app.users


Branch: refs/heads/1.2.x
Date: 2016-02-21T19:10:29+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.users/commit/41a24eb491f2690778a2c0b1273fdc5001e1632f

Get more info from error_log in csrf test failure.

Files changed:
M plone/app/users/tests/userdata_prefs_user_details.txt

diff --git a/plone/app/users/tests/userdata_prefs_user_details.txt b/plone/app/users/tests/userdata_prefs_user_details.txt
index b35cd6f..dee4012 100644
--- a/plone/app/users/tests/userdata_prefs_user_details.txt
+++ b/plone/app/users/tests/userdata_prefs_user_details.txt
@@ -56,7 +56,14 @@ Modifying user data
     >>> portrait_file = self.get_test_file('onepixel.jpg')
     >>> self.browser.getControl(name='form.portrait').add_file(portrait_file, "image/jpg", "onepixel.jpg")
 
-    >>> self.browser.getControl(name="form.actions.save").click()
+    >>> from urllib2 import HTTPError
+    >>> try:
+    ...     self.browser.getControl(name="form.actions.save").click()
+    ... except HTTPError as e:
+    ...     # get the error just thrown
+    ...     err = self.portal.error_log.getLogEntries()[0]
+    ...     msg = "%s:\n %s" % (e, err['tb_text'])
+    ...     self.fail(msg)
     >>> 'Required input is missing.' in self.browser.contents
     False
     >>> 'No changes made.' in self.browser.contents


