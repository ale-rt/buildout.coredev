Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-03-30T10:39:19+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.contentrules/commit/1f1ccc0dde1dbd692cacf2ce5542ee14b0a3bda5

Fix issue where content rules edit forms were broken because of move of getIcon from @@plone to @@plone_layout

Files changed:
M plone/app/contentrules/browser/elements.py

diff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py
index 55c01b7..2f6754b 100644
--- a/plone/app/contentrules/browser/elements.py
+++ b/plone/app/contentrules/browser/elements.py
@@ -153,7 +153,8 @@ def assignments(self):
         site = getToolByName(rule, "portal_url").getPortalObject()
         site_path = '/'.join(site.getPhysicalPath())
 
-        plone_view = getMultiAdapter((rule, self.request), name="plone")
+        plone_layout_view = getMultiAdapter((rule, self.request),
+                                            name="plone_layout")
 
         info = []
         if site_path in paths:
@@ -162,7 +163,7 @@ def assignments(self):
                 'url': site.absolute_url(),
                 'title': site.title_or_id(),
                 'description': site.Description(),
-                'icon': plone_view.getIcon(site)})
+                'icon': plone_layout_view.getIcon(site)})
 
         catalog = getToolByName(rule, "portal_catalog")
         for a in catalog(path=dict(query=list(paths), depth=0),
@@ -171,7 +172,7 @@ def assignments(self):
                 'url': a.getURL(),
                 'title': a.Title or a.getId,
                 'description': a.Description,
-                'icon': plone_view.getIcon(a)})
+                'icon': plone_layout_view.getIcon(a)})
 
         return info
 


Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-03-30T10:39:52+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.contentrules/commit/ae61ed75c52d504912939d77db108215e3cffe7f

Update changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index e23690c..bab0a14 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+-  Fix issue where content rules edit forms were broken because of move of
+   getIcon from @@plone to @@plone_layout
+   [datakurre]
 
 
 4.0.13 (2016-12-30)


Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2017-03-31T11:27:47+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/10d56c9e76b6f859e6ff3dea0c270818e3933487

Merge pull request #27 from plone/datakurre-getIcon

Fix issue where content rules edit form for a rules with assigned locations was broken because of move of getIcon

Files changed:
M CHANGES.rst
M plone/app/contentrules/browser/elements.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e23690c..bab0a14 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+-  Fix issue where content rules edit forms were broken because of move of
+   getIcon from @@plone to @@plone_layout
+   [datakurre]
 
 
 4.0.13 (2016-12-30)
diff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py
index 55c01b7..2f6754b 100644
--- a/plone/app/contentrules/browser/elements.py
+++ b/plone/app/contentrules/browser/elements.py
@@ -153,7 +153,8 @@ def assignments(self):
         site = getToolByName(rule, "portal_url").getPortalObject()
         site_path = '/'.join(site.getPhysicalPath())
 
-        plone_view = getMultiAdapter((rule, self.request), name="plone")
+        plone_layout_view = getMultiAdapter((rule, self.request),
+                                            name="plone_layout")
 
         info = []
         if site_path in paths:
@@ -162,7 +163,7 @@ def assignments(self):
                 'url': site.absolute_url(),
                 'title': site.title_or_id(),
                 'description': site.Description(),
-                'icon': plone_view.getIcon(site)})
+                'icon': plone_layout_view.getIcon(site)})
 
         catalog = getToolByName(rule, "portal_catalog")
         for a in catalog(path=dict(query=list(paths), depth=0),
@@ -171,7 +172,7 @@ def assignments(self):
                 'url': a.getURL(),
                 'title': a.Title or a.getId,
                 'description': a.Description,
-                'icon': plone_view.getIcon(a)})
+                'icon': plone_layout_view.getIcon(a)})
 
         return info
 


