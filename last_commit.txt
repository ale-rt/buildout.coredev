Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-04-10T12:59:59+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/2ab08baed1faed5adf6081d25d1c8741bc41b88b

Do not convert/fail on None while update_social_media_fields

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 83b00cd..332dd59 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Do not convert/fail on None while update_social_media_fields
+  [agitator]
+
 - Fixed ImportError when ``Products.ATContentTypes`` is not available.
   This happens when you only have the ``Products.CMFPlone`` egg
   and not the ``Plone`` egg.  [maurits]
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index d003ad1..4585b5e 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -127,7 +127,10 @@ def update_social_media_fields(context):
     from Products.CMFPlone.interfaces.controlpanel import ISocialMediaSchema
     registry = getUtility(IRegistry)
     settings = registry.forInterface(ISocialMediaSchema, prefix='plone')
-    settings.twitter_username = str(settings.twitter_username)
-    settings.facebook_app_id = str(settings.facebook_app_id)
-    settings.facebook_username = str(settings.facebook_username)
+    if settings.twitter_username:
+        settings.twitter_username = str(settings.twitter_username)
+    if settings.facebook_app_id:
+        settings.facebook_app_id = str(settings.facebook_app_id)
+    if settings.facebook_username:
+        settings.facebook_username = str(settings.facebook_username)
     logger.log(logging.INFO, 'Field types updated on social media schema')


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2017-04-10T14:22:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/a9d5ee3eebe6173d57b2a84503fe92cfcc0de167

Merge pull request #113 from plone/do-not-converte-none

Do not convert/fail on None while update_social_media_fields

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 83b00cd..332dd59 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Do not convert/fail on None while update_social_media_fields
+  [agitator]
+
 - Fixed ImportError when ``Products.ATContentTypes`` is not available.
   This happens when you only have the ``Products.CMFPlone`` egg
   and not the ``Plone`` egg.  [maurits]
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index d003ad1..4585b5e 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -127,7 +127,10 @@ def update_social_media_fields(context):
     from Products.CMFPlone.interfaces.controlpanel import ISocialMediaSchema
     registry = getUtility(IRegistry)
     settings = registry.forInterface(ISocialMediaSchema, prefix='plone')
-    settings.twitter_username = str(settings.twitter_username)
-    settings.facebook_app_id = str(settings.facebook_app_id)
-    settings.facebook_username = str(settings.facebook_username)
+    if settings.twitter_username:
+        settings.twitter_username = str(settings.twitter_username)
+    if settings.facebook_app_id:
+        settings.facebook_app_id = str(settings.facebook_app_id)
+    if settings.facebook_username:
+        settings.facebook_username = str(settings.facebook_username)
     logger.log(logging.INFO, 'Field types updated on social media schema')


