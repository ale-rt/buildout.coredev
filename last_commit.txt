Repository: plone.app.jquerytools


Branch: refs/heads/master
Date: 2016-08-08T15:17:58+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/plone.app.jquerytools/commit/af45786fd323b7682b06ee4b3f08ae74551739fd

The prepOverlay function can be used on a form instead of a link.
When a button of this form is clicked, the form action attribute is used to
retrieve the overlay. (This was already the case in previous versions,
What's new is the following.) If method="POST", the overlay will be fetched
via a POST with the form payload instead of GET.
The use of a POST instead of GET may be useful to avoid the url length limit.

Files changed:
M CHANGES.rst
M README.rst
M plone/app/jquerytools/browser/overlayhelpers.js
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7269070..423f2da 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,10 +1,16 @@
 Changelog
 =========
 
-1.7.2 (unreleased)
+1.8.0 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- The prepOverlay function can be used on a form instead of a link. When a
+  button of this form is clicked, the form action attribute is used to retrieve
+  the overlay. (This was already the case in previous versions, What's new is
+  the following.) If method="POST", the overlay will be fetched via a POST with
+  the form payload instead of GET.
+  The use of a POST instead of GET may be useful to avoid the url length limit.
+  [vincentfretin]
 
 
 1.7.1 (2016-06-27)
diff --git a/README.rst b/README.rst
index 16fba22..7210f72 100644
--- a/README.rst
+++ b/README.rst
@@ -311,6 +311,12 @@ The `jquery form plugin`_ is used to do the data serialization for form posts.
 It provides a more complete serialization, including submit name/value and file
 data, than jQuery alone.
 
+The prepOverlay function can be used on a form instead of a link. When a button
+of this form is clicked, the form action attribute is used to retrieve the
+overlay. If method="POST", the overlay will be fetched via a POST with the
+form payload instead of GET.
+The use of a POST instead of GET may be useful to avoid the url length limit.
+
 jQuery Tools Events
 -------------------
 
diff --git a/plone/app/jquerytools/browser/overlayhelpers.js b/plone/app/jquerytools/browser/overlayhelpers.js
index 2e928bc..66fdc8c 100644
--- a/plone/app/jquerytools/browser/overlayhelpers.js
+++ b/plone/app/jquerytools/browser/overlayhelpers.js
@@ -582,7 +582,14 @@ jQuery(function ($) {
         };
 
         // and load the div
-        el.load(src, null, function (responseText, errorText) {
+        var data = null;
+        var form = $(pbo.source.context);
+        var method = form.attr('method');
+        if (method && method.toLowerCase() == 'post') {
+            data = form.serializeArray();
+        }
+        // load will do a POST instead of GET if data is not null
+        el.load(src, data, function (responseText, errorText) {
             // post-process the overlay contents
             el[0].handle_load_inside_overlay.apply(this, [responseText, errorText]);
 
diff --git a/setup.py b/setup.py
index f5455d3..b416d04 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,6 @@
 from setuptools import setup, find_packages
 
-version = '1.7.2.dev0'
+version = '1.8.0.dev0'
 
 setup(
     name='plone.app.jquerytools',


