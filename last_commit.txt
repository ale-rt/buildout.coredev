Repository: plone.app.contenttypes


Branch: refs/heads/1.2.x
Date: 2017-04-10T10:00:25+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.contenttypes/commit/7d6801cdda9a33577aaac26c78aae9fca969f222

Fixed Mimetype icon path.

Version 1.2.19 introduced a change to fit Products.MimetypesRegistry 2.1, but Plone 5.0 should remain on 2.0.x.
Fixes https://github.com/plone/Products.CMFPlone/issues/1997.

Revert "with the removal of the skins folder in https://github.com/plone/Products.MimetypesRegistry/pull/8/commits/61acf8327e5c844bff9e5c5676170aaf0ee2c323 we need the full resourcepath now"
This reverts commit 292aefd647a67d6d0767aba39a687845fab00a76.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/browser/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5c39611..4b7a50b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,11 @@ New features:
 
 Bug fixes:
 
+- Fixed Mimetype icon path. Version 1.2.19 introduced a change to fit
+  Products.MimetypesRegistry 2.1, but Plone 5.0 should remain on 2.0.x.
+  Fixes `issue 1997 <https://github.com/plone/Products.CMFPlone/issues/1997>`_.
+  [maurits]
+
 - Avoid failure during migration if relation is broken.
   [cedricmessiant]
 
diff --git a/plone/app/contenttypes/browser/utils.py b/plone/app/contenttypes/browser/utils.py
index ba07fb3..cf76657 100644
--- a/plone/app/contenttypes/browser/utils.py
+++ b/plone/app/contenttypes/browser/utils.py
@@ -37,8 +37,7 @@ def getMimeTypeIcon(self, content_file):
         if content_file.filename:
             mime.append(mtr.lookupExtension(content_file.filename))
         mime.append(mtr.lookup('application/octet-stream')[0])
-        icon_paths = ['++resource++mimetype.icons/' + m.icon_path
-                      for m in mime if hasattr(m, 'icon_path')]
+        icon_paths = [m.icon_path for m in mime if hasattr(m, 'icon_path')]
         if icon_paths:
             return icon_paths[0]
 


Repository: plone.app.contenttypes


Branch: refs/heads/1.2.x
Date: 2017-04-26T11:48:16+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/25c8a64408244649eb0c1ab69f072b2db627b86c

Merge pull request #395 from plone/revert-mimetype-icons-12x

Fixed Mimetype icon path. [1.2.x, Plone 5.0]

Files changed:
M CHANGES.rst
M plone/app/contenttypes/browser/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5c39611..4b7a50b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,11 @@ New features:
 
 Bug fixes:
 
+- Fixed Mimetype icon path. Version 1.2.19 introduced a change to fit
+  Products.MimetypesRegistry 2.1, but Plone 5.0 should remain on 2.0.x.
+  Fixes `issue 1997 <https://github.com/plone/Products.CMFPlone/issues/1997>`_.
+  [maurits]
+
 - Avoid failure during migration if relation is broken.
   [cedricmessiant]
 
diff --git a/plone/app/contenttypes/browser/utils.py b/plone/app/contenttypes/browser/utils.py
index ba07fb3..cf76657 100644
--- a/plone/app/contenttypes/browser/utils.py
+++ b/plone/app/contenttypes/browser/utils.py
@@ -37,8 +37,7 @@ def getMimeTypeIcon(self, content_file):
         if content_file.filename:
             mime.append(mtr.lookupExtension(content_file.filename))
         mime.append(mtr.lookup('application/octet-stream')[0])
-        icon_paths = ['++resource++mimetype.icons/' + m.icon_path
-                      for m in mime if hasattr(m, 'icon_path')]
+        icon_paths = [m.icon_path for m in mime if hasattr(m, 'icon_path')]
         if icon_paths:
             return icon_paths[0]
 


