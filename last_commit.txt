Repository: plone.app.contentmenu


Branch: refs/heads/master
Date: 2016-05-25T13:41:34-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.contentmenu/commit/13479796eb28adccca0773c44f23cb19a76ffcc9

Optimize display menu's check for index_html

This makes a big difference for BTree-based folders with thousands of items
when the container is not yet in the ZODB cache.
`context.objectIds()` woke all BTree buckets and built a list of ids
whereas `'index_html' in context` just does a BTree lookup.

Files changed:
M CHANGES.rst
M plone/app/contentmenu/menu.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a8201ee..3594420 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Optimized display menu's check for `index_html`.
+  [davisagli]
 
 
 2.1.7 (2016-02-19)
diff --git a/plone/app/contentmenu/menu.py b/plone/app/contentmenu/menu.py
index 3976d72..6753071 100644
--- a/plone/app/contentmenu/menu.py
+++ b/plone/app/contentmenu/menu.py
@@ -215,7 +215,7 @@ def disabled(self):
             context = utils.parent(context)
         if not getattr(context, 'isPrincipiaFolderish', False):
             return False
-        elif 'index_html' not in context.objectIds():
+        elif 'index_html' not in context:
             return False
         else:
             return True


Repository: plone.app.contentmenu


Branch: refs/heads/master
Date: 2016-05-26T00:11:38+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentmenu/commit/761cb8cd59704d66efa96a2ab5e82133a4998ca3

Merge pull request #13 from plone/davisagli-optimize

Optimize display menu's check for index_html

Files changed:
M CHANGES.rst
M plone/app/contentmenu/menu.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a8201ee..3594420 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Optimized display menu's check for `index_html`.
+  [davisagli]
 
 
 2.1.7 (2016-02-19)
diff --git a/plone/app/contentmenu/menu.py b/plone/app/contentmenu/menu.py
index 3976d72..6753071 100644
--- a/plone/app/contentmenu/menu.py
+++ b/plone/app/contentmenu/menu.py
@@ -215,7 +215,7 @@ def disabled(self):
             context = utils.parent(context)
         if not getattr(context, 'isPrincipiaFolderish', False):
             return False
-        elif 'index_html' not in context.objectIds():
+        elif 'index_html' not in context:
             return False
         else:
             return True


