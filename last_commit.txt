Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-05T08:33:54+02:00
Author: Franz Gerhard Reinisch (fgrcon) <franz@fgrcon.net>
Commit: https://github.com/plone/plone.app.contentlisting/commit/0d39e69a427ae54444f127dd7750e73969cfa107

 provide Mimetype icon path for file types in contentlisting object
 https://github.com/plone/Products.CMFPlone/issues/1734

Files changed:
M CHANGES.rst
M plone/app/contentlisting/contentlisting.py
M plone/app/contentlisting/interfaces.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5cace04..8352e7a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- provide Mimetype icon path for file types in contentlisting object
+  https://github.com/plone/Products.CMFPlone/issues/1734 [fgrcon]
 
 Bug fixes:
 
diff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py
index cccee03..1a0ff28 100644
--- a/plone/app/contentlisting/contentlisting.py
+++ b/plone/app/contentlisting/contentlisting.py
@@ -1,13 +1,18 @@
 # -*- coding: utf-8 -*-
+
+from plone import api
 from plone.app.contentlisting.interfaces import IContentListing
 from plone.app.contentlisting.interfaces import IContentListingObject
 from plone.i18n.normalizer.interfaces import IIDNormalizer
 from plone.registry.interfaces import IRegistry
 from Products.CMFPlone.interfaces import INavigationSchema
+from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from zope.component import getUtility
 from zope.component import queryUtility
 from zope.interface import implementer
 
+import os
+
 
 @implementer(IContentListing)
 class ContentListing(object):
@@ -141,3 +146,15 @@ def isVisibleInNav(self):
             return False
 
         return True
+
+    def MimeTypeIcon(self):
+        if not self.PortalType() == 'File':
+            return None
+        portal_url = api.portal.get().absolute_url()
+        mtt = api.portal.get_tool(name='mimetypes_registry')
+        if self.getObject().file.contentType:
+            ctype = mtt.lookup(self.getObject().file.contentType)
+            return os.path.join(portal_url,
+                                guess_icon_path(ctype[0])
+                                )
+        return None
diff --git a/plone/app/contentlisting/interfaces.py b/plone/app/contentlisting/interfaces.py
index 7fd3bc4..3f77c29 100644
--- a/plone/app/contentlisting/interfaces.py
+++ b/plone/app/contentlisting/interfaces.py
@@ -86,3 +86,8 @@ def ContentTypeClass():
         """The contenttype suitable as a css class name, matching Plone
         conventions.
         """
+
+    def MimeTypeIcon():
+        """ return mimetype icon from mimetype registry if contenttype is
+        File else None
+        """


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-05T08:36:32+02:00
Author: root (fgrcon) <franz@fgrcon.net>
Commit: https://github.com/plone/plone.app.contentlisting/commit/5dfdafc262fe6b54d81e2f60b36ee9a15d7f88be

update documentation

Files changed:
M CHANGES.rst
M README.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 8352e7a..b961cc5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,7 +11,8 @@ Breaking changes:
 New features:
 
 - provide Mimetype icon path for file types in contentlisting object
-  https://github.com/plone/Products.CMFPlone/issues/1734 [fgrcon]
+  https://github.com/plone/Products.CMFPlone/issues/1734
+  [fgrcon]
 
 Bug fixes:
 
diff --git a/README.rst b/README.rst
index 19af613..c49ff4b 100644
--- a/README.rst
+++ b/README.rst
@@ -156,11 +156,6 @@ uuid() -
   point of it is to be unique. It can for example look like this
   `b0e80776-d41d-4f48-bf9e-7cb1aebabad5`.
 
-getIcon() -
-  Icon for the object. Returns an icon object from plone.app.layout.
-  If printed as a string, it will produce an HTML tag for the icon. Check
-  plone.app.layout for more info.
-
 getSize() -
   Size in bytes for example `24`.
 
@@ -254,3 +249,7 @@ Rights() -
 
 isVisibleInNav() -
   Return whether this object will be visible in a navigation view.
+
+MimeTypeIcon():
+  Return mimetype icon from mimetype registry if contenttype is
+        File else None.


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-07T13:10:25+02:00
Author: root (fgrcon) <franz@fgrcon.net>
Commit: https://github.com/plone/plone.app.contentlisting/commit/8c9616965021df1dec46923c5dd6aec0970ff8b6

catch attribute error

Files changed:
M plone/app/contentlisting/contentlisting.py

diff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py
index 1a0ff28..e9e6a97 100644
--- a/plone/app/contentlisting/contentlisting.py
+++ b/plone/app/contentlisting/contentlisting.py
@@ -152,9 +152,12 @@ def MimeTypeIcon(self):
             return None
         portal_url = api.portal.get().absolute_url()
         mtt = api.portal.get_tool(name='mimetypes_registry')
-        if self.getObject().file.contentType:
-            ctype = mtt.lookup(self.getObject().file.contentType)
-            return os.path.join(portal_url,
-                                guess_icon_path(ctype[0])
-                                )
+        try:
+            if self.getObject().file.contentType:
+                ctype = mtt.lookup(self.getObject().file.contentType)
+                return os.path.join(portal_url,
+                                    guess_icon_path(ctype[0])
+                                    )
+        except AttributeError:
+            pass
         return None


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-04-14T13:29:07+02:00
Author: root (fgrcon) <franz@fgrcon.net>
Commit: https://github.com/plone/plone.app.contentlisting/commit/17a8debee74764ddd63814924b3ea650dfa40bd0

review findings worked in, removed api, use mime_type column, pep8 ....

Files changed:
M plone/app/contentlisting/contentlisting.py

diff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py
index e9e6a97..1230719 100644
--- a/plone/app/contentlisting/contentlisting.py
+++ b/plone/app/contentlisting/contentlisting.py
@@ -1,10 +1,12 @@
 # -*- coding: utf-8 -*-
 
-from plone import api
+from Acquisition import aq_base
 from plone.app.contentlisting.interfaces import IContentListing
 from plone.app.contentlisting.interfaces import IContentListingObject
+from plone.app.layout.navigation.root import getNavigationRoot
 from plone.i18n.normalizer.interfaces import IIDNormalizer
 from plone.registry.interfaces import IRegistry
+from Products.CMFCore.utils import getToolByName
 from Products.CMFPlone.interfaces import INavigationSchema
 from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from zope.component import getUtility
@@ -148,16 +150,16 @@ def isVisibleInNav(self):
         return True
 
     def MimeTypeIcon(self):
-        if not self.PortalType() == 'File':
-            return None
-        portal_url = api.portal.get().absolute_url()
-        mtt = api.portal.get_tool(name='mimetypes_registry')
-        try:
-            if self.getObject().file.contentType:
-                ctype = mtt.lookup(self.getObject().file.contentType)
-                return os.path.join(portal_url,
-                                    guess_icon_path(ctype[0])
-                                    )
-        except AttributeError:
-            pass
-        return None
+        mimeicon = None
+        navroot = getNavigationRoot(self._brain)
+        contenttype = aq_base(
+            getattr(self._brain, 'mime_type', None))
+        if contenttype:
+            mtt = getToolByName(
+                self._brain, 'mimetypes_registry')
+            ctype = mtt.lookup(contenttype)
+            mimeicon = os.path.join(
+                navroot,
+                guess_icon_path(ctype[0]))
+
+        return mimeicon


Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2017-06-01T14:13:04+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/f0b255db4448aafc9981ad1afd39974b00cff693

Merge pull request #19 from plone/plip1734thumbs

Plip1734thumbs

Files changed:
M CHANGES.rst
M README.rst
M plone/app/contentlisting/contentlisting.py
M plone/app/contentlisting/interfaces.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7e2726b..91976bc 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- provide Mimetype icon path for file types in contentlisting object
+  https://github.com/plone/Products.CMFPlone/issues/1734
+  [fgrcon]
 
 Bug fixes:
 
diff --git a/README.rst b/README.rst
index 19af613..c49ff4b 100644
--- a/README.rst
+++ b/README.rst
@@ -156,11 +156,6 @@ uuid() -
   point of it is to be unique. It can for example look like this
   `b0e80776-d41d-4f48-bf9e-7cb1aebabad5`.
 
-getIcon() -
-  Icon for the object. Returns an icon object from plone.app.layout.
-  If printed as a string, it will produce an HTML tag for the icon. Check
-  plone.app.layout for more info.
-
 getSize() -
   Size in bytes for example `24`.
 
@@ -254,3 +249,7 @@ Rights() -
 
 isVisibleInNav() -
   Return whether this object will be visible in a navigation view.
+
+MimeTypeIcon():
+  Return mimetype icon from mimetype registry if contenttype is
+        File else None.
diff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py
index cccee03..1230719 100644
--- a/plone/app/contentlisting/contentlisting.py
+++ b/plone/app/contentlisting/contentlisting.py
@@ -1,13 +1,20 @@
 # -*- coding: utf-8 -*-
+
+from Acquisition import aq_base
 from plone.app.contentlisting.interfaces import IContentListing
 from plone.app.contentlisting.interfaces import IContentListingObject
+from plone.app.layout.navigation.root import getNavigationRoot
 from plone.i18n.normalizer.interfaces import IIDNormalizer
 from plone.registry.interfaces import IRegistry
+from Products.CMFCore.utils import getToolByName
 from Products.CMFPlone.interfaces import INavigationSchema
+from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from zope.component import getUtility
 from zope.component import queryUtility
 from zope.interface import implementer
 
+import os
+
 
 @implementer(IContentListing)
 class ContentListing(object):
@@ -141,3 +148,18 @@ def isVisibleInNav(self):
             return False
 
         return True
+
+    def MimeTypeIcon(self):
+        mimeicon = None
+        navroot = getNavigationRoot(self._brain)
+        contenttype = aq_base(
+            getattr(self._brain, 'mime_type', None))
+        if contenttype:
+            mtt = getToolByName(
+                self._brain, 'mimetypes_registry')
+            ctype = mtt.lookup(contenttype)
+            mimeicon = os.path.join(
+                navroot,
+                guess_icon_path(ctype[0]))
+
+        return mimeicon
diff --git a/plone/app/contentlisting/interfaces.py b/plone/app/contentlisting/interfaces.py
index 7fd3bc4..3f77c29 100644
--- a/plone/app/contentlisting/interfaces.py
+++ b/plone/app/contentlisting/interfaces.py
@@ -86,3 +86,8 @@ def ContentTypeClass():
         """The contenttype suitable as a css class name, matching Plone
         conventions.
         """
+
+    def MimeTypeIcon():
+        """ return mimetype icon from mimetype registry if contenttype is
+        File else None
+        """


