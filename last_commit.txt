Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2017-02-07T14:34:42+02:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.multilingual/commit/838db18dae5f04e273c20f925e19d393acc54660

Add '@@tg' view for accessing translation group of the object TTW

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/helper_views.py
M src/plone/app/multilingual/tests/test_api.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0fe6c2c..5092de1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Add a new view ``@@tg`` for translatable content. It will return the
+  current translation group of the content, matching the bahavior of ``@@uuid``
+  of ``plone.app.uuid`` returning UUID of the content.  [datakurre]
 
 Bug fixes:
 
diff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml
index 6373c85..cbe747a 100644
--- a/src/plone/app/multilingual/browser/configure.zcml
+++ b/src/plone/app/multilingual/browser/configure.zcml
@@ -142,6 +142,14 @@
       permission="zope.Public"
       layer="..interfaces.IPloneAppMultilingualInstalled"/>
 
+  <!-- Translation Group -->
+  <browser:page
+      name="tg"
+      for="plone.app.multilingual.interfaces.ITranslatable"
+      class=".helper_views.TGView"
+      permission="zope.Public"
+      layer="..interfaces.IPloneAppMultilingualInstalled"/>
+
   <!-- Selector -->
   <browser:page
       name="multilingual-selector"
diff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py
index a379c45..34cd0a2 100644
--- a/src/plone/app/multilingual/browser/helper_views.py
+++ b/src/plone/app/multilingual/browser/helper_views.py
@@ -9,6 +9,7 @@
 from borg.localrole.interfaces import IFactoryTempFolder
 from plone.app.layout.navigation.interfaces import INavigationRoot
 from plone.app.multilingual.interfaces import IMultiLanguageExtraOptionsSchema
+from plone.app.multilingual.interfaces import ITG
 from plone.app.multilingual.browser.selector import NOT_TRANSLATED_YET_TEMPLATE
 from plone.app.multilingual.browser.selector import addQuery
 from plone.app.multilingual.interfaces import ILanguageRootFolder
@@ -278,3 +279,11 @@ def language_name(self, lang=None):
         if lang_info is None:
             return None
         return lang_info.get('native', None) or lang_info.get('name')
+
+
+class TGView(BrowserView):
+    """A simple browser view that renders the TG of its context
+    """
+
+    def __call__(self):
+        return str(ITG(self.context, u""))
diff --git a/src/plone/app/multilingual/tests/test_api.py b/src/plone/app/multilingual/tests/test_api.py
index 9776a65..e7d1ce0 100644
--- a/src/plone/app/multilingual/tests/test_api.py
+++ b/src/plone/app/multilingual/tests/test_api.py
@@ -3,6 +3,7 @@
 from Products.CMFCore.utils import getToolByName
 from plone.app.multilingual import api
 from Products.CMFPlone.interfaces import ILanguage
+from plone.app.multilingual.interfaces import ATTRIBUTE_NAME
 from plone.app.multilingual.interfaces import ITranslationIdChooser
 from plone.app.multilingual.interfaces import ITranslationLocator
 from plone.app.multilingual.interfaces import ITranslationManager
@@ -293,3 +294,13 @@ def test_locator(self):
 
         child_locator = ITranslationLocator(subfolder_ca)
         self.assertEqual(child_locator('es'), folder_es)
+
+    def test_tg_view(self):
+        a_ca = createContentInContainer(
+            self.portal['ca'],
+            'Document',
+            title=u"Test document"
+        )
+        tg = getattr(a_ca, ATTRIBUTE_NAME)
+        self.assertTrue(bool(tg))
+        self.assertEqual(a_ca.restrictedTraverse('@@tg')(), tg)


Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2017-03-09T18:43:35+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/380aa0c4f0b78e29445fed75e2d1a85249b87944

Merge pull request #261 from plone/datakurre-tg-view

Add '@@tg' view for accessing translation group of the object TTW

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/helper_views.py
M src/plone/app/multilingual/tests/test_api.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d4747d2..2e1734e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Add a new view ``@@tg`` for translatable content. It will return the
+  current translation group of the content, matching the bahavior of ``@@uuid``
+  of ``plone.app.uuid`` returning UUID of the content.  [datakurre]
 
 Bug fixes:
 
diff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml
index 6373c85..cbe747a 100644
--- a/src/plone/app/multilingual/browser/configure.zcml
+++ b/src/plone/app/multilingual/browser/configure.zcml
@@ -142,6 +142,14 @@
       permission="zope.Public"
       layer="..interfaces.IPloneAppMultilingualInstalled"/>
 
+  <!-- Translation Group -->
+  <browser:page
+      name="tg"
+      for="plone.app.multilingual.interfaces.ITranslatable"
+      class=".helper_views.TGView"
+      permission="zope.Public"
+      layer="..interfaces.IPloneAppMultilingualInstalled"/>
+
   <!-- Selector -->
   <browser:page
       name="multilingual-selector"
diff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py
index a379c45..34cd0a2 100644
--- a/src/plone/app/multilingual/browser/helper_views.py
+++ b/src/plone/app/multilingual/browser/helper_views.py
@@ -9,6 +9,7 @@
 from borg.localrole.interfaces import IFactoryTempFolder
 from plone.app.layout.navigation.interfaces import INavigationRoot
 from plone.app.multilingual.interfaces import IMultiLanguageExtraOptionsSchema
+from plone.app.multilingual.interfaces import ITG
 from plone.app.multilingual.browser.selector import NOT_TRANSLATED_YET_TEMPLATE
 from plone.app.multilingual.browser.selector import addQuery
 from plone.app.multilingual.interfaces import ILanguageRootFolder
@@ -278,3 +279,11 @@ def language_name(self, lang=None):
         if lang_info is None:
             return None
         return lang_info.get('native', None) or lang_info.get('name')
+
+
+class TGView(BrowserView):
+    """A simple browser view that renders the TG of its context
+    """
+
+    def __call__(self):
+        return str(ITG(self.context, u""))
diff --git a/src/plone/app/multilingual/tests/test_api.py b/src/plone/app/multilingual/tests/test_api.py
index 9776a65..e7d1ce0 100644
--- a/src/plone/app/multilingual/tests/test_api.py
+++ b/src/plone/app/multilingual/tests/test_api.py
@@ -3,6 +3,7 @@
 from Products.CMFCore.utils import getToolByName
 from plone.app.multilingual import api
 from Products.CMFPlone.interfaces import ILanguage
+from plone.app.multilingual.interfaces import ATTRIBUTE_NAME
 from plone.app.multilingual.interfaces import ITranslationIdChooser
 from plone.app.multilingual.interfaces import ITranslationLocator
 from plone.app.multilingual.interfaces import ITranslationManager
@@ -293,3 +294,13 @@ def test_locator(self):
 
         child_locator = ITranslationLocator(subfolder_ca)
         self.assertEqual(child_locator('es'), folder_es)
+
+    def test_tg_view(self):
+        a_ca = createContentInContainer(
+            self.portal['ca'],
+            'Document',
+            title=u"Test document"
+        )
+        tg = getattr(a_ca, ATTRIBUTE_NAME)
+        self.assertTrue(bool(tg))
+        self.assertEqual(a_ca.restrictedTraverse('@@tg')(), tg)


