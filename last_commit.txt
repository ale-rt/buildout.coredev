Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-04-05T15:36:25+02:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/44b71596f5ec014891674481017f90c6dee5a8f3

fix: related items to search for the whole site rather than from the navigation root only

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 88c4155..44b012f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix related items to search for the whole site rather than from the navigation root only.
+  [Gagaro]
 
 
 2.0.4 (2016-02-27)
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index f43bf08..6cf15de 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -121,7 +121,7 @@ def get_ajaxselect_options(context, value, separator, vocabulary_name,
 def get_relateditems_options(context, value, separator, vocabulary_name,
                              vocabulary_view, field_name=None):
     portal = get_portal()
-    options = get_ajaxselect_options(context, value, separator,
+    options = get_ajaxselect_options(portal, value, separator,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
     if IForm.providedBy(context):
@@ -144,10 +144,13 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
     options.setdefault('sort_on', 'sortable_title')
     options.setdefault('sort_order', 'ascending')
 
-    nav_root = getNavigationRootObject(context, get_portal())
-    options['rootPath'] = (
+    nav_root = getNavigationRootObject(context, portal)
+    options['basePath'] = (
         '/'.join(nav_root.getPhysicalPath()) if nav_root else '/'
     )
+    options['rootPath'] = (
+        '/'.join(portal.getPhysicalPath()) if portal else '/'
+    )
     return options
 
 


Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-04-06T01:40:17+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.widgets/commit/512516d91b8993f585d405d27e37d13c1d948369

Merge pull request #138 from plone/fix-relateditem-vocabularyurl

fix: related items to search for the whole site rather than from the navigation root only

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 88c4155..44b012f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix related items to search for the whole site rather than from the navigation root only.
+  [Gagaro]
 
 
 2.0.4 (2016-02-27)
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index f43bf08..6cf15de 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -121,7 +121,7 @@ def get_ajaxselect_options(context, value, separator, vocabulary_name,
 def get_relateditems_options(context, value, separator, vocabulary_name,
                              vocabulary_view, field_name=None):
     portal = get_portal()
-    options = get_ajaxselect_options(context, value, separator,
+    options = get_ajaxselect_options(portal, value, separator,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
     if IForm.providedBy(context):
@@ -144,10 +144,13 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
     options.setdefault('sort_on', 'sortable_title')
     options.setdefault('sort_order', 'ascending')
 
-    nav_root = getNavigationRootObject(context, get_portal())
-    options['rootPath'] = (
+    nav_root = getNavigationRootObject(context, portal)
+    options['basePath'] = (
         '/'.join(nav_root.getPhysicalPath()) if nav_root else '/'
     )
+    options['rootPath'] = (
+        '/'.join(portal.getPhysicalPath()) if portal else '/'
+    )
     return options
 
 


