Repository: mockup


Branch: refs/heads/2.1.x
Date: 2016-06-08T18:59:50+02:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/0e69d3afb46b0ae384a75f5ae4d2da16793a2b10

Escape input into select2 widget

Files changed:
M CHANGES.rst
M mockup/js/utils.js
M mockup/patterns/select2/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 6b259a6..168c729 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,9 @@ New:
 
 Fixes:
 
+- Escape input into select2 widget
+  [vangheem]
+
 
 2.1.4 (2016-03-31)
 ------------------
diff --git a/mockup/js/utils.js b/mockup/js/utils.js
index 90f83d8..2663678 100644
--- a/mockup/js/utils.js
+++ b/mockup/js/utils.js
@@ -324,6 +324,9 @@ define([
       history: function(){
         return !!(window.history && window.history.pushState);
       }
+    },
+    escapeHTML: function(val){
+      return $("<div/>").text(val).html();
     }
   };
 });
diff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js
index ef143ff..218694e 100644
--- a/mockup/patterns/select2/pattern.js
+++ b/mockup/patterns/select2/pattern.js
@@ -64,10 +64,11 @@
 define([
   'jquery',
   'pat-base',
+  'mockup-utils',
   'select2',
   'jquery.event.drag',
   'jquery.event.drop'
-], function($, Base) {
+], function($, Base, utils) {
   'use strict';
 
   var Select2 = Base.extend({
@@ -115,7 +116,7 @@ define([
             if (seldefaults[this]) {
               text = seldefaults[this];
             }
-            data.push({id: this, text: text});
+            data.push({id: utils.escapeHTML(this), text: utils.escapeHTML(text)});
           });
           callback(data);
         };
@@ -221,7 +222,8 @@ define([
           self.options.initSelection = function ($el, callback) {
             var data = [], value = $el.val();
             $(value.split(self.options.separator)).each(function () {
-              data.push({id: this, text: this});
+              var val = utils.escapeHTML(this);
+              data.push({id: val, text: val});
             });
             callback(data);
           };
@@ -249,6 +251,7 @@ define([
 
               var haveResult = queryTerm === '' || $.inArray(queryTerm, dataIds) >= 0;
               if (self.options.allowNewItems && !haveResult) {
+                queryTerm = utils.escapeHTML(queryTerm);
                 results.push({id: queryTerm, text: queryTerm});
               }
 


Repository: mockup


Branch: refs/heads/2.1.x
Date: 2016-06-08T23:17:21+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/mockup/commit/982503290487119cd6b06605327fd9329edb0891

Merge pull request #686 from plone/escape-html-2x

Escape html on 2.1.x

Files changed:
M CHANGES.rst
M mockup/js/utils.js
M mockup/patterns/select2/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 6b259a6..168c729 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,9 @@ New:
 
 Fixes:
 
+- Escape input into select2 widget
+  [vangheem]
+
 
 2.1.4 (2016-03-31)
 ------------------
diff --git a/mockup/js/utils.js b/mockup/js/utils.js
index 90f83d8..2663678 100644
--- a/mockup/js/utils.js
+++ b/mockup/js/utils.js
@@ -324,6 +324,9 @@ define([
       history: function(){
         return !!(window.history && window.history.pushState);
       }
+    },
+    escapeHTML: function(val){
+      return $("<div/>").text(val).html();
     }
   };
 });
diff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js
index ef143ff..218694e 100644
--- a/mockup/patterns/select2/pattern.js
+++ b/mockup/patterns/select2/pattern.js
@@ -64,10 +64,11 @@
 define([
   'jquery',
   'pat-base',
+  'mockup-utils',
   'select2',
   'jquery.event.drag',
   'jquery.event.drop'
-], function($, Base) {
+], function($, Base, utils) {
   'use strict';
 
   var Select2 = Base.extend({
@@ -115,7 +116,7 @@ define([
             if (seldefaults[this]) {
               text = seldefaults[this];
             }
-            data.push({id: this, text: text});
+            data.push({id: utils.escapeHTML(this), text: utils.escapeHTML(text)});
           });
           callback(data);
         };
@@ -221,7 +222,8 @@ define([
           self.options.initSelection = function ($el, callback) {
             var data = [], value = $el.val();
             $(value.split(self.options.separator)).each(function () {
-              data.push({id: this, text: this});
+              var val = utils.escapeHTML(this);
+              data.push({id: val, text: val});
             });
             callback(data);
           };
@@ -249,6 +251,7 @@ define([
 
               var haveResult = queryTerm === '' || $.inArray(queryTerm, dataIds) >= 0;
               if (self.options.allowNewItems && !haveResult) {
+                queryTerm = utils.escapeHTML(queryTerm);
                 results.push({id: queryTerm, text: queryTerm});
               }
 


