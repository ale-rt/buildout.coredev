Repository: plone.app.layout


Branch: refs/heads/2.3.x
Date: 2016-02-14T20:00:16+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.layout/commit/5901bd880f913fa9fc2e9ec00cd8f20c540e93b4

Fixed possible test failure comparing member objects.

Asking getAuthenticatedMember twice can result in two objects that are
not the same.  Fixed it by comparing only the resulting member id and
user name.

Files changed:
M CHANGES.rst
M plone/app/layout/globals/tests/test_portal.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 758a70d..30f7f94 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.3.14 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Fixed possible test failure by not comparing member objects, but
+  member ids and user names.  [maurits]
 
 
 2.3.13 (2015-04-30)
@@ -49,7 +50,7 @@ Changelog
 2.3.9 (2013-09-25)
 ------------------
 
-- Removed hard dependency on plone.app.relationfield. [pabo, marcosfromero] 
+- Removed hard dependency on plone.app.relationfield. [pabo, marcosfromero]
 
 
 2.3.8 (2013-09-16)
diff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py
index 1cb1cc2..ec9640e 100644
--- a/plone/app/layout/globals/tests/test_portal.py
+++ b/plone/app/layout/globals/tests/test_portal.py
@@ -96,7 +96,16 @@ def test_is_rtl(self):
         self.assertEquals(self.view.is_rtl(), True)
 
     def test_member(self):
-        self.assertEquals(self.view.member(), self.portal.portal_membership.getAuthenticatedMember())
+        # self.view.member() and
+        # self.portal.portal_membership.getAuthenticatedMember() used to be the
+        # same.  But now when I ask if
+        # self.portal.portal_membership.getAuthenticatedMember() is the same as
+        # self.portal.portal_membership.getAuthenticatedMember() the answer
+        # strangely is no.  So we check details.
+        view_member = self.view.member()
+        auth_member = self.portal.portal_membership.getAuthenticatedMember()
+        self.assertEquals(view_member.getId(), auth_member.getId())
+        self.assertEquals(view_member.getUserName(), auth_member.getUserName())
 
     def test_anonymous(self):
         self.assertEquals(self.view.anonymous(), False)


